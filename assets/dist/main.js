!function(){function e(e,t,n,i){Object.defineProperty(e,t,{get:n,set:i,enumerable:!0,configurable:!0})}var t,n,i,r,a,s,o,l,u,c,h,d,f,v,g,m,p,y,E,k,b,T,S,_,A,L,w,I,R,D,C,x,P="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};function O(e){return e&&e.__esModule?e.default:e}var M={},F={},N=P.parcelRequire94c2;null==N&&((N=function(e){if(e in M)return M[e].exports;if(e in F){var t=F[e];delete F[e];var n={id:e,exports:{}};return M[e]=n,t.call(n.exports,n,n.exports),n.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){F[e]=t},P.parcelRequire94c2=N);var B=N.register;function U(e,t,n,i,r,a,s){try{var o=e[a](s),l=o.value}catch(e){n(e);return}o.done?t(l):Promise.resolve(l).then(i,r)}function j(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){var a=e.apply(t,n);function s(e){U(a,i,r,s,o,"next",e)}function o(e){U(a,i,r,s,o,"throw",e)}s(void 0)})}}B("gkaGM",function(e,t){var n,i,r,a,s,o,l,u,c,h,d,f,v,g,m,p,y=N("375Sc"),E=N("6M8s5"),k=N("8ro5P"),b=N("eh14X"),T=N("fd2TQ"),S=N("drHcY"),_=N("3w2eu"),A=N("1Zvtp"),L=N("l9etm"),w=N("16gB1"),I=N("lA74D"),R=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},D=Number.isSafeInteger||function(e){return"number"==typeof e&&Math.abs(e)<=C},C=Number.MAX_SAFE_INTEGER||0x1fffffffffffff,x=((o={}).NETWORK_ERROR="networkError",o.MEDIA_ERROR="mediaError",o.KEY_SYSTEM_ERROR="keySystemError",o.MUX_ERROR="muxError",o.OTHER_ERROR="otherError",o),P=((l={}).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",l.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",l.KEY_SYSTEM_NO_SESSION="keySystemNoSession",l.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",l.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",l.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",l.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",l.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",l.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",l.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",l.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",l.MANIFEST_LOAD_ERROR="manifestLoadError",l.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",l.MANIFEST_PARSING_ERROR="manifestParsingError",l.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",l.LEVEL_EMPTY_ERROR="levelEmptyError",l.LEVEL_LOAD_ERROR="levelLoadError",l.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",l.LEVEL_PARSING_ERROR="levelParsingError",l.LEVEL_SWITCH_ERROR="levelSwitchError",l.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",l.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",l.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",l.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",l.FRAG_LOAD_ERROR="fragLoadError",l.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",l.FRAG_DECRYPT_ERROR="fragDecryptError",l.FRAG_PARSING_ERROR="fragParsingError",l.FRAG_GAP="fragGap",l.REMUX_ALLOC_ERROR="remuxAllocError",l.KEY_LOAD_ERROR="keyLoadError",l.KEY_LOAD_TIMEOUT="keyLoadTimeOut",l.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",l.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",l.BUFFER_APPEND_ERROR="bufferAppendError",l.BUFFER_APPENDING_ERROR="bufferAppendingError",l.BUFFER_STALLED_ERROR="bufferStalledError",l.BUFFER_FULL_ERROR="bufferFullError",l.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",l.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",l.ASSET_LIST_LOAD_ERROR="assetListLoadError",l.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",l.ASSET_LIST_PARSING_ERROR="assetListParsingError",l.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",l.INTERNAL_EXCEPTION="internalException",l.INTERNAL_ABORTED="aborted",l.ATTACH_MEDIA_ERROR="attachMediaError",l.UNKNOWN="unknown",l),O=((u={}).MEDIA_ATTACHING="hlsMediaAttaching",u.MEDIA_ATTACHED="hlsMediaAttached",u.MEDIA_DETACHING="hlsMediaDetaching",u.MEDIA_DETACHED="hlsMediaDetached",u.MEDIA_ENDED="hlsMediaEnded",u.STALL_RESOLVED="hlsStallResolved",u.BUFFER_RESET="hlsBufferReset",u.BUFFER_CODECS="hlsBufferCodecs",u.BUFFER_CREATED="hlsBufferCreated",u.BUFFER_APPENDING="hlsBufferAppending",u.BUFFER_APPENDED="hlsBufferAppended",u.BUFFER_EOS="hlsBufferEos",u.BUFFERED_TO_END="hlsBufferedToEnd",u.BUFFER_FLUSHING="hlsBufferFlushing",u.BUFFER_FLUSHED="hlsBufferFlushed",u.MANIFEST_LOADING="hlsManifestLoading",u.MANIFEST_LOADED="hlsManifestLoaded",u.MANIFEST_PARSED="hlsManifestParsed",u.LEVEL_SWITCHING="hlsLevelSwitching",u.LEVEL_SWITCHED="hlsLevelSwitched",u.LEVEL_LOADING="hlsLevelLoading",u.LEVEL_LOADED="hlsLevelLoaded",u.LEVEL_UPDATED="hlsLevelUpdated",u.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",u.LEVELS_UPDATED="hlsLevelsUpdated",u.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",u.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",u.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",u.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",u.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",u.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",u.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",u.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",u.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",u.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",u.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",u.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",u.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",u.CUES_PARSED="hlsCuesParsed",u.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",u.INIT_PTS_FOUND="hlsInitPtsFound",u.FRAG_LOADING="hlsFragLoading",u.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",u.FRAG_LOADED="hlsFragLoaded",u.FRAG_DECRYPTED="hlsFragDecrypted",u.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",u.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",u.FRAG_PARSING_METADATA="hlsFragParsingMetadata",u.FRAG_PARSED="hlsFragParsed",u.FRAG_BUFFERED="hlsFragBuffered",u.FRAG_CHANGED="hlsFragChanged",u.FPS_DROP="hlsFpsDrop",u.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",u.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",u.ERROR="hlsError",u.DESTROYING="hlsDestroying",u.KEY_LOADING="hlsKeyLoading",u.KEY_LOADED="hlsKeyLoaded",u.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",u.BACK_BUFFER_REACHED="hlsBackBufferReached",u.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",u.ASSET_LIST_LOADING="hlsAssetListLoading",u.ASSET_LIST_LOADED="hlsAssetListLoaded",u.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",u.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",u.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",u.INTERSTITIAL_STARTED="hlsInterstitialStarted",u.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",u.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",u.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",u.INTERSTITIAL_ENDED="hlsInterstitialEnded",u.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",u.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",u.EVENT_CUE_ENTER="hlsEventCueEnter",u),M="manifest",F="level",B="audioTrack",U="subtitleTrack",j="main",G="audio",K="subtitle",H=function(){"use strict";function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,E._)(this,e),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=n,this.totalWeight_=i}return(0,k._)(e,[{key:"sample",value:function(e,t){var n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}]),e}(),V=function(){"use strict";function e(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;(0,E._)(this,e),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new H(t),this.fast_=new H(n),this.defaultTTFB_=r,this.ttfb_=new H(t)}return(0,k._)(e,[{key:"update",value:function(e,t){var n=this.slow_,i=this.fast_,r=this.ttfb_;n.halfLife!==e&&(this.slow_=new H(e,n.getEstimate(),n.getTotalWeight())),i.halfLife!==t&&(this.fast_=new H(t,i.getEstimate(),i.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new H(e,r.getEstimate(),r.getTotalWeight()))}},{key:"sample",value:function(e,t){var n=(e=Math.max(e,this.minDelayMs_))/1e3,i=8*t/n;this.fast_.sample(n,i),this.slow_.sample(n,i)}},{key:"sampleTTFB",value:function(e){var t=Math.sqrt(2)*Math.exp(-Math.pow(e/1e3,2)/2);this.ttfb_.sample(t,Math.max(e,5))}},{key:"canEstimate",value:function(){return this.fast_.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"getEstimateTTFB",value:function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}},{key:"defaultEstimate",get:function(){return this.defaultEstimate_}},{key:"destroy",value:function(){}}]),e}();function q(){return(q=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(null,arguments)}function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(n),!0).forEach(function(t){var i,r;i=t,r=n[t],(i=function(e){var t=function(e,t){if("object"!=(void 0===e?"undefined":(0,w._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=(void 0===i?"undefined":(0,w._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,w._)(t))?t:t+""}(i))in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var z=function e(t,n){"use strict";(0,E._)(this,e),this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;var i="[".concat(t,"]:");this.trace=X,this.debug=n.debug.bind(null,i),this.log=n.log.bind(null,i),this.warn=n.warn.bind(null,i),this.info=n.info.bind(null,i),this.error=n.error.bind(null,i)},X=function(){},Q={trace:X,debug:X,log:X,warn:X,info:X,error:X};function $(){return q({},Q)}function Z(e,t,n){var i;return t[e]?t[e].bind(t):(i=self.console[e])?i.bind(self.console,"".concat(n?"["+n+"] ":"","[").concat(e,"] >")):X}var J=$();function ee(){var e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if("undefined"!=typeof self)return(e||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function et(e,t){var n=Object.keys(e),i=Object.keys(t),r=n.length,a=i.length;return!r||!a||r===a&&!n.some(function(e){return -1===i.indexOf(e)})}function en(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("undefined"!=typeof TextDecoder){var r=new TextDecoder("utf-8").decode(e);if(i){var a=r.indexOf("\0");return -1!==a?r.substring(0,a):r}return r.replace(/\0/g,"")}for(var s=e.length,o="",l=0;l<s&&(0!==(t=e[l++])||!i);)if(0!==t&&3!==t)switch(t>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(t);break;case 12:case 13:o+=String.fromCharCode((31&t)<<6|63&(n=e[l++]));break;case 14:o+=String.fromCharCode((15&t)<<12|(63&(n=e[l++]))<<6|63&e[l++])}return o}function ei(e){for(var t="",n=0;n<e.length;n++){var i=e[n].toString(16);i.length<2&&(i="0"+i),t+=i}return t}function er(e){return Uint8Array.from(e.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var ea={exports:{}},es=v?ea.exports:(v=1,n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,ea.exports=s={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),!(t=t.trim())){if(!n.alwaysNormalize)return e;var r=s.parseURL(e);if(!r)throw Error("Error trying to parse base URL.");return r.path=s.normalizePath(r.path),s.buildURLFromParts(r)}var a=s.parseURL(t);if(!a)throw Error("Error trying to parse relative URL.");if(a.scheme)return n.alwaysNormalize?(a.path=s.normalizePath(a.path),s.buildURLFromParts(a)):t;var o=s.parseURL(e);if(!o)throw Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=i.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var u={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(u.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var c=o.path,h=c.substring(0,c.lastIndexOf("/")+1)+a.path;u.path=s.normalizePath(h)}else u.path=o.path,!a.params&&(u.params=o.params,a.query||(u.query=o.query));return null===u.path&&(u.path=n.alwaysNormalize?s.normalizePath(a.path):a.path),s.buildURLFromParts(u)},parseURL:function(e){var t=n.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(r,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},ea.exports),eo=function e(){"use strict";(0,E._)(this,e),this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},el="audio",eu="video",ec="audiovideo",eh=function(){"use strict";function e(t){var n,i,r;(0,E._)(this,e),this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,"string"==typeof t&&(t={url:t}),this.base=t,n=this,(r=function e(t,n){var i=Object.getPrototypeOf(t);if(i){var r=Object.getOwnPropertyDescriptor(i,n);return r||e(i,n)}}(n,i="stats"))&&(r.enumerable=!0,Object.defineProperty(n,i,r))}return(0,k._)(e,[{key:"setByteRange",value:function(e,t){var n,i=e.split("@",2);n=1===i.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(i[1]),this._byteRange=[n,parseInt(i[0])+n]}},{key:"baseurl",get:function(){return this.base.url}},{key:"byteRange",get:function(){return null===this._byteRange?[]:this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"elementaryStreams",get:function(){var e;return null===this._streams&&(this._streams=(e={},(0,b._)(e,el,null),(0,b._)(e,eu,null),(0,b._)(e,ec,null),e)),this._streams},set:function(e){this._streams=e}},{key:"hasStats",get:function(){return null!==this._stats}},{key:"hasStreams",get:function(){return null!==this._streams}},{key:"stats",get:function(){return null===this._stats&&(this._stats=new eo),this._stats},set:function(e){this._stats=e}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=es.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}},{key:"clearElementaryStreamInfo",value:function(){var e=this.elementaryStreams;e[el]=null,e[eu]=null,e[ec]=null}}]),e}();function ed(e){return"initSegment"!==e.sn}var ef=function(e){"use strict";function t(e,n){var i;return(0,E._)(this,t),(i=(0,y._)(this,t,[n]))._decryptdata=null,i._programDateTime=null,i._ref=null,i._bitrate=void 0,i.rawProgramDateTime=null,i.tagList=[],i.duration=0,i.sn=0,i.levelkeys=void 0,i.type=void 0,i.loader=null,i.keyLoader=null,i.level=-1,i.cc=0,i.startPTS=void 0,i.endPTS=void 0,i.startDTS=void 0,i.endDTS=void 0,i.start=0,i.playlistOffset=0,i.deltaPTS=void 0,i.maxStartPTS=void 0,i.minEndPTS=void 0,i.data=void 0,i.bitrateTest=!1,i.title=null,i.initSegment=null,i.endList=void 0,i.gap=void 0,i.urlId=0,i.type=e,i}return(0,_._)(t,e),(0,k._)(t,[{key:"byteLength",get:function(){if(this.hasStats){var e=this.stats.total;if(e)return e}if(this.byteRange.length){var t=this.byteRange[0],n=this.byteRange[1];if(R(t)&&R(n))return n-t}return null}},{key:"bitrate",get:function(){return this.byteLength?8*this.byteLength/this.duration:this._bitrate?this._bitrate:null},set:function(e){this._bitrate=e}},{key:"decryptdata",get:function(){var e,t=this.levelkeys;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!(null!=(e=this._decryptdata)&&e.keyId)){var n=Object.keys(t);if(1===n.length){var i=this._decryptdata=t[n[0]]||null;i&&(this._decryptdata=i.getDecryptData(this.sn,t))}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;var e=R(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){var t,n=Object.keys(this.levelkeys),i=n.length;if(i>1||1===i&&null!=(t=this.levelkeys[n[0]])&&t.encrypted)return!0}return!1}},{key:"programDateTime",get:function(){return null===this._programDateTime&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime},set:function(e){if(!R(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}},{key:"ref",get:function(){return ed(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}},{key:"addStart",value:function(e){this.setStart(this.start+e)}},{key:"setStart",value:function(e){this.start=e,this._ref&&(this._ref.start=e)}},{key:"setDuration",value:function(e){this.duration=e,this._ref&&(this._ref.duration=e)}},{key:"setKeyFormat",value:function(e){var t=this.levelkeys;if(t){var n,i=t[e];i&&!(null!=(n=this._decryptdata)&&n.keyId)&&(this._decryptdata=i.getDecryptData(this.sn,t))}}},{key:"abortRequests",value:function(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}},{key:"setElementaryStreamInfo",value:function(e,t,n,i,r){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=this.elementaryStreams,o=s[e];if(!o){s[e]={startPTS:t,endPTS:n,startDTS:i,endDTS:r,partial:a};return}o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,n),o.startDTS=Math.min(o.startDTS,i),o.endDTS=Math.max(o.endDTS,r)}}]),t}(eh),ev=function(e){"use strict";function t(e,n,i,r,a){(0,E._)(this,t),(s=(0,y._)(this,t,[i])).fragOffset=0,s.duration=0,s.gap=!1,s.independent=!1,s.relurl=void 0,s.fragment=void 0,s.index=void 0,s.duration=e.decimalFloatingPoint("DURATION"),s.gap=e.bool("GAP"),s.independent=e.bool("INDEPENDENT"),s.relurl=e.enumeratedString("URI"),s.fragment=n,s.index=r;var s,o=e.enumeratedString("BYTERANGE");return o&&s.setByteRange(o,a),a&&(s.fragOffset=a.fragOffset+a.duration),s}return(0,_._)(t,e),(0,k._)(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var e=this.elementaryStreams;return!!(e.audio||e.video||e.audiovideo)}}]),t}(eh),eg=[].push,em={video:1,audio:2,id3:3,text:4};function ep(e){return String.fromCharCode.apply(null,e)}function ey(e,t){var n=e[t]<<8|e[t+1];return n<0?65536+n:n}function eE(e,t){var n=eb(e,t);return n<0?0x100000000+n:n}function ek(e,t){var n=eE(e,t);return n*=0x100000000,n+=eE(e,t+4)}function eb(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function eT(e,t){var n=[];if(!t.length)return n;for(var i=e.byteLength,r=0;r<i;){var a=eE(e,r),s=ep(e.subarray(r+4,r+8)),o=a>1?r+a:i;if(s===t[0])if(1===t.length)n.push(e.subarray(r+8,o));else{var l=eT(e.subarray(r+8,o),t.slice(1));l.length&&eg.apply(n,l)}r=o}return n}function eS(e){for(var t=[],n=eT(e,["moov","trak"]),i=0;i<n.length;i++){var r=n[i],a=eT(r,["tkhd"])[0];if(a){var s=a[0],o=eE(a,0===s?12:20),l=eT(r,["mdia","mdhd"])[0];if(l){s=l[0];var u=eE(l,0===s?12:20),c=eT(r,["mdia","hdlr"])[0];if(c){var h=ep(c.subarray(8,12)),d={soun:el,vide:eu}[h],f=function(e){var t,n=e.subarray(8),i=n.subarray(86),r=ep(n.subarray(4,8)),a=r,s="enca"===r||"encv"===r;if(s){var o=eT(n,[r])[0].subarray("enca"===r?28:78);eT(o,["sinf"]).forEach(function(e){var t=eT(e,["schm"])[0];if(t){var n=ep(t.subarray(4,8));if("cbcs"===n||"cenc"===n){var i=eT(e,["frma"])[0];i&&(a=ep(i))}}})}var l=a;switch(a){case"avc1":case"avc2":case"avc3":case"avc4":var u=eT(i,["avcC"])[0];u&&u.length>3&&(a+="."+eL(u[1])+eL(u[2])+eL(u[3]),t=e_("avc1"===l?"dva1":"dvav",i));break;case"mp4a":var c=eT(n,[r])[0],h=eT(c.subarray(28),["esds"])[0];if(h&&h.length>7){var d=4;if(3!==h[d++])break;d=eA(h,d)+2;var f=h[d++];if(128&f&&(d+=2),64&f&&(d+=h[d++]),4!==h[d++])break;d=eA(h,d);var v=h[d++];if(64===v)a+="."+eL(v);else break;if(d+=12,5!==h[d++])break;d=eA(h,d);var g=h[d++],m=(248&g)>>3;31===m&&(m+=1+((7&g)<<3)+((224&h[d])>>5)),a+="."+m}break;case"hvc1":case"hev1":var p=eT(i,["hvcC"])[0];if(p&&p.length>12){var y=p[1],E=["","A","B","C"][y>>6],k=eE(p,2),b=p[12],T=p.subarray(6,12);a+="."+E+(31&y),a+="."+(function(e){for(var t=0,n=0;n<32;n++)t|=(e>>n&1)<<31-n;return t>>>0})(k).toString(16).toUpperCase(),a+="."+((32&y)>>5?"H":"L")+b;for(var S="",_=T.length;_--;){var A=T[_];(A||S)&&(S="."+A.toString(16).toUpperCase()+S)}a+=S}t=e_("hev1"==l?"dvhe":"dvh1",i);break;case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":a=e_(a,i)||a;break;case"vp09":var L=eT(i,["vpcC"])[0];if(L&&L.length>6){var w=L[4],I=L[5],R=L[6]>>4&15;a+="."+ew(w)+"."+ew(I)+"."+ew(R)}break;case"av01":var D=eT(i,["av1C"])[0];if(D&&D.length>2){var C=D[1]>>>5,x=31&D[1],P=D[2]>>>7?"H":"M",O=(64&D[2])>>6,M=(32&D[2])>>5,F=(16&D[2])>>4,N=(8&D[2])>>3,B=(4&D[2])>>2,U=3&D[2];a+="."+C+"."+ew(x)+P+"."+ew(2===C&&O?M?12:10:O?10:8)+"."+F+"."+N+B+U+"."+ew(1)+"."+ew(1)+"."+ew(1)+".0",t=e_("dav1",i)}}return{codec:a,encrypted:s,supplemental:t}}(eT(r,["mdia","minf","stbl","stsd"])[0]);d?(t[o]={timescale:u,type:d,stsd:f},t[d]=W({timescale:u,id:o},f)):t[o]={timescale:u,type:h,stsd:f}}}}}return eT(e,["moov","mvex","trex"]).forEach(function(e){var n=t[eE(e,4)];n&&(n.default={duration:eE(e,12),flags:eE(e,20)})}),t}function e_(e,t){var n=eT(t,["dvvC"]),i=n.length?n[0]:eT(t,["dvcC"])[0];if(i){var r=i[2]>>1&127,a=i[2]<<5&32|i[3]>>3&31;return e+"."+ew(r)+"."+ew(a)}}function eA(e,t){for(var n=t+5;128&e[t++]&&t<n;);return t}function eL(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function ew(e){return(e<10?"0":"")+e}function eI(e,t){eT(e,["moov","trak"]).forEach(function(e){var n=eT(e,["mdia","minf","stbl","stsd"])[0];if(n){var i=n.subarray(8),r=eT(i,["enca"]),a=r.length>0;a||(r=eT(i,["encv"])),r.forEach(function(e){eT(a?e.subarray(28):e.subarray(78),["sinf"]).forEach(function(e){var n=eR(e);n&&t(n,a)})})}})}function eR(e){var t=eT(e,["schm"])[0];if(t){var n=ep(t.subarray(4,8));if("cbcs"===n||"cenc"===n){var i=eT(e,["schi","tenc"])[0];if(i)return i}}}function eD(e,t){var n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function eC(e,t){var n=[],i=t.samples,r=t.timescale,a=t.id,s=!1;return eT(i,["moof"]).map(function(o){var l=o.byteOffset-8;eT(o,["traf"]).map(function(o){var u=eT(o,["tfdt"]).map(function(e){var t=e[0],n=eE(e,4);return 1===t&&(n*=0x100000000,n+=eE(e,8)),n/r})[0];return void 0!==u&&(e=u),eT(o,["tfhd"]).map(function(u){var c=eE(u,4),h=0xffffff&eE(u,0),d=0,f=0,v=8;c===a&&((1&h)!=0&&(v+=8),(2&h)!=0&&(v+=4),(8&h)!=0&&(d=eE(u,v),v+=4),(16&h)!=0&&(f=eE(u,v),v+=4),(32&h)!=0&&(v+=4),"video"===t.type&&(s=ex(t.codec)),eT(o,["trun"]).map(function(a){var o=a[0],u=0xffffff&eE(a,0),c=0,h=(256&u)!=0,v=0,g=(512&u)!=0,m=0,p=(1024&u)!=0,y=(2048&u)!=0,E=0,k=eE(a,4),b=8;(1&u)!=0&&(c=eE(a,b),b+=4),(4&u)!=0&&(b+=4);for(var T=c+l,S=0;S<k;S++){if(h?(v=eE(a,b),b+=4):v=d,g?(m=eE(a,b),b+=4):m=f,p&&(b+=4),y&&(E=0===o?eE(a,b):eb(a,b),b+=4),t.type===eu)for(var _=0;_<m;){var A=eE(i,T);T+=4,function(e,t){if(!e)return 6==(31&t);var n=t>>1&63;return 39===n||40===n}(s,i[T])&&eP(i.subarray(T,T+A),s?2:1,e+E/r,n),T+=A,_+=A+4}e+=v/r}}))})})}),n}function ex(e){if(!e)return!1;var t=e.substring(0,4);return"hvc1"===t||"hev1"===t||"dvh1"===t||"dvhe"===t}function eP(e,t,n,i){var r,a=eO(e);r=0+t;for(var s=0,o=0,l=0;r<a.length;){s=0;do{if(r>=a.length)break;s+=l=a[r++]}while(255===l)o=0;do{if(r>=a.length)break;o+=l=a[r++]}while(255===l)var u=a.length-r,c=r;if(o<u)r+=o;else if(o>u){J.error("Malformed SEI payload. ".concat(o," is too small, only ").concat(u," bytes left to parse."));break}if(4===s){if(181===a[c++]){var h=ey(a,c);if(c+=2,49===h){var d=eE(a,c);if(c+=4,0x47413934===d){var f=a[c++];if(3===f){var v=a[c++],g=31&v,m=64&v,p=m?2+3*g:0,y=new Uint8Array(p);if(m){y[0]=v;for(var E=1;E<p;E++)y[E]=a[c++]}i.push({type:f,payloadType:s,pts:n,bytes:y})}}}}}else if(5===s&&o>16){for(var k=[],b=0;b<16;b++){var T=a[c++].toString(16);k.push(1==T.length?"0"+T:T),(3===b||5===b||7===b||9===b)&&k.push("-")}for(var S=o-16,_=new Uint8Array(S),A=0;A<S;A++)_[A]=a[c++];i.push({payloadType:s,pts:n,uuid:k.join(""),userData:en(_),userDataBytes:_})}}}function eO(e){for(var t=e.byteLength,n=[],i=1;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(n.push(i+2),i+=2):i++;if(0===n.length)return e;var r=t-n.length,a=new Uint8Array(r),s=0;for(i=0;i<r;s++,i++)s===n[0]&&(s++,n.shift()),a[i]=e[s];return a}var eM=function(){return/\(Windows.+Firefox\//i.test(navigator.userAgent)},eF={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function eN(e,t){var n=eF[t];return!!n&&!!n[e.slice(0,4)]}function eB(e,t){var n=!(arguments.length>2)||void 0===arguments[2]||arguments[2];return!e.split(",").some(function(e){return!eU(e,t,n)})}function eU(e,t){var n,i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],r=ee(i);return null!=(n=null==r?void 0:r.isTypeSupported(ej(e,t)))&&n}function ej(e,t){return"".concat(t,"/mp4;codecs=").concat(e)}function eG(e){if(e){var t=e.substring(0,4);return eF.video[t]}return 2}function eK(e){var t=eM();return e.split(",").reduce(function(e,n){var i=t&&ex(n)?9:eF.video[n];return i?(2*i+e)/(e?3:2):(eF.audio[n]+e)/(e?2:1)},0)}var eH={},eV=/flac|opus|mp4a\.40\.34/i;function eq(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return e.replace(eV,function(e){return function(e){var t,n=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(eH[e])return eH[e];for(var i={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[e],r=0;r<i.length;r++){if(eU(i[r],"audio",n))return eH[e]=i[r],i[r];if("mp3"===i[r]&&null!=(t=ee(n))&&t.isTypeSupported("audio/mpeg"))return""}return e}(e.toLowerCase(),t)})}function eY(e,t){if(e&&(e.length>4||-1!==["ac-3","ec-3","alac","fLaC","Opus"].indexOf(e))&&(eW(e,"audio")||eW(e,"video")))return e;if(t){var n=t.split(",");if(n.length>1){if(e){for(var i=n.length;i--;)if(n[i].substring(0,4)===e.substring(0,4))return n[i]}return n[0]}}return t||e}function eW(e,t){return eN(e,t)&&eU(e,t)}function ez(e){var t=ee(e)||{isTypeSupported:function(){return!1}};return{mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:t.isTypeSupported('audio/mp4; codecs="ac-3"')}}function eX(e){return e.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}var eQ={supported:!1,smooth:!1,powerEfficient:!1},e$={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function eZ(e,t){return{supported:!1,configurations:t,decodingInfoResults:[eQ],error:e}}function eJ(e,t,n){var i,r,a,s,o,l,u,c,h,d,f,v,g,m,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},y=e.videoCodec;if(!y&&!e.audioCodec||!n)return Promise.resolve(e$);for(var E=[],k=(a=null==(r=(i=e).videoCodec)?void 0:r.split(","),s=e0(i),o=i.width||640,l=i.height||480,u=i.frameRate||30,c=i.videoRange.toLowerCase(),a?a.map(function(e){var t={contentType:ej(function(e){if(e.startsWith("av01.")){for(var t=e.split("."),n=["0","111","01","01","01","0"],i=t.length;i>4&&i<10;i++)t[i]=n[i-4];return t.join(".")}return e}(e),"video"),width:o,height:l,bitrate:s,framerate:u};return"sdr"!==c&&(t.transferFunction=c),t}):[]),b=k.length,T=(h=e,d=t,f=b>0,g=null==(v=h.audioCodec)?void 0:v.split(","),m=e0(h),g&&h.audioGroups?h.audioGroups.reduce(function(e,t){var n,i=t?null==(n=d.groups[t])?void 0:n.tracks:null;return i?i.reduce(function(e,n){if(n.groupId===t){var i=parseFloat(n.channels||"");g.forEach(function(t){var n={contentType:ej(t,"audio"),bitrate:f?function(e,t){if(t<=1)return 1;var n=128e3;return"ec-3"===e?n=768e3:"ac-3"===e&&(n=64e4),Math.min(t/2,n)}(t,m):m};i&&(n.channels=""+i),e.push(n)})}return e},e):e},[]):[]),S=T.length,_=b||+S||1;_--;){var A={type:"media-source"};if(b&&(A.video=k[_%b]),S){A.audio=T[_%S];var L=A.audio.bitrate;A.video&&L&&(A.video.bitrate-=L)}E.push(A)}if(y){var w=navigator.userAgent;if(y.split(",").some(function(e){return ex(e)})&&eM())return Promise.resolve(eZ(Error("Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (".concat(w,")")),E))}return Promise.all(E.map(function(e){var t=function(e){var t="",n=e.audio,i=e.video;if(i){var r=eX(i.contentType);t+="".concat(r,"_r").concat(i.height,"x").concat(i.width,"f").concat(Math.ceil(i.framerate)).concat(i.transferFunction||"sd","_").concat(Math.ceil(i.bitrate/1e5))}if(n){var a=eX(n.contentType);t+="".concat(i?"_":"").concat(a,"_c").concat(n.channels)}return t}(e);return p[t]||(p[t]=n.decodingInfo(e))})).then(function(e){return{supported:!e.some(function(e){return!e.supported}),configurations:E,decodingInfoResults:e}}).catch(function(e){return{supported:!1,configurations:E,decodingInfoResults:[],error:e}})}function e0(e){return 1e3*Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)/1e3)||1}var e1=["NONE","TYPE-0","TYPE-1",null],e2=["SDR","PQ","HLG"];function e3(e){var t=e.canSkipUntil,n=e.canSkipDateRanges,i=e.age;return t&&i<t/2?n?"v2":"YES":""}var e5=function(){"use strict";function e(t,n,i){(0,E._)(this,e),this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=n,this.skip=i}return(0,k._)(e,[{key:"addDirectives",value:function(e){var t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}]),e}(),e4=function(){"use strict";function e(t){if((0,E._)(this,e),this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[t.url],this._attrs=[t.attrs],this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.frameRate=t.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=t.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.codecSet=[t.videoCodec,t.audioCodec].filter(function(e){return!!e}).map(function(e){return e.substring(0,4)}).join(","),"supplemental"in t){this.supplemental=t.supplemental;var n,i=null==(n=t.supplemental)?void 0:n.videoCodec;i&&i!==t.videoCodec&&(this.codecSet+=",".concat(i.substring(0,4)))}this.addGroupId("audio",t.attrs.AUDIO),this.addGroupId("text",t.attrs.SUBTITLES)}return(0,k._)(e,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"averageBitrate",get:function(){return this._avgBitrate||this.realBitrate||this.bitrate}},{key:"attrs",get:function(){return this._attrs[0]}},{key:"codecs",get:function(){return this.attrs.CODECS||""}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"videoRange",get:function(){return this.attrs["VIDEO-RANGE"]||"SDR"}},{key:"score",get:function(){return this.attrs.optionalFloat("SCORE",0)}},{key:"uri",get:function(){return this.url[0]||""}},{key:"hasAudioGroup",value:function(e){return e8(this._audioGroups,e)}},{key:"hasSubtitleGroup",value:function(e){return e8(this._subtitleGroups,e)}},{key:"audioGroups",get:function(){return this._audioGroups}},{key:"subtitleGroups",get:function(){return this._subtitleGroups}},{key:"addGroupId",value:function(e,t){if(t){if("audio"===e){var n=this._audioGroups;n||(n=this._audioGroups=[]),-1===n.indexOf(t)&&n.push(t)}else if("text"===e){var i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),-1===i.indexOf(t)&&i.push(t)}}}},{key:"urlId",get:function(){return 0},set:function(e){}},{key:"audioGroupIds",get:function(){return this.audioGroups?[this.audioGroupId]:void 0}},{key:"textGroupIds",get:function(){return this.subtitleGroups?[this.textGroupId]:void 0}},{key:"audioGroupId",get:function(){var e;return null==(e=this.audioGroups)?void 0:e[0]}},{key:"textGroupId",get:function(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}},{key:"addFallback",value:function(){}}]),e}();function e8(e,t){return!!t&&!!e&&-1!==e.indexOf(t)}var e6=function(e){var t=new WeakSet;return function(n,i){if(e&&(i=e(n,i)),(void 0===i?"undefined":(0,w._)(i))==="object"&&null!==i){if(t.has(i))return;t.add(i)}return i}},e9=function(e,t){return JSON.stringify(e,e6(t))};function e7(e,t){J.log('[abr] start candidates with "'.concat(e,'" ignored because ').concat(t))}function te(e){return e.reduce(function(e,t){var n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);var i=t.channels||"2";return n.channels[i]=(n.channels[i]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function tt(e){return e?{lang:e.lang,assocLang:e.assocLang,characteristics:e.characteristics,channels:e.channels,audioCodec:e.audioCodec}:e}function tn(e,t,n){if("attrs"in e){var i=t.indexOf(e);if(-1!==i)return i}for(var r=0;r<t.length;r++)if(ti(e,t[r],n))return r;return -1}function ti(e,t,n){var i=e.groupId,r=e.name,a=e.lang,s=e.assocLang,o=e.default,l=e.forced;return(void 0===i||t.groupId===i)&&(void 0===r||t.name===r)&&(void 0===a||function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"--";return e.length===t.length?e===t:e.startsWith(t)||t.startsWith(e)}(a,t.lang))&&(void 0===a||t.assocLang===s)&&(void 0===o||t.default===o)&&(void 0===l||t.forced===l)&&(!("characteristics"in e)||function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.split(","),i=t.split(",");return n.length===i.length&&!n.some(function(e){return -1===i.indexOf(e)})}(e.characteristics||"",t.characteristics))&&(void 0===n||n(e,t))}function tr(e,t){var n=e.audioCodec,i=e.channels;return(void 0===n||(t.audioCodec||"").substring(0,4)===n.substring(0,4))&&(void 0===i||i===(t.channels||"2"))}function ta(e,t,n){for(var i=t;i>-1;i--)if(n(e[i]))return i;for(var r=t+1;r<e.length;r++)if(n(e[r]))return r;return -1}function ts(e,t){var n;return!!e&&e!==(null==(n=t.loadLevelObj)?void 0:n.uri)}var to=function(e){"use strict";function t(e){var n;return(0,E._)(this,t),(n=(0,y._)(this,t,["abr",e.logger])).hls=void 0,n.lastLevelLoadSec=0,n.lastLoadedFragLevel=-1,n.firstSelection=-1,n._nextAutoLevel=-1,n.nextAutoLevelKey="",n.audioTracksByGroup=null,n.codecTiers=null,n.timer=-1,n.fragCurrent=null,n.partCurrent=null,n.bitrateTestDelay=0,n.rebufferNotice=-1,n.supportedCache={},n.bwEstimator=void 0,n._abandonRulesCheck=function(e){var t,i,r=n.fragCurrent,a=n.partCurrent,s=n.hls,o=s.autoLevelEnabled,l=s.media;if(!r||!l)return;var u=performance.now(),c=a?a.stats:r.stats,h=a?a.duration:r.duration,d=u-c.loading.start,f=s.minAutoLevel,v=r.level,g=n._nextAutoLevel;if(c.aborted||c.loaded&&c.loaded===c.total||v<=f){n.clearTimer(),n._nextAutoLevel=-1;return}if(!o)return;var m=g>-1&&g!==v,p=!!e||m;if(!p&&(l.paused||!l.playbackRate||!l.readyState))return;var y=s.mainForwardBufferInfo;if(!p&&null===y)return;var E=n.bwEstimator.getEstimateTTFB(),k=Math.abs(l.playbackRate);if(d<=Math.max(E,h/(2*k)*1e3))return;var b=y?y.len/k:0,T=c.loading.first?c.loading.first-c.loading.start:-1,S=c.loaded&&T>-1,_=n.getBwEstimate(),A=s.levels,L=A[v],w=Math.max(c.loaded,Math.round(h*(r.bitrate||L.averageBitrate)/8)),I=S?d-T:d;I<1&&S&&(I=Math.min(d,8*c.loaded/_));var D=S?1e3*c.loaded/I:0,C=E/1e3,x=D?(w-c.loaded)/D:8*w/_+C;if(!(x<=b)){var P=D?8*D:_,M=(null==(t=(null==e?void 0:e.details)||n.hls.latestLevelDetails)?void 0:t.live)===!0,F=n.hls.config.abrBandWidthUpFactor,N=1/0;for(i=v-1;i>f;i--){var B=A[i].maxBitrate,U=!A[i].details||M;if((N=n.getTimeToLoadFrag(C,P,h*B,U))<Math.min(b,h+C))break}if(!(N>=x)&&!(N>10*h)){S?n.bwEstimator.sample(d-Math.min(E,T),c.loaded):n.bwEstimator.sampleTTFB(d);var j=A[i].maxBitrate;n.getBwEstimate()*F>j&&n.resetEstimator(j);var G=n.findBestLevel(j,f,i,0,b,1,1);G>-1&&(i=G),n.warn("Fragment ".concat(r.sn).concat(a?" part "+a.index:""," of level ").concat(v," is loading too slowly;\n      Fragment duration: ").concat(r.duration.toFixed(3),"\n      Time to underbuffer: ").concat(b.toFixed(3)," s\n      Estimated load time for current fragment: ").concat(x.toFixed(3)," s\n      Estimated load time for down switch fragment: ").concat(N.toFixed(3)," s\n      TTFB estimate: ").concat(0|T," ms\n      Current BW estimate: ").concat(R(_)?0|_:"Unknown"," bps\n      New BW estimate: ").concat(0|n.getBwEstimate()," bps\n      Switching to level ").concat(i," @ ").concat(0|j," bps")),s.nextLoadLevel=s.nextAutoLevel=i,n.clearTimer();var K=function(){if(n.clearTimer(),n.fragCurrent===r&&n.hls.loadLevel===i&&i>0){var e=n.getStarvationDelay();if(n.warn("Aborting inflight request ".concat(i>0?"and switching down":"","\n      Fragment duration: ").concat(r.duration.toFixed(3)," s\n      Time to underbuffer: ").concat(e.toFixed(3)," s")),r.abortRequests(),n.fragCurrent=n.partCurrent=null,i>f){var t=n.findBestLevel(n.hls.levels[f].bitrate,f,i,0,e,1,1);-1===t&&(t=f),n.hls.nextLoadLevel=n.hls.nextAutoLevel=t,n.resetEstimator(n.hls.levels[t].bitrate)}}};m||x>2*N?K():n.timer=self.setInterval(K,1e3*N),s.trigger(O.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:a,stats:c})}}},n.hls=e,n.bwEstimator=n.initEstimator(),n.registerListeners(),n}return(0,_._)(t,e),(0,k._)(t,[{key:"resetEstimator",value:function(e){e&&(this.log("setting initial bwe to ".concat(e)),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}},{key:"initEstimator",value:function(){var e=this.hls.config;return new V(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}},{key:"registerListeners",value:function(){var e=this.hls;e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.FRAG_LOADING,this.onFragLoading,this),e.on(O.FRAG_LOADED,this.onFragLoaded,this),e.on(O.FRAG_BUFFERED,this.onFragBuffered,this),e.on(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(O.LEVEL_LOADED,this.onLevelLoaded,this),e.on(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(O.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(O.ERROR,this.onError,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e&&(e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.FRAG_LOADING,this.onFragLoading,this),e.off(O.FRAG_LOADED,this.onFragLoaded,this),e.off(O.FRAG_BUFFERED,this.onFragBuffered,this),e.off(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(O.LEVEL_LOADED,this.onLevelLoaded,this),e.off(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(O.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(O.ERROR,this.onError,this))}},{key:"destroy",value:function(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}},{key:"onManifestLoading",value:function(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}},{key:"onLevelsUpdated",value:function(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}},{key:"onMaxAutoLevelUpdated",value:function(){this.firstSelection=-1,this.nextAutoLevelKey=""}},{key:"onFragLoading",value:function(e,t){var n,i=t.frag;this.ignoreFragment(i)||(i.bitrateTest||(this.fragCurrent=i,this.partCurrent=null!=(n=t.part)?n:null),this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100))}},{key:"onLevelSwitching",value:function(e,t){this.clearTimer()}},{key:"onError",value:function(e,t){if(!t.fatal)switch(t.details){case P.BUFFER_ADD_CODEC_ERROR:case P.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case P.FRAG_LOAD_TIMEOUT:var n=t.frag,i=this.fragCurrent,r=this.partCurrent;if(n&&i&&n.sn===i.sn&&n.level===i.level){var a=performance.now(),s=r?r.stats:n.stats,o=a-s.loading.start,l=s.loading.first?s.loading.first-s.loading.start:-1;if(s.loaded&&l>-1){var u=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(o-Math.min(u,l),s.loaded)}else this.bwEstimator.sampleTTFB(o)}}}},{key:"getTimeToLoadFrag",value:function(e,t,n,i){var r=i?e+this.lastLevelLoadSec:0;return e+n/t+r}},{key:"onLevelLoaded",value:function(e,t){var n=this.hls.config,i=t.stats.loading,r=i.end-i.first;R(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}},{key:"onFragLoaded",value:function(e,t){var n=t.frag,i=t.part,r=i?i.stats:n.stats;if(n.type===j&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(n)){if(this.clearTimer(),n.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){var a=i?i.duration:n.duration,s=this.hls.levels[n.level],o=(s.loaded?s.loaded.bytes:0)+r.loaded,l=(s.loaded?s.loaded.duration:0)+a;s.loaded={bytes:o,duration:l},s.realBitrate=Math.round(8*o/l)}if(n.bitrateTest){var u={stats:r,frag:n,part:i,id:n.type};this.onFragBuffered(O.FRAG_BUFFERED,u),n.bitrateTest=!1}else this.lastLoadedFragLevel=n.level}}},{key:"onFragBuffered",value:function(e,t){var n=t.frag,i=t.part,r=null!=i&&i.stats.loaded?i.stats:n.stats;if(!r.aborted&&!this.ignoreFragment(n)){var a=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,r.loaded),r.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}}},{key:"ignoreFragment",value:function(e){return e.type!==j||"initSegment"===e.sn}},{key:"clearTimer",value:function(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}},{key:"firstAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,n=e.minAutoLevel,i=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,a=this.findBestLevel(i,n,t,0,r,1,1);if(a>-1)return a;var s=this.hls.firstLevel,o=Math.min(Math.max(s,n),t);return this.warn("Could not find best starting auto level. Defaulting to first in playlist ".concat(s," clamped to ").concat(o)),o}},{key:"forcedAutoLevel",get:function(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}},{key:"nextAutoLevel",get:function(){var e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(-1!==e&&(!t||!n||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;var i=t&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){var r=this.hls.levels;if(r.length>Math.max(e,i)&&r[e].loadError<=r[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i},set:function(e){var t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}},{key:"getAutoLevelKey",value:function(){return"".concat(this.getBwEstimate(),"_").concat(this.getStarvationDelay().toFixed(2))}},{key:"getNextABRAutoLevel",value:function(){var e=this.fragCurrent,t=this.partCurrent,n=this.hls;if(n.levels.length<=1)return n.loadLevel;var i=n.maxAutoLevel,r=n.config,a=n.minAutoLevel,s=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay(),u=r.abrBandWidthFactor,c=r.abrBandWidthUpFactor;if(l){var h=this.findBestLevel(o,a,i,l,0,u,c);if(h>=0)return this.rebufferNotice=-1,h}var d=s?Math.min(s,r.maxStarvationDelay):r.maxStarvationDelay;if(!l){var f=this.bitrateTestDelay;f&&(d=(s?Math.min(s,r.maxLoadingDelay):r.maxLoadingDelay)-f,this.info("bitrate test took ".concat(Math.round(1e3*f),"ms, set first fragment max fetchDuration to ").concat(Math.round(1e3*d)," ms")),u=c=1)}var v=this.findBestLevel(o,a,i,l,d,u,c);if(this.rebufferNotice!==v&&(this.rebufferNotice=v,this.info("".concat(l?"rebuffering expected":"buffer is empty",", optimal quality level ").concat(v))),v>-1)return v;var g=n.levels[a],m=n.loadLevelObj;return m&&(null==g?void 0:g.bitrate)<m.bitrate?a:n.loadLevel}},{key:"getStarvationDelay",value:function(){var e=this.hls,t=e.media;if(!t)return 1/0;var n=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/n}},{key:"getBwEstimate",value:function(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}},{key:"findBestLevel",value:function(e,t,n,i,r,a,s){var o=this,l=i+r,u=this.lastLoadedFragLevel,c=-1===u?this.hls.firstLevel:u,h=this.fragCurrent,d=this.partCurrent,f=this.hls,v=f.levels,g=f.allAudioTracks,m=f.loadLevel,p=f.config;if(1===v.length)return 0;var y=v[c],E=!!(null!=(I=this.hls.latestLevelDetails)&&I.live),k=-1===m||-1===u,b="SDR",T=(null==y?void 0:y.frameRate)||0,S=p.audioPreference,_=p.videoPreference,A=this.audioTracksByGroup||(this.audioTracksByGroup=te(g)),L=-1;if(k){if(-1!==this.firstSelection)return this.firstSelection;var I,D,C,x=function(e,t,n,i,r){for(var a=Object.keys(e),s=null==i?void 0:i.channels,o=null==i?void 0:i.audioCodec,l=null==r?void 0:r.videoCodec,u=s&&2===parseInt(s),c=!1,h=!1,d=1/0,f=1/0,v=1/0,g=1/0,m=0,p=[],y=function(e,t){var n=!1,i=[];if(e&&(n="SDR"!==e,i=[e]),t){var r="SDR"!==(i=t.allowedVideoRanges||e2.slice(0)).join("")&&!t.videoCodec;(n=void 0!==t.preferHDR?t.preferHDR:r&&function(){if("function"==typeof matchMedia){var e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}())||(i=["SDR"])}return{preferHDR:n,allowedVideoRanges:i}}(t,r),E=y.preferHDR,k=y.allowedVideoRanges,b=a.length;b--;)!function(t){var n=e[a[t]];c||(c=n.channels[2]>0),d=Math.min(d,n.minHeight),f=Math.min(f,n.minFramerate),v=Math.min(v,n.minBitrate),k.filter(function(e){return n.videoRanges[e]>0}).length>0&&(h=!0)}(b);d=R(d)?d:0,f=R(f)?f:0;var T=Math.max(1080,d),S=Math.max(30,f);n=Math.max(v=R(v)?v:n,n),h||(t=void 0);var _=a.length>1;return{codecSet:a.reduce(function(t,i){var r=e[i];if(i===t)return t;if(p=h?k.filter(function(e){return r.videoRanges[e]>0}):[],_){if(r.minBitrate>n)return e7(i,"min bitrate of ".concat(r.minBitrate," > current estimate of ").concat(n)),t;if(!r.hasDefaultAudio)return e7(i,"no renditions with default or auto-select sound found"),t;if(o&&i.indexOf(o.substring(0,4))%5!=0)return e7(i,'audio codec preference "'.concat(o,'" not found')),t;if(s&&!u){if(!r.channels[s])return e7(i,"no renditions with ".concat(s," channel sound found (channels options: ").concat(Object.keys(r.channels),")")),t}else if((!o||u)&&c&&0===r.channels["2"])return e7(i,"no renditions with stereo sound found"),t;if(r.minHeight>T)return e7(i,"min resolution of ".concat(r.minHeight," > maximum of ").concat(T)),t;if(r.minFramerate>S)return e7(i,"min framerate of ".concat(r.minFramerate," > maximum of ").concat(S)),t;if(!p.some(function(e){return r.videoRanges[e]>0}))return e7(i,"no variants with VIDEO-RANGE of ".concat(e9(p)," found")),t;if(l&&i.indexOf(l.substring(0,4))%5!=0)return e7(i,'video codec preference "'.concat(l,'" not found')),t;if(r.maxScore<m)return e7(i,"max score of ".concat(r.maxScore," < selected max of ").concat(m)),t}return t&&(eK(i)>=eK(t)||r.fragmentError>e[t].fragmentError)?t:(g=r.minIndex,m=r.maxScore,i)},void 0),videoRanges:p,preferHDR:E,minFramerate:f,minBitrate:v,minIndex:g}}(this.codecTiers||(this.codecTiers=v.slice(t,n+1).reduce(function(e,t,n){if(!t.codecSet)return e;var i=t.audioGroups,r=e[t.codecSet];r||(e[t.codecSet]=r={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:n,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!i,fragmentError:0}),r.minBitrate=Math.min(r.minBitrate,t.bitrate);var a=Math.min(t.height,t.width);return r.minHeight=Math.min(r.minHeight,a),r.minFramerate=Math.min(r.minFramerate,t.frameRate),r.minIndex=Math.min(r.minIndex,n),r.maxScore=Math.max(r.maxScore,t.score),r.fragmentError+=t.fragmentError,r.videoRanges[t.videoRange]=(r.videoRanges[t.videoRange]||0)+1,i&&i.forEach(function(e){if(e){var t=A.groups[e];t&&(r.hasDefaultAudio=r.hasDefaultAudio||A.hasDefaultAudio?t.hasDefault:t.hasAutoSelect||!A.hasDefaultAudio&&!A.hasAutoSelectAudio,Object.keys(t.channels).forEach(function(e){r.channels[e]=(r.channels[e]||0)+t.channels[e]}))}}),e},{})),b,e,S,_),P=x.codecSet,O=x.videoRanges,M=x.minFramerate,F=x.minBitrate,N=x.minIndex,B=x.preferHDR;L=N,D=P,b=B?O[O.length-1]:O[0],T=M,e=Math.max(e,F),this.log("picked start tier ".concat(e9(x)))}else D=null==y?void 0:y.codecSet,b=null==y?void 0:y.videoRange;for(var U=d?d.duration:h?h.duration:0,j=this.bwEstimator.getEstimateTTFB()/1e3,G=[],K=n;K>=t;K--){var H=(C=this,function(t){var h,f=v[t],g=t>c;if(!f)return"continue";if(p.useMediaCapabilities&&!f.supportedResult&&!f.supportedPromise){var y=navigator.mediaCapabilities;"function"==typeof(null==y?void 0:y.decodingInfo)&&function(e,t,n,i,r,a){var s=e.videoCodec,o=e.audioCodec?e.audioGroups:null,l=null==a?void 0:a.audioCodec,u=null==a?void 0:a.channels,c=u?parseInt(u):l?1/0:2,h=null;if(null!=o&&o.length)try{h=1===o.length&&o[0]?t.groups[o[0]].channels:o.reduce(function(e,n){if(n){var i=t.groups[n];if(!i)throw Error("Audio track group ".concat(n," not found"));Object.keys(i.channels).forEach(function(t){e[t]=(e[t]||0)+i.channels[t]})}return e},{2:0})}catch(e){return!0}return void 0!==s&&(s.split(",").some(function(e){return ex(e)})||e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(i,30)||"SDR"!==e.videoRange&&e.videoRange!==n||e.bitrate>Math.max(r,8e6))||!!h&&R(c)&&Object.keys(h).some(function(e){return parseInt(e)>c})}(f,A,b,T,e,S)?(f.supportedPromise=eJ(f,A,y,C.supportedCache),f.supportedPromise.then(function(e){if(o.hls){f.supportedResult=e;var t=o.hls.levels,n=t.indexOf(f);e.error?o.warn('MediaCapabilities decodingInfo error: "'.concat(e.error,'" for level ').concat(n," ").concat(e9(e))):e.supported?e.decodingInfoResults.some(function(e){return!1===e.smooth||!1===e.powerEfficient})&&o.log("MediaCapabilities decodingInfo for level ".concat(n," not smooth or powerEfficient: ").concat(e9(e))):(o.warn("Unsupported MediaCapabilities decodingInfo result for level ".concat(n," ").concat(e9(e))),n>-1&&t.length>1&&(o.log("Removing unsupported level ".concat(n)),o.hls.removeLevel(n),-1===o.hls.loadLevel&&(o.hls.nextLoadLevel=0)))}}).catch(function(e){o.warn("Error handling MediaCapabilities decodingInfo: ".concat(e))})):f.supportedResult=e$}if((D&&f.codecSet!==D||b&&f.videoRange!==b||g&&T>f.frameRate||!g&&T>0&&T<f.frameRate||null!=(h=f.supportedResult)&&null!=(h=h.decodingInfoResults)&&h.some(function(e){return!1===e.smooth}))&&(!k||t!==L))return G.push(t),"continue";var _=f.details,w=(d?null==_?void 0:_.partTarget:null==_?void 0:_.averagetargetduration)||U,I=void 0;I=g?s*e:a*e;var x=U&&i>=2*U&&0===r?f.averageBitrate:f.maxBitrate,P=C.getTimeToLoadFrag(j,I,x*w,void 0===_);if(I>=x&&(t===u||0===f.loadError&&0===f.fragmentError)&&(P<=j||!R(P)||E&&!C.bitrateTestDelay||P<l)){var O=C.forcedAutoLevel;return t!==m&&(-1===O||O!==m)&&(G.length&&C.trace("Skipped level(s) ".concat(G.join(",")," of ").concat(n,' max with CODECS and VIDEO-RANGE:"').concat(v[G[0]].codecs,'" ').concat(v[G[0]].videoRange,'; not compatible with "').concat(D,'" ').concat(b)),C.info("switch candidate:".concat(c,"->").concat(t," adjustedbw(").concat(Math.round(I),")-bitrate=").concat(Math.round(I-x)," ttfb:").concat(j.toFixed(1)," avgDuration:").concat(w.toFixed(1)," maxFetchDuration:").concat(l.toFixed(1)," fetchDuration:").concat(P.toFixed(1)," firstSelection:").concat(k," codecSet:").concat(f.codecSet," videoRange:").concat(f.videoRange," hls.loadLevel:").concat(m))),k&&(C.firstSelection=t),{v:t}}}(K));if("object"===(0,w._)(H))return H.v}return -1}},{key:"deriveNextAutoLevel",value:function(e){var t=this.hls,n=t.maxAutoLevel;return Math.min(Math.max(e,t.minAutoLevel),n)}}]),t}(z),tl=function(e,t){for(var n=0,i=e.length-1,r=null,a=null;n<=i;){var s=t(a=e[r=(n+i)/2|0]);if(s>0)n=r+1;else{if(!(s<0))return a;i=r-1}}return null};function tu(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.005,a=null;if(e){a=t[1+e.sn-t[0].sn]||null;var s=e.endDTS-n;s>0&&s<15e-7&&(n+=15e-7),a&&e.level!==a.level&&a.end<=e.end&&(a=t[2+e.sn-t[0].sn]||null)}else 0===n&&0===t[0].start&&(a=t[0]);if(a&&((!e||e.level===a.level)&&0===tc(n,i,a)||function(e,t,n){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){var i=t.tagList.reduce(function(e,t){return"INF"===t[0]&&(e+=parseFloat(t[1])),e},n);return e.start<=i}return!1}(a,e,Math.min(r,i))))return a;var o=tl(t,tc.bind(null,n,i));return o&&(o!==e||!a)?o:a}function tc(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(n.start<=e&&n.start+n.duration>e)return 0;var i=Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-i<=e?1:n.start-i>e&&n.start?-1:0}function th(e,t,n){if(e&&e.startCC<=t&&e.endCC>=t){var i,r=e.fragments,a=e.fragmentHint;return a&&(r=r.concat(a)),tl(r,function(e){return e.cc<t?1:e.cc>t?-1:(i=e,e.end<=n)?1:e.start>n?-1:0}),i||null}return null}function td(e){switch(e.details){case P.FRAG_LOAD_TIMEOUT:case P.KEY_LOAD_TIMEOUT:case P.LEVEL_LOAD_TIMEOUT:case P.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function tf(e){return e.details.startsWith("key")}function tv(e){return tf(e)&&!!e.frag&&!e.frag.decryptdata}function tg(e,t){var n=td(t);return e.default["".concat(n?"timeout":"error","Retry")]}function tm(e,t){return Math.min(("linear"===e.backoff?1:Math.pow(2,t))*e.retryDelayMs,e.maxRetryDelayMs)}function tp(e){return W(W({},e),{errorRetry:null,timeoutRetry:null})}function ty(e,t,n,i){if(!e)return!1;var r,a=null==i?void 0:i.code,s=t<e.maxNumRetry&&(tE(r=a)||!!r&&(r<400||r>499)||!!n);return e.shouldRetry?e.shouldRetry(e,t,n,i,s):s}function tE(e){return 0===e&&!1===navigator.onLine}var tk=function(e){"use strict";function t(e){var n;return(0,E._)(this,t),(n=(0,y._)(this,t,["error-controller",e.logger])).hls=void 0,n.playlistError=0,n.hls=e,n.registerListeners(),n}return(0,_._)(t,e),(0,k._)(t,[{key:"registerListeners",value:function(){var e=this.hls;e.on(O.ERROR,this.onError,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.LEVEL_UPDATED,this.onLevelUpdated,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e&&(e.off(O.ERROR,this.onError,this),e.off(O.ERROR,this.onErrorOut,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.LEVEL_UPDATED,this.onLevelUpdated,this))}},{key:"destroy",value:function(){this.unregisterListeners(),this.hls=null}},{key:"startLoad",value:function(e){}},{key:"stopLoad",value:function(){this.playlistError=0}},{key:"getVariantLevelIndex",value:function(e){return(null==e?void 0:e.type)===j?e.level:this.getVariantIndex()}},{key:"getVariantIndex",value:function(){var e,t=this.hls,n=t.currentLevel;return null!=(e=t.loadLevelObj)&&e.details||-1===n?t.loadLevel:n}},{key:"variantHasKey",value:function(e,t){if(e){if(null!=(n=e.details)&&n.hasKey(t))return!0;var n,i=e.audioGroups;if(i)return this.hls.allAudioTracks.filter(function(e){return i.indexOf(e.groupId)>=0}).some(function(e){var n;return null==(n=e.details)?void 0:n.hasKey(t)})}return!1}},{key:"onManifestLoading",value:function(){this.playlistError=0}},{key:"onLevelUpdated",value:function(){this.playlistError=0}},{key:"onError",value:function(e,t){if(!t.fatal){var n,i=this.hls,r=t.context;switch(t.details){case P.FRAG_LOAD_ERROR:case P.FRAG_LOAD_TIMEOUT:case P.KEY_LOAD_ERROR:case P.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case P.FRAG_PARSING_ERROR:if(null!=(a=t.frag)&&a.gap){t.errorAction=tb();return}case P.FRAG_GAP:case P.FRAG_DECRYPT_ERROR:t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=2;return;case P.LEVEL_EMPTY_ERROR:case P.LEVEL_PARSING_ERROR:var a,s,o=t.parent===j?t.level:i.loadLevel;t.details===P.LEVEL_EMPTY_ERROR&&null!=(s=t.context)&&null!=(s=s.levelDetails)&&s.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,o):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,o));return;case P.LEVEL_LOAD_ERROR:case P.LEVEL_LOAD_TIMEOUT:"number"==typeof(null==r?void 0:r.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level));return;case P.AUDIO_TRACK_LOAD_ERROR:case P.AUDIO_TRACK_LOAD_TIMEOUT:case P.SUBTITLE_LOAD_ERROR:case P.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){var l=i.loadLevelObj;l&&(r.type===B&&l.hasAudioGroup(r.groupId)||r.type===U&&l.hasSubtitleGroup(r.groupId))&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=2,t.errorAction.flags=1)}return;case P.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:2,flags:2};return;case P.KEY_SYSTEM_SESSION_UPDATE_FAILED:case P.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case P.KEY_SYSTEM_NO_SESSION:t.errorAction={action:2,flags:4};return;case P.BUFFER_ADD_CODEC_ERROR:case P.REMUX_ALLOC_ERROR:case P.BUFFER_APPEND_ERROR:t.errorAction||(t.errorAction=this.getLevelSwitchAction(t,null!=(n=t.level)?n:i.loadLevel));return;case P.INTERNAL_EXCEPTION:case P.BUFFER_APPENDING_ERROR:case P.BUFFER_FULL_ERROR:case P.LEVEL_SWITCH_ERROR:case P.BUFFER_STALLED_ERROR:case P.BUFFER_SEEK_OVER_HOLE:case P.BUFFER_NUDGE_ON_STALL:t.errorAction=tb();return}t.type===x.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=tb())}}},{key:"getPlaylistRetryOrSwitchAction",value:function(e,t){var n=tg(this.hls.config.playlistLoadPolicy,e),i=this.playlistError++;if(ty(n,i,td(e),e.response))return{action:5,flags:0,retryConfig:n,retryCount:i};var r=this.getLevelSwitchAction(e,t);return n&&(r.retryConfig=n,r.retryCount=i),r}},{key:"getFragRetryOrSwitchAction",value:function(e){var t=this.hls,n=this.getVariantLevelIndex(e.frag),i=t.levels[n],r=t.config,a=r.fragLoadPolicy,s=r.keyLoadPolicy,o=tg(tf(e)?s:a,e),l=t.levels.reduce(function(e,t){return e+t.fragmentError},0);if(i&&(e.details!==P.FRAG_GAP&&i.fragmentError++,!tv(e))&&ty(o,l,td(e),e.response))return{action:5,flags:0,retryConfig:o,retryCount:l};var u=this.getLevelSwitchAction(e,n);return o&&(u.retryConfig=o,u.retryCount=l),u}},{key:"getLevelSwitchAction",value:function(e,t){var n=this.hls;null==t&&(t=n.loadLevel);var i=this.hls.levels[t];if(i){var r,a,s=e.details;i.loadError++,s===P.BUFFER_APPEND_ERROR&&i.fragmentError++;var o=-1,l=n.levels,u=n.loadLevel,c=n.minAutoLevel,h=n.maxAutoLevel;n.autoLevelEnabled||n.config.preserveManualLevelOnError||(n.loadLevel=-1);for(var d=null==(r=e.frag)?void 0:r.type,f=(d===G&&s===P.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(s===P.BUFFER_ADD_CODEC_ERROR||s===P.BUFFER_APPEND_ERROR))&&l.some(function(e){var t=e.audioCodec;return i.audioCodec!==t}),v="video"===e.sourceBufferName&&(s===P.BUFFER_ADD_CODEC_ERROR||s===P.BUFFER_APPEND_ERROR)&&l.some(function(e){var t=e.codecSet,n=e.audioCodec;return i.codecSet!==t&&i.audioCodec===n}),g=null!=(a=e.context)?a:{},m=g.type,p=g.groupId,y=l.length;y--&&"break"!==function(t){var n=(t+u)%l.length;if(n!==u&&n>=c&&n<=h&&0===l[n].loadError){var r,a,g=l[n];if(s===P.FRAG_GAP&&d===j&&e.frag){var y=l[n].details;if(y){var E=tu(e.frag,y.fragments,e.frag.start);if(null!=E&&E.gap)return"continue"}}else if(m===B&&g.hasAudioGroup(p)||m===U&&g.hasSubtitleGroup(p))return"continue";else if(d===G&&null!=(r=i.audioGroups)&&r.some(function(e){return g.hasAudioGroup(e)})||d===K&&null!=(a=i.subtitleGroups)&&a.some(function(e){return g.hasSubtitleGroup(e)})||f&&i.audioCodec===g.audioCodec||v&&i.codecSet===g.codecSet||!f&&i.codecSet!==g.codecSet)return"continue";return o=n,"break"}}(y););if(o>-1&&n.loadLevel!==o)return e.levelRetry=!0,this.playlistError=0,{action:2,flags:0,nextAutoLevel:o}}return{action:2,flags:1}}},{key:"onErrorOut",value:function(e,t){var n;switch(null==(n=t.errorAction)?void 0:n.action){case 0:break;case 2:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===P.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn('MediaSource ended after "'.concat(t.sourceBufferName,'" sourceBuffer append error. Attempting to recover from media error.')),this.hls.recoverMediaError()):t.fatal=!0}if(t.fatal)return void this.hls.stopLoad()}},{key:"sendAlternateToPenaltyBox",value:function(e){var t=this.hls,n=e.errorAction;if(n){var i=n.flags,r=n.nextAutoLevel;switch(i){case 0:this.switchLevel(e,r);break;case 2:var a=this.getVariantLevelIndex(e.frag),s=t.levels[a],o=null==s?void 0:s.attrs["HDCP-LEVEL"];if(n.hdcpLevel=o,"NONE"===o)this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(o){t.maxHdcpLevel=e1[e1.indexOf(o)-1],n.resolved=!0,this.warn('Restricting playback to HDCP-LEVEL of "'.concat(t.maxHdcpLevel,'" or lower'));break}case 4:var l=e.decryptdata;if(l){for(var u,c,h=this.hls.levels,d=h.length,f=d;f--;)this.variantHasKey(h[f],l)&&(this.log("Banned key found in level ".concat(f," (").concat(h[f].bitrate,'bps) or audio group "').concat(null==(u=h[f].audioGroups)?void 0:u.join(","),'" (').concat(null==(c=e.frag)?void 0:c.type," fragment) ").concat(ei(l.keyId||[]))),h[f].fragmentError++,h[f].loadError++,this.log("Removing level ".concat(f," with key error (").concat(e.error,")")),this.hls.removeLevel(f));var v=e.frag;if(this.hls.levels.length<d)n.resolved=!0;else if(v&&v.type!==j){var g=v.decryptdata;g&&!l.matches(g)&&(n.resolved=!0)}}}n.resolved||this.switchLevel(e,r)}}},{key:"switchLevel",value:function(e,t){if(void 0!==t&&e.errorAction&&(this.warn("switching to level ".concat(t," after ").concat(e.details)),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===P.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&"audiovideo"!==e.sourceBufferName))for(var n=eX(e.mimeType),i=this.hls.levels,r=i.length;r--;)i[r]["".concat(e.sourceBufferName,"Codec")]===n&&(this.log("Removing level ".concat(r," for ").concat(e.details,' ("').concat(n,'" not supported)')),this.hls.removeLevel(r))}}]),t}(z);function tb(e){var t={action:0,flags:0};return e&&(t.resolved=!0),t}var tT="NOT_LOADED",tS="APPENDING",t_="PARTIAL",tA=function(){"use strict";function e(t){(0,E._)(this,e),this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=t,this._registerListeners()}return(0,k._)(e,[{key:"_registerListeners",value:function(){var e=this.hls;e&&(e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.BUFFER_APPENDED,this.onBufferAppended,this),e.on(O.FRAG_BUFFERED,this.onFragBuffered,this),e.on(O.FRAG_LOADED,this.onFragLoaded,this))}},{key:"_unregisterListeners",value:function(){var e=this.hls;e&&(e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.BUFFER_APPENDED,this.onBufferAppended,this),e.off(O.FRAG_BUFFERED,this.onFragBuffered,this),e.off(O.FRAG_LOADED,this.onFragLoaded,this))}},{key:"destroy",value:function(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}},{key:"getAppendedFrag",value:function(e,t){var n=this.activePartLists[t];if(n)for(var i=n.length;i--;){var r=n[i];if(!r)break;if(r.start<=e&&e<=r.end&&r.loaded)return r}return this.getBufferedFrag(e,t)}},{key:"getBufferedFrag",value:function(e,t){return this.getFragAtPos(e,t,!0)}},{key:"getFragAtPos",value:function(e,t,n){for(var i=this.fragments,r=Object.keys(i),a=r.length;a--;){var s=i[r[a]];if((null==s?void 0:s.body.type)===t&&(!n||s.buffered)){var o=s.body;if(o.start<=e&&e<=o.end)return o}}return null}},{key:"detectEvictedFragments",value:function(e,t,n,i,r){var a=this;this.timeRanges&&(this.timeRanges[e]=t);var s=(null==i?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(function(i){var o=a.fragments[i];if(o&&!(s>=o.body.sn)){if(!o.buffered&&(!o.loaded||r)){o.body.type===n&&a.removeFragment(o.body);return}var l=o.range[e];if(l){if(0===l.time.length)return void a.removeFragment(o.body);l.time.some(function(e){var n=!a.isTimeBuffered(e.startPTS,e.endPTS,t);return n&&a.removeFragment(o.body),n})}}})}},{key:"detectPartialFragments",value:function(e){var t=this,n=this.timeRanges;if(n&&"initSegment"!==e.frag.sn){var i=e.frag,r=tw(i),a=this.fragments[r];if(a&&(!a.buffered||!i.gap)){var s=!i.relurl;Object.keys(n).forEach(function(r){var o=i.elementaryStreams[r];if(o){var l=n[r],u=s||!0===o.partial;a.range[r]=t.getBufferedTimes(i,e.part,u,l)}}),a.loaded=null,Object.keys(a.range).length?(a.buffered=!0,(a.body.endList=i.endList||a.body.endList)&&(this.endListFragments[a.body.type]=a),tL(a)||this.removeParts(i.sn-1,i.type)):this.removeFragment(a.body)}}}},{key:"removeParts",value:function(e,t){var n=this.activePartLists[t];n&&(this.activePartLists[t]=tI(n,function(t){return t.fragment.sn>=e}))}},{key:"fragBuffered",value:function(e,t){var n=tw(e),i=this.fragments[n];!i&&t&&(i=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}},{key:"getBufferedTimes",value:function(e,t,n,i){for(var r={time:[],partial:n},a=e.start,s=e.end,o=e.minEndPTS||s,l=e.maxStartPTS||a,u=0;u<i.length;u++){var c=i.start(u)-this.bufferPadding,h=i.end(u)+this.bufferPadding;if(l>=c&&o<=h){r.time.push({startPTS:Math.max(a,i.start(u)),endPTS:Math.min(s,i.end(u))});break}if(a<h&&s>c){var d=Math.max(a,i.start(u)),f=Math.min(s,i.end(u));f>d&&(r.partial=!0,r.time.push({startPTS:d,endPTS:f}))}else if(s<=c)break}return r}},{key:"getPartialFragment",value:function(e){var t,n,i,r=null,a=0,s=this.bufferPadding,o=this.fragments;return Object.keys(o).forEach(function(l){var u=o[l];u&&tL(u)&&(n=u.body.start-s,i=u.body.end+s,e>=n&&e<=i&&a<=(t=Math.min(e-n,i-e))&&(r=u.body,a=t))}),r}},{key:"isEndListAppended",value:function(e){var t=this.endListFragments[e];return void 0!==t&&(t.buffered||tL(t))}},{key:"getState",value:function(e){var t=tw(e),n=this.fragments[t];if(n)if(!n.buffered)return tS;else if(tL(n))return t_;else return"OK";return tT}},{key:"isTimeBuffered",value:function(e,t,n){for(var i,r,a=0;a<n.length;a++){if(i=n.start(a)-this.bufferPadding,r=n.end(a)+this.bufferPadding,e>=i&&t<=r)return!0;if(t<=i)break}return!1}},{key:"onManifestLoading",value:function(){this.removeAllFragments()}},{key:"onFragLoaded",value:function(e,t){if("initSegment"!==t.frag.sn&&!t.frag.bitrateTest){var n=t.frag,i=t.part?null:t,r=tw(n);this.fragments[r]={body:n,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}}},{key:"onBufferAppended",value:function(e,t){var n=t.frag,i=t.part,r=t.timeRanges,a=t.type;if("initSegment"!==n.sn){var s=n.type;if(i){var o=this.activePartLists[s];o||(this.activePartLists[s]=o=[]),o.push(i)}this.timeRanges=r;var l=r[a];this.detectEvictedFragments(a,l,s,i)}}},{key:"onFragBuffered",value:function(e,t){this.detectPartialFragments(t)}},{key:"hasFragment",value:function(e){var t=tw(e);return!!this.fragments[t]}},{key:"hasFragments",value:function(e){var t=this.fragments,n=Object.keys(t);if(!e)return n.length>0;for(var i=n.length;i--;){var r=t[n[i]];if((null==r?void 0:r.body.type)===e)return!0}return!1}},{key:"hasParts",value:function(e){var t;return!!(null!=(t=this.activePartLists[e])&&t.length)}},{key:"removeFragmentsInRange",value:function(e,t,n,i,r){var a=this;(!i||this.hasGaps)&&Object.keys(this.fragments).forEach(function(s){var o=a.fragments[s];if(o){var l=o.body;l.type===n&&(!i||l.gap)&&l.start<t&&l.end>e&&(o.buffered||r)&&a.removeFragment(l)}})}},{key:"removeFragment",value:function(e){var t=tw(e);e.clearElementaryStreamInfo();var n=this.activePartLists[e.type];if(n){var i=e.sn;this.activePartLists[e.type]=tI(n,function(e){return e.fragment.sn!==i})}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}},{key:"removeAllFragments",value:function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;var e,t=null==(e=this.hls)||null==(e=e.latestLevelDetails)?void 0:e.partList;t&&t.forEach(function(e){return e.clearElementaryStreamInfo()})}}]),e}();function tL(e){var t,n,i;return e.buffered&&!!(e.body.gap||null!=(t=e.range.video)&&t.partial||null!=(n=e.range.audio)&&n.partial||null!=(i=e.range.audiovideo)&&i.partial)}function tw(e){return"".concat(e.type,"_").concat(e.level,"_").concat(e.sn)}function tI(e,t){return e.filter(function(e){var n=t(e);return n||e.clearElementaryStreamInfo(),n})}var tR=function(){"use strict";function e(t,n,i){(0,E._)(this,e),this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=t,this.aesIV=n,this.aesMode=i}return(0,k._)(e,[{key:"decrypt",value:function(e,t){switch(this.aesMode){case 0:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case 1:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw Error("[AESCrypto] invalid aes mode ".concat(this.aesMode))}}}]),e}(),tD=function(){"use strict";function e(){(0,E._)(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}return(0,k._)(e,[{key:"uint8ArrayToUint32Array_",value:function(e){for(var t=new DataView(e),n=new Uint32Array(4),i=0;i<4;i++)n[i]=t.getUint32(4*i);return n}},{key:"initTable",value:function(){var e=this.sBox,t=this.invSBox,n=this.subMix,i=n[0],r=n[1],a=n[2],s=n[3],o=this.invSubMix,l=o[0],u=o[1],c=o[2],h=o[3],d=new Uint32Array(256),f=0,v=0,g=0;for(g=0;g<256;g++)g<128?d[g]=g<<1:d[g]=g<<1^283;for(g=0;g<256;g++){var m=v^v<<1^v<<2^v<<3^v<<4;m=m>>>8^255&m^99,e[f]=m,t[m]=f;var p=d[f],y=d[p],E=d[y],k=257*d[m]^0x1010100*m;i[f]=k<<24|k>>>8,r[f]=k<<16|k>>>16,a[f]=k<<8|k>>>24,s[f]=k,k=0x1010101*E^65537*y^257*p^0x1010100*f,l[m]=k<<24|k>>>8,u[m]=k<<16|k>>>16,c[m]=k<<8|k>>>24,h[m]=k,f?(f=p^d[d[d[E^p]]],v^=d[d[v]]):f=v=1}}},{key:"expandKey",value:function(e){for(var t,n,i,r,a=this.uint8ArrayToUint32Array_(e),s=!0,o=0;o<a.length&&s;)s=a[o]===this.key[o],o++;if(!s){this.key=a;var l=this.keySize=a.length;if(4!==l&&6!==l&&8!==l)throw Error("Invalid aes key size="+l);var u=this.ksRows=(l+6+1)*4,c=this.keySchedule=new Uint32Array(u),h=this.invKeySchedule=new Uint32Array(u),d=this.sBox,f=this.rcon,v=this.invSubMix,g=v[0],m=v[1],p=v[2],y=v[3];for(t=0;t<u;t++){if(t<l){i=c[t]=a[t];continue}r=i,t%l==0?r=(d[(r=r<<8|r>>>24)>>>24]<<24|d[r>>>16&255]<<16|d[r>>>8&255]<<8|d[255&r])^f[t/l|0]<<24:l>6&&t%l==4&&(r=d[r>>>24]<<24|d[r>>>16&255]<<16|d[r>>>8&255]<<8|d[255&r]),c[t]=i=(c[t-l]^r)>>>0}for(n=0;n<u;n++)t=u-n,r=3&n?c[t]:c[t-4],n<4||t<=4?h[n]=r:h[n]=g[d[r>>>24]]^m[d[r>>>16&255]]^p[d[r>>>8&255]]^y[d[255&r]],h[n]=h[n]>>>0}}},{key:"networkToHostOrderSwap",value:function(e){return e<<24|(65280&e)<<8|(0xff0000&e)>>8|e>>>24}},{key:"decrypt",value:function(e,t,n){for(var i,r,a,s,o,l,u,c,h,d,f,v,g,m,p=this.keySize+6,y=this.invKeySchedule,E=this.invSBox,k=this.invSubMix,b=k[0],T=k[1],S=k[2],_=k[3],A=this.uint8ArrayToUint32Array_(n),L=A[0],w=A[1],I=A[2],R=A[3],D=new Int32Array(e),C=new Int32Array(D.length),x=this.networkToHostOrderSwap;t<D.length;){for(m=1,h=x(D[t]),d=x(D[t+1]),f=x(D[t+2]),v=x(D[t+3]),o=h^y[0],l=v^y[1],u=f^y[2],c=d^y[3],g=4;m<p;m++)i=b[o>>>24]^T[l>>16&255]^S[u>>8&255]^_[255&c]^y[g],r=b[l>>>24]^T[u>>16&255]^S[c>>8&255]^_[255&o]^y[g+1],a=b[u>>>24]^T[c>>16&255]^S[o>>8&255]^_[255&l]^y[g+2],s=b[c>>>24]^T[o>>16&255]^S[l>>8&255]^_[255&u]^y[g+3],o=i,l=r,u=a,c=s,g+=4;i=E[o>>>24]<<24^E[l>>16&255]<<16^E[u>>8&255]<<8^E[255&c]^y[g],r=E[l>>>24]<<24^E[u>>16&255]<<16^E[c>>8&255]<<8^E[255&o]^y[g+1],a=E[u>>>24]<<24^E[c>>16&255]<<16^E[o>>8&255]<<8^E[255&l]^y[g+2],s=E[c>>>24]<<24^E[o>>16&255]<<16^E[l>>8&255]<<8^E[255&u]^y[g+3],C[t]=x(i^L),C[t+1]=x(s^w),C[t+2]=x(a^I),C[t+3]=x(r^R),L=h,w=d,I=f,R=v,t+=4}return C.buffer}}]),e}(),tC=function(){"use strict";function e(t,n,i){(0,E._)(this,e),this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=t,this.key=n,this.aesMode=i}return(0,k._)(e,[{key:"expandKey",value:function(){var e=function(e){switch(e){case 0:return"AES-CBC";case 1:return"AES-CTR";default:throw Error("[FastAESKey] invalid aes mode ".concat(e))}}(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}]),e}(),tx=function(){"use strict";function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.removePKCS7Padding,r=void 0===i||i;if((0,E._)(this,e),this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=t.enableSoftwareAES,this.removePKCS7Padding=r,r)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch(e){}this.useSoftware=!this.subtle}return(0,k._)(e,[{key:"destroy",value:function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}},{key:"isSync",value:function(){return this.useSoftware}},{key:"flush",value:function(){var e,t,n=this.currentResult,i=this.remainderData;if(!n||i)return this.reset(),null;var r=new Uint8Array(n);return(this.reset(),this.removePKCS7Padding)?(t=(e=r.byteLength)&&new DataView(r.buffer).getUint8(e-1))?r.slice(0,e-t):r:r}},{key:"reset",value:function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}},{key:"decrypt",value:function(e,t,n,i){var r=this;return this.useSoftware?new Promise(function(a,s){var o=ArrayBuffer.isView(e)?e:new Uint8Array(e);r.softwareDecrypt(o,t,n,i);var l=r.flush();l?a(l.buffer):s(Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,i)}},{key:"softwareDecrypt",value:function(e,t,n,i){var r=this.currentIV,a=this.currentResult,s=this.remainderData;if(0!==i||16!==t.byteLength)return J.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),s&&(e=eD(s,e),this.remainderData=null);var o=this.getValidChunk(e);if(!o.length)return null;r&&(n=r);var l=this.softwareDecrypter;return(l||(l=this.softwareDecrypter=new tD),l.expandKey(t),this.currentResult=l.decrypt(o.buffer,0,n),this.currentIV=o.slice(-16).buffer,a)?a:null}},{key:"webCryptoDecrypt",value:function(e,t,n,i){var r=this;if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,i));this.key=t,this.fastAesKey=new tC(this.subtle,t,i)}return this.fastAesKey.expandKey().then(function(t){return r.subtle?(r.logOnce("WebCrypto AES decrypt"),new tR(r.subtle,new Uint8Array(n),i).decrypt(e.buffer,t)):Promise.reject(Error("web crypto not initialized"))}).catch(function(a){return J.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, ".concat(a.name,": ").concat(a.message)),r.onWebCryptoError(e,t,n,i)})}},{key:"onWebCryptoError",value:function(e,t,n,i){var r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,i);var a=this.flush();if(a)return a.buffer}throw Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}},{key:"getValidChunk",value:function(e){var t=e,n=e.length-e.length%16;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}},{key:"logOnce",value:function(e){this.logEnabled&&(J.log("[decrypter]: ".concat(e)),this.logEnabled=!1)}}]),e}(),tP=function(){"use strict";function e(t){(0,E._)(this,e),this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}return(0,k._)(e,[{key:"destroy",value:function(){this.loader&&(this.loader.destroy(),this.loader=null)}},{key:"abort",value:function(){this.loader&&this.loader.abort()}},{key:"load",value:function(e,t){var n=this,i=e.url;if(!i)return Promise.reject(new tF({type:x.NETWORK_ERROR,details:P.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:Error("Fragment does not have a ".concat(i?"part list":"url")),networkDetails:null}));this.abort();var r=this.config,a=r.fLoader,s=r.loader;return new Promise(function(o,l){if(n.loader&&n.loader.destroy(),e.gap)if(e.tagList.some(function(e){return"GAP"===e[0]}))return void l(tM(e));else e.gap=!1;var u=n.loader=a?new a(r):new s(r),c=tO(e);e.loader=u;var h=tp(r.fragLoadPolicy.default),d={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:131072};e.stats=u.stats;var f={onSuccess:function(t,i,r,a){n.resetLoader(e,u);var s=t.data;r.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(s.slice(0,16)),s=s.slice(16)),o({frag:e,part:null,payload:s,networkDetails:a})},onError:function(t,r,a,s){n.resetLoader(e,u),l(new tF({type:x.NETWORK_ERROR,details:P.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:W({url:i,data:void 0},t),error:Error("HTTP Error ".concat(t.code," ").concat(t.text)),networkDetails:a,stats:s}))},onAbort:function(t,i,r){n.resetLoader(e,u),l(new tF({type:x.NETWORK_ERROR,details:P.INTERNAL_ABORTED,fatal:!1,frag:e,error:Error("Aborted"),networkDetails:r,stats:t}))},onTimeout:function(t,i,r){n.resetLoader(e,u),l(new tF({type:x.NETWORK_ERROR,details:P.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:Error("Timeout after ".concat(d.timeout,"ms")),networkDetails:r,stats:t}))}};t&&(f.onProgress=function(n,i,r,a){return t({frag:e,part:null,payload:r,networkDetails:a})}),u.load(c,d,f)})}},{key:"loadPart",value:function(e,t,n){var i=this;this.abort();var r=this.config,a=r.fLoader,s=r.loader;return new Promise(function(o,l){if(i.loader&&i.loader.destroy(),e.gap||t.gap)return void l(tM(e,t));var u=i.loader=a?new a(r):new s(r),c=tO(e,t);e.loader=u;var h=tp(r.fragLoadPolicy.default),d={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:131072};t.stats=u.stats,u.load(c,d,{onSuccess:function(r,a,s,l){i.resetLoader(e,u),i.updateStatsFromPart(e,t);var c={frag:e,part:t,payload:r.data,networkDetails:l};n(c),o(c)},onError:function(n,r,a,s){i.resetLoader(e,u),l(new tF({type:x.NETWORK_ERROR,details:P.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:W({url:c.url,data:void 0},n),error:Error("HTTP Error ".concat(n.code," ").concat(n.text)),networkDetails:a,stats:s}))},onAbort:function(n,r,a){e.stats.aborted=t.stats.aborted,i.resetLoader(e,u),l(new tF({type:x.NETWORK_ERROR,details:P.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:Error("Aborted"),networkDetails:a,stats:n}))},onTimeout:function(n,r,a){i.resetLoader(e,u),l(new tF({type:x.NETWORK_ERROR,details:P.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:Error("Timeout after ".concat(d.timeout,"ms")),networkDetails:a,stats:n}))}})})}},{key:"updateStatsFromPart",value:function(e,t){var n=e.stats,i=t.stats,r=i.total;if(n.loaded+=i.loaded,r){var a=Math.round(e.duration/t.duration),s=Math.min(Math.round(n.loaded/r),a),o=(a-s)*Math.round(n.loaded/s);n.total=n.loaded+o}else n.total=Math.max(n.loaded,n.total);var l=n.loading,u=i.loading;l.start?l.first+=u.first-u.start:(l.start=u.start,l.first=u.first),l.end=u.end}},{key:"resetLoader",value:function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}]),e}();function tO(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=t||e,i={frag:e,part:t,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},r=n.byteRangeStartOffset,a=n.byteRangeEndOffset;if(R(r)&&R(a)){var s,o,l=r,u=a;if("initSegment"===e.sn&&("AES-128"===(s=null==(o=e.decryptdata)?void 0:o.method)||"AES-256"===s)){var c=a-r;c%16&&(u=a+(16-c%16)),0!==r&&(i.resetIV=!0,l=r-16)}i.rangeStart=l,i.rangeEnd=u}return i}function tM(e,t){var n=Error("GAP ".concat(e.gap?"tag":"attribute"," found")),i={type:x.MEDIA_ERROR,details:P.FRAG_GAP,fatal:!1,frag:e,error:n,networkDetails:null};return t&&(i.part=t),(t||e).stats.aborted=!0,new tF(i)}var tF=function(e){"use strict";function t(e){var n;return(0,E._)(this,t),(n=(0,y._)(this,t,[e.error.message])).data=void 0,n.data=e,n}return(0,_._)(t,e),t}((0,I._)(Error)),tN=function(e){"use strict";function t(e,n){var i;return(0,E._)(this,t),(i=(0,y._)(this,t,[e,n]))._boundTick=void 0,i._tickTimer=null,i._tickInterval=null,i._tickCallCount=0,i._boundTick=i.tick.bind(i),i}return(0,_._)(t,e),(0,k._)(t,[{key:"destroy",value:function(){this.onHandlerDestroying(),this.onHandlerDestroyed()}},{key:"onHandlerDestroying",value:function(){this.clearNextTick(),this.clearInterval()}},{key:"onHandlerDestroyed",value:function(){}},{key:"hasInterval",value:function(){return!!this._tickInterval}},{key:"hasNextTick",value:function(){return!!this._tickTimer}},{key:"setInterval",value:function(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}},{key:"clearInterval",value:function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}},{key:"clearNextTick",value:function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}},{key:"tick",value:function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}},{key:"tickImmediate",value:function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}},{key:"doTick",value:function(){}}]),t}(z),tB=function e(t,n,i){"use strict";var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];(0,E._)(this,e),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=tU(),this.buffering={audio:tU(),video:tU(),audiovideo:tU()},this.level=t,this.sn=n,this.id=i,this.size=r,this.part=a,this.partial=s};function tU(){return{start:0,executeStart:0,executeEnd:0,end:0}}var tj={length:0,start:function(){return 0},end:function(){return 0}},tG=function(){"use strict";function e(){(0,E._)(this,e)}return(0,k._)(e,null,[{key:"isBuffered",value:function(t,n){if(t){for(var i=e.getBuffered(t),r=i.length;r--;)if(n>=i.start(r)&&n<=i.end(r))return!0}return!1}},{key:"bufferedRanges",value:function(t){if(t){var n=e.getBuffered(t);return e.timeRangesToArray(n)}return[]}},{key:"timeRangesToArray",value:function(e){for(var t=[],n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}},{key:"bufferInfo",value:function(t,n,i){if(t){var r=e.bufferedRanges(t);if(r.length)return e.bufferedInfo(r,n,i)}return{len:0,start:n,end:n,bufferedIndex:-1}}},{key:"bufferedInfo",value:function(e,t,n){t=Math.max(0,t),e.length>1&&e.sort(function(e,t){return e.start-t.start||t.end-e.end});var i,r=-1,a=[];if(n)for(var s=0;s<e.length;s++){t>=e[s].start&&t<=e[s].end&&(r=s);var o=a.length;if(o){var l=a[o-1].end;e[s].start-l<n?e[s].end>l&&(a[o-1].end=e[s].end):a.push(e[s])}else a.push(e[s])}else a=e;for(var u=0,c=t,h=t,d=0;d<a.length;d++){var f=a[d].start,v=a[d].end;if(-1===r&&t>=f&&t<=v&&(r=d),t+n>=f&&t<v)c=f,u=(h=v)-t;else if(t+n<f){i=f;break}}return{len:u,start:c||0,end:h||0,nextStart:i,buffered:e,bufferedIndex:r}}},{key:"getBuffered",value:function(e){try{return e.buffered||tj}catch(e){return J.log("failed to get media.buffered",e),tj}}}]),e}(),tK=/\{\$([a-zA-Z0-9-_]+)\}/g;function tH(e,t){if(null!==e.variableList||e.hasVariableRefs){var n=e.variableList;return t.replace(tK,function(t){var i=t.substring(2,t.length-1),r=null==n?void 0:n[i];return void 0===r?(e.playlistParsingError||(e.playlistParsingError=Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'.concat(i,'"'))),t):r})}return t}function tV(e,t,n){var i,r,a=e.variableList;if(a||(e.variableList=a={}),"QUERYPARAM"in t){i=t.QUERYPARAM;try{var s=new self.URL(n).searchParams;if(s.has(i))r=s.get(i);else throw Error('"'.concat(i,'" does not match any query parameter in URI: "').concat(n,'"'))}catch(t){e.playlistParsingError||(e.playlistParsingError=Error("EXT-X-DEFINE QUERYPARAM: ".concat(t.message)))}}else i=t.NAME,r=t.VALUE;i in a?e.playlistParsingError||(e.playlistParsingError=Error('EXT-X-DEFINE duplicate Variable Name declarations: "'.concat(i,'"'))):a[i]=r||""}var tq=/^(\d+)x(\d+)$/,tY=/(.+?)=(".*?"|.*?)(?:,|$)/g,tW=function(){"use strict";function e(t,n){(0,E._)(this,e),"string"==typeof t&&(t=e.parseAttrList(t,n)),q(this,t)}return(0,k._)(e,[{key:"clientAttrs",get:function(){return Object.keys(this).filter(function(e){return"X-"===e.substring(0,2)})}},{key:"decimalInteger",value:function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"hexadecimalInteger",value:function(e){if(this[e]){for(var t=(this[e]||"0x").slice(2),n=new Uint8Array((t=(1&t.length?"0":"")+t).length/2),i=0;i<t.length/2;i++)n[i]=parseInt(t.slice(2*i,2*i+2),16);return n}return null}},{key:"hexadecimalIntegerAsNumber",value:function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"decimalFloatingPoint",value:function(e){return parseFloat(this[e])}},{key:"optionalFloat",value:function(e,t){var n=this[e];return n?parseFloat(n):t}},{key:"enumeratedString",value:function(e){return this[e]}},{key:"enumeratedStringList",value:function(e,t){var n=this[e];return(n?n.split(/[ ,]+/):[]).reduce(function(e,t){return e[t.toLowerCase()]=!0,e},t)}},{key:"bool",value:function(e){return"YES"===this[e]}},{key:"decimalResolution",value:function(e){var t=tq.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}}],[{key:"parseAttrList",value:function(e,t){var n,i={};for(tY.lastIndex=0;null!==(n=tY.exec(e));){var r=n[1].trim(),a=n[2],s=0===a.indexOf('"')&&a.lastIndexOf('"')===a.length-1,o=!1;if(s)a=a.slice(1,-1);else switch(r){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":o=!0}if(t&&(s||o))a=tH(t,a);else if(!o&&!s)switch(r){case"CLOSED-CAPTIONS":if("NONE"===a)break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":J.warn("".concat(e,": attribute ").concat(r," is missing quotes"))}i[r]=a}return i}}]),e}(),tz=function(){"use strict";function e(t,n){var i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if((0,E._)(this,e),this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(null==n?void 0:n.tagAnchor)||null,this.tagOrder=null!=(i=null==n?void 0:n.tagOrder)?i:r,n){var a=n.attr;for(var s in a)if(Object.prototype.hasOwnProperty.call(t,s)&&t[s]!==a[s]){J.warn('DATERANGE tag attribute: "'.concat(s,'" does not match for tags with ID: "').concat(t.ID,'"')),this._badValueForSameId=s;break}t=q(new tW({}),a,t)}if(this.attr=t,n?(this._startDate=n._startDate,this._cue=n._cue,this._endDate=n._endDate,this._dateAtEnd=n._dateAtEnd):this._startDate=new Date(t["START-DATE"]),"END-DATE"in this.attr){var o=(null==n?void 0:n.endDate)||new Date(this.attr["END-DATE"]);R(o.getTime())&&(this._endDate=o)}}return(0,k._)(e,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"cue",get:function(){var e=this._cue;return void 0===e?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}},{key:"startTime",get:function(){var e=this.tagAnchor;return null===e||null===e.programDateTime?(J.warn('Expected tagAnchor Fragment with PDT set for DateRange "'.concat(this.id,'": ').concat(e)),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){var e=this._endDate||this._dateAtEnd;if(e)return e;var t=this.duration;return null!==t?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*t):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var e=this.attr.decimalFloatingPoint("DURATION");if(R(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isInterstitial",get:function(){return"com.apple.hls.interstitial"===this.class}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&R(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}]),e}(),tX=function(){"use strict";function e(t){(0,E._)(this,e),this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}return(0,k._)(e,[{key:"reloaded",value:function(e){if(!e){this.advanced=!0,this.updated=!0;return}var t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1}},{key:"hasKey",value:function(e){return this.encryptedFragments.some(function(t){var n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}},{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&R(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var e=this.driftEndTime-this.driftStartTime;return e>0?1e3*(this.driftEnd-this.driftStart)/e:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}},{key:"fragmentStart",get:function(){return this.fragments.length?this.fragments[0].start:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}},{key:"maxPartIndex",get:function(){var e=this.partList;if(e){var t=this.lastPartIndex;if(-1!==t){for(var n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}},{key:"lastPartSn",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}},{key:"expired",get:function(){if(this.live&&this.age&&this.misses<3){var e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}]),e}();function tQ(e,t){return e.length===t.length&&!e.some(function(e,n){return e!==t[n]})}function t$(e,t){return!e&&!t||!!e&&!!t&&tQ(e,t)}function tZ(e){return"AES-128"===e||"AES-256"===e||"AES-256-CTR"===e}function tJ(e){switch(e){case"AES-128":case"AES-256":return 0;case"AES-256-CTR":return 1;default:throw Error("invalid full segment method ".concat(e))}}function t0(e){return Uint8Array.from(atob(e),function(e){return e.charCodeAt(0)})}function t1(e){return Uint8Array.from(unescape(encodeURIComponent(e)),function(e){return e.charCodeAt(0)})}function t2(e){var t=function(e,t,n){var i=e[t];e[t]=e[n],e[n]=i};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}function t3(e){var t=e.split(":"),n=null;if("data"===t[0]&&2===t.length){var i=t[1].split(";"),r=i[i.length-1].split(",");if(2===r.length){var a,s,o="base64"===r[0],l=r[1];o?(i.splice(-1,1),n=t0(l)):(a=t1(l).subarray(0,16),(s=new Uint8Array(16)).set(a,16-a.length),n=s)}}return n}var t5="undefined"!=typeof self?self:void 0,t4="org.w3.clearkey",t8="com.apple.fps",t6="com.microsoft.playready",t9="com.widevine.alpha",t7="org.w3.clearkey",ne="com.apple.streamingkeydelivery",nt="com.microsoft.playready",nn="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function ni(e){switch(e){case ne:return t8;case nt:return t6;case nn:return t9;case t7:return t4}}function nr(e){switch(e){case t8:return ne;case t6:return nt;case t9:return nn;case t4:return t7}}function na(e){var t=e.drmSystems,n=e.widevineLicenseUrl,i=t?[t8,t9,t6,t4].filter(function(e){return!!t[e]}):[];return!i[t9]&&n&&i.push(t9),i}var ns=null!=t5&&null!=(c=t5.navigator)&&c.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function no(e){var t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),n=String.fromCharCode.apply(null,Array.from(t)),i=n.substring(n.indexOf("<"),n.length),r=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(r){var a=r.childNodes[0]?r.childNodes[0].nodeValue:r.getAttribute("VALUE");if(a){var s=t0(a).subarray(0,16);return t2(s),s}}return null}var nl={},nu=function(){"use strict";function e(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5?arguments[5]:void 0;(0,E._)(this,e),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=n,this.keyFormat=i,this.keyFormatVersions=r,this.iv=a,this.encrypted=!!t&&"NONE"!==t,this.isCommonEncryption=this.encrypted&&!tZ(t),null!=s&&s.startsWith("0x")&&(this.keyId=new Uint8Array(er(s)))}return(0,k._)(e,[{key:"matches",value:function(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&tQ(e.keyFormatVersions,this.keyFormatVersions)&&t$(e.iv,this.iv)&&t$(e.keyId,this.keyId)}},{key:"isSupported",value:function(){if(this.method){if(tZ(this.method)||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case ne:case nn:case nt:case t7:return -1!==["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}},{key:"getDecryptData",value:function(t,n){if(!this.encrypted||!this.uri)return null;if(tZ(this.method)){var i,r,a,s=this.iv;return s||("number"!=typeof t&&(J.warn('missing IV for initialization segment with method="'.concat(this.method,'" - compliance issue')),t=0),s=function(e){for(var t=new Uint8Array(16),n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t}(t)),new e(this.method,this.uri,"identity",this.keyFormatVersions,s)}if(this.keyId){var o=nl[this.uri];if(o&&!tQ(this.keyId,o)&&e.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}var l=t3(this.uri);if(l)switch(this.keyFormat){case nn:if(this.pssh=l,!this.keyId){var u=function(e){var t=[];if(e instanceof ArrayBuffer)for(var n=e.byteLength,i=0;i+32<n;){var r=function(e){var t=e.getUint32(0),n=e.byteOffset,i=e.byteLength;if(i<t)return{offset:n,size:i};if(0x70737368!==e.getUint32(4))return{offset:n,size:t};var r=e.getUint32(8)>>>24;if(0!==r&&1!==r)return{offset:n,size:t};var a=e.buffer,s=ei(new Uint8Array(a,n+12,16)),o=null,l=0;if(0===r)l=28;else{var u=e.getUint32(28);if(!u||i<32+16*u)return{offset:n,size:t};o=[];for(var c=0;c<u;c++)o.push(new Uint8Array(a,n+32+16*c,16));l=32+16*u}if(!l)return{offset:n,size:t};var h=e.getUint32(l);return t-32<h?{offset:n,size:t}:{version:r,systemId:s,kids:o,data:new Uint8Array(a,n+l+4,h),offset:n,size:t}}(new DataView(e,i));t.push(r),i+=r.size}return t}(l.buffer);if(u.length){var c,h=u[0];this.keyId=null!=(c=h.kids)&&c.length?h.kids[0]:null}}this.keyId||(this.keyId=nc(n));break;case nt:var d=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=function(e,t,n){if(16!==e.byteLength)throw RangeError("Invalid system id");i=new Uint8Array,r=new Uint8Array;var i,r,a=new Uint8Array(4);return n.byteLength>0&&new DataView(a.buffer).setUint32(0,n.byteLength,!1),function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=n.length,a=8,s=r;s--;)a+=n[s].byteLength;var o=new Uint8Array(a);for(o[0]=a>>24&255,o[1]=a>>16&255,o[2]=a>>8&255,o[3]=255&a,o.set(e,4),s=0,a=8;s<r;s++)o.set(n[s],a),a+=n[s].byteLength;return o}([112,115,115,104],new Uint8Array([0,0,0,0]),e,r,i,a,n)}(d,0,l),this.keyId=no(l);break;default:var f=l.subarray(0,16);if(16!==f.length){var v=new Uint8Array(16);v.set(f,16-f.length),f=v}this.keyId=f}return(!this.keyId||16!==this.keyId.byteLength)&&(!(a=(r=null==(i=n)?void 0:i[nn])?r.keyId:null)&&((a=nc(n))||(a=nl[this.uri])),a&&(this.keyId=a,e.setKeyIdForUri(this.uri,a))),this}}],[{key:"clearKeyUriToKeyIdMap",value:function(){nl={}}},{key:"setKeyIdForUri",value:function(e,t){nl[e]=t}}]),e}();function nc(e){var t=null==e?void 0:e[nt];if(t){var n=t3(t.uri);if(n)return no(n)}return null}var nh=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,nd=/#EXT-X-MEDIA:(.*)/g,nf=/^#EXT(?:INF|-X-TARGETDURATION):/m,nv=RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),ng=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),nm=function(){"use strict";function e(){(0,E._)(this,e)}return(0,k._)(e,null,[{key:"findGroup",value:function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(i.id===t)return i}}},{key:"resolve",value:function(e,t){return es.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}},{key:"isMediaPlaylist",value:function(e){return nf.test(e)}},{key:"parseMasterPlaylist",value:function(t,n){var i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:tK.test(t)},r=[];if(nh.lastIndex=0,!t.startsWith("#EXTM3U"))return i.playlistParsingError=Error("no EXTM3U delimiter"),i;for(;null!=(a=nh.exec(t));)if(a[1]){var a,s,o=new tW(a[1],i),l=tH(i,a[2]),u={attrs:o,bitrate:o.decimalInteger("BANDWIDTH")||o.decimalInteger("AVERAGE-BANDWIDTH"),name:o.NAME,url:e.resolve(l,n)},c=o.decimalResolution("RESOLUTION");c&&(u.width=c.width,u.height=c.height),nk(o.CODECS,u);var h=o["SUPPLEMENTAL-CODECS"];h&&(u.supplemental={},nk(h,u.supplemental)),null!=(s=u.unknownCodecs)&&s.length||r.push(u),i.levels.push(u)}else if(a[3]){var d=a[3],f=a[4];switch(d){case"SESSION-DATA":var v=new tW(f,i),g=v["DATA-ID"];g&&(null===i.sessionData&&(i.sessionData={}),i.sessionData[g]=v);break;case"SESSION-KEY":var m=ny(f,n,i);m.encrypted&&m.isSupported()?(null===i.sessionKeys&&(i.sessionKeys=[]),i.sessionKeys.push(m)):J.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'.concat(f,'"'));break;case"DEFINE":var p=new tW(f,i);tV(i,p,n);break;case"CONTENT-STEERING":var y=new tW(f,i);i.contentSteering={uri:e.resolve(y["SERVER-URI"],n),pathwayId:y["PATHWAY-ID"]||"."};break;case"START":i.startTimeOffset=nE(f)}}var E=r.length>0&&r.length<i.levels.length;return i.levels=E?r:i.levels,0===i.levels.length&&(i.playlistParsingError=Error("no levels found in manifest")),i}},{key:"parseMasterPlaylistMedia",value:function(t,n,i){var r,a={},s=i.levels,o={AUDIO:s.map(function(e){return{id:e.attrs.AUDIO,audioCodec:e.audioCodec}}),SUBTITLES:s.map(function(e){return{id:e.attrs.SUBTITLES,textCodec:e.textCodec}}),"CLOSED-CAPTIONS":[]},l=0;for(nd.lastIndex=0;null!==(r=nd.exec(t));){var u=new tW(r[1],i),c=u.TYPE;if(c){var h=o[c],d=a[c]||[];a[c]=d;var f=u.LANGUAGE,v=u["ASSOC-LANGUAGE"],g=u.CHANNELS,m=u.CHARACTERISTICS,p=u["INSTREAM-ID"],y={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||f||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:f,url:u.URI?e.resolve(u.URI,n):""};if(v&&(y.assocLang=v),g&&(y.channels=g),m&&(y.characteristics=m),p&&(y.instreamId=p),null!=h&&h.length){var E=e.findGroup(h,y.groupId)||h[0];nb(y,E,"audioCodec"),nb(y,E,"textCodec")}d.push(y)}}return a}},{key:"parseLevelPlaylist",value:function(e,t,n,i,r,a){var s,o,l,u,c,h={url:t},d=new tX(t),f=d.fragments,v=[],g=null,m=0,p=0,y=0,E=0,k=0,b=null,T=new ef(i,h),S=-1,_=!1,A=null;if(nv.lastIndex=0,d.m3u8=e,d.hasVariableRefs=tK.test(e),(null==(s=nv.exec(e))?void 0:s[0])!=="#EXTM3U")return d.playlistParsingError=Error("Missing format identifier #EXTM3U"),d;for(;null!==(o=nv.exec(e));){_&&(_=!1,(T=new ef(i,h)).playlistOffset=y,T.setStart(y),T.sn=m,T.cc=E,k&&(T.bitrate=k),T.level=n,g&&(T.initSegment=g,g.rawProgramDateTime&&(T.rawProgramDateTime=g.rawProgramDateTime,g.rawProgramDateTime=null),A&&(T.setByteRange(A),A=null)));var L=o[1];if(L){T.duration=parseFloat(L);var w=(" "+o[2]).slice(1);T.title=w||null,T.tagList.push(w?["INF",L,w]:["INF",L])}else if(o[3]){if(R(T.duration)){T.playlistOffset=y,T.setStart(y),u&&n_(T,u,d),T.sn=m,T.level=n,T.cc=E,f.push(T);var I=(" "+o[3]).slice(1);T.relurl=tH(d,I),nT(T,b,v),b=T,y+=T.duration,m++,p=0,_=!0}}else{if(!(o=o[0].match(ng))){J.warn("No matches on slow regex match for level playlist!");continue}for(l=1;l<o.length&&void 0===o[l];l++);var D=(" "+o[l]).slice(1),C=(" "+o[l+1]).slice(1),x=o[l+2]?(" "+o[l+2]).slice(1):null;switch(D){case"BYTERANGE":b?T.setByteRange(C,b):T.setByteRange(C);break;case"PROGRAM-DATE-TIME":T.rawProgramDateTime=C,T.tagList.push(["PROGRAM-DATE-TIME",C]),-1===S&&(S=f.length);break;case"PLAYLIST-TYPE":d.type&&nA(d,D,o),d.type=C.toUpperCase();break;case"MEDIA-SEQUENCE":0!==d.startSN?nA(d,D,o):f.length>0&&nL(d,D,o),m=d.startSN=parseInt(C);break;case"SKIP":d.skippedSegments&&nA(d,D,o);var P=new tW(C,d),O=P.decimalInteger("SKIPPED-SEGMENTS");if(R(O)){d.skippedSegments+=O;for(var M=O;M--;)f.push(null);m+=O}var F=P.enumeratedString("RECENTLY-REMOVED-DATERANGES");F&&(d.recentlyRemovedDateranges=(d.recentlyRemovedDateranges||[]).concat(F.split("	")));break;case"TARGETDURATION":0!==d.targetduration&&nA(d,D,o),d.targetduration=Math.max(parseInt(C),1);break;case"VERSION":null!==d.version&&nA(d,D,o),d.version=parseInt(C);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":d.live||nA(d,D,o),d.live=!1;break;case"#":(C||x)&&T.tagList.push(x?[C,x]:[C]);break;case"DISCONTINUITY":E++,T.tagList.push(["DIS"]);break;case"GAP":T.gap=!0,T.tagList.push([D]);break;case"BITRATE":T.tagList.push([D,C]),R(k=1e3*parseInt(C))?T.bitrate=k:k=0;break;case"DATERANGE":var N=new tW(C,d),B=new tz(N,d.dateRanges[N.ID],d.dateRangeTagCount);d.dateRangeTagCount++,B.isValid||d.skippedSegments?d.dateRanges[B.id]=B:J.warn('Ignoring invalid DATERANGE tag: "'.concat(C,'"')),T.tagList.push(["EXT-X-DATERANGE",C]);break;case"DEFINE":var U=new tW(C,d);"IMPORT"in U?function(e,t,n){var i=t.IMPORT;if(n&&i in n){var r=e.variableList;r||(e.variableList=r={}),r[i]=n[i]}else e.playlistParsingError||(e.playlistParsingError=Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'.concat(i,'"')))}(d,U,a):tV(d,U,t);break;case"DISCONTINUITY-SEQUENCE":0!==d.startCC?nA(d,D,o):f.length>0&&nL(d,D,o),d.startCC=E=parseInt(C);break;case"KEY":var j=ny(C,t,d);if(j.isSupported()){if("NONE"===j.method){u=void 0;break}u||(u={});var G=u[j.keyFormat];null!=G&&G.matches(j)||(G&&(u=q({},u)),u[j.keyFormat]=j)}else J.warn('[Keys] Ignoring unsupported EXT-X-KEY tag: "'.concat(C,'"'));break;case"START":d.startTimeOffset=nE(C);break;case"MAP":var K=new tW(C,d);if(T.duration){var H=new ef(i,h);nS(H,K,n,u),g=H,T.initSegment=g,g.rawProgramDateTime&&!T.rawProgramDateTime&&(T.rawProgramDateTime=g.rawProgramDateTime)}else{var V=T.byteRangeEndOffset;if(V){var Y=T.byteRangeStartOffset;A="".concat(V-Y,"@").concat(Y)}else A=null;nS(T,K,n,u),g=T,_=!0}g.cc=E;break;case"SERVER-CONTROL":c&&nA(d,D,o),d.canBlockReload=(c=new tW(C)).bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=c.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&c.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=c.optionalFloat("PART-HOLD-BACK",0),d.holdBack=c.optionalFloat("HOLD-BACK",0);break;case"PART-INF":d.partTarget&&nA(d,D,o),d.partTarget=new tW(C).decimalFloatingPoint("PART-TARGET");break;case"PART":var W=d.partList;W||(W=d.partList=[]);var z=p>0?W[W.length-1]:void 0,X=p++,Q=new ev(new tW(C,d),T,h,X,z);W.push(Q),T.duration+=Q.duration;break;case"PRELOAD-HINT":var $=new tW(C,d);d.preloadHint=$;break;case"RENDITION-REPORT":var Z=new tW(C,d);d.renditionReports=d.renditionReports||[],d.renditionReports.push(Z);break;default:J.warn("line parsed but not handled: ".concat(o))}}}b&&!b.relurl?(f.pop(),y-=b.duration,d.partList&&(d.fragmentHint=b)):d.partList&&(nT(T,b,v),T.cc=E,d.fragmentHint=T,u&&n_(T,u,d)),d.targetduration||(d.playlistParsingError=Error("Missing Target Duration"));var ee=f.length,et=f[0],en=f[ee-1];if((y+=d.skippedSegments*d.targetduration)>0&&ee&&en){d.averagetargetduration=y/ee;var ei=en.sn;d.endSN="initSegment"!==ei?ei:0,d.live||(en.endList=!0),S>0&&(function(e,t){for(var n=e[t],i=t;i--;){var r=e[i];if(!r)return;r.programDateTime=n.programDateTime-1e3*r.duration,n=r}}(f,S),et&&v.unshift(et))}return d.fragmentHint&&(y+=d.fragmentHint.duration),d.totalduration=y,v.length&&d.dateRangeTagCount&&et&&np(v,d),d.endCC=E,d}}]),e}();function np(e,t){var n=e.length;if(!n)if(!t.hasProgramDateTime)return;else{var i=t.fragments[t.fragments.length-1];e.push(i),n++}for(var r=e[n-1],a=t.live?1/0:t.totalduration,s=Object.keys(t.dateRanges),o=s.length;o--;){var l=t.dateRanges[s[o]],u=l.startDate.getTime();l.tagAnchor=r.ref;for(var c=n;c--&&!((null==(h=e[c])?void 0:h.sn)<t.startSN);){var h,d=function(e,t,n,i,r){var a=n[i];if(a){var s,o=a.programDateTime;if((t>=o||0===i)&&t<=o+1e3*(((null==(s=n[i+1])?void 0:s.start)||r)-a.start)){var l=n[i].sn-e.startSN;if(l<0)return -1;var u=e.fragments;if(u.length>n.length)for(var c=(n[i+1]||u[u.length-1]).sn-e.startSN,h=c;h>l;h--){var d=u[h].programDateTime;if(t>=d&&t<d+1e3*u[h].duration)return h}return l}}return -1}(t,u,e,c,a);if(-1!==d){l.tagAnchor=t.fragments[d].ref;break}}}}function ny(e,t,n){var i,r,a=new tW(e,n),s=null!=(i=a.METHOD)?i:"",o=a.URI,l=a.hexadecimalInteger("IV"),u=a.KEYFORMATVERSIONS,c=null!=(r=a.KEYFORMAT)?r:"identity";return o&&a.IV&&!l&&J.error("Invalid IV: ".concat(a.IV)),new nu(s,o?nm.resolve(o,t):"",c,(u||"1").split("/").map(Number).filter(Number.isFinite),l,a.KEYID)}function nE(e){var t=new tW(e).decimalFloatingPoint("TIME-OFFSET");return R(t)?t:null}function nk(e,t){var n=(e||"").split(/[ ,]+/).filter(function(e){return e});["video","audio","text"].forEach(function(e){var i=n.filter(function(t){return eN(t,e)});i.length&&(t["".concat(e,"Codec")]=i.map(function(e){return e.split("/")[0]}).join(","),n=n.filter(function(e){return -1===i.indexOf(e)}))}),t.unknownCodecs=n}function nb(e,t,n){var i=t[n];i&&(e[n]=i)}function nT(e,t,n){e.rawProgramDateTime?n.push(e):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime)}function nS(e,t,n,i){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=n,e.sn="initSegment",i&&(e.levelkeys=i),e.initSegment=null}function n_(e,t,n){e.levelkeys=t;var i=n.encryptedFragments;(!i.length||i[i.length-1].levelkeys!==t)&&Object.keys(t).some(function(e){return t[e].isCommonEncryption})&&i.push(e)}function nA(e,t,n){e.playlistParsingError=Error("#EXT-X-".concat(t," must not appear more than once (").concat(n[0],")"))}function nL(e,t,n){e.playlistParsingError=Error("#EXT-X-".concat(t," must appear before the first Media Segment (").concat(n[0],")"))}function nw(e,t){var n=t.startPTS;if(R(n)){var i,r=0;t.sn>e.sn?(r=n-e.start,i=e):(r=e.start-n,i=t),i.duration!==r&&i.setDuration(r)}else t.sn>e.sn?e.cc===t.cc&&e.minEndPTS?t.setStart(e.start+(e.minEndPTS-e.start)):t.setStart(e.start+e.duration):t.setStart(Math.max(e.start-t.duration,0))}function nI(e,t,n,i,r,a,s){i-n<=0&&(s.warn("Fragment should have a positive duration",t),i=n+t.duration,a=r+t.duration);var o,l=n,u=i,c=t.startPTS,h=t.endPTS;if(R(c)){var d=Math.abs(c-n);e&&d>e.totalduration?s.warn("media timestamps and playlist times differ by ".concat(d,"s for level ").concat(t.level," ").concat(e.url)):R(t.deltaPTS)?t.deltaPTS=Math.max(d,t.deltaPTS):t.deltaPTS=d,l=Math.max(n,c),n=Math.min(n,c),r=void 0!==t.startDTS?Math.min(r,t.startDTS):r,u=Math.min(i,h),i=Math.max(i,h),a=void 0!==t.endDTS?Math.max(a,t.endDTS):a}var f=n-t.start;0!==t.start&&t.setStart(n),t.setDuration(i-t.start),t.startPTS=n,t.maxStartPTS=l,t.startDTS=r,t.endPTS=i,t.minEndPTS=u,t.endDTS=a;var v=t.sn;if(!e||v<e.startSN||v>e.endSN)return 0;var g=v-e.startSN,m=e.fragments;for(m[g]=t,o=g;o>0;o--)nw(m[o],m[o-1]);for(o=g;o<m.length-1;o++)nw(m[o],m[o+1]);return e.fragmentHint&&nw(m[m.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,f}function nR(e,t,n,i,r){return Error("".concat(e," ").concat(r.url,"\nPlaylist starting @").concat(t.startSN,"\n").concat(t.m3u8,"\n\nPlaylist starting @").concat(n.startSN,"\n").concat(n.m3u8))}function nD(e,t){var n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],i=t.startSN+t.skippedSegments-e.startSN,r=e.fragments,a=i>=0,s=0;if(a&&i<r.length)s=r[i].start;else if(a&&t.startSN===e.endSN+1)s=e.fragmentEnd;else if(a&&n)s=e.fragmentStart+i*t.levelTargetDuration;else{if(t.skippedSegments||0!==t.fragmentStart)return;s=e.fragmentStart}nC(t,s)}function nC(e,t){if(t){for(var n=e.fragments,i=e.skippedSegments;i<n.length;i++)n[i].addStart(t);e.fragmentHint&&e.fragmentHint.addStart(t)}}function nx(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=1e3*e.targetduration;if(e.updated){var i=e.fragments;if(i.length&&4*n>t){var r=1e3*i[i.length-1].duration;r<n&&(n=r)}}else n/=2;return Math.round(n)}function nP(e,t,n){if(!e)return null;var i=e.fragments[t-e.startSN];return i||(i=e.fragmentHint)&&i.sn===t?i:t<e.startSN&&n&&n.sn===t?n:null}function nO(e,t,n){return e?nM(e.partList,t,n):null}function nM(e,t,n){if(e)for(var i=e.length;i--;){var r=e[i];if(r.index===n&&r.fragment.sn===t)return r}return null}function nF(e){e.forEach(function(e,t){var n;null==(n=e.details)||n.fragments.forEach(function(e){e.level=t,e.initSegment&&(e.initSegment.level=t)})})}function nN(e){return e.replace(/\?[^?]*$/,"")}function nB(e,t){for(var n,i=0,r=e.length;i<r;i++)if((null==(n=e[i])?void 0:n.cc)===t)return e[i];return null}function nU(e,t){var n=e.start+t;e.startPTS=n,e.setStart(n),e.endPTS=n+e.duration}function nj(e,t){for(var n=t.fragments,i=0,r=n.length;i<r;i++)nU(n[i],e);t.fragmentHint&&nU(t.fragmentHint,e),t.alignedSliding=!0}function nG(e,t){if(t&&e.startCC<t.endCC&&e.endCC>t.startCC){var n=Math.min(t.endCC,e.endCC),i=nB(t.fragments,n),r=nB(e.fragments,n);i&&r&&(J.log("Aligning playlist at start of dicontinuity sequence ".concat(n)),nj(i.start-r.start,e))}}function nK(e,t){if(e.hasProgramDateTime&&t.hasProgramDateTime){var n,i,r=e.fragments,a=t.fragments;if(r.length&&a.length){var s=Math.min(t.endCC,e.endCC);t.startCC<s&&e.startCC<s&&(n=nB(a,s),i=nB(r,s)),n&&i||(i=nB(r,(n=a[Math.floor(a.length/2)]).cc)||r[Math.floor(r.length/2)]);var o=n.programDateTime,l=i.programDateTime;o&&l&&nj((l-o)/1e3-(i.start-n.start),e)}}}function nH(e,t,n){nV(e,t,n),e.addEventListener(t,n)}function nV(e,t,n){e.removeEventListener(t,n)}var nq=function(e){for(var t="",n=e.length,i=0;i<n;i++)t+="[".concat(e.start(i).toFixed(3),"-").concat(e.end(i).toFixed(3),"]");return t},nY="STOPPED",nW="IDLE",nz="KEY_LOADING",nX="FRAG_LOADING",nQ="FRAG_LOADING_WAITING_RETRY",n$="WAITING_TRACK",nZ="PARSING",nJ="PARSED",n0="ENDED",n1="ERROR",n2="WAITING_INIT_PTS",n3="WAITING_LEVEL",n5=function(e){"use strict";function t(e,n,i,r,a){var s;return(0,E._)(this,t),(s=(0,y._)(this,t,[r,e.logger])).hls=void 0,s.fragPrevious=null,s.fragCurrent=null,s.fragmentTracker=void 0,s.transmuxer=null,s._state=nY,s.playlistType=void 0,s.media=null,s.mediaBuffer=null,s.config=void 0,s.bitrateTest=!1,s.lastCurrentTime=0,s.nextLoadPosition=0,s.startPosition=0,s.startTimeOffset=null,s.retryDate=0,s.levels=null,s.fragmentLoader=void 0,s.keyLoader=void 0,s.levelLastLoaded=null,s.startFragRequested=!1,s.decrypter=void 0,s.initPTS=[],s.buffering=!0,s.loadingParts=!1,s.loopSn=void 0,s.onMediaSeeking=function(){var e=s.config,t=s.fragCurrent,n=s.media,i=s.mediaBuffer,r=s.state,a=n?n.currentTime:0,o=tG.bufferInfo(i||n,a,e.maxBufferHole),l=!o.len;if(s.log("Media seeking to ".concat(R(a)?a.toFixed(3):a,", state: ").concat(r,", ").concat(l?"out of":"in"," buffer")),s.state===n0)s.resetLoadingState();else if(t){var u=e.maxFragLookUpTolerance,c=t.start-u,h=t.start+t.duration+u;if(l||h<o.start||c>o.end){var d=a>h;(a<c||d)&&(d&&t.loader&&(s.log("Cancelling fragment load for seek (sn: ".concat(t.sn,")")),t.abortRequests(),s.resetLoadingState()),s.fragPrevious=null)}}if(n&&(s.fragmentTracker.removeFragmentsInRange(a,1/0,s.playlistType,!0),a>s.lastCurrentTime&&(s.lastCurrentTime=a),!s.loadingParts)){var f=Math.max(o.end,a),v=s.shouldLoadParts(s.getLevelDetails(),f);v&&(s.log("LL-Part loading ON after seeking to ".concat(a.toFixed(2)," with buffer @").concat(f.toFixed(2))),s.loadingParts=v)}!s.hls.hasEnoughToStart&&(s.log("Setting ".concat(l?"startPosition":"nextLoadPosition"," to ").concat(a," for seek without enough to start")),s.nextLoadPosition=a,l&&(s.startPosition=a)),l&&s.state===nW&&s.tickImmediate()},s.onMediaEnded=function(){s.log("setting startPosition to 0 because media ended"),s.startPosition=s.lastCurrentTime=0},s.playlistType=a,s.hls=e,s.fragmentLoader=new tP(e.config),s.keyLoader=i,s.fragmentTracker=n,s.config=e.config,s.decrypter=new tx(e.config),s}return(0,_._)(t,e),(0,k._)(t,[{key:"registerListeners",value:function(){var e=this.hls;e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(O.ERROR,this.onError,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(O.ERROR,this.onError,this)}},{key:"doTick",value:function(){this.onTickEnd()}},{key:"onTickEnd",value:function(){}},{key:"startLoad",value:function(e){}},{key:"stopLoad",value:function(){if(this.state!==nY){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=nY}}},{key:"startPositionValue",get:function(){var e=this.nextLoadPosition,t=this.startPosition;return -1===t&&e?e:t}},{key:"bufferingEnabled",get:function(){return this.buffering}},{key:"pauseBuffering",value:function(){this.buffering=!1}},{key:"resumeBuffering",value:function(){this.buffering=!0}},{key:"inFlightFrag",get:function(){return{frag:this.fragCurrent,state:this.state}}},{key:"_streamEnded",value:function(e,t){if(t.live||!this.media)return!1;var n=e.end||0,i=this.config.timelineOffset||0;if(n<=i)return!1;var r=e.buffered;this.config.maxBufferHole&&r&&r.length>1&&(e=tG.bufferedInfo(r,e.start,0));var a=e.nextStart;if(a&&a>i&&a<t.edge||this.media.currentTime<e.start)return!1;var s=t.partList;if(null!=s&&s.length){var o=s[s.length-1];return tG.isBuffered(this.media,o.start+o.duration/2)}var l=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(l)}},{key:"getLevelDetails",value:function(){if(this.levels&&null!==this.levelLastLoaded)return this.levelLastLoaded.details}},{key:"timelineOffset",get:function(){var e,t=this.config.timelineOffset;return t?(null==(e=this.getLevelDetails())?void 0:e.appliedTimelineOffset)||t:0}},{key:"onMediaAttached",value:function(e,t){var n=this.media=this.mediaBuffer=t.media;nH(n,"seeking",this.onMediaSeeking),nH(n,"ended",this.onMediaEnded);var i=this.config;this.levels&&i.autoStartLoad&&this.state===nY&&this.startLoad(i.startPosition)}},{key:"onMediaDetaching",value:function(e,t){var n=!!t.transferMedia,i=this.media;if(null!==i){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),nV(i,"seeking",this.onMediaSeeking),nV(i,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}},{key:"onManifestLoading",value:function(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}},{key:"onError",value:function(e,t){}},{key:"onManifestLoaded",value:function(e,t){this.startTimeOffset=t.startTimeOffset}},{key:"onHandlerDestroying",value:function(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),(0,T._)((0,S._)(t.prototype),"onHandlerDestroying",this).call(this),this.hls=this.onMediaSeeking=this.onMediaEnded=null}},{key:"onHandlerDestroyed",value:function(){this.state=nY,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,(0,T._)((0,S._)(t.prototype),"onHandlerDestroyed",this).call(this)}},{key:"loadFragment",value:function(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}},{key:"_loadFragForPlayback",value:function(e,t,n){var i=this;this._doFragLoad(e,t,n,function(e){var t=e.frag;if(i.fragContextChanged(t)){i.warn("".concat(t.type," sn: ").concat(t.sn).concat(e.part?" part: "+e.part.index:""," of ").concat(i.fragInfo(t,!1,e.part),") was dropped during download.")),i.fragmentTracker.removeFragment(t);return}t.stats.chunkCount++,i._handleFragmentLoadProgress(e)}).then(function(e){if(e){var t=i.state,n=e.frag;if(i.fragContextChanged(n)){t!==nX&&(i.fragCurrent||t!==nZ)||(i.fragmentTracker.removeFragment(n),i.state=nW);return}"payload"in e&&(i.log("Loaded ".concat(n.type," sn: ").concat(n.sn," of ").concat(i.playlistLabel()," ").concat(n.level)),i.hls.trigger(O.FRAG_LOADED,e)),i._handleFragmentLoadComplete(e)}}).catch(function(t){i.state!==nY&&i.state!==n1&&(i.warn("Frag error: ".concat((null==t?void 0:t.message)||t)),i.resetFragmentLoading(e))})}},{key:"clearTrackerIfNeeded",value:function(e){var t,n=this.fragmentTracker;if(n.getState(e)===tS){var i=e.type,r=this.getFwdBufferInfo(this.mediaBuffer,i),a=Math.max(e.duration,r?r.len:this.config.maxBufferLength),s=this.backtrackFragment;(1==(s?e.sn-s.sn:0)||this.reduceMaxBufferLength(a,e.duration))&&n.removeFragment(e)}else(null==(t=this.mediaBuffer)?void 0:t.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===t_&&n.removeFragment(e))}},{key:"checkLiveUpdate",value:function(e){if(e.updated&&!e.live){var t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}},{key:"waitForLive",value:function(e){var t=e.details;return(null==t?void 0:t.live)&&"EVENT"!==t.type&&(this.levelLastLoaded!==e||t.expired)}},{key:"flushMainBuffer",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e-t&&this.hls.trigger(O.BUFFER_FLUSHING,{startOffset:e,endOffset:t,type:n})}},{key:"_loadInitSegment",value:function(e,t){var n=this;this._doFragLoad(e,t).then(function(e){var t=null==e?void 0:e.frag;if(!t||n.fragContextChanged(t)||!n.levels)throw Error("init load aborted");return e}).then(function(e){var t=n.hls,i=e.frag,r=e.payload,a=i.decryptdata;if(r&&r.byteLength>0&&null!=a&&a.key&&a.iv&&tZ(a.method)){var s=self.performance.now();return n.decrypter.decrypt(new Uint8Array(r),a.key.buffer,a.iv.buffer,tJ(a.method)).catch(function(e){throw t.trigger(O.ERROR,{type:x.MEDIA_ERROR,details:P.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:i}),e}).then(function(r){var a=self.performance.now();return t.trigger(O.FRAG_DECRYPTED,{frag:i,payload:r,stats:{tstart:s,tdecrypt:a}}),e.payload=r,n.completeInitSegmentLoad(e)})}return n.completeInitSegmentLoad(e)}).catch(function(t){n.state!==nY&&n.state!==n1&&(n.warn(t),n.resetFragmentLoading(e))})}},{key:"completeInitSegmentLoad",value:function(e){if(!this.levels)throw Error("init load aborted, missing levels");var t=e.frag.stats;this.state!==nY&&(this.state=nW),e.frag.data=new Uint8Array(e.payload),t.parsing.start=t.buffering.start=self.performance.now(),t.parsing.end=t.buffering.end=self.performance.now(),this.tick()}},{key:"unhandledEncryptionError",value:function(e,t){var n,i,r=e.tracks;if(r&&!t.encrypted&&(null!=(n=r.audio)&&n.encrypted||null!=(i=r.video)&&i.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){var a=this.media,s=Error("Encrypted track with no key in ".concat(this.fragInfo(t)," (media ").concat(a?"attached mediaKeys: "+a.mediaKeys:"detached",")"));return this.warn(s.message),!!a&&!a.mediaKeys&&(this.hls.trigger(O.ERROR,{type:x.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_NO_KEYS,fatal:!1,error:s,frag:t}),this.resetTransmuxer(),!0)}return!1}},{key:"fragContextChanged",value:function(e){var t=this.fragCurrent;return!e||!t||e.sn!==t.sn||e.level!==t.level}},{key:"fragBufferedComplete",value:function(e,t){var n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered ".concat(e.type," sn: ").concat(e.sn).concat(t?" part: "+t.index:""," of ").concat(this.fragInfo(e,!1,t)," > buffer:").concat(n?nq(tG.getBuffered(n)):"(detached)",")")),ed(e)){if(e.type!==K){var i,r=e.elementaryStreams;if(!Object.keys(r).some(function(e){return!!r[e]})){this.state=nW;return}}var a=null==(i=this.levels)?void 0:i[e.level];null!=a&&a.fragmentError&&(this.log("Resetting level fragment error count of ".concat(a.fragmentError," on frag buffered")),a.fragmentError=0)}this.state=nW}},{key:"_handleFragmentLoadComplete",value:function(e){var t=this.transmuxer;if(t){var n=e.frag,i=e.part,r=e.partsLoaded,a=!r||0===r.length||r.some(function(e){return!e}),s=new tB(n.level,n.sn,n.stats.chunkCount+1,0,i?i.index:-1,!a);t.flush(s)}}},{key:"_handleFragmentLoadProgress",value:function(e){}},{key:"_doFragLoad",value:function(e,t){var n,i,r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3?arguments[3]:void 0;this.fragCurrent=e;var o=t.details;if(!this.levels||!o)throw Error("frag load aborted, missing level".concat(o?"":" detail","s"));var l=null;if(e.encrypted&&!(null!=(f=e.decryptdata)&&f.key)){if(this.log("Loading key for ".concat(e.sn," of [").concat(o.startSN,"-").concat(o.endSN,"], ").concat(this.playlistLabel()," ").concat(e.level)),this.state=nz,this.fragCurrent=e,l=this.keyLoader.load(e).then(function(e){if(!r.fragContextChanged(e.frag))return r.hls.trigger(O.KEY_LOADED,e),r.state===nz&&(r.state=nW),e}),this.hls.trigger(O.KEY_LOADING,{frag:e}),null===this.fragCurrent)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else!e.encrypted&&(l=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested))&&this.log("[eme] blocking frag load until media-keys acquired");var u=this.fragPrevious;if(ed(e)&&(!u||e.sn!==u.sn)){var c=this.shouldLoadParts(t.details,e.end);c!==this.loadingParts&&(this.log("LL-Part loading ".concat(c?"ON":"OFF"," loading sn ").concat(null==u?void 0:u.sn,"->").concat(e.sn)),this.loadingParts=c)}if(a=Math.max(e.start,a||0),this.loadingParts&&ed(e)){var h=o.partList;if(h&&s){a>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);var d=this.getNextPart(h,e,a);if(d>-1){var f,v,g=h[d];return(e=this.fragCurrent=g.fragment,this.log("Loading ".concat(e.type," sn: ").concat(e.sn," part: ").concat(g.index," (").concat(d,"/").concat(h.length-1,") of ").concat(this.fragInfo(e,!1,g),") cc: ").concat(e.cc," [").concat(o.startSN,"-").concat(o.endSN,"], target: ").concat(parseFloat(a.toFixed(3)))),this.nextLoadPosition=g.start+g.duration,this.state=nX,v=l?l.then(function(n){return!n||r.fragContextChanged(n.frag)?null:r.doFragPartsLoad(e,g,t,s)}).catch(function(e){return r.handleFragLoadError(e)}):this.doFragPartsLoad(e,g,t,s).catch(function(e){return r.handleFragLoadError(e)}),this.hls.trigger(O.FRAG_LOADING,{frag:e,part:g,targetBufferTime:a}),null===this.fragCurrent)?Promise.reject(Error("frag load aborted, context changed in FRAG_LOADING parts")):v}if(!e.url||this.loadedEndOfParts(h,a))return Promise.resolve(null)}}if(ed(e)&&this.loadingParts)this.log("LL-Part loading OFF after next part miss @".concat(a.toFixed(2)," Check buffer at sn: ").concat(e.sn," loaded parts: ").concat(null==(n=o.partList)?void 0:n.filter(function(e){return e.loaded}).map(function(e){return"[".concat(e.start,"-").concat(e.end,"]")}))),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log("Loading ".concat(e.type," sn: ").concat(e.sn," of ").concat(this.fragInfo(e,!1),") cc: ").concat(e.cc," ").concat("["+o.startSN+"-"+o.endSN+"]",", target: ").concat(parseFloat(a.toFixed(3)))),R(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=nX;var m=this.config.progressive;return(i=m&&l?l.then(function(t){return!t||r.fragContextChanged(t.frag)?null:r.fragmentLoader.load(e,s)}).catch(function(e){return r.handleFragLoadError(e)}):Promise.all([this.fragmentLoader.load(e,m?s:void 0),l]).then(function(e){var t=(0,A._)(e,1)[0];return!m&&s&&s(t),t}).catch(function(e){return r.handleFragLoadError(e)}),this.hls.trigger(O.FRAG_LOADING,{frag:e,targetBufferTime:a}),null===this.fragCurrent)?Promise.reject(Error("frag load aborted, context changed in FRAG_LOADING")):i}},{key:"doFragPartsLoad",value:function(e,t,n,i){var r=this;return new Promise(function(a,s){var o,l=[],u=null==(o=n.details)?void 0:o.partList,c=function(t){r.fragmentLoader.loadPart(e,t,i).then(function(i){l[t.index]=i;var s=i.part;r.hls.trigger(O.FRAG_LOADED,i);var o=nO(n.details,e.sn,t.index+1)||nM(u,e.sn,t.index+1);if(!o)return a({frag:e,part:s,partsLoaded:l});c(o)}).catch(s)};c(t)})}},{key:"handleFragLoadError",value:function(e){if("data"in e){var t=e.data;t.frag&&t.details===P.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===x.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(O.ERROR,t)}else this.hls.trigger(O.ERROR,{type:x.OTHER_ERROR,details:P.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}},{key:"_handleTransmuxerFlush",value:function(e){var t=this.getCurrentContext(e);if(!t||this.state!==nZ){this.fragCurrent||this.state===nY||this.state===n1||(this.state=nW);return}var n=t.frag,i=t.part,r=t.level,a=self.performance.now();n.stats.parsing.end=a,i&&(i.stats.parsing.end=a);var s=this.getLevelDetails(),o=s&&n.sn>s.endSN||this.shouldLoadParts(s,n.end);o!==this.loadingParts&&(this.log("LL-Part loading ".concat(o?"ON":"OFF"," after parsing segment ending @").concat(n.end.toFixed(2))),this.loadingParts=o),this.updateLevelTiming(n,i,r,e.partial)}},{key:"shouldLoadParts",value:function(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n,i,r=e.partList[0];if(r.fragment.type===K)return!1;if(t>=r.end+((null==(n=e.fragmentHint)?void 0:n.duration)||0)&&(this.hls.hasEnoughToStart?(null==(i=this.media)?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}return!1}},{key:"getCurrentContext",value:function(e){var t=this.levels,n=this.fragCurrent,i=e.level,r=e.sn,a=e.part;if(!(null!=t&&t[i]))return this.warn("Levels object was unset while buffering fragment ".concat(r," of ").concat(this.playlistLabel()," ").concat(i,". The current chunk will not be buffered.")),null;var s=t[i],o=s.details,l=a>-1?nO(o,r,a):null,u=l?l.fragment:nP(o,r,n);return u?(n&&n!==u&&(u.stats=n.stats),{frag:u,part:l,level:s}):null}},{key:"bufferFragmentData",value:function(e,t,n,i,r){if(this.state===nZ){var a=e.data1,s=e.data2,o=a;if(s&&(o=eD(a,s)),o.length){var l=this.initPTS[t.cc],u=l?-l.baseTime/l.timescale:void 0,c={type:e.type,frag:t,part:n,chunkMeta:i,offset:u,parent:t.type,data:o};if(this.hls.trigger(O.BUFFER_APPENDING,c),e.dropped&&e.independent&&!n){if(r)return;this.flushBufferGap(t)}}}}},{key:"flushBufferGap",value:function(e){var t=this.media;if(t){if(!tG.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);var n=t.currentTime,i=tG.bufferInfo(t,n,0),r=e.duration,a=Math.min(2*this.config.maxFragLookUpTolerance,.25*r),s=Math.max(Math.min(e.start-a,i.end-a),n+a);e.start-s>a&&this.flushMainBuffer(s,e.start)}}},{key:"getFwdBufferInfo",value:function(e,t){var n,i=this.getLoadPosition();if(!R(i))return null;var r=this.lastCurrentTime>i||null!=(n=this.media)&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,t,r)}},{key:"getFwdBufferInfoAtPos",value:function(e,t,n,i){var r=tG.bufferInfo(e,t,i);if(0===r.len&&void 0!==r.nextStart){var a=this.fragmentTracker.getBufferedFrag(t,n);if(a&&(r.nextStart<=a.end||a.gap)){var s=Math.max(Math.min(r.nextStart,a.end)-t,i);return tG.bufferInfo(e,t,s)}}return r}},{key:"getMaxBufferLength",value:function(e){var t=this.config;return Math.min(e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,t.maxMaxBufferLength)}},{key:"reduceMaxBufferLength",value:function(e,t){var n=this.config,i=Math.max(Math.min(e-t,n.maxBufferLength),t),r=Math.max(e-3*t,n.maxMaxBufferLength/2,i);return r>=i&&(n.maxMaxBufferLength=r,this.warn("Reduce max buffer length to ".concat(r,"s")),!0)}},{key:"getAppendedFrag",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j,n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}},{key:"getNextFragment",value:function(e,t){var n=t.fragments,i=n.length;if(!i)return null;var r=this.config,a=n[0].start,s=r.lowLatencyMode&&!!t.partList,o=null;if(t.live){var l=r.initialLiveManifestSize;if(i<l)return this.warn("Not enough fragments to start playback (have: ".concat(i,", need: ").concat(l,")")),null;if(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<a){s&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),o=this.getInitialLiveFragment(t);var u,c=this.hls.startPosition,h=this.hls.liveSyncPosition,d=o?(-1!==c&&c>=a?c:h)||o.start:e;this.log("Setting startPosition to ".concat(d," to match start frag at live edge. mainStart: ").concat(c," liveSyncPosition: ").concat(h," frag.start: ").concat(null==(u=o)?void 0:u.start)),this.startPosition=this.nextLoadPosition=d}}else e<=a&&(o=n[0]);if(!o){var f=this.loadingParts?t.partEnd:t.fragmentEnd;o=this.getFragmentAtPosition(e,f,t)}var v=this.filterReplacedPrimary(o,t);if(!v&&o){var g=o.sn-t.startSN;v=this.filterReplacedPrimary(n[g+1]||null,t)}return this.mapToInitFragWhenRequired(v)}},{key:"isLoopLoading",value:function(e,t){var n=this.fragmentTracker.getState(e);return("OK"===n||n===t_&&!!e.gap)&&this.nextLoadPosition>t}},{key:"getNextFragmentLoopLoading",value:function(e,t,n,i,r){var a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t))&&!a.gap&&n.nextStart){var s=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,i,0);if(null!==s&&n.len+s.len>=r){var o=a.sn;return this.loopSn!==o&&(this.log('buffer full after gaps in "'.concat(i,'" playlist starting at sn: ').concat(o)),this.loopSn=o),null}}return this.loopSn=void 0,a}},{key:"primaryPrefetch",get:function(){if(n4(this.config)){var e;if(null==(e=this.hls.interstitialsManager)||null==(e=e.playingItem)?void 0:e.event)return!0}return!1}},{key:"filterReplacedPrimary",value:function(e,t){if(!e)return e;if(n4(this.config)&&e.type!==K){var n=this.hls.interstitialsManager,i=null==n?void 0:n.bufferingItem;if(i){var r=i.event;if(r){if(r.appendInPlace||Math.abs(e.start-i.start)>1||0===i.start)return null}else if(e.end<=i.start&&(null==t?void 0:t.live)===!1||e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}var a=null==n?void 0:n.playerQueue;if(a)for(var s=a.length;s--;){var o=a[s].interstitial;if(o.appendInPlace&&e.start>=o.startTime&&e.end<=o.resumeTime)return null}}return e}},{key:"mapToInitFragWhenRequired",value:function(e){return null==e||!e.initSegment||e.initSegment.data||this.bitrateTest?e:e.initSegment}},{key:"getNextPart",value:function(e,t,n){for(var i=-1,r=!1,a=!0,s=0,o=e.length;s<o;s++){var l=e[s];if(a=a&&!l.independent,i>-1&&n<l.start)break;var u=l.loaded;u?i=-1:(r||(l.independent||a)&&l.fragment===t)&&(l.fragment!==t&&this.warn("Need buffer at ".concat(n," but next unloaded part starts at ").concat(l.start)),i=s),r=u}return i}},{key:"loadedEndOfParts",value:function(e,t){for(var n,i=e.length;i--&&(n=e[i]).loaded;)if(t>n.start)return!0;return!1}},{key:"getInitialLiveFragment",value:function(e){var t=e.fragments,n=this.fragPrevious,i=null;if(n){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: ".concat(n.programDateTime)),i=function(e,t,n){if(null===t||!Array.isArray(e)||!e.length||!R(t)||t<(e[0].programDateTime||0)||t>=(e[e.length-1].endProgramDateTime||0))return null;for(var i=0;i<e.length;++i){var r=e[i];if(function(e,t,n){var i=1e3*Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-i>e}(t,n,r))return r}return null}(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){var r=n.sn+1;if(r>=e.startSN&&r<=e.endSN){var a=t[r-e.startSN];n.cc===a.cc&&(i=a,this.log("Live playlist, switching playlist, load frag with next SN: ".concat(i.sn)))}!i&&(i=th(e,n.cc,n.end))&&this.log("Live playlist, switching playlist, load frag with same CC: ".concat(i.sn))}}else{var s=this.hls.liveSyncPosition;null!==s&&(i=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}},{key:"getFragmentAtPosition",value:function(e,t,n){var i=this.config,r=this.fragPrevious,a=n.fragments,s=n.endSN,o=n.fragmentHint,l=i.maxFragLookUpTolerance,u=n.partList,c=!!(this.loadingParts&&null!=u&&u.length&&o);if(c&&!this.bitrateTest&&u[u.length-1].fragment.sn===o.sn&&(a=a.concat(o),s=o.sn),e<t){var h,d,f=e<this.lastCurrentTime||e>t-l||null!=(d=this.media)&&d.paused||!this.startFragRequested?0:l;h=tu(r,a,e,f)}else h=a[a.length-1];if(h){var v=h.sn-n.startSN,g=this.fragmentTracker.getState(h);if(("OK"===g||g===t_&&h.gap)&&(r=h),r&&h.sn===r.sn&&(!c||u[0].fragment.sn>h.sn||!n.live)&&h.level===r.level){var m=a[v+1];h=h.sn<s&&"OK"!==this.fragmentTracker.getState(m)?m:null}}return h}},{key:"alignPlaylists",value:function(e,t,n){var i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;var r=e.fragmentStart,a=!t,s=e.alignedSliding&&R(r);if(a||!s&&!r){n&&(nG(e,n),e.alignedSliding||nK(e,n),e.alignedSliding||e.skippedSegments||nD(n,e,!1));var o=e.fragmentStart;return this.log("Live playlist sliding: ".concat(o.toFixed(2)," start-sn: ").concat(t?t.startSN:"na","->").concat(e.startSN," fragments: ").concat(i)),o}return r}},{key:"waitForCdnTuneIn",value:function(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}},{key:"setStartPosition",value:function(e,t){var n=this.startPosition;n<t&&(n=-1);var i=this.timelineOffset;if(-1===n){var r=null!==this.startTimeOffset,a=r?this.startTimeOffset:e.startTimeOffset;null!==a&&R(a)?(n=t+a,a<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log("Setting startPosition to ".concat(n," for start time offset ").concat(a," found in ").concat(r?"multivariant":"media"," playlist")),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log("Setting startPosition to -1 to start at live edge ".concat(n)),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+i}this.nextLoadPosition=n+i}},{key:"getLoadPosition",value:function(){var e,t=this.media,n=0;return null!=(e=this.hls)&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}},{key:"handleFragLoadAborted",value:function(e,t){this.transmuxer&&e.type===this.playlistType&&ed(e)&&e.stats.aborted&&(this.log("Fragment ".concat(e.sn).concat(t?" part "+t.index:""," of ").concat(this.playlistLabel()," ").concat(e.level," was aborted")),this.resetFragmentLoading(e))}},{key:"resetFragmentLoading",value:function(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===nQ)||(this.state=nW)}},{key:"onFragmentOrKeyLoadError",value:function(e,t){if(t.chunkMeta&&!t.frag){var n=this.getCurrentContext(t.chunkMeta);n&&(t.frag=n.frag)}var i=t.frag;if(i&&i.type===e&&this.levels){if(this.fragContextChanged(i))return void this.warn("Frag load error must match current frag to retry ".concat(i.url," > ").concat(null==(m=this.fragCurrent)?void 0:m.url));var r=t.details===P.FRAG_GAP;r&&this.fragmentTracker.fragBuffered(i,!0);var a=t.errorAction;if(!a){this.state=n1;return}var s=a.action,o=a.flags,l=a.retryCount,u=void 0===l?0:l,c=a.retryConfig,h=!!c,d=h&&5===s,f=h&&!a.resolved&&1===o,v=null==(g=this.hls.latestLevelDetails)?void 0:g.live;if(!d&&f&&ed(i)&&!i.endList&&v&&!tv(t))this.resetFragmentErrors(e),this.treatAsGap(i),a.resolved=!0;else if((d||f)&&u<c.maxNumRetry){var g,m,p,y=tE(null==(p=t.response)?void 0:p.code),E=tm(c,u);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+E,this.state=nQ,a.resolved=!0,y){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn("Fragment ".concat(i.sn," of ").concat(e," ").concat(i.level," errored with ").concat(t.details,", retrying loading ").concat(u+1,"/").concat(c.maxNumRetry," in ").concat(E,"ms"))}else if(c){if(this.resetFragmentErrors(e),!(u<c.maxNumRetry))return void this.warn("".concat(t.details," reached or exceeded max retry (").concat(u,")"));r||3===s||(a.resolved=!0)}else 2===s?this.state=n3:this.state=n1;this.tickImmediate()}}},{key:"checkRetryDate",value:function(){var e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!tE(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=nW)}},{key:"reduceLengthAndFlushBuffer",value:function(e){if(this.state===nZ||this.state===nJ){var t=e.frag,n=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,n),r=i&&i.len>.5;r&&this.reduceMaxBufferLength(i.len,(null==t?void 0:t.duration)||10);var a=!r;return a&&this.warn("Buffer full error while media.currentTime (".concat(this.getLoadPosition(),") is not buffered, flush ").concat(n," buffer")),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}},{key:"resetFragmentErrors",value:function(e){e===G&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==nY&&(this.state=nW)}},{key:"afterBufferFlushed",value:function(e,t,n){if(e){var i=tG.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,n),this.state===n0&&this.resetLoadingState()}}},{key:"resetLoadingState",value:function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==nY&&(this.state=nW)}},{key:"resetStartWhenNotLoaded",value:function(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;var e=this.levelLastLoaded,t=e?e.details:null;null!=t&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}},{key:"resetWhenMissingContext",value:function(e){this.log("Loading context changed while buffering sn ".concat(e.sn," of ").concat(this.playlistLabel()," ").concat(-1===e.level?"<removed>":e.level,". This chunk will not be buffered.")),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}},{key:"removeUnbufferedFrags",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}},{key:"updateLevelTiming",value:function(e,t,n,i){var r,a=this,s=n.details;if(!s)return void this.warn("level.details undefined");if(!Object.keys(e.elementaryStreams).reduce(function(t,r){var o=e.elementaryStreams[r];if(o){var l=o.endPTS-o.startPTS;if(l<=0)return a.warn("Could not parse fragment ".concat(e.sn," ").concat(r," duration reliably (").concat(l,")")),t||!1;var u=i?0:nI(s,e,o.startPTS,o.endPTS,o.startDTS,o.endDTS,a);return a.hls.trigger(O.LEVEL_PTS_UPDATED,{details:s,level:n,drift:u,type:r,frag:e,start:o.startPTS,end:o.endPTS}),!0}return t},!1)&&(0===n.fragmentError&&this.treatAsGap(e,n),(null==(r=this.transmuxer)?void 0:r.error)===null)){var o=Error("Found no media in fragment ".concat(e.sn," of ").concat(this.playlistLabel()," ").concat(e.level," resetting transmuxer to fallback to playlist timing"));if(this.warn(o.message),this.hls.trigger(O.ERROR,{type:x.MEDIA_ERROR,details:P.FRAG_PARSING_ERROR,fatal:!1,error:o,frag:e,reason:"Found no media in msn ".concat(e.sn," of ").concat(this.playlistLabel(),' "').concat(n.url,'"')}),!this.hls)return;this.resetTransmuxer()}this.state=nJ,this.log("Parsed ".concat(e.type," sn: ").concat(e.sn).concat(t?" part: "+t.index:""," of ").concat(this.fragInfo(e,!1,t),")")),this.hls.trigger(O.FRAG_PARSED,{frag:e,part:t})}},{key:"playlistLabel",value:function(){return this.playlistType===j?"level":"track"}},{key:"fragInfo",value:function(e){var t,n,i=!(arguments.length>1)||void 0===arguments[1]||arguments[1],r=arguments.length>2?arguments[2]:void 0;return"".concat(this.playlistLabel()," ").concat(e.level," (").concat(r?"part":"frag",":[").concat((null!=(t=i&&!r?e.startPTS:(r||e).start)?t:NaN).toFixed(3),"-").concat((null!=(n=i&&!r?e.endPTS:(r||e).end)?n:NaN).toFixed(3),"]").concat(r&&"main"===e.type?"INDEPENDENT="+(r.independent?"YES":"NO"):"")}},{key:"treatAsGap",value:function(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}},{key:"resetTransmuxer",value:function(){var e;null==(e=this.transmuxer)||e.reset()}},{key:"recoverWorkerError",value:function(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}},{key:"state",get:function(){return this._state},set:function(e){var t=this._state;t!==e&&(this._state=e,this.log("".concat(t,"->").concat(e)))}}]),t}(tN);function n4(e){return!!e.interstitialsController&&!1!==e.enableInterstitialPlayback}var n8=function(){"use strict";function e(){(0,E._)(this,e),this.chunks=[],this.dataLength=0}return(0,k._)(e,[{key:"push",value:function(e){this.chunks.push(e),this.dataLength+=e.length}},{key:"flush",value:function(){var e,t=this.chunks,n=this.dataLength;return t.length?(e=1===t.length?t[0]:function(e,t){for(var n=new Uint8Array(t),i=0,r=0;r<e.length;r++){var a=e[r];n.set(a,i),i+=a.length}return n}(t,n),this.reset(),e):new Uint8Array(0)}},{key:"reset",value:function(){this.chunks.length=0,this.dataLength=0}}]),e}(),n6={exports:{}},n9=(g||(g=1,!function(e){var t=Object.prototype.hasOwnProperty,n="~";function i(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,i,a,s){if("function"!=typeof i)throw TypeError("The listener must be a function");var o=new r(i,a||e,s),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(n=!1)),o.prototype.eventNames=function(){var e,i,r=[];if(0===this._eventsCount)return r;for(i in e=this._events)t.call(e,i)&&r.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},o.prototype.listeners=function(e){var t=n?n+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,a=i.length,s=Array(a);r<a;r++)s[r]=i[r].fn;return s},o.prototype.listenerCount=function(e){var t=n?n+e:e,i=this._events[t];return i?i.fn?1:i.length:0},o.prototype.emit=function(e,t,i,r,a,s){var o=n?n+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,i),!0;case 4:return c.fn.call(c.context,t,i,r),!0;case 5:return c.fn.call(c.context,t,i,r,a),!0;case 6:return c.fn.call(c.context,t,i,r,a,s),!0}for(u=1,l=Array(h-1);u<h;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var d,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),h){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,i);break;case 4:c[u].fn.call(c[u].context,t,i,r);break;default:if(!l)for(d=1,l=Array(h-1);d<h;d++)l[d-1]=arguments[d];c[u].fn.apply(c[u].context,l)}}return!0},o.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,i,r){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return s(this,a),this;var o=this._events[a];if(o.fn)o.fn!==t||r&&!o.once||i&&o.context!==i||s(this,a);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==t||r&&!o[l].once||i&&o[l].context!==i)&&u.push(o[l]);u.length?this._events[a]=1===u.length?u[0]:u:s(this,a)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o}(n6)),(h=n6.exports)&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default"))?h.default:h,n7="1.6.13",ie={};function it(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128||!1}function ii(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128||!1}function ir(e,t){return(127&e[t])<<21|(127&e[t+1])<<14|(127&e[t+2])<<7|127&e[t+3]}function ia(e,t){for(var n=t,i=0;ii(e,t);)i+=10,i+=ir(e,t+6),it(e,t+10)&&(i+=10),t+=i;if(i>0)return e.subarray(n,n+i)}function is(e,t){return 255===e[t]&&(246&e[t+1])==240}function io(e,t){return 1&e[t+1]?7:9}function il(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function iu(e,t){return t+1<e.length&&is(e,t)}function ic(e,t,n,i,r){if(!e.samplerate){var a=function(e,t,n,i){var r=t[n+2],a=r>>2&15;if(a>12){var s=Error("invalid ADTS sampling index:".concat(a));e.emit(O.ERROR,O.ERROR,{type:x.MEDIA_ERROR,details:P.FRAG_PARSING_ERROR,fatal:!0,error:s,reason:s.message});return}var o=(r>>6&3)+1,l=t[n+3]>>6&3|(1&r)<<2,u="mp4a.40."+o,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][a],h=a;(5===o||29===o)&&(h-=3);var d=[o<<3|(14&h)>>1,(1&h)<<7|l<<3];return J.log("manifest codec:".concat(i,", parsed codec:").concat(u,", channels:").concat(l,", rate:").concat(c," (ADTS object type:").concat(o," sampling index:").concat(a,")")),{config:d,samplerate:c,channelCount:l,codec:u,parsedCodec:u,manifestCodec:i}}(t,n,i,r);a&&q(e,a)}}function ih(e,t,n,i,r){var a,s=i+r*(9216e4/e.samplerate),o=function(e,t){var n=io(e,t);if(t+n<=e.length){var i=il(e,t)-n;if(i>0)return{headerLength:n,frameLength:i}}}(t,n);if(o){var l=o.frameLength,u=o.headerLength,c=u+l,h=Math.max(0,n+c-t.length);h?(a=new Uint8Array(c-u)).set(t.subarray(n+u,t.length),0):a=t.subarray(n+u,n+c);var d={unit:a,pts:s};return h||e.samples.push(d),{sample:d,length:c,missing:h}}var f=t.length-n;return(a=new Uint8Array(f)).set(t.subarray(n,t.length),0),{sample:{unit:a,pts:s},length:f,missing:-1}}function id(e){var t,n,i,r,a,s,o,l,u,c,h,d,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;return t=e,n=f,i=v,r=Uint8Array,s=(a=t)instanceof ArrayBuffer?a:a.buffer,o=1,"BYTES_PER_ELEMENT"in r&&(o=r.BYTES_PER_ELEMENT),c=((u=(l=t)&&l.buffer instanceof ArrayBuffer&&void 0!==l.byteLength&&void 0!==l.byteOffset?t.byteOffset:0)+t.byteLength)/o,d=Math.floor(Math.min((h=Math.floor(Math.max(0,Math.min((u+n)/o,c))))+Math.max(i,0),c)),new r(s,h,d-h)}function iv(e){for(var t=0,n=[];ii(e,t);){var i=ir(e,t+6);e[t+5]>>6&1&&(t+=10);for(var r=(t+=10)+i;t+10<r;){var a=function(e){var t=String.fromCharCode(e[0],e[1],e[2],e[3]),n=ir(e,4);return{type:t,size:n,data:e.subarray(10,10+n)}}(e.subarray(t)),s=function(e){if("PRIV"===e.type){if(!(e.size<2)){var t=en(e.data,!0),n=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:n.buffer}}return}if("W"===e.type[0]){if("WXXX"===e.type){if(e.size<2)return;var i=1,r=en(e.data.subarray(i),!0);i+=r.length+1;var a=en(e.data.subarray(i));return{key:e.type,info:r,data:a}}var s=en(e.data);return{key:e.type,info:"",data:s}}if("APIC"===e.type)return function(e){var t,n={key:e.type,description:"",data:"",mimeType:null,pictureType:null};if(!(e.size<2)){if(3!==e.data[0])return void console.log("Ignore frame with unrecognized character encoding");var i=e.data.subarray(1).indexOf(0);if(-1!==i){var r=en(id(e.data,1,i)),a=e.data[2+i],s=e.data.subarray(3+i).indexOf(0);if(-1!==s){var o,l=en(id(e.data,3+i,s));return t="--\x3e"===r?en(id(e.data,4+i+s)):(o=e.data.subarray(4+i+s))instanceof ArrayBuffer?o:0==o.byteOffset&&o.byteLength==o.buffer.byteLength?o.buffer:new Uint8Array(o).buffer,n.mimeType=r,n.pictureType=a,n.description=l,n.data=t,n}}}}(e);if(!(e.size<2)){if("TXXX"===e.type){var o=1,l=en(e.data.subarray(o),!0);o+=l.length+1;var u=en(e.data.subarray(o));return{key:e.type,info:l,data:u}}var c=en(e.data.subarray(1));return{key:e.type,info:"",data:c}}}(a);s&&n.push(s),t+=a.size+10}it(e,t)&&(t+=10)}return n}function ig(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info}function im(e){for(var t=iv(e),n=0;n<t.length;n++){var i=t[n];if(ig(i))return function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),n=1&t[3],i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,n&&(i+=47721858.84),Math.round(i)}}(i)}}var ip=((d={}).audioId3="org.id3",d.dateRange="com.apple.quicktime.HLS",d.emsg="https://aomedia.org/emsg/ID3",d.misbklv="urn:misb:KLV:bin:1910.1",d);function iy(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}var iE=function(){"use strict";function e(){(0,E._)(this,e),this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}return(0,k._)(e,[{key:"resetInitSegment",value:function(e,t,n,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}},{key:"resetTimeStamp",value:function(e){this.initPTS=e,this.resetContiguity()}},{key:"resetContiguity",value:function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}},{key:"canParse",value:function(e,t){return!1}},{key:"appendFrame",value:function(e,t,n){}},{key:"demux",value:function(e,t){this.cachedData&&(e=eD(this.cachedData,e),this.cachedData=null);var n,i=ia(e,0),r=i?i.length:0,a=this._audioTrack,s=this._id3Track,o=i?im(i):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&R(o))&&(this.basePTS=ik(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),i&&i.length>0&&s.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:ip.audioId3,duration:1/0});r<l;){if(this.canParse(e,r)){var u,c,h=this.appendFrame(a,e,r);h?(this.frameIndex++,this.lastPTS=h.sample.pts,r+=h.length,n=r):r=l}else ii(u=e,c=r)&&ir(u,c+6)+10<=u.length-c?(i=ia(e,r),s.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:ip.audioId3,duration:1/0}),r+=i.length,n=r):r++;if(r===l&&n!==l){var d=e.slice(n);this.cachedData?this.cachedData=eD(this.cachedData,d):this.cachedData=d}}return{audioTrack:a,videoTrack:iy(),id3Track:s,textTrack:iy()}}},{key:"demuxSampleAes",value:function(e,t,n){return Promise.reject(Error("[".concat(this,"] This demuxer does not support Sample-AES decryption")))}},{key:"flush",value:function(e){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:iy(),id3Track:this._id3Track,textTrack:iy()}}},{key:"destroy",value:function(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}]),e}(),ik=function(e,t,n){return R(e)?90*e:9e4*t+(n?9e4*n.baseTime/n.timescale:0)},ib=null,iT=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],iS=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],i_=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],iA=[0,1,1,4];function iL(e,t,n,i,r){if(!(n+24>t.length)){var a=iw(t,n);if(a&&n+a.frameLength<=t.length){var s=i+r*(9e4*a.samplesPerFrame/a.sampleRate),o={unit:t.subarray(n,n+a.frameLength),pts:s,dts:s};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(o),{sample:o,length:a.frameLength,missing:0}}}}function iw(e,t){var n=e[t+1]>>3&3,i=e[t+1]>>1&3,r=e[t+2]>>4&15,a=e[t+2]>>2&3;if(1!==n&&0!==r&&15!==r&&3!==a){var s=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*iT[14*(3===n?3-i:3===i?3:4)+r-1],u=iS[3*(3===n?0:2===n?1:2)+a],c=i_[n][i],h=iA[i],d=Math.floor(c*l/u+s)*h;if(null===ib){var f=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ib=f?parseInt(f[1]):0}return ib&&ib<=87&&2===i&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:u,channelCount:3===o?1:2,frameLength:d,samplesPerFrame:8*c*h}}}function iI(e,t){return 255===e[t]&&(224&e[t+1])==224&&(6&e[t+1])!=0}function iR(e,t){return t+1<e.length&&iI(e,t)}function iD(e,t){if(t+1<e.length&&iI(e,t)){var n=iw(e,t),i=4;null!=n&&n.frameLength&&(i=n.frameLength);var r=t+i;return r===e.length||iR(e,r)}return!1}var iC=function(e){"use strict";function t(e,n){var i;return(0,E._)(this,t),(i=(0,y._)(this,t)).observer=void 0,i.config=void 0,i.observer=e,i.config=n,i}return(0,_._)(t,e),(0,k._)(t,[{key:"resetInitSegment",value:function(e,n,i,r){(0,T._)((0,S._)(t.prototype),"resetInitSegment",this).call(this,e,n,i,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:n,duration:r,inputTimeScale:9e4,dropped:0}}},{key:"canParse",value:function(e,t){return t+5<e.length&&is(e,t)&&il(e,t)<=e.length-t}},{key:"appendFrame",value:function(e,t,n){ic(e,this.observer,t,n,e.manifestCodec);var i=ih(e,t,n,this.basePTS,this.frameIndex);if(i&&0===i.missing)return i}}],[{key:"probe",value:function(e,t){if(!e)return!1;var n=ia(e,0),i=(null==n?void 0:n.length)||0;if(iD(e,i))return!1;for(var r=e.length;i<r;i++)if(function(e,t){if(iu(e,t)){var n=io(e,t);if(t+n>=e.length)return!1;var i=il(e,t);if(i<=n)return!1;var r=t+i;return r===e.length||iu(e,r)}return!1}(e,i))return t.log("ADTS sync word found !"),!0;return!1}}]),t}(iE),ix=function(e,t){var n=0,i=5;t+=5;for(var r=new Uint32Array(1),a=new Uint32Array(1),s=new Uint8Array(1);i>0;){s[0]=e[t];var o=Math.min(i,8),l=8-o;a[0]=0xff000000>>>24+l<<l,r[0]=(s[0]&a[0])>>l,n=n?n<<o|r[0]:r[0],t+=1,i-=o}return n},iP=function(e){"use strict";function t(e){var n;return(0,E._)(this,t),(n=(0,y._)(this,t)).observer=void 0,n.observer=e,n}return(0,_._)(t,e),(0,k._)(t,[{key:"resetInitSegment",value:function(e,n,i,r){(0,T._)((0,S._)(t.prototype),"resetInitSegment",this).call(this,e,n,i,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:n,duration:r,inputTimeScale:9e4,dropped:0}}},{key:"canParse",value:function(e,t){return t+64<e.length}},{key:"appendFrame",value:function(e,t,n){var i=iO(e,t,n,this.basePTS,this.frameIndex);if(-1!==i)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}}],[{key:"probe",value:function(e){if(!e)return!1;var t=ia(e,0);if(!t)return!1;var n=t.length;return!!(11===e[n]&&119===e[n+1]&&void 0!==im(t)&&16>ix(e,n))}}]),t}(iE);function iO(e,t,n,i,r){if(n+8>t.length||11!==t[n]||119!==t[n+1])return -1;var a=t[n+4]>>6;if(a>=3)return -1;var s=[48e3,44100,32e3][a],o=63&t[n+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+a];if(n+l>t.length)return -1;var u=t[n+6]>>5,c=0;2===u?c+=2:(1&u&&1!==u&&(c+=2),4&u&&(c+=2));var h=(t[n+6]<<8|t[n+7])>>12-c&1,d=[2,1,2,3,3,4,4,5][u]+h,f=t[n+5]>>3,v=7&t[n+5],g=new Uint8Array([a<<6|f<<1|v>>2,(3&v)<<6|u<<3|h<<2|o>>4,o<<4&224]),m=t.subarray(n,n+l);return e.config=g,e.channelCount=d,e.samplerate=s,e.samples.push({unit:m,pts:i+1536/s*9e4*r}),l}var iM=function(e){"use strict";function t(){return(0,E._)(this,t),(0,y._)(this,t,arguments)}return(0,_._)(t,e),(0,k._)(t,[{key:"resetInitSegment",value:function(e,n,i,r){(0,T._)((0,S._)(t.prototype),"resetInitSegment",this).call(this,e,n,i,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:n,duration:r,inputTimeScale:9e4,dropped:0}}},{key:"canParse",value:function(e,t){return iI(e,t)&&4<=e.length-t}},{key:"appendFrame",value:function(e,t,n){if(null!==this.basePTS)return iL(e,t,n,this.basePTS,this.frameIndex)}}],[{key:"probe",value:function(e){if(!e)return!1;var t=ia(e,0),n=(null==t?void 0:t.length)||0;if(t&&11===e[n]&&119===e[n+1]&&void 0!==im(t)&&16>=ix(e,n))return!1;for(var i=e.length;n<i;n++)if(iD(e,n))return J.log("MPEG Audio sync word found !"),!0;return!1}}]),t}(iE),iF=/\/emsg[-/]ID3/i,iN=function(){"use strict";function e(t,n){(0,E._)(this,e),this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=n}return(0,k._)(e,[{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(e,t,n,i){var r=this.videoTrack=iy("video",1),a=this.audioTrack=iy("audio",1),s=this.txtTrack=iy("text",1);if(this.id3Track=iy("id3",1),this.timeOffset=0,null!=e&&e.byteLength){var o=eS(e);if(o.video){var l=o.video,u=l.id,c=l.timescale,h=l.codec,d=l.supplemental;r.id=u,r.timescale=s.timescale=c,r.codec=h,r.supplemental=d}if(o.audio){var f=o.audio,v=f.id,g=f.timescale,m=f.codec;a.id=v,a.timescale=g,a.codec=m}s.id=em.text,r.sampleDuration=0,r.duration=a.duration=i}}},{key:"resetContiguity",value:function(){this.remainderData=null}},{key:"demux",value:function(e,t){this.timeOffset=t;var n=e,i=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=eD(this.remainderData,e));var a=function(e){var t={valid:null,remainder:null},n=eT(e,["moof"]);if(n.length<2)return t.remainder=e,t;var i=n[n.length-1];return t.valid=e.slice(0,i.byteOffset-8),t.remainder=e.slice(i.byteOffset-8),t}(n);this.remainderData=a.remainder,i.samples=a.valid||new Uint8Array}else i.samples=n;var s=this.extractID3Track(i,t);return r.samples=eC(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:s,textTrack:this.txtTrack}}},{key:"flush",value:function(){var e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;var i=this.extractID3Track(t,this.timeOffset);return n.samples=eC(e,t),{videoTrack:t,audioTrack:iy(),id3Track:i,textTrack:iy()}}},{key:"extractID3Track",value:function(e,t){var n=this,i=this.id3Track;if(e.samples.length){var r=eT(e.samples,["emsg"]);r&&r.forEach(function(e){var r=function(e){var t=e[0],n="",i="",r=0,a=0,s=0,o=0,l=0,u=0;if(0===t){for(;"\0"!==ep(e.subarray(u,u+1));)n+=ep(e.subarray(u,u+1)),u+=1;for(n+=ep(e.subarray(u,u+1)),u+=1;"\0"!==ep(e.subarray(u,u+1));)i+=ep(e.subarray(u,u+1)),u+=1;i+=ep(e.subarray(u,u+1)),u+=1,r=eE(e,12),a=eE(e,16),o=eE(e,20),l=eE(e,24),u=28}else if(1===t){u+=4,r=eE(e,u);var c=eE(e,u+=4),h=eE(e,u+=4);for(u+=4,D(s=0x100000000*c+h)||(s=Number.MAX_SAFE_INTEGER,J.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=eE(e,u),u+=4,l=eE(e,u),u+=4;"\0"!==ep(e.subarray(u,u+1));)n+=ep(e.subarray(u,u+1)),u+=1;for(n+=ep(e.subarray(u,u+1)),u+=1;"\0"!==ep(e.subarray(u,u+1));)i+=ep(e.subarray(u,u+1)),u+=1;i+=ep(e.subarray(u,u+1)),u+=1}return{schemeIdUri:n,value:i,timeScale:r,presentationTime:s,presentationTimeDelta:a,eventDuration:o,id:l,payload:e.subarray(u,e.byteLength)}}(e);if(iF.test(r.schemeIdUri)){var a=iB(r,t),s=0xffffffff===r.eventDuration?1/0:r.eventDuration/r.timeScale;s<=.001&&(s=1/0);var o=r.payload;i.samples.push({data:o,len:o.byteLength,dts:a,pts:a,type:ip.emsg,duration:s})}else if(n.config.enableEmsgKLVMetadata&&r.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){var l=iB(r,t);i.samples.push({data:r.payload,len:r.payload.byteLength,dts:l,pts:l,type:ip.misbklv,duration:1/0})}})}return i}},{key:"demuxSampleAes",value:function(e,t,n){return Promise.reject(Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}},{key:"destroy",value:function(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}],[{key:"probe",value:function(e){for(var t=e.byteLength,n=0;n<t;){var i=eE(e,n);if(i>8&&109===e[n+4]&&111===e[n+5]&&111===e[n+6]&&102===e[n+7])return!0;n=i>1?n+i:t}return!1}}]),e}();function iB(e,t){return R(e.presentationTime)?e.presentationTime/e.timeScale:t+e.presentationTimeDelta/e.timeScale}var iU=function(){"use strict";function e(t,n,i){(0,E._)(this,e),this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new tx(n,{removePKCS7Padding:!1})}return(0,k._)(e,[{key:"decryptBuffer",value:function(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,0)}},{key:"decryptAacSample",value:function(e,t,n){var i=this,r=e[t].unit;if(!(r.length<=16)){var a=r.subarray(16,r.length-r.length%16),s=a.buffer.slice(a.byteOffset,a.byteOffset+a.length);this.decryptBuffer(s).then(function(a){var s=new Uint8Array(a);r.set(s,16),i.decrypter.isSync()||i.decryptAacSamples(e,t+1,n)}).catch(n)}}},{key:"decryptAacSamples",value:function(e,t,n){for(;;t++){if(t>=e.length)return void n();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}},{key:"getAvcEncryptedData",value:function(e){for(var t=new Int8Array(16*Math.floor((e.length-48)/160)+16),n=0,i=32;i<e.length-16;i+=160,n+=16)t.set(e.subarray(i,i+16),n);return t}},{key:"getAvcDecryptedUnit",value:function(e,t){for(var n=new Uint8Array(t),i=0,r=32;r<e.length-16;r+=160,i+=16)e.set(n.subarray(i,i+16),r);return e}},{key:"decryptAvcSample",value:function(e,t,n,i,r){var a=this,s=eO(r.data),o=this.getAvcEncryptedData(s);this.decryptBuffer(o.buffer).then(function(o){r.data=a.getAvcDecryptedUnit(s,o),a.decrypter.isSync()||a.decryptAvcSamples(e,t,n+1,i)}).catch(i)}},{key:"decryptAvcSamples",value:function(e,t,n,i){if(e instanceof Uint8Array)throw Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length)return void i();for(var r=e[t].units;!(n>=r.length);n++){var a=r[n];if(!(a.data.length<=48)&&(1===a.type||5===a.type)&&(this.decryptAvcSample(e,t,n,i,a),!this.decrypter.isSync()))return}}}}]),e}(),ij=function(){"use strict";function e(){(0,E._)(this,e),this.VideoSample=null}return(0,k._)(e,[{key:"createVideoSample",value:function(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}},{key:"getLastNalUnit",value:function(e){var t,n,i=this.VideoSample;if(i&&0!==i.units.length||(i=e[e.length-1]),null!=(t=i)&&t.units){var r=i.units;n=r[r.length-1]}return n}},{key:"pushAccessUnit",value:function(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){var n=t.samples,i=n.length;if(!i)return void t.dropped++;var r=n[i-1];e.pts=r.pts,e.dts=r.dts}t.samples.push(e)}}},{key:"parseNALu",value:function(e,t,n){var i,r,a,s=t.byteLength,o=e.naluState||0,l=o,u=[],c=0,h=-1,d=0;for(-1===o&&(h=0,d=this.getNALuType(t,0),o=0,c=1);c<s;){if(i=t[c++],!o){o=+!i;continue}if(1===o){o=2*!i;continue}if(i)if(1===i){if(r=c-o-1,h>=0){var f={data:t.subarray(h,r),type:d};u.push(f)}else{var v=this.getLastNalUnit(e.samples);v&&(l&&c<=4-l&&v.state&&(v.data=v.data.subarray(0,v.data.byteLength-l)),r>0&&(v.data=eD(v.data,t.subarray(0,r)),v.state=0))}c<s?(a=this.getNALuType(t,c),h=c,d=a,o=0):o=-1}else o=0;else o=3}if(h>=0&&o>=0){var g={data:t.subarray(h,s),type:d,state:o};u.push(g)}if(0===u.length){var m=this.getLastNalUnit(e.samples);m&&(m.data=eD(m.data,t))}return e.naluState=o,u}}]),e}(),iG=function(){"use strict";function e(t){(0,E._)(this,e),this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return(0,k._)(e,[{key:"loadWord",value:function(){var e=this.data,t=this.bytesAvailable,n=e.byteLength-t,i=new Uint8Array(4),r=Math.min(4,t);if(0===r)throw Error("no bytes available");i.set(e.subarray(n,n+r)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r}},{key:"skipBits",value:function(e){var t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e||(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord()),this.word<<=e,this.bitsAvailable-=e}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),n=this.word>>>32-t;if(e>32&&J.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw Error("no bits available");return(t=e-t)>0&&this.bitsAvailable?n<<t|this.readBits(t):n}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if((this.word&0x80000000>>>e)!=0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}}]),e}(),iK=function(e){"use strict";function t(){return(0,E._)(this,t),(0,y._)(this,t,arguments)}return(0,_._)(t,e),(0,k._)(t,[{key:"parsePES",value:function(e,t,n,i){var r,a=this,s=this.parseNALu(e,n.data,i),o=this.VideoSample,l=!1;n.data=null,o&&s.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(function(i){var s,u;switch(i.type){case 1:var c,h=!1;r=!0;var d=i.data;if(l&&d.length>4){var f=a.readSliceType(d);(2===f||4===f||7===f||9===f)&&(h=!0)}h&&null!=(c=o)&&c.frame&&!o.key&&(a.pushAccessUnit(o,e),o=a.VideoSample=null),o||(o=a.VideoSample=a.createVideoSample(!0,n.pts,n.dts)),o.frame=!0,o.key=h;break;case 5:r=!0,null!=(s=o)&&s.frame&&!o.key&&(a.pushAccessUnit(o,e),o=a.VideoSample=null),o||(o=a.VideoSample=a.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 6:r=!0,eP(i.data,1,n.pts,t.samples);break;case 7:r=!0,l=!0;var v,g,m=i.data,p=a.readSPS(m);if(!e.sps||e.width!==p.width||e.height!==p.height||(null==(v=e.pixelRatio)?void 0:v[0])!==p.pixelRatio[0]||(null==(g=e.pixelRatio)?void 0:g[1])!==p.pixelRatio[1]){e.width=p.width,e.height=p.height,e.pixelRatio=p.pixelRatio,e.sps=[m];for(var y=m.subarray(1,4),E="avc1.",k=0;k<3;k++){var b=y[k].toString(16);b.length<2&&(b="0"+b),E+=b}e.codec=E}break;case 8:r=!0,e.pps=[i.data];break;case 9:r=!0,e.audFound=!0,null!=(u=o)&&u.frame&&(a.pushAccessUnit(o,e),o=null),o||(o=a.VideoSample=a.createVideoSample(!1,n.pts,n.dts));break;case 12:r=!0;break;default:r=!1}o&&r&&o.units.push(i)}),i&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}},{key:"getNALuType",value:function(e,t){return 31&e[t]}},{key:"readSliceType",value:function(e){var t=new iG(e);return t.readUByte(),t.readUEG(),t.readUEG()}},{key:"skipScalingList",value:function(e,t){for(var n=8,i=8,r=0;r<e;r++)0!==i&&(i=(n+t.readEG()+256)%256),n=0===i?n:i}},{key:"readSPS",value:function(e){var t,n,i,r=new iG(e),a=0,s=0,o=0,l=0,u=r.readUByte.bind(r),c=r.readBits.bind(r),h=r.readUEG.bind(r),d=r.readBoolean.bind(r),f=r.skipBits.bind(r),v=r.skipEG.bind(r),g=r.skipUEG.bind(r),m=this.skipScalingList.bind(this);u();var p=u();if(c(5),f(3),u(),g(),100===p||110===p||122===p||244===p||44===p||83===p||86===p||118===p||128===p){var y=h();if(3===y&&f(1),g(),g(),f(1),d())for(i=0,n=3!==y?8:12;i<n;i++)d()&&m(i<6?16:64,r)}g();var E=h();if(0===E)h();else if(1===E)for(f(1),v(),v(),t=h(),i=0;i<t;i++)v();g(),f(1);var k=h(),b=h(),T=c(1);0===T&&f(1),f(1),d()&&(a=h(),s=h(),o=h(),l=h());var S=[1,1];if(d()&&d())switch(u()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[u()<<8|u(),u()<<8|u()]}return{width:Math.ceil((k+1)*16-2*a-2*s),height:(2-T)*(b+1)*16-(T?2:4)*(o+l),pixelRatio:S}}}]),t}(ij),iH=function(e){"use strict";function t(){for(var e,n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];return(0,E._)(this,t),(e=(0,y._)(this,t,(0,L._)(i))).initVPS=null,e}return(0,_._)(t,e),(0,k._)(t,[{key:"parsePES",value:function(e,t,n,i){var r,a=this,s=this.parseNALu(e,n.data,i),o=this.VideoSample,l=!1;n.data=null,o&&s.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(function(i){switch(i.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=a.VideoSample=a.createVideoSample(!1,n.pts,n.dts)),o.frame=!0,r=!0;break;case 16:case 17:case 18:case 21:r=!0,l&&null!=(c=o)&&c.frame&&!o.key&&(a.pushAccessUnit(o,e),o=a.VideoSample=null),o||(o=a.VideoSample=a.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:r=!0,null!=(s=o)&&s.frame&&!o.key&&(a.pushAccessUnit(o,e),o=a.VideoSample=null),o||(o=a.VideoSample=a.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 39:r=!0,eP(i.data,2,n.pts,t.samples);break;case 32:r=!0,e.vps||("object"!==(0,w._)(e.params)&&(e.params={}),e.params=q(e.params,a.readVPS(i.data)),a.initVPS=i.data),e.vps=[i.data];break;case 33:if(r=!0,l=!0,void 0===e.vps||e.vps[0]===a.initVPS||void 0===e.sps||a.matchSPS(e.sps[0],i.data)||(a.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){var s,u,c,h=a.readSPS(i.data);for(var d in e.width=h.width,e.height=h.height,e.pixelRatio=h.pixelRatio,e.codec=h.codecString,e.sps=[],"object"!==(0,w._)(e.params)&&(e.params={}),h.params)e.params[d]=h.params[d]}a.pushParameterSet(e.sps,i.data,e.vps),o||(o=a.VideoSample=a.createVideoSample(!0,n.pts,n.dts)),o.key=!0;break;case 34:if(r=!0,"object"===(0,w._)(e.params)){if(!e.pps){e.pps=[];var f=a.readPPS(i.data);for(var v in f)e.params[v]=f[v]}a.pushParameterSet(e.pps,i.data,e.vps)}break;case 35:r=!0,e.audFound=!0,null!=(u=o)&&u.frame&&(a.pushAccessUnit(o,e),o=null),o||(o=a.VideoSample=a.createVideoSample(!1,n.pts,n.dts));break;default:r=!1}o&&r&&o.units.push(i)}),i&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}},{key:"pushParameterSet",value:function(e,t,n){(!n||n[0]!==this.initVPS)&&(n||e.length)||e.push(t)}},{key:"getNALuType",value:function(e,t){return(126&e[t])>>>1}},{key:"ebsp2rbsp",value:function(e){for(var t=new Uint8Array(e.byteLength),n=0,i=0;i<e.byteLength;i++)(!(i>=2)||3!==e[i]||0!==e[i-1]||0!==e[i-2])&&(t[n]=e[i],n++);return new Uint8Array(t.buffer,0,n)}},{key:"pushAccessUnit",value:function(e,n){(0,T._)((0,S._)(t.prototype),"pushAccessUnit",this).call(this,e,n),this.initVPS&&(this.initVPS=null)}},{key:"readVPS",value:function(e){var t=new iG(e);return t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6),{numTemporalLayers:t.readBits(3)+1,temporalIdNested:t.readBoolean()}}},{key:"readSPS",value:function(e){var t=new iG(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);var n=t.readBits(3);t.readBoolean();for(var i=t.readBits(2),r=t.readBoolean(),a=t.readBits(5),s=t.readUByte(),o=t.readUByte(),l=t.readUByte(),u=t.readUByte(),c=t.readUByte(),h=t.readUByte(),d=t.readUByte(),f=t.readUByte(),v=t.readUByte(),g=t.readUByte(),m=t.readUByte(),p=[],y=[],E=0;E<n;E++)p.push(t.readBoolean()),y.push(t.readBoolean());if(n>0)for(var k=n;k<8;k++)t.readBits(2);for(var b=0;b<n;b++)p[b]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),y[b]&&t.readUByte();t.readUEG();var T=t.readUEG();3==T&&t.skipBits(1);var S=t.readUEG(),_=t.readUEG(),A=t.readBoolean(),L=0,w=0,I=0,R=0;A&&(L+=t.readUEG(),w+=t.readUEG(),I+=t.readUEG(),R+=t.readUEG());for(var D=t.readUEG(),C=t.readUEG(),x=t.readUEG(),P=t.readBoolean(),O=P?0:n;O<=n;O++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(var M=0;M<4;M++)for(var F=0;F<(3===M?2:6);F++)if(t.readBoolean()){var N=Math.min(64,1<<4+(M<<1));M>1&&t.readEG();for(var B=0;B<N;B++)t.readEG()}else t.readUEG();t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());for(var U=t.readUEG(),j=0,G=0;G<U;G++){var K=!1;if(0!==G&&(K=t.readBoolean()),K){G===U&&t.readUEG(),t.readBoolean(),t.readUEG();for(var H=0,V=0;V<=j;V++){var q=t.readBoolean(),Y=!1;q||(Y=t.readBoolean()),(q||Y)&&H++}j=H}else{var W=t.readUEG(),z=t.readUEG();j=W+z;for(var X=0;X<W;X++)t.readUEG(),t.readBoolean();for(var Q=0;Q<z;Q++)t.readUEG(),t.readBoolean()}}if(t.readBoolean())for(var $=t.readUEG(),Z=0;Z<$;Z++){for(var J=0;J<x+4;J++)t.readBits(1);t.readBits(1)}var ee=0,et=1,en=1,ei=!0,er=1,ea=0;t.readBoolean(),t.readBoolean();if(t.readBoolean()){if(t.readBoolean()){var es=t.readUByte();es>0&&es<16?(et=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][es-1],en=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][es-1]):255===es&&(et=t.readBits(16),en=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(er=t.readBits(32),ea=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){var eo=t.readBoolean(),el=t.readBoolean(),eu=!1;(eo||el)&&((eu=t.readBoolean())&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),eu&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(var ec=0;ec<=n;ec++){var eh=(ei=t.readBoolean())||t.readBoolean(),ed=!1;eh?t.readEG():ed=t.readBoolean();var ef=ed?1:t.readUEG()+1;if(eo)for(var ev=0;ev<ef;ev++)t.readUEG(),t.readUEG(),eu&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(el)for(var eg=0;eg<ef;eg++)t.readUEG(),t.readUEG(),eu&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),ee=t.readUEG())}var em=S,ep=_;if(A){var ey=1,eE=1;1===T?ey=eE=2:2==T&&(ey=2),em=S-ey*w-ey*L,ep=_-eE*R-eE*I}for(var ek=i?["A","B","C"][i]:"",eb=s<<24|o<<16|l<<8|u,eT=0,eS=0;eS<32;eS++)eT=(eT|(eb>>eS&1)<<31-eS)>>>0;var e_=eT.toString(16);return 1===a&&"2"===e_&&(e_="6"),{codecString:"hvc1.".concat(ek).concat(a,".").concat(e_,".").concat(r?"H":"L").concat(m,".B0"),params:{general_tier_flag:r,general_profile_idc:a,general_profile_space:i,general_profile_compatibility_flags:[s,o,l,u],general_constraint_indicator_flags:[c,h,d,f,v,g],general_level_idc:m,bit_depth:D+8,bit_depth_luma_minus8:D,bit_depth_chroma_minus8:C,min_spatial_segmentation_idc:ee,chroma_format_idc:T,frame_rate:{fixed:ei,fps:ea/er}},width:em,height:ep,pixelRatio:[et,en]}}},{key:"readPPS",value:function(e){var t=new iG(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);var n=t.readBoolean(),i=t.readBoolean(),r=1;return i&&n?r=0:i?r=3:n&&(r=2),{parallelismType:r}}},{key:"matchSPS",value:function(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}]),t}(ij),iV=function(){"use strict";function e(t,n,i,r){(0,E._)(this,e),this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=t,this.config=n,this.typeSupported=i,this.logger=r,this.videoParser=null}return(0,k._)(e,[{key:"resetInitSegment",value:function(t,n,i,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=e.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=e.createTrack("audio",r),this._id3Track=e.createTrack("id3"),this._txtTrack=e.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=n,this.videoCodec=i}},{key:"resetTimeStamp",value:function(){}},{key:"resetContiguity",value:function(){var e=this._audioTrack,t=this._videoTrack,n=this._id3Track;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}},{key:"demux",value:function(t,n){var i,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];r||(this.sampleAes=null);var s=this._videoTrack,o=this._audioTrack,l=this._id3Track,u=this._txtTrack,c=s.pid,h=s.pesData,d=o.pid,f=l.pid,v=o.pesData,g=l.pesData,m=null,p=this.pmtParsed,y=this._pmtId,E=t.length;if(this.remainderData&&(E=(t=eD(this.remainderData,t)).length,this.remainderData=null),E<188&&!a)return this.remainderData=t,{audioTrack:o,videoTrack:s,id3Track:l,textTrack:u};var k=Math.max(0,e.syncOffset(t));(E-=(E-k)%188)<t.byteLength&&!a&&(this.remainderData=new Uint8Array(t.buffer,E,t.buffer.byteLength-E));for(var b=0,T=k;T<E;T+=188)if(71===t[T]){var S,_,A=!!(64&t[T+1]),L=iq(t,T),w=(48&t[T+3])>>4,I=void 0;if(w>1){if((I=T+5+t[T+4])===T+188)continue}else I=T+4;switch(L){case c:A&&(h&&(i=iz(h,this.logger))&&(this.readyVideoParser(s.segmentCodec),null!==this.videoParser&&this.videoParser.parsePES(s,u,i,!1)),h={data:[],size:0}),h&&(h.data.push(t.subarray(I,T+188)),h.size+=T+188-I);break;case d:if(A){if(v&&(i=iz(v,this.logger)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,i);break;case"mp3":this.parseMPEGPES(o,i);break;case"ac3":this.parseAC3PES(o,i)}v={data:[],size:0}}v&&(v.data.push(t.subarray(I,T+188)),v.size+=T+188-I);break;case f:A&&(g&&(i=iz(g,this.logger))&&this.parseID3PES(l,i),g={data:[],size:0}),g&&(g.data.push(t.subarray(I,T+188)),g.size+=T+188-I);break;case 0:A&&(I+=t[I]+1),y=this._pmtId=(31&(S=t)[(_=I)+10])<<8|S[_+11];break;case y:A&&(I+=t[I]+1);var R=function(e,t,n,i,r,a){var s={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(15&e[t+1])<<8|e[t+2],l=t+3+o-4,u=(15&e[t+10])<<8|e[t+11];for(t+=12+u;t<l;){var c=iq(e,t),h=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!i){iW("ADTS AAC",a);break}case 15:-1===s.audioPid&&(s.audioPid=c);break;case 21:-1===s.id3Pid&&(s.id3Pid=c);break;case 219:if(!i){iW("H.264",a);break}case 27:-1===s.videoPid&&(s.videoPid=c);break;case 3:case 4:n.mpeg||n.mp3?-1===s.audioPid&&(s.audioPid=c,s.segmentAudioCodec="mp3"):a.log("MPEG audio found, not supported in this browser");break;case 193:if(!i){iW("AC-3",a);break}case 129:n.ac3?-1===s.audioPid&&(s.audioPid=c,s.segmentAudioCodec="ac3"):a.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===s.audioPid&&h>0)for(var d=t+5,f=h;f>2;){106===e[d]&&(!0!==n.ac3?a.log("AC-3 audio found, not supported in this browser for now"):(s.audioPid=c,s.segmentAudioCodec="ac3"));var v=e[d+1]+2;d+=v,f-=v}break;case 194:case 135:return iY(r,Error("Unsupported EC-3 in M2TS found"),void 0,a),s;case 36:-1===s.videoPid&&(s.videoPid=c,s.segmentVideoCodec="hevc",a.log("HEVC in M2TS found"))}t+=h+5}return s}(t,I,this.typeSupported,r,this.observer,this.logger);(c=R.videoPid)>0&&(s.pid=c,s.segmentCodec=R.segmentVideoCodec),(d=R.audioPid)>0&&(o.pid=d,o.segmentCodec=R.segmentAudioCodec),(f=R.id3Pid)>0&&(l.pid=f),null===m||p||(this.logger.warn("MPEG-TS PMT found at ".concat(T," after unknown PID '").concat(m,"'. Backtracking to sync byte @").concat(k," to parse all TS packets.")),m=null,T=k-188),p=this.pmtParsed=!0;break;case 17:case 8191:break;default:m=L}}else b++;b>0&&iY(this.observer,Error("Found ".concat(b," TS packet/s that do not start with 0x47")),void 0,this.logger),s.pesData=h,o.pesData=v,l.pesData=g;var D={audioTrack:o,videoTrack:s,id3Track:l,textTrack:u};return a&&this.extractRemainingSamples(D),D}},{key:"flush",value:function(){var e,t=this.remainderData;return(this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes)?this.decrypt(e,this.sampleAes):e}},{key:"extractRemainingSamples",value:function(e){var t,n=e.audioTrack,i=e.videoTrack,r=e.id3Track,a=e.textTrack,s=i.pesData,o=n.pesData,l=r.pesData;if(s&&(t=iz(s,this.logger))?(this.readyVideoParser(i.segmentCodec),null!==this.videoParser&&(this.videoParser.parsePES(i,a,t,!0),i.pesData=null)):i.pesData=s,o&&(t=iz(o,this.logger))){switch(n.segmentCodec){case"aac":this.parseAACPES(n,t);break;case"mp3":this.parseMPEGPES(n,t);break;case"ac3":this.parseAC3PES(n,t)}n.pesData=null}else null!=o&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),n.pesData=o;l&&(t=iz(l,this.logger))?(this.parseID3PES(r,t),r.pesData=null):r.pesData=l}},{key:"demuxSampleAes",value:function(e,t,n){var i=this.demux(e,n,!0,!this.config.progressive),r=this.sampleAes=new iU(this.observer,this.config,t);return this.decrypt(i,r)}},{key:"readyVideoParser",value:function(e){null===this.videoParser&&("avc"===e?this.videoParser=new iK:"hevc"===e&&(this.videoParser=new iH))}},{key:"decrypt",value:function(e,t){return new Promise(function(n){var i=e.audioTrack,r=e.videoTrack;i.samples&&"aac"===i.segmentCodec?t.decryptAacSamples(i.samples,0,function(){r.samples?t.decryptAvcSamples(r.samples,0,0,function(){n(e)}):n(e)}):r.samples&&t.decryptAvcSamples(r.samples,0,0,function(){n(e)})})}},{key:"destroy",value:function(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}},{key:"parseAACPES",value:function(e,t){var n,i,r=0,a=this.aacOverFlow,s=t.data;if(a){this.aacOverFlow=null;var o=a.missing,l=a.sample.unit.byteLength;-1===o?s=eD(a.sample.unit,s):(a.sample.unit.set(s.subarray(0,o),l-o),e.samples.push(a.sample),r=a.missing)}for(u=r,c=s.length;u<c-1&&!iu(s,u);u++);if(u!==r){var u,c,h,d=u<c-1;if(h=d?"AAC PES did not start with ADTS header,offset:".concat(u):"No ADTS header found in AAC PES",iY(this.observer,Error(h),d,this.logger),!d)return}if(ic(e,this.observer,s,u,this.audioCodec),void 0!==t.pts)n=t.pts;else{if(!a)return void this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var f=9216e4/e.samplerate;n=a.sample.pts+f}for(var v=0;u<c;){if(i=ih(e,s,u,n,v),u+=i.length,i.missing){this.aacOverFlow=i;break}for(v++;u<c-1&&!iu(s,u);u++);}}},{key:"parseMPEGPES",value:function(e,t){var n=t.data,i=n.length,r=0,a=0,s=t.pts;if(void 0===s)return void this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");for(;a<i;)if(iR(n,a)){var o=iL(e,n,a,s,r);if(o)a+=o.length,r++;else break}else a++}},{key:"parseAC3PES",value:function(e,t){var n,i=t.data,r=t.pts;if(void 0===r)return void this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");for(var a=i.length,s=0,o=0;o<a&&(n=iO(e,i,o,r,s++))>0;)o+=n}},{key:"parseID3PES",value:function(e,t){if(void 0===t.pts)return void this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");var n=q({},t,{type:this._videoTrack?ip.emsg:ip.audioId3,duration:1/0});e.samples.push(n)}}],[{key:"probe",value:function(t,n){var i=e.syncOffset(t);return i>0&&n.warn("MPEG2-TS detected but first sync word found @ offset ".concat(i)),-1!==i}},{key:"syncOffset",value:function(e){for(var t=e.length,n=Math.min(940,t-188)+1,i=0;i<n;){for(var r=!1,a=-1,s=0,o=i;o<t;o+=188)if(71===e[o]&&(t-o==188||71===e[o+188])){if(s++,-1===a&&0!==(a=o)&&(n=Math.min(a+18612,e.length-188)+1),r||(r=0===iq(e,o)),r&&s>1&&(0===a&&s>2||o+188>n))return a}else if(s)return -1;else break;i++}return -1}},{key:"createTrack",value:function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:em[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}}]),e}();function iq(e,t){return((31&e[t+1])<<8)+e[t+2]}function iY(e,t,n,i){i.warn("parsing error: ".concat(t.message)),e.emit(O.ERROR,O.ERROR,{type:x.MEDIA_ERROR,details:P.FRAG_PARSING_ERROR,fatal:!1,levelRetry:n,error:t,reason:t.message})}function iW(e,t){t.log("".concat(e," with AES-128-CBC encryption found in unencrypted stream"))}function iz(e,t){var n,i,r,a,s,o=0,l=e.data;if(!e||0===e.size)return null;for(;l[0].length<19&&l.length>1;)l[0]=eD(l[0],l[1]),l.splice(1,1);if(1===((n=l[0])[0]<<16)+(n[1]<<8)+n[2]){if((i=(n[4]<<8)+n[5])&&i>e.size-6)return null;var u=n[7];192&u&&(a=(14&n[9])*0x20000000+(255&n[10])*4194304+(254&n[11])*16384+(255&n[12])*128+(254&n[13])/2,64&u?a-(s=(14&n[14])*0x20000000+(255&n[15])*4194304+(254&n[16])*16384+(255&n[17])*128+(254&n[18])/2)>54e5&&(t.warn("".concat(Math.round((a-s)/9e4),"s delta between PTS and DTS, align them")),a=s):s=a);var c=(r=n[8])+9;if(e.size<=c)return null;e.size-=c;for(var h=new Uint8Array(e.size),d=0,f=l.length;d<f;d++){var v=(n=l[d]).byteLength;if(c)if(c>v){c-=v;continue}else n=n.subarray(c),v-=c,c=0;h.set(n,o),o+=v}return i&&(i-=r+3),{data:h,pts:a,dts:s,len:i}}return null}var iX=function(){"use strict";function e(){(0,E._)(this,e)}return(0,k._)(e,null,[{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);else if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);else if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);else if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}]),e}(),iQ=function(){"use strict";function e(){(0,E._)(this,e)}return(0,k._)(e,null,[{key:"init",value:function(){for(t in e.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);e.HDLR_TYPES={video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])};var t,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);e.STTS=e.STSC=e.STCO=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var i=new Uint8Array([105,115,111,109]),r=new Uint8Array([97,118,99,49]),a=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,i,a,i,r),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,n))}},{key:"box",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=8,a=n.length,s=a;a--;)r+=n[a].byteLength;var o=new Uint8Array(r);for(o[0]=r>>24&255,o[1]=r>>16&255,o[2]=r>>8&255,o[3]=255&r,o.set(e,4),a=0,r=8;a<s;a++)o.set(n[a],r),r+=n[a].byteLength;return o}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,n){var i=Math.floor((n*=t)/0x100000000),r=Math.floor(n%0x100000000);return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale||0,t.duration||0),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,n,i){return e.box(e.types.moof,e.mfhd(t),e.traf(i,n))}},{key:"moov",value:function(t){for(var n=t.length,i=[];n--;)i[n]=e.trak(t[n]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale||0,t[0].duration||0)].concat(i).concat(e.mvex(t)))}},{key:"mvex",value:function(t){for(var n=t.length,i=[];n--;)i[n]=e.trex(t[n]);return e.box.apply(null,[e.types.mvex].concat((0,L._)(i)))}},{key:"mvhd",value:function(t,n){var i=Math.floor((n*=t)/0x100000000),r=Math.floor(n%0x100000000),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,a)}},{key:"sdtp",value:function(t){var n,i,r=t.samples||[],a=new Uint8Array(4+r.length);for(n=0;n<r.length;n++)i=r[n].flags,a[n+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return e.box(e.types.sdtp,a)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var n,i,r,a=[],s=[];for(n=0;n<t.sps.length;n++)r=(i=t.sps[n]).byteLength,a.push(r>>>8&255),a.push(255&r),a=a.concat(Array.prototype.slice.call(i));for(n=0;n<t.pps.length;n++)r=(i=t.pps[n]).byteLength,s.push(r>>>8&255),s.push(255&r),s=s.concat(Array.prototype.slice.call(i));var o=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(s))),l=t.width,u=t.height,c=t.pixelRatio[0],h=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,h>>24,h>>16&255,h>>8&255,255&h])))}},{key:"esds",value:function(e){var t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2].concat((0,L._)(t),[6,1,2]))}},{key:"audioStsd",value:function(e){var t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,255&t,0,0])}},{key:"mp4a",value:function(t){return e.box(e.types.mp4a,e.audioStsd(t),e.box(e.types.esds,e.esds(t)))}},{key:"mp3",value:function(t){return e.box(e.types[".mp3"],e.audioStsd(t))}},{key:"ac3",value:function(t){return e.box(e.types["ac-3"],e.audioStsd(t),e.box(e.types.dac3,t.config))}},{key:"stsd",value:function(t){var n=t.segmentCodec;if("audio"===t.type){if("aac"===n)return e.box(e.types.stsd,e.STSD,e.mp4a(t));if("ac3"===n&&t.config)return e.box(e.types.stsd,e.STSD,e.ac3(t));if("mp3"===n&&"mp3"===t.codec)return e.box(e.types.stsd,e.STSD,e.mp3(t))}else if(t.pps&&t.sps){if("avc"===n)return e.box(e.types.stsd,e.STSD,e.avc1(t));if("hevc"===n&&t.vps)return e.box(e.types.stsd,e.STSD,e.hvc1(t))}else throw Error("video track missing pps or sps");throw Error("unsupported ".concat(t.type," segment codec (").concat(n,"/").concat(t.codec,")"))}},{key:"tkhd",value:function(t){var n=t.id,i=(t.duration||0)*(t.timescale||0),r=t.width||0,a=t.height||0,s=Math.floor(i/0x100000000),o=Math.floor(i%0x100000000);return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,a>>8&255,255&a,0,0]))}},{key:"traf",value:function(t,n){var i=e.sdtp(t),r=t.id,a=Math.floor(n/0x100000000),s=Math.floor(n%0x100000000);return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s])),e.trun(t,i.length+16+20+8+16+8+8),i)}},{key:"trak",value:function(t){return t.duration=t.duration||0xffffffff,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var n=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,n){var i,r,a,s,o,l,u=t.samples||[],c=u.length,h=12+16*c,d=new Uint8Array(h);for(n+=8+h,d.set([+("video"===t.type),0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),i=0;i<c;i++)a=(r=u[i]).duration,s=r.size,o=r.flags,l=r.cts,d.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*i);return e.box(e.types.trun,d)}},{key:"initSegment",value:function(t){e.types||e.init();var n=e.moov(t);return eD(e.FTYP,n)}},{key:"hvc1",value:function(t){for(var n=t.params,i=[t.vps,t.sps,t.pps],r=new Uint8Array([1,n.general_profile_space<<6|32*!!n.general_tier_flag|n.general_profile_idc,n.general_profile_compatibility_flags[0],n.general_profile_compatibility_flags[1],n.general_profile_compatibility_flags[2],n.general_profile_compatibility_flags[3],n.general_constraint_indicator_flags[0],n.general_constraint_indicator_flags[1],n.general_constraint_indicator_flags[2],n.general_constraint_indicator_flags[3],n.general_constraint_indicator_flags[4],n.general_constraint_indicator_flags[5],n.general_level_idc,240|n.min_spatial_segmentation_idc>>8,255&n.min_spatial_segmentation_idc,252|n.parallelismType,252|n.chroma_format_idc,248|n.bit_depth_luma_minus8,248|n.bit_depth_chroma_minus8,0,parseInt(n.frame_rate.fps),3|n.temporal_id_nested<<2|n.num_temporal_layers<<3|64*!!n.frame_rate.fixed,i.length]),a=r.length,s=0;s<i.length;s+=1){a+=3;for(var o=0;o<i[s].length;o+=1)a+=2+i[s][o].length}var l=new Uint8Array(a);l.set(r,0),a=r.length;for(var u=i.length-1,c=0;c<i.length;c+=1){l.set(new Uint8Array([32+c|128*(c===u),0,i[c].length]),a),a+=3;for(var h=0;h<i[c].length;h+=1)l.set(new Uint8Array([i[c][h].length>>8,255&i[c][h].length]),a),a+=2,l.set(i[c][h],a),a+=i[c][h].length}var d=e.box(e.types.hvcC,l),f=t.width,v=t.height,g=t.pixelRatio[0],m=t.pixelRatio[1];return e.box(e.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,255&f,v>>8&255,255&v,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([g>>24,g>>16&255,g>>8&255,255&g,m>>24,m>>16&255,m>>8&255,255&m])))}}]),e}();function i$(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=e*t*n;return i?Math.round(r):r}function iZ(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i$(e,1e3,11111111111111112e-21,t)}function iJ(e){var t=e.baseTime,n=e.timescale,i=e.trackId;return"".concat(t/n," (").concat(t,"/").concat(n,") trackId: ").concat(i)}iQ.types=void 0,iQ.HDLR_TYPES=void 0,iQ.STTS=void 0,iQ.STSC=void 0,iQ.STCO=void 0,iQ.STSZ=void 0,iQ.VMHD=void 0,iQ.SMHD=void 0,iQ.STSD=void 0,iQ.FTYP=void 0,iQ.DINF=void 0;var i0=null,i1=null;function i2(e,t,n,i){return{duration:t,size:n,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:+!e}}}var i3=function(e){"use strict";function t(e,n,i,r){if((0,E._)(this,t),(a=(0,y._)(this,t,["mp4-remuxer",r])).observer=void 0,a.config=void 0,a.typeSupported=void 0,a.ISGenerated=!1,a._initPTS=null,a._initDTS=null,a.nextVideoTs=null,a.nextAudioTs=null,a.videoSampleDuration=null,a.isAudioContiguous=!1,a.isVideoContiguous=!1,a.videoTrackConfig=void 0,a.observer=e,a.config=n,a.typeSupported=i,a.ISGenerated=!1,null===i0){var a,s=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);i0=s?parseInt(s[1]):0}if(null===i1){var o=navigator.userAgent.match(/Safari\/(\d+)/i);i1=o?parseInt(o[1]):0}return a}return(0,_._)(t,e),(0,k._)(t,[{key:"destroy",value:function(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}},{key:"resetTimeStamp",value:function(e){var t=this._initPTS;t&&e&&e.trackId===t.trackId&&e.baseTime===t.baseTime&&e.timescale===t.timescale||this.log("Reset initPTS: ".concat(t?iJ(t):t," > ").concat(e?iJ(e):e)),this._initPTS=this._initDTS=e}},{key:"resetNextTimestamp",value:function(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}},{key:"resetInitSegment",value:function(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}},{key:"getVideoStartPts",value:function(e){var t=!1,n=e[0].pts,i=e.reduce(function(e,i){var r=i.pts,a=r-e;return(a<-0x100000000&&(t=!0,a=(r=i5(r,n))-e),a>0)?e:r},n);return t&&this.debug("PTS rollover detected"),i}},{key:"remux",value:function(e,t,n,i,r,a,s,o){var l=r,u=r,c=e.pid>-1,h=t.pid>-1,d=t.samples.length,f=e.samples.length>0,v=s&&d>0||d>1;if((!c||f)&&(!h||v)||this.ISGenerated||s){if(this.ISGenerated){var g,m,p,y,E,k,b,T,S,_,A,L=this.videoTrackConfig;(L&&(t.width!==L.width||t.height!==L.height||(null==(T=t.pixelRatio)?void 0:T[0])!==(null==(S=L.pixelRatio)?void 0:S[0])||(null==(_=t.pixelRatio)?void 0:_[1])!==(null==(A=L.pixelRatio)?void 0:A[1]))||!L&&v||null===this.nextAudioTs&&f)&&this.resetInitSegment()}this.ISGenerated||(p=this.generateIS(e,t,r,a));var w=this.isVideoContiguous,I=-1;if(v&&(I=function(e){for(var t=0;t<e.length;t++)if(e[t].key)return t;return -1}(t.samples),!w&&this.config.forceKeyFrameOnDiscontinuity))if(k=!0,I>0){this.warn("Dropped ".concat(I," out of ").concat(d," video samples due to a missing keyframe"));var R=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(I),t.dropped+=I,u+=(t.samples[0].pts-R)/t.inputTimeScale,b=u}else -1===I&&(this.warn("No keyframe found out of ".concat(d," video samples")),k=!1);if(this.ISGenerated){if(f&&v){var D=this.getVideoStartPts(t.samples),C=(i5(e.samples[0].pts,D)-D)/t.inputTimeScale;l+=Math.max(0,C),u+=Math.max(0,-C)}if(f){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),p=this.generateIS(e,t,r,a)),m=this.remuxAudio(e,l,this.isAudioContiguous,a,h||v||o===G?u:void 0),v){var x=m?m.endPTS-m.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),p=this.generateIS(e,t,r,a)),g=this.remuxVideo(t,u,w,x)}}else v&&(g=this.remuxVideo(t,u,w,0));g&&(g.firstKeyFrame=I,g.independent=-1!==I,g.firstKeyFramePTS=b)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(E=i4(n,r,this._initPTS,this._initDTS)),i.samples.length&&(y=i8(i,r,this._initPTS))),{audio:m,video:g,initSegment:p,independent:k,text:y,id3:E}}},{key:"computeInitPts",value:function(e,t,n,i){var r=Math.round(n*t),a=i5(e,r);if(a<r+t)for(this.log("Adjusting PTS for rollover in timeline near ".concat((r-a)/t," ").concat(i));a<r+t;)a+=0x200000000;return a-r}},{key:"generateIS",value:function(e,t,n,i){var r,a,s,o=e.samples,l=t.samples,u=this.typeSupported,c={},h=this._initPTS,d=!h||i,f="audio/mp4",v=-1;if(d&&(r=a=1/0),e.config&&o.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":u.mpeg?(f="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}c.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&u.mpeg?new Uint8Array(0):iQ.initSegment([e]),metadata:{channelCount:e.channelCount}},d&&(v=e.id,s=e.inputTimeScale,h&&s===h.timescale?d=!1:r=a=this.computeInitPts(o[0].pts,s,n,"audio"))}if(t.sps&&t.pps&&l.length){if(t.timescale=t.inputTimeScale,c.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:iQ.initSegment([t]),metadata:{width:t.width,height:t.height}},d)if(v=t.id,s=t.inputTimeScale,h&&s===h.timescale)d=!1;else{var g=this.getVideoStartPts(l),m=i5(l[0].dts,g),p=this.computeInitPts(m,s,n,"video"),y=this.computeInitPts(g,s,n,"video");a=Math.min(a,p),r=Math.min(r,y)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(c).length)return this.ISGenerated=!0,d?(h&&this.warn("Timestamps at playlist time: ".concat(i?"":"~").concat(n," ").concat(r/s," != initPTS: ").concat(h.baseTime/h.timescale," (").concat(h.baseTime,"/").concat(h.timescale,") trackId: ").concat(h.trackId)),this.log("Found initPTS at playlist time: ".concat(n," offset: ").concat(r/s," (").concat(r,"/").concat(s,") trackId: ").concat(v)),this._initPTS={baseTime:r,timescale:s,trackId:v},this._initDTS={baseTime:a,timescale:s,trackId:v}):r=s=void 0,{tracks:c,initPTS:r,timescale:s,trackId:v}}},{key:"remuxVideo",value:function(e,t,n,i){var r,a,s,o=e.inputTimeScale,l=e.samples,u=[],c=l.length,h=this._initPTS,d=h.baseTime*o/h.timescale,f=this.nextVideoTs,v=8,g=this.videoSampleDuration,m=1/0,p=-1/0,y=!1;if(!n||null===f){var E=d+t*o,k=l[0].pts-i5(l[0].dts,l[0].pts);i0&&null!==f&&15e3>Math.abs(E-k-(f+d))?n=!0:f=E-k-d}for(var b=f+d,T=0;T<c;T++){var S=l[T];S.pts=i5(S.pts,b),S.dts=i5(S.dts,b),S.dts<l[T>0?T-1:T].dts&&(y=!0)}y&&l.sort(function(e,t){var n=e.dts-t.dts,i=e.pts-t.pts;return n||i}),r=l[0].dts;var _=(a=l[l.length-1].dts)-r,A=_?Math.round(_/(c-1)):g||e.inputTimeScale/30;if(n){var L=r-b,w=L>A,I=L<-1;if((w||I)&&(w?this.warn("".concat((e.segmentCodec||"").toUpperCase(),": ").concat(iZ(L,!0)," ms (").concat(L,"dts) hole between fragments detected at ").concat(t.toFixed(3))):this.warn("".concat((e.segmentCodec||"").toUpperCase(),": ").concat(iZ(-L,!0)," ms (").concat(L,"dts) overlapping between fragments detected at ").concat(t.toFixed(3))),!I||b>=l[0].pts||i0)){r=b;var R=l[0].pts-L;if(w)l[0].dts=r,l[0].pts=R;else for(var D=!0,C=0;C<l.length&&(!(l[C].dts>R)||!D);C++){var M=l[C].pts;if(l[C].dts-=L,l[C].pts-=L,C<l.length-1){var F=l[C+1].pts;D=F<=l[C].pts==F<=M}}this.log("Video: Initial PTS/DTS adjusted: ".concat(iZ(R,!0),"/").concat(iZ(r,!0),", delta: ").concat(iZ(L,!0)," ms"))}}for(var N=0,B=0,U=r=Math.max(0,r),j=0;j<c;j++){for(var G=l[j],K=G.units,H=K.length,V=0,Y=0;Y<H;Y++)V+=K[Y].data.length;B+=V,N+=H,G.length=V,G.dts<U?(G.dts=U,U+=A/4|0||1):U=G.dts,m=Math.min(G.pts,m),p=Math.max(G.pts,p)}a=l[c-1].dts;var W=B+4*N+8;try{s=new Uint8Array(W)}catch(e){this.observer.emit(O.ERROR,O.ERROR,{type:x.MUX_ERROR,details:P.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:W,reason:"fail allocating video mdat ".concat(W)});return}var z=new DataView(s.buffer);z.setUint32(0,W),s.set(iQ.types.mdat,4);for(var X=!1,Q=1/0,$=1/0,Z=-1/0,J=-1/0,ee=0;ee<c;ee++){for(var et=l[ee],en=et.units,ei=0,er=0,ea=en.length;er<ea;er++){var es=en[er],eo=es.data,el=es.data.byteLength;z.setUint32(v,el),v+=4,s.set(eo,v),v+=el,ei+=4+el}var eu=void 0;if(ee<c-1)g=l[ee+1].dts-et.dts,eu=l[ee+1].pts-et.pts;else{var ec=this.config,eh=ee>0?et.dts-l[ee-1].dts:A;if(eu=ee>0?et.pts-l[ee-1].pts:A,ec.stretchShortVideoTrack&&null!==this.nextAudioTs){var ed=Math.floor(ec.maxBufferHole*o),ef=(i?m+i*o:this.nextAudioTs+d)-et.pts;ef>ed?((g=ef-eh)<0?g=eh:X=!0,this.log("It is approximately ".concat(ef/90," ms to the next segment; using duration ").concat(g/90," ms for the last video frame."))):g=eh}else g=eh}var ev=Math.round(et.pts-et.dts);Q=Math.min(Q,g),Z=Math.max(Z,g),$=Math.min($,eu),J=Math.max(J,eu),u.push(i2(et.key,g,ei,ev))}if(u.length){if(i0){if(i0<70){var eg=u[0].flags;eg.dependsOn=2,eg.isNonSync=0}}else if(i1&&J-$<Z-Q&&A/Z<.025&&0===u[0].cts){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var em=r,ep=0,ey=u.length;ep<ey;ep++){var eE=em+u[ep].duration,ek=em+u[ep].cts;if(ep<ey-1){var eb=eE+u[ep+1].cts;u[ep].duration=eb-ek}else u[ep].duration=ep?u[ep-1].duration:A;u[ep].cts=0,em=eE}}}var eT=a+(g=X||!g?A:g);this.nextVideoTs=f=eT-d,this.videoSampleDuration=g,this.isVideoContiguous=!0;var eS={data1:iQ.moof(e.sequenceNumber++,r,q(e,{samples:u})),data2:s,startPTS:(m-d)/o,endPTS:(p+g-d)/o,startDTS:(r-d)/o,endDTS:f/o,type:"video",hasAudio:!1,hasVideo:!0,nb:u.length,dropped:e.dropped};return e.samples=[],e.dropped=0,eS}},{key:"getSamplesPerFrame",value:function(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}},{key:"remuxAudio",value:function(e,t,n,i,r){var a,s=e.inputTimeScale,o=e.samplerate?e.samplerate:s,l=s/o,u=this.getSamplesPerFrame(e),c=u*l,h=this._initPTS,d="mp3"===e.segmentCodec&&this.typeSupported.mpeg,f=[],v=void 0!==r,g=e.samples,m=8*!d,p=this.nextAudioTs||-1,y=h.baseTime*s/h.timescale,E=y+t*s;if(this.isAudioContiguous=n=n||g.length&&p>0&&(i&&9e3>Math.abs(E-(p+y))||Math.abs(i5(g[0].pts,E)-(p+y))<20*c),g.forEach(function(e){e.pts=i5(e.pts,E)}),!n||p<0){var k=g.length;if(k!==(g=g.filter(function(e){return e.pts>=0})).length&&this.warn("Removed ".concat(g.length-k," of ").concat(k," samples (initPTS ").concat(y," / ").concat(s,")")),!g.length)return;p=0===r?0:i&&!v?Math.max(0,E-y):g[0].pts-y}if("aac"===e.segmentCodec)for(var b=this.config.maxAudioFramesDrift,T=0,S=p+y;T<g.length;T++){var _=g[T],A=_.pts,L=A-S,w=Math.abs(1e3*L/s);if(L<=-b*c&&v)0===T&&(this.warn("Audio frame @ ".concat((A/s).toFixed(3),"s overlaps marker by ").concat(Math.round(1e3*L/s)," ms.")),this.nextAudioTs=p=A-y,S=A);else if(L>=b*c&&w<1e4&&v){var I=Math.round(L/c);for(S=A-I*c;S<0&&I&&c;)I--,S+=c;0===T&&(this.nextAudioTs=p=S-y),this.warn("Injecting ".concat(I," audio frames @ ").concat(((S-y)/s).toFixed(3),"s due to ").concat(Math.round(1e3*L/s)," ms gap."));for(var R=0;R<I;R++){var D=iX.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);D||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),D=_.unit.subarray()),g.splice(T,0,{unit:D,pts:S}),S+=c,T++}}_.pts=S,S+=c}for(var C=null,M=null,F=0,N=g.length;N--;)F+=g[N].unit.byteLength;for(var B=0,U=g.length;B<U;B++){var j=g[B],G=j.unit,K=j.pts;if(null!==M)f[B-1].duration=Math.round((K-M)/l);else{if(n&&"aac"===e.segmentCodec&&(K=p+y),C=K,!(F>0))return;F+=m;try{a=new Uint8Array(F)}catch(e){this.observer.emit(O.ERROR,O.ERROR,{type:x.MUX_ERROR,details:P.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:F,reason:"fail allocating audio mdat ".concat(F)});return}d||(new DataView(a.buffer).setUint32(0,F),a.set(iQ.types.mdat,4))}a.set(G,m);var H=G.byteLength;m+=H,f.push(i2(!0,u,H,0)),M=K}var V=f.length;if(V){var Y=f[f.length-1];p=M-y,this.nextAudioTs=p+l*Y.duration;var W=d?new Uint8Array(0):iQ.moof(e.sequenceNumber++,C/l,q({},e,{samples:f}));e.samples=[];var z=(C-y)/s,X=p/s,Q={data1:W,data2:a,startPTS:z,endPTS:X,startDTS:z,endDTS:X,type:"audio",hasAudio:!0,hasVideo:!1,nb:V};return this.isAudioContiguous=!0,Q}}}]),t}(z);function i5(e,t){var n;if(null===t)return e;for(n=t<e?-0x200000000:0x200000000;Math.abs(e-t)>0x100000000;)e+=n;return e}function i4(e,t,n,i){var r=e.samples.length;if(r){for(var a=e.inputTimeScale,s=0;s<r;s++){var o=e.samples[s];o.pts=i5(o.pts-n.baseTime*a/n.timescale,t*a)/a,o.dts=i5(o.dts-i.baseTime*a/i.timescale,t*a)/a}var l=e.samples;return e.samples=[],{samples:l}}}function i8(e,t,n){var i=e.samples.length;if(i){for(var r=e.inputTimeScale,a=0;a<i;a++){var s=e.samples[a];s.pts=i5(s.pts-n.baseTime*r/n.timescale,t*r)/r}e.samples.sort(function(e,t){return e.pts-t.pts});var o=e.samples;return e.samples=[],{samples:o}}}var i6=function(e){"use strict";function t(e,n,i,r){var a;return(0,E._)(this,t),(a=(0,y._)(this,t,["passthrough-remuxer",r])).emitInitSegment=!1,a.audioCodec=void 0,a.videoCodec=void 0,a.initData=void 0,a.initPTS=null,a.initTracks=void 0,a.lastEndTime=null,a.isVideoContiguous=!1,a}return(0,_._)(t,e),(0,k._)(t,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(e){this.lastEndTime=null;var t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}},{key:"resetNextTimestamp",value:function(){this.isVideoContiguous=!1,this.lastEndTime=null}},{key:"resetInitSegment",value:function(e,t,n,i){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,i),this.emitInitSegment=!0}},{key:"generateInitSegment",value:function(e,t){var n=this.audioCodec,i=this.videoCodec;if(!(null!=e&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}var r=this.initData=eS(e),a=r.audio,s=r.video;if(t){if(e&&t){var o=t.keyId;o&&t.isCommonEncryption&&eI(e,function(e,t){var n=e.subarray(8,24);n.some(function(e){return 0!==e})||(J.log("[eme] Patching keyId in 'enc".concat(t?"a":"v",">sinf>>tenc' box: ").concat(ei(n)," -> ").concat(ei(o))),e.set(o,8))})}}else{var l=a||s;null!=l&&l.encrypted&&this.warn('Init segment with encrypted track with has no key ("'.concat(l.codec,'")!'))}a&&(n=i7(a,el,this)),s&&(i=i7(s,eu,this));var u={};a&&s?u.audiovideo={container:"video/mp4",codec:n+","+i,supplemental:s.supplemental,encrypted:s.encrypted,initSegment:e,id:"main"}:a?u.audio={container:"audio/mp4",codec:n,encrypted:a.encrypted,initSegment:e,id:"audio"}:s?u.video={container:"video/mp4",codec:i,supplemental:s.supplemental,encrypted:s.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=u}},{key:"remux",value:function(e,t,n,i,r,a){var s,o,l=this.initPTS,u=this.lastEndTime,c={audio:void 0,video:void 0,text:i,id3:n,initSegment:void 0};R(u)||(u=this.lastEndTime=r||0);var h=t.samples;if(!h.length)return c;var d={initPTS:void 0,timescale:void 0,trackId:void 0},f=this.initData;if(null!=(s=f)&&s.length||(this.generateInitSegment(h),f=this.initData),!(null!=(o=f)&&o.length))return this.warn("Failed to generate initSegment."),c;this.emitInitSegment&&(d.tracks=this.initTracks,this.emitInitSegment=!1);var v=function(e,t,n){for(var i={},r=eT(e,["moof","traf"]),a=0;a<r.length;a++){var s=r[a],o=eT(s,["tfhd"])[0],l=eE(o,4),u=t[l];if(u){i[l]||(i[l]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type});var c=i[l],h=eT(s,["tfdt"])[0];if(h){var d=h[0],f=eE(h,4);1===d&&(0xffffffff===f?n.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(f*=0x100000000,f+=eE(h,8))),R(f)&&(!R(c.start)||f<c.start)&&(c.start=f)}var v=u.default,g=eE(o,0)|(null==v?void 0:v.flags),m=(null==v?void 0:v.duration)||0;8&g&&(m=2&g?eE(o,12):eE(o,8));for(var p=eT(s,["trun"]),y=c.start||0,E=0,k=m,b=0;b<p.length;b++){var T=p[b],S=eE(T,4),_=c.sampleCount;c.sampleCount+=S;var A=1&T[3],L=4&T[3],w=1&T[2],I=2&T[2],D=4&T[2],C=8&T[2],x=8,P=S;for(A&&(x+=4),L&&S&&(1&T[x+1]||void 0!==c.keyFrameIndex||(c.keyFrameIndex=_),x+=4,w?(k=eE(T,x),x+=4):k=m,I&&(x+=4),C&&(x+=4),y+=k,E+=k,P--);P--;)w?(k=eE(T,x),x+=4):k=m,I&&(x+=4),D&&(1&T[x+1]||void 0!==c.keyFrameIndex||(c.keyFrameIndex=c.sampleCount-(P+1),c.keyFrameStart=y),x+=4),C&&(x+=4),y+=k,E+=k;!E&&m&&(E+=m*S)}c.duration+=E}}if(!Object.keys(i).some(function(e){return i[e].duration})){for(var O=1/0,M=0,F=eT(e,["sidx"]),N=0;N<F.length;N++){var B=function(e){var t=[],n=e[0],i=8,r=eE(e,8);i+=4;var a=0,s=0;0===n?(a=eE(e,i),s=eE(e,i+4),i+=8):(a=ek(e,i),s=ek(e,i+8),i+=16),i+=2;var o=e.length+s,l=ey(e,i);i+=2;for(var u=0;u<l;u++){var c=i,h=eE(e,c);c+=4;var d=0x7fffffff&h;if(1==(0x80000000&h)>>>31)return J.warn("SIDX has hierarchical references (not supported)"),null;var f=eE(e,c);c+=4,t.push({referenceSize:d,subsegmentDuration:f,info:{duration:f/r,start:o,end:o+d-1}}),o+=d,c+=4,i=c}return{earliestPresentationTime:a,timescale:r,version:n,referencesCount:l,references:t}}(F[N]);if(null!=B&&B.references){O=Math.min(O,B.earliestPresentationTime/B.timescale);var U=B.references.reduce(function(e,t){return e+t.info.duration||0},0);M=Math.max(M,U+B.earliestPresentationTime/B.timescale)}}M&&R(M)&&Object.keys(i).forEach(function(e){i[e].duration||(i[e].duration=M*i[e].timescale-i[e].start)})}return i}(h,f,this),g=f.audio?v[f.audio.id]:null,m=f.video?v[f.video.id]:null,p=i9(m,1/0),y=i9(g,1/0),E=i9(m,0,!0),k=i9(g,0,!0),b=r,T=0,S=g&&(!m||!l&&y<p||l&&l.trackId===f.audio.id),_=S?g:m;if(_){var A=_.timescale,L=_.start-r*A,w=S?f.audio.id:f.video.id;b=_.start/A,T=S?k-y:E-p,(a||!l)&&(function(e,t,n,i){if(null===e)return!0;var r=Math.max(i,1);return Math.abs(t-e.baseTime/e.timescale-n)>r}(l,b,r,T)||A!==l.timescale)&&(l&&this.warn("Timestamps at playlist time: ".concat(a?"":"~").concat(r," ").concat(L/A," != initPTS: ").concat(l.baseTime/l.timescale," (").concat(l.baseTime,"/").concat(l.timescale,") trackId: ").concat(l.trackId)),this.log("Found initPTS at playlist time: ".concat(r," offset: ").concat(b-r," (").concat(L,"/").concat(A,") trackId: ").concat(w)),l=null,d.initPTS=L,d.timescale=A,d.trackId=w)}else this.warn("No audio or video samples found for initPTS at playlist time: ".concat(r));l?(d.initPTS=l.baseTime,d.timescale=l.timescale,d.trackId=l.trackId):(d.timescale&&void 0!==d.trackId&&void 0!==d.initPTS||(this.warn("Could not set initPTS"),d.initPTS=b,d.timescale=1,d.trackId=-1),this.initPTS=l={baseTime:d.initPTS,timescale:d.timescale,trackId:d.trackId});var I=b-l.baseTime/l.timescale,D=I+T;T>0?this.lastEndTime=D:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var C=!!f.audio,x=!!f.video,P="";C&&(P+="audio"),x&&(P+="video");var O={data1:h,startPTS:I,startDTS:I,endPTS:D,endDTS:D,type:P,hasAudio:C,hasVideo:x,nb:1,dropped:0,encrypted:!!f.audio&&f.audio.encrypted||!!f.video&&f.video.encrypted};c.audio=C&&!x?O:void 0,c.video=x?O:void 0;var M=null==m?void 0:m.sampleCount;if(M){var F=m.keyFrameIndex,N=-1!==F;O.nb=M,O.dropped=0===F||this.isVideoContiguous?0:N?F:M,O.independent=N,O.firstKeyFrame=F,N&&m.keyFrameStart&&(O.firstKeyFramePTS=(m.keyFrameStart-l.baseTime)/l.timescale),this.isVideoContiguous||(c.independent=N),this.isVideoContiguous||(this.isVideoContiguous=N),O.dropped&&this.warn("fmp4 does not start with IDR: firstIDR ".concat(F,"/").concat(M," dropped: ").concat(O.dropped," start: ").concat(O.firstKeyFramePTS||"NA"))}return c.initSegment=d,c.id3=i4(n,r,l,l),i.samples.length&&(c.text=i8(i,r,l)),c}}]),t}(z);function i9(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(null==e?void 0:e.start)!==void 0?(e.start+(n?e.duration:0))/e.timescale:t}function i7(e,t,n){var i=e.codec;return i&&i.length>4?i:t===el?"ec-3"===i||"ac-3"===i||"alac"===i?i:"fLaC"===i||"Opus"===i?eq(i,!1):(n.warn('Unhandled audio codec "'.concat(i,'" in mp4 MAP')),i||"mp4a"):(n.warn('Unhandled video codec "'.concat(i,'" in mp4 MAP')),i||"avc1")}try{m=self.performance.now.bind(self.performance)}catch(e){m=Date.now}var re=[{demux:iN,remux:i6},{demux:iV,remux:i3},{demux:iC,remux:i3},{demux:iM,remux:i3}];re.splice(2,0,{demux:iP,remux:i3});var rt=function(){"use strict";function e(t,n,i,r,a,s){(0,E._)(this,e),this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=n,this.config=i,this.id=a,this.logger=s}return(0,k._)(e,[{key:"configure",value:function(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}},{key:"push",value:function(e,t,n,i){var r,a,s,o=this,l=n.transmuxing;l.executeStart=m();var u=new Uint8Array(e),c=this.currentTransmuxState,h=this.transmuxConfig;i&&(this.currentTransmuxState=i);var d=i||c,f=d.contiguous,v=d.discontinuity,g=d.trackSwitch,p=d.accurateTimeOffset,y=d.timeOffset,E=d.initSegmentChange,k=h.audioCodec,b=h.videoCodec,T=h.defaultInitPts,S=h.duration,_=h.initSegmentData,A=(r=u,a=t,s=null,r.byteLength>0&&(null==a?void 0:a.key)!=null&&null!==a.iv&&null!=a.method&&(s=a),s);if(A&&tZ(A.method)){var L=this.getDecrypter(),w=tJ(A.method);if(!L.isSync())return this.asyncResult=!0,this.decryptionPromise=L.webCryptoDecrypt(u,A.key.buffer,A.iv.buffer,w).then(function(e){var t=o.push(e,null,n);return o.decryptionPromise=null,t}),this.decryptionPromise;var I=L.softwareDecrypt(u,A.key.buffer,A.iv.buffer,w);if(n.part>-1){var R=L.flush();I=R?R.buffer:R}if(!I)return l.executeEnd=m(),rn(n);u=new Uint8Array(I)}var D=this.needsProbing(v,g);if(D){var C=this.configureTransmuxer(u);if(C)return this.logger.warn("[transmuxer] ".concat(C.message)),this.observer.emit(O.ERROR,O.ERROR,{type:x.MEDIA_ERROR,details:P.FRAG_PARSING_ERROR,fatal:!1,error:C,reason:C.message}),l.executeEnd=m(),rn(n)}(v||g||E||D)&&this.resetInitSegment(_,k,b,S,t),(v||E||D)&&this.resetInitialTimestamp(T),f||this.resetContiguity();var M=this.transmux(u,A,y,p,n);this.asyncResult=ri(M);var F=this.currentTransmuxState;return F.contiguous=!0,F.discontinuity=!1,F.trackSwitch=!1,l.executeEnd=m(),M}},{key:"flush",value:function(e){var t=this,n=e.transmuxing;n.executeStart=m();var i=this.decrypter,r=this.currentTransmuxState,a=this.decryptionPromise;if(a)return this.asyncResult=!0,a.then(function(){return t.flush(e)});var s=[],o=r.timeOffset;if(i){var l=i.flush();l&&s.push(this.push(l.buffer,null,e))}var u=this.demuxer,c=this.remuxer;if(!u||!c){n.executeEnd=m();var h=[rn(e)];return this.asyncResult?Promise.resolve(h):h}var d=u.flush(o);return ri(d)?(this.asyncResult=!0,d.then(function(n){return t.flushRemux(s,n,e),s})):(this.flushRemux(s,d,e),this.asyncResult)?Promise.resolve(s):s}},{key:"flushRemux",value:function(e,t,n){var i=t.audioTrack,r=t.videoTrack,a=t.id3Track,s=t.textTrack,o=this.currentTransmuxState,l=o.accurateTimeOffset,u=o.timeOffset;this.logger.log("[transmuxer.ts]: Flushed ".concat(this.id," sn: ").concat(n.sn).concat(n.part>-1?" part: "+n.part:""," of ").concat(this.id===j?"level":"track"," ").concat(n.level));var c=this.remuxer.remux(i,r,a,s,u,l,!0,this.id);e.push({remuxResult:c,chunkMeta:n}),n.transmuxing.executeEnd=m()}},{key:"resetInitialTimestamp",value:function(e){var t=this.demuxer,n=this.remuxer;t&&n&&(t.resetTimeStamp(e),n.resetTimeStamp(e))}},{key:"resetContiguity",value:function(){var e=this.demuxer,t=this.remuxer;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}},{key:"resetInitSegment",value:function(e,t,n,i,r){var a=this.demuxer,s=this.remuxer;a&&s&&(a.resetInitSegment(e,t,n,i),s.resetInitSegment(e,t,n,r))}},{key:"destroy",value:function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}},{key:"transmux",value:function(e,t,n,i,r){return t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,n,i,r):this.transmuxUnencrypted(e,n,i,r)}},{key:"transmuxUnencrypted",value:function(e,t,n,i){var r=this.demuxer.demux(e,t,!1,!this.config.progressive),a=r.audioTrack,s=r.videoTrack,o=r.id3Track,l=r.textTrack;return{remuxResult:this.remuxer.remux(a,s,o,l,t,n,!1,this.id),chunkMeta:i}}},{key:"transmuxSampleAes",value:function(e,t,n,i,r){var a=this;return this.demuxer.demuxSampleAes(e,t,n).then(function(e){return{remuxResult:a.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,n,i,!1,a.id),chunkMeta:r}})}},{key:"configureTransmuxer",value:function(e){for(var t,n,i=this.config,r=this.observer,a=this.typeSupported,s=0,o=re.length;s<o;s++)if(null!=(n=re[s].demux)&&n.probe(e,this.logger)){t=re[s];break}if(!t)return Error("Failed to find demuxer by probing fragment data");var l=this.demuxer,u=this.remuxer,c=t.remux,h=t.demux;u&&u instanceof c||(this.remuxer=new c(r,i,a,this.logger)),l&&l instanceof h||(this.demuxer=new h(r,i,a,this.logger),this.probe=h.probe)}},{key:"needsProbing",value:function(e,t){return!this.demuxer||!this.remuxer||e||t}},{key:"getDecrypter",value:function(){var e=this.decrypter;return e||(e=this.decrypter=new tx(this.config)),e}}]),e}(),rn=function(e){return{remuxResult:{},chunkMeta:e}};function ri(e){return"then"in e&&e.then instanceof Function}var rr=function e(t,n,i,r,a){"use strict";(0,E._)(this,e),this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=n,this.initSegmentData=i,this.duration=r,this.defaultInitPts=a||null},ra=function e(t,n,i,r,a,s){"use strict";(0,E._)(this,e),this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=n,this.accurateTimeOffset=i,this.trackSwitch=r,this.timeOffset=a,this.initSegmentChange=s},rs=0,ro=function(){"use strict";function e(t,n,i,r){var a=this;(0,E._)(this,e),this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=rs++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=function(e){var t=e.data,n=a.hls;if(n&&null!=t&&t.event&&t.instanceNo===a.instanceNo)switch(t.event){case"init":var i,r=null==(i=a.workerContext)?void 0:i.objectURL;r&&self.URL.revokeObjectURL(r);break;case"transmuxComplete":a.handleTransmuxComplete(t.data);break;case"flush":a.onFlush(t.data);break;case"workerLog":n.logger[t.data.logType]&&n.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=a.frag,t.data.part=a.part,t.data.id=a.id,n.trigger(t.event,t.data)}},this.onWorkerError=function(e){if(a.hls){var t=Error("".concat(e.message,"  (").concat(e.filename,":").concat(e.lineno,")"));a.hls.config.enableWorker=!1,a.hls.logger.warn('Error in "'.concat(a.id,'" Web Worker, fallback to inline')),a.hls.trigger(O.ERROR,{type:x.OTHER_ERROR,details:P.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:t})}};var s=t.config;this.hls=t,this.id=n,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=i,this.onFlush=r;var o=function(e,t){(t=t||{}).frag=a.frag||void 0,e===O.ERROR&&(t.parent=a.id,t.part=a.part,a.error=t.error),a.hls.trigger(e,t)};this.observer=new n9,this.observer.on(O.FRAG_DECRYPTED,o),this.observer.on(O.ERROR,o);var l=ez(s.preferManagedMediaSource);if(this.useWorker&&"undefined"!=typeof Worker){var u=this.hls.logger;if(s.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__){try{s.workerPath?(u.log("loading Web Worker ".concat(s.workerPath,' for "').concat(n,'"')),this.workerContext=function(e){var t=ie[e];if(t)return t.clientCount++,t;var n=new self.URL(e,self.location.href).href,i={worker:new self.Worker(n),scriptURL:n,clientCount:1};return ie[e]=i,i}(s.workerPath)):(u.log('injecting Web Worker for "'.concat(n,'"')),this.workerContext=function(){var e=ie[n7];if(e)return e.clientCount++,e;var t=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(".concat(__HLS_WORKER_BUNDLE__.toString(),")(true);")],{type:"text/javascript"}),n=self.URL.createObjectURL(t),i={worker:new self.Worker(n),objectURL:n,clientCount:1};return ie[n7]=i,i}());var c=this.workerContext.worker;c.addEventListener("message",this.onWorkerMessage),c.addEventListener("error",this.onWorkerError),c.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:l,id:n,config:e9(s)})}catch(e){u.warn('Error setting up "'.concat(n,'" Web Worker, fallback to inline'),e),this.terminateWorker(),this.error=null,this.transmuxer=new rt(this.observer,l,s,"",n,t.logger)}return}}this.transmuxer=new rt(this.observer,l,s,"",n,t.logger)}return(0,k._)(e,[{key:"reset",value:function(){if(this.frag=null,this.part=null,this.workerContext){var e=this.instanceNo;this.instanceNo=rs++;var t=this.hls.config,n=ez(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:e9(t)})}}},{key:"terminateWorker",value:function(){if(this.workerContext){var e=this.workerContext.worker;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),function(e){var t=ie[e||n7];if(t&&1==t.clientCount--){var n=t.worker,i=t.objectURL;delete ie[e||n7],i&&self.URL.revokeObjectURL(i),n.terminate()}}(this.hls.config.workerPath)}}},{key:"destroy",value:function(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{var e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}var t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}},{key:"push",value:function(e,t,n,i,r,a,s,o,l,u){var c,h,d=this;l.transmuxing.start=self.performance.now();var f=this.instanceNo,v=this.transmuxer,g=a?a.start:r.start,m=r.decryptdata,p=this.frag,y=!(p&&r.cc===p.cc),E=!(p&&l.level===p.level),k=p?l.sn-p.sn:-1,b=this.part?l.part-this.part.index:-1,T=0===k&&l.id>1&&l.id===(null==p?void 0:p.stats.chunkCount),S=!E&&(1===k||0===k&&(1===b||T&&b<=0)),_=self.performance.now();(E||k||0===r.stats.parsing.start)&&(r.stats.parsing.start=_),a&&(b||!S)&&(a.stats.parsing.start=_);var A=!(p&&(null==(c=r.initSegment)?void 0:c.url)===(null==(h=p.initSegment)?void 0:h.url)),L=new ra(y,S,o,E,g,A);if(!S||y||A){this.hls.logger.log("[transmuxer-interface]: Starting new transmux session for ".concat(r.type," sn: ").concat(l.sn).concat(l.part>-1?" part: "+l.part:""," ").concat(this.id===j?"level":"track",": ").concat(l.level," id: ").concat(l.id,"\n        discontinuity: ").concat(y,"\n        trackSwitch: ").concat(E,"\n        contiguous: ").concat(S,"\n        accurateTimeOffset: ").concat(o,"\n        timeOffset: ").concat(g,"\n        initSegmentChange: ").concat(A));var w=new rr(n,i,t,s,u);this.configureTransmuxer(w)}if(this.frag=r,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:f,cmd:"demux",data:e,decryptdata:m,chunkMeta:l,state:L},e instanceof ArrayBuffer?[e]:[]);else if(v){var I=v.push(e,m,l,L);ri(I)?I.then(function(e){d.handleTransmuxComplete(e)}).catch(function(e){d.transmuxerError(e,l,"transmuxer-interface push error")}):this.handleTransmuxComplete(I)}}},{key:"flush",value:function(e){var t=this;e.transmuxing.start=self.performance.now();var n=this.instanceNo,i=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:n,cmd:"flush",chunkMeta:e});else if(i){var r=i.flush(e);ri(r)?r.then(function(n){t.handleFlushResult(n,e)}).catch(function(n){t.transmuxerError(n,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}},{key:"transmuxerError",value:function(e,t,n){this.hls&&(this.error=e,this.hls.trigger(O.ERROR,{type:x.MEDIA_ERROR,details:P.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}},{key:"handleFlushResult",value:function(e,t){var n=this;e.forEach(function(e){n.handleTransmuxComplete(e)}),this.onFlush(t)}},{key:"configureTransmuxer",value:function(e){var t=this.instanceNo,n=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}},{key:"handleTransmuxComplete",value:function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}]),e}(),rl=function(e){"use strict";function t(e,n,i){var r;return(0,E._)(this,t),(r=(0,y._)(this,t,[e,n,i,"audio-stream-controller",G])).mainAnchor=null,r.mainFragLoading=null,r.audioOnly=!1,r.bufferedTrack=null,r.switchingTrack=null,r.trackId=-1,r.waitingData=null,r.mainDetails=null,r.flushing=!1,r.bufferFlushed=!1,r.cachedTrackLoadedData=null,r.registerListeners(),r}return(0,_._)(t,e),(0,k._)(t,[{key:"onHandlerDestroying",value:function(){this.unregisterListeners(),(0,T._)((0,S._)(t.prototype),"onHandlerDestroying",this).call(this),this.resetItem()}},{key:"resetItem",value:function(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}},{key:"registerListeners",value:function(){(0,T._)((0,S._)(t.prototype),"registerListeners",this).call(this);var e=this.hls;e.on(O.LEVEL_LOADED,this.onLevelLoaded,this),e.on(O.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(O.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(O.BUFFER_RESET,this.onBufferReset,this),e.on(O.BUFFER_CREATED,this.onBufferCreated,this),e.on(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(O.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(O.FRAG_LOADING,this.onFragLoading,this),e.on(O.FRAG_BUFFERED,this.onFragBuffered,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e&&((0,T._)((0,S._)(t.prototype),"unregisterListeners",this).call(this),e.off(O.LEVEL_LOADED,this.onLevelLoaded,this),e.off(O.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(O.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(O.BUFFER_RESET,this.onBufferReset,this),e.off(O.BUFFER_CREATED,this.onBufferCreated,this),e.off(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(O.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(O.FRAG_LOADING,this.onFragLoading,this),e.off(O.FRAG_BUFFERED,this.onFragBuffered,this))}},{key:"onInitPtsFound",value:function(e,t){var n=t.frag,i=t.id,r=t.initPTS,a=t.timescale,s=t.trackId;if(i===j){var o=n.cc,l=this.fragCurrent;if(this.initPTS[o]={baseTime:r,timescale:a,trackId:s},this.log("InitPTS for cc: ".concat(o," found from main: ").concat(r/a," (").concat(r,"/").concat(a,") trackId: ").concat(s)),this.mainAnchor=n,this.state===n2){var u=this.waitingData;(u||this.loadingParts)&&(!u||u.frag.cc===o)||this.syncWithAnchor(n,null==u?void 0:u.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==o?(l.abortRequests(),this.syncWithAnchor(n,l)):this.state===nW&&this.tick()}}},{key:"getLoadPosition",value:function(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:(0,T._)((0,S._)(t.prototype),"getLoadPosition",this).call(this)}},{key:"syncWithAnchor",value:function(e,t){var n,i=(null==(n=this.mainFragLoading)?void 0:n.frag)||null;if(!t||(null==i?void 0:i.cc)!==t.cc){var r=(i||e).cc,a=th(this.getLevelDetails(),r,this.getLoadPosition());a&&(this.log("Syncing with main frag at ".concat(a.start," cc ").concat(a.cc)),this.startFragRequested=!1,this.nextLoadPosition=a.start,this.resetLoadingState(),this.state===nW&&this.doTickIdle())}}},{key:"startLoad",value:function(e,t){if(!this.levels){this.startPosition=e,this.state=nY;return}var n=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),n>0&&-1===e?(this.log("Override startPosition with lastCurrentTime @".concat(n.toFixed(3))),e=n,this.state=nW):this.state=n$,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}},{key:"doTick",value:function(){switch(this.state){case nW:this.doTickIdle();break;case n$:var e=this.levels,n=this.trackId,i=null==e?void 0:e[n],r=null==i?void 0:i.details;if(r&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(r))break;this.state=n2}break;case nQ:this.checkRetryDate();break;case n2:var a=this.waitingData;if(a){var s=a.frag,o=a.part,l=a.cache,u=a.complete,c=this.mainAnchor;if(void 0!==this.initPTS[s.cc]){this.waitingData=null,this.state=nX;var h={frag:s,part:o,payload:l.flush().buffer,networkDetails:null};this._handleFragmentLoadProgress(h),u&&(0,T._)((0,S._)(t.prototype),"_handleFragmentLoadComplete",this).call(this,h)}else c&&c.cc!==a.frag.cc&&this.syncWithAnchor(c,a.frag)}else this.state=nW}this.onTickEnd()}},{key:"resetLoadingState",value:function(){var e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),(0,T._)((0,S._)(t.prototype),"resetLoadingState",this).call(this)}},{key:"onTickEnd",value:function(){var e=this.media;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}},{key:"doTickIdle",value:function(){var e,t=this.hls,n=this.levels,i=this.media,r=this.trackId,a=t.config;if(this.buffering&&(i||this.primaryPrefetch||!this.startFragRequested&&a.startFragPrefetch)&&null!=n&&n[r]){var s=n[r],o=s.details;if(!o||this.waitForLive(s)||this.waitForCdnTuneIn(o)){this.state=n$,this.startFragRequested=!1;return}var l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,el,G));var u=this.getFwdBufferInfo(l,G);if(null!==u){if(!this.switchingTrack&&this._streamEnded(u,o)){t.trigger(O.BUFFER_EOS,{type:"audio"}),this.state=n0;return}var c=u.len,h=t.maxBufferLength,d=o.fragments,f=d[0].start,v=this.getLoadPosition(),g=this.flushing?v:u.end;if(this.switchingTrack&&i&&o.PTSKnown&&v<f&&(u.end>f||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=f+.05),!(c>=h)||this.switchingTrack||!(g<d[d.length-1].start)){var m=this.getNextFragment(g,o);if(m&&this.isLoopLoading(m,g)&&(m=this.getNextFragmentLoopLoading(m,o,u,j,h)),!m){this.bufferFlushed=!0;return}var p=(null==(e=this.mainFragLoading)?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&p&&ed(m)&&!m.endList&&(!o.live||!this.loadingParts&&g<this.hls.liveSyncPosition)&&("OK"===this.fragmentTracker.getState(p)&&(this.mainFragLoading=p=null),p&&ed(p))){if(m.start>p.end){var y=this.fragmentTracker.getFragAtPos(g,j);y&&y.end>p.end&&(p=y,this.mainFragLoading={frag:y,targetBufferTime:null})}if(m.start>p.end)return}this.loadFragment(m,s,g)}}}}},{key:"onMediaDetaching",value:function(e,n){this.bufferFlushed=this.flushing=!1,(0,T._)((0,S._)(t.prototype),"onMediaDetaching",this).call(this,e,n)}},{key:"onAudioTracksUpdated",value:function(e,t){var n=t.audioTracks;this.resetTransmuxer(),this.levels=n.map(function(e){return new e4(e)})}},{key:"onAudioTrackSwitching",value:function(e,t){var n=!!t.url;this.trackId=t.id;var i=this.fragCurrent;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==nY&&(this.setInterval(100),this.state=nW,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}},{key:"onManifestLoading",value:function(){(0,T._)((0,S._)(t.prototype),"onManifestLoading",this).call(this),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}},{key:"onLevelLoaded",value:function(e,t){this.mainDetails=t.details;var n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(O.AUDIO_TRACK_LOADED,n))}},{key:"onAudioTrackLoaded",value:function(e,t){var n,i,r=this.levels,a=t.details,s=t.id,o=t.groupId,l=t.track;if(!r)return void this.warn("Audio tracks reset while loading track ".concat(s,' "').concat(l.name,'" of "').concat(o,'"'));var u=this.mainDetails;if(!u||a.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=t,this.state!==nY&&(this.state=n$);return}this.cachedTrackLoadedData=null,this.log("Audio track ".concat(s,' "').concat(l.name,'" of "').concat(o,'" loaded [').concat(a.startSN,",").concat(a.endSN,"]").concat(a.lastPartSn?"[part-".concat(a.lastPartSn,"-").concat(a.lastPartIndex,"]"):"",",duration:").concat(a.totalduration));var c=r[s],h=0;if(a.live||null!=(n=c.details)&&n.live){if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;c.details&&(h=this.alignPlaylists(a,c.details,null==(i=this.levelLastLoaded)?void 0:i.details)),a.alignedSliding||(nG(a,u),a.alignedSliding||nK(a,u),h=a.fragmentStart)}c.details=a,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(u,h),this.hls.trigger(O.AUDIO_TRACK_UPDATED,{details:a,id:s,groupId:t.groupId}),this.state!==n$||this.waitForCdnTuneIn(a)||(this.state=nW),this.tick()}},{key:"_handleFragmentLoadProgress",value:function(e){var t,n=e.frag,i=e.part,r=e.payload,a=this.config,s=this.trackId,o=this.levels;if(!o)return void this.warn("Audio tracks were reset while fragment load was in progress. Fragment ".concat(n.sn," of level ").concat(n.level," will not be buffered"));var l=o[s];if(!l)return void this.warn("Audio track is undefined on fragment load progress");var u=l.details;if(!u){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}var c=a.defaultAudioCodec||l.audioCodec||"mp4a.40.2",h=this.transmuxer;h||(h=this.transmuxer=new ro(this.hls,G,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var d=this.initPTS[n.cc],f=null==(t=n.initSegment)?void 0:t.data;if(void 0!==d){var v=i?i.index:-1,g=new tB(n.level,n.sn,n.stats.chunkCount,r.byteLength,v,-1!==v);h.push(r,f,c,"",n,i,u.totalduration,!1,g,d)}else this.log("Unknown video PTS for cc ".concat(n.cc,", waiting for video PTS before demuxing audio frag ").concat(n.sn," of [").concat(u.startSN," ,").concat(u.endSN,"],track ").concat(s)),(this.waitingData=this.waitingData||{frag:n,part:i,cache:new n8,complete:!1}).cache.push(new Uint8Array(r)),this.state!==nY&&(this.state=n2)}},{key:"_handleFragmentLoadComplete",value:function(e){if(this.waitingData){this.waitingData.complete=!0;return}(0,T._)((0,S._)(t.prototype),"_handleFragmentLoadComplete",this).call(this,e)}},{key:"onBufferReset",value:function(){this.mediaBuffer=null}},{key:"onBufferCreated",value:function(e,t){this.bufferFlushed=this.flushing=!1;var n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}},{key:"onFragLoading",value:function(e,t){!this.audioOnly&&t.frag.type===j&&ed(t.frag)&&(this.mainFragLoading=t,this.state===nW&&this.tick())}},{key:"onFragBuffered",value:function(e,t){var n=t.frag,i=t.part;if(n.type!==G){this.audioOnly||n.type!==j||n.elementaryStreams.video||n.elementaryStreams.audiovideo||(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(n))return void this.warn("Fragment ".concat(n.sn).concat(i?" p: "+i.index:""," of level ").concat(n.level," finished buffering, but was aborted. state: ").concat(this.state,", audioSwitch: ").concat(this.switchingTrack?this.switchingTrack.name:"false"));if(ed(n)){this.fragPrevious=n;var r=this.switchingTrack;r&&(this.bufferedTrack=r,this.switchingTrack=null,this.hls.trigger(O.AUDIO_TRACK_SWITCHED,W({},r)))}this.fragBufferedComplete(n,i),this.media&&this.tick()}},{key:"onError",value:function(e,n){var i;if(n.fatal){this.state=n1;return}switch(n.details){case P.FRAG_GAP:case P.FRAG_PARSING_ERROR:case P.FRAG_DECRYPT_ERROR:case P.FRAG_LOAD_ERROR:case P.FRAG_LOAD_TIMEOUT:case P.KEY_LOAD_ERROR:case P.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(G,n);break;case P.AUDIO_TRACK_LOAD_ERROR:case P.AUDIO_TRACK_LOAD_TIMEOUT:case P.LEVEL_PARSING_ERROR:n.levelRetry||this.state!==n$||(null==(i=n.context)?void 0:i.type)!==B||(this.state=nW);break;case P.BUFFER_ADD_CODEC_ERROR:case P.BUFFER_APPEND_ERROR:if("audio"!==n.parent)return;this.reduceLengthAndFlushBuffer(n)||this.resetLoadingState();break;case P.BUFFER_FULL_ERROR:if("audio"!==n.parent)return;this.reduceLengthAndFlushBuffer(n)&&(this.bufferedTrack=null,(0,T._)((0,S._)(t.prototype),"flushMainBuffer",this).call(this,0,1/0,"audio"));break;case P.INTERNAL_EXCEPTION:this.recoverWorkerError(n)}}},{key:"onBufferFlushing",value:function(e,t){t.type!==eu&&(this.flushing=!0)}},{key:"onBufferFlushed",value:function(e,t){var n=t.type;if(n!==eu){this.flushing=!1,this.bufferFlushed=!0,this.state===n0&&(this.state=nW);var i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,n,G),this.tick())}}},{key:"_handleTransmuxComplete",value:function(e){var t,n="audio",i=this.hls,r=e.remuxResult,a=e.chunkMeta,s=this.getCurrentContext(a);if(!s)return void this.resetWhenMissingContext(a);var o=s.frag,l=s.part,u=s.level,c=u.details,h=r.audio,d=r.text,f=r.id3,v=r.initSegment;if(this.fragContextChanged(o)||!c)return void this.fragmentTracker.removeFragment(o);if(this.state=nZ,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),null!=v&&v.tracks){var g=o.initSegment||o;if(this.unhandledEncryptionError(v,o))return;this._bufferInitSegment(u,v.tracks,g,a),i.trigger(O.FRAG_PARSING_INIT_SEGMENT,{frag:g,id:n,tracks:v.tracks})}if(h){var m=h.startPTS,p=h.endPTS,y=h.startDTS,E=h.endDTS;l&&(l.elementaryStreams[el]={startPTS:m,endPTS:p,startDTS:y,endDTS:E}),o.setElementaryStreamInfo(el,m,p,y,E),this.bufferFragmentData(h,o,l,a)}if(null!=f&&null!=(t=f.samples)&&t.length){var k=q({id:n,frag:o,details:c},f);i.trigger(O.FRAG_PARSING_METADATA,k)}if(d){var b=q({id:n,frag:o,details:c},d);i.trigger(O.FRAG_PARSING_USERDATA,b)}}},{key:"_bufferInitSegment",value:function(e,t,n,i){if(this.state===nZ&&(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,t.audio)){var r=t.audio;r.id=G;var a=e.audioCodec;this.log("Init audio buffer, container:".concat(r.container,", codecs[level/parsed]=[").concat(a,"/").concat(r.codec,"]")),a&&1===a.split(",").length&&(r.levelCodec=a),this.hls.trigger(O.BUFFER_CODECS,t);var s=r.initSegment;if(null!=s&&s.byteLength){var o={type:"audio",frag:n,part:null,chunkMeta:i,parent:n.type,data:s};this.hls.trigger(O.BUFFER_APPENDING,o)}this.tickImmediate()}}},{key:"loadFragment",value:function(e,n,i){var r,a=this.fragmentTracker.getState(e);if(this.switchingTrack||a===tT||a===t_)if(ed(e))if(null!=(r=n.details)&&r.live&&!this.initPTS[e.cc]){this.log("Waiting for video PTS in continuity counter ".concat(e.cc," of live stream before loading audio fragment ").concat(e.sn," of level ").concat(this.trackId)),this.state=n2;var s=this.mainDetails;s&&s.fragmentStart!==n.details.fragmentStart&&nK(n.details,s)}else(0,T._)((0,S._)(t.prototype),"loadFragment",this).call(this,e,n,i);else this._loadInitSegment(e,n);else this.clearTrackerIfNeeded(e)}},{key:"flushAudioIfNeeded",value:function(e){if(this.media&&this.bufferedTrack){var n=this.bufferedTrack;ti({name:n.name,lang:n.lang,assocLang:n.assocLang,characteristics:n.characteristics,audioCodec:n.audioCodec,channels:n.channels},e,tr)||(ts(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),(0,T._)((0,S._)(t.prototype),"flushMainBuffer",this).call(this,0,1/0,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}},{key:"completeAudioSwitch",value:function(e){var t=this.hls;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(O.AUDIO_TRACK_SWITCHED,W({},e))}}]),t}(n5),ru=function(e){"use strict";function t(e,n){var i;return(0,E._)(this,t),(i=(0,y._)(this,t,[n,e.logger])).hls=void 0,i.canLoad=!1,i.timer=-1,i.hls=e,i}return(0,_._)(t,e),(0,k._)(t,[{key:"destroy",value:function(){this.clearTimer(),this.hls=this.log=this.warn=null}},{key:"clearTimer",value:function(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}},{key:"startLoad",value:function(){this.canLoad=!0,this.loadPlaylist()}},{key:"stopLoad",value:function(){this.canLoad=!1,this.clearTimer()}},{key:"switchParams",value:function(e,t,n){var i=null==t?void 0:t.renditionReports;if(i){for(var r=-1,a=0;a<i.length;a++){var s=i[a],o=void 0;try{o=new self.URL(s.URI,t.url).href}catch(e){this.warn("Could not construct new URL for Rendition Report: ".concat(e)),o=s.URI||""}if(o===e){r=a;break}o===e.substring(0,o.length)&&(r=a)}if(-1!==r){var l=i[r],u=parseInt(l["LAST-MSN"])||t.lastPartSn,c=parseInt(l["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){var h=Math.min(t.age-t.partTarget,t.targetduration);c>=0&&h>t.partTarget&&(c+=1)}return new e5(u,c>=0?c:void 0,n&&e3(n))}}}},{key:"loadPlaylist",value:function(e){this.clearTimer()}},{key:"loadingPlaylist",value:function(e,t){this.clearTimer()}},{key:"shouldLoadPlaylist",value:function(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}},{key:"getUrlWithDirectives",value:function(e,t){if(t)try{return t.addDirectives(e)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: ".concat(e))}return e}},{key:"playlistLoaded",value:function(e,t,n){var i=t.details,r=t.stats,a=self.performance.now(),s=r.loading.first?Math.max(0,a-r.loading.first):0;i.advancedDateTime=Date.now()-s;var o=this.hls.config.timelineOffset;if(o!==i.appliedTimelineOffset){var l=Math.max(o||0,0);i.appliedTimelineOffset=l,i.fragments.forEach(function(e){e.setStart(e.playlistOffset+l)})}if(i.live||null!=n&&n.live){var u,c="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(n),n&&i.fragments.length>0){!function(e,t,n){if(e!==t){for(var i=null,r=e.fragments,a=r.length-1;a>=0;a--){var s=r[a].initSegment;if(s){i=s;break}}e.fragmentHint&&delete e.fragmentHint.endPTS,function(e,t,n){for(var i=t.skippedSegments,r=Math.max(e.startSN,t.startSN)-t.startSN,a=+!!e.fragmentHint+(i?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,s=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,u=r;u<=a;u++){var c=l[s+u],h=o[u];if(i&&!h&&c&&(h=t.fragments[u]=c),c&&h){n(c,h,u,o);var d,f,v=c.relurl,g=h.relurl;if(v&&(d=v)!==(f=g)&&f&&nN(d)!==nN(f)){t.playlistParsingError=nR("media sequence mismatch ".concat(h.sn,":"),e,t,c,h);return}if(c.cc!==h.cc){t.playlistParsingError=nR("discontinuity sequence mismatch (".concat(c.cc,"!=").concat(h.cc,")"),e,t,c,h);return}}}}(e,t,function(e,n,r,a){if((!t.startCC||t.skippedSegments)&&n.cc!==e.cc){for(var s=e.cc-n.cc,o=r;o<a.length;o++)a[o].cc+=s;t.endCC=a[a.length-1].cc}R(e.startPTS)&&R(e.endPTS)&&(n.setStart(n.startPTS=e.startPTS),n.startDTS=e.startDTS,n.maxStartPTS=e.maxStartPTS,n.endPTS=e.endPTS,n.endDTS=e.endDTS,n.minEndPTS=e.minEndPTS,n.setDuration(e.endPTS-e.startPTS),n.duration&&(E=n),t.PTSKnown=t.alignedSliding=!0),e.hasStreams&&(n.elementaryStreams=e.elementaryStreams),n.loader=e.loader,e.hasStats&&(n.stats=e.stats),e.initSegment&&(n.initSegment=e.initSegment,i=e.initSegment)});var o=t.fragments,l=t.fragmentHint?o.concat(t.fragmentHint):o;if(i&&l.forEach(function(e){var t;e&&(!e.initSegment||e.initSegment.relurl===(null==(t=i)?void 0:t.relurl))&&(e.initSegment=i)}),t.skippedSegments){if(t.deltaUpdateFailed=o.some(function(e){return!e}),t.deltaUpdateFailed){n.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var u=t.skippedSegments;u--;)o.shift();t.startSN=o[0].sn}else{t.canSkipDateRanges&&(c=e.dateRanges,h=t,d=n,f=h.dateRanges,v=h.recentlyRemovedDateranges,g=q({},c),v&&v.forEach(function(e){delete g[e]}),t.dateRanges=(m=Object.keys(g).length)?(Object.keys(f).forEach(function(e){var t=g[e],n=new tz(f[e].attr,t);n.isValid?(g[e]=n,t||(n.tagOrder+=m)):d.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'.concat(e9(f[e].attr),'"'))}),g):f);var c,h,d,f,v,g,m,p=e.fragments.filter(function(e){return e.rawProgramDateTime});if(e.hasProgramDateTime&&!t.hasProgramDateTime)for(var y=1;y<l.length;y++)null===l[y].programDateTime&&nT(l[y],l[y-1],p);np(p,t)}t.endCC=o[o.length-1].cc}if(!t.startCC){var E,k,b=nP(e,t.startSN-1);t.startCC=null!=(k=null==b?void 0:b.cc)?k:o[0].cc}(function(e,t,n){if(e&&t)for(var i=0,r=0,a=e.length;r<=a;r++){var s=e[r],o=t[r+i];s&&o&&s.index===o.index&&s.fragment.sn===o.fragment.sn?n(s,o):i--}})(e.partList,t.partList,function(e,t){t.elementaryStreams=e.elementaryStreams,t.stats=e.stats}),E?nI(t,E,E.startPTS,E.endPTS,E.startDTS,E.endDTS,n):nD(e,t),o.length&&(t.totalduration=t.edge-o[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;var T=t.advancedDateTime;if(t.advanced&&T){var S=t.edge;t.driftStart||(t.driftStartTime=T,t.driftStart=S),t.driftEndTime=T,t.driftEnd=S}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime;-1===t.requestScheduled&&(t.requestScheduled=e.requestScheduled)}}(n,i,this);var h=i.playlistParsingError;if(h){this.warn(h);var d=this.hls;if(!d.config.ignorePlaylistParsingErrors){var f,v=t.networkDetails;d.trigger(O.ERROR,{type:x.NETWORK_ERROR,details:P.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:h,reason:h.message,level:t.level||void 0,parent:null==(f=i.fragments[0])?void 0:f.type,networkDetails:v,stats:r});return}i.playlistParsingError=null}}-1===i.requestScheduled&&(i.requestScheduled=r.loading.start);var g=this.hls.mainForwardBufferInfo,m=g?g.end-g.len:0,p=(i.edge-m)*1e3,y=nx(i,p);if(i.requestScheduled+y<a?i.requestScheduled=a:i.requestScheduled+=y,this.log("live playlist ".concat(e," ").concat(i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED")),!this.canLoad||!i.live)return;var E=void 0,k=void 0;if(i.canBlockReload&&i.endSN&&i.advanced){var b=this.hls.config.lowLatencyMode,T=i.lastPartSn,S=i.endSN,_=i.lastPartIndex,A=T===S;-1!==_?A?(E=S+1,k=b?0:_):(E=T,k=b?_+1:i.maxPartIndex):E=S+1;var L=i.age,w=L+i.ageHeader,I=Math.min(w-i.partTarget,1.5*i.targetduration);if(I>0){if(w>3*i.targetduration)this.log("Playlist last advanced ".concat(L.toFixed(2),"s ago. Omitting segment and part directives.")),E=void 0,k=void 0;else if(null!=n&&n.tuneInGoal&&w-i.partTarget>n.tuneInGoal)this.warn("CDN Tune-in goal increased from: ".concat(n.tuneInGoal," to: ").concat(I," with playlist age: ").concat(i.age)),I=0;else{var D=Math.floor(I/i.targetduration);E+=D,void 0!==k&&(k+=Math.round(I%i.targetduration/i.partTarget)),this.log("CDN Tune-in age: ".concat(i.ageHeader,"s last advanced ").concat(L.toFixed(2),"s goal: ").concat(I," skip sn ").concat(D," to part ").concat(k))}i.tuneInGoal=I}if(u=this.getDeliveryDirectives(i,t.deliveryDirectives,E,k),b||!A){i.requestScheduled=a,this.loadingPlaylist(c,u);return}}else(i.canBlockReload||i.canSkipUntil)&&(u=this.getDeliveryDirectives(i,t.deliveryDirectives,E,k));u&&void 0!==E&&i.canBlockReload&&(i.requestScheduled=r.loading.first+Math.max(y-2*s,y/2)),this.scheduleLoading(c,u,i)}else this.clearTimer()}},{key:"scheduleLoading",value:function(e,t,n){var i=this,r=n||e.details;if(!r)return void this.loadingPlaylist(e,t);var a=self.performance.now(),s=r.requestScheduled;if(a>=s)return void this.loadingPlaylist(e,t);var o=s-a;this.log("reload live playlist ".concat(e.name||e.bitrate+"bps"," in ").concat(Math.round(o)," ms")),this.clearTimer(),this.timer=self.setTimeout(function(){return i.loadingPlaylist(e,t)},o)}},{key:"getDeliveryDirectives",value:function(e,t,n,i){var r=e3(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,i=t.part,r=""),new e5(n,i,r)}},{key:"checkRetry",value:function(e){var t,n=this,i=e.details,r=td(e),a=e.errorAction,s=a||{},o=s.action,l=s.retryCount,u=void 0===l?0:l,c=s.retryConfig,h=!!a&&!!c&&(5===o||!a.resolved&&2===o);if(h){if(u>=c.maxNumRetry)return!1;if(r&&null!=(t=e.context)&&t.deliveryDirectives)this.warn("Retrying playlist loading ".concat(u+1,"/").concat(c.maxNumRetry,' after "').concat(i,'" without delivery-directives')),this.loadPlaylist();else{var d=tm(c,u);this.clearTimer(),this.timer=self.setTimeout(function(){return n.loadPlaylist()},d),this.warn("Retrying playlist loading ".concat(u+1,"/").concat(c.maxNumRetry,' after "').concat(i,'" in ').concat(d,"ms"))}e.levelRetry=!0,a.resolved=!0}return h}}]),t}(z);function rc(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!rh(e[n].attrs,t[n].attrs))return!1;return!0}function rh(e,t,n){var i=e["STABLE-RENDITION-ID"];return i&&!n?i===t["STABLE-RENDITION-ID"]:!(n||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(function(n){return e[n]!==t[n]})}function rd(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}var rf=function(e){"use strict";function t(e){var n;return(0,E._)(this,t),(n=(0,y._)(this,t,[e,"audio-track-controller"])).tracks=[],n.groupIds=null,n.tracksInGroup=[],n.trackId=-1,n.currentTrack=null,n.selectDefaultTrack=!0,n.registerListeners(),n}return(0,_._)(t,e),(0,k._)(t,[{key:"registerListeners",value:function(){var e=this.hls;e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.LEVEL_LOADING,this.onLevelLoading,this),e.on(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(O.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(O.ERROR,this.onError,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.LEVEL_LOADING,this.onLevelLoading,this),e.off(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(O.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(O.ERROR,this.onError,this)}},{key:"destroy",value:function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,(0,T._)((0,S._)(t.prototype),"destroy",this).call(this)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}},{key:"onManifestParsed",value:function(e,t){this.tracks=t.audioTracks||[]}},{key:"onAudioTrackLoaded",value:function(e,t){var n=t.id,i=t.groupId,r=t.details,a=this.tracksInGroup[n];if(!a||a.groupId!==i)return void this.warn("Audio track with id:".concat(n," and group:").concat(i," not found in active group ").concat(null==a?void 0:a.groupId));var s=a.details;a.details=t.details,this.log("Audio track ".concat(n,' "').concat(a.name,'" lang:').concat(a.lang," group:").concat(i," loaded [").concat(r.startSN,"-").concat(r.endSN,"]")),n===this.trackId&&this.playlistLoaded(n,t,s)}},{key:"onLevelLoading",value:function(e,t){this.switchLevel(t.level)}},{key:"onLevelSwitching",value:function(e,t){this.switchLevel(t.level)}},{key:"switchLevel",value:function(e){var t=this.hls.levels[e];if(t){var n=t.audioGroups||null,i=this.groupIds,r=this.currentTrack;if(!n||(null==i?void 0:i.length)!==(null==n?void 0:n.length)||null!=n&&n.some(function(e){return(null==i?void 0:i.indexOf(e))===-1})){this.groupIds=n,this.trackId=-1,this.currentTrack=null;var a=this.tracks.filter(function(e){return!n||-1!==n.indexOf(e.groupId)});if(a.length)this.selectDefaultTrack&&!a.some(function(e){return e.default})&&(this.selectDefaultTrack=!1),a.forEach(function(e,t){e.id=t});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=a;var s=this.hls.config.audioPreference;if(!r&&s){var o=tn(s,a,tr);if(o>-1)r=a[o];else{var l=tn(s,this.tracks);r=this.tracks[l]}}var u=this.findTrackId(r);-1===u&&r&&(u=this.findTrackId(null)),this.log("Updating audio tracks, ".concat(a.length," track(s) found in group(s): ").concat(null==n?void 0:n.join(","))),this.hls.trigger(O.AUDIO_TRACKS_UPDATED,{audioTracks:a});var c=this.trackId;if(-1!==u&&-1===c)this.setAudioTrack(u);else if(a.length&&-1===c){var h,d=Error("No audio track selected for current audio group-ID(s): ".concat(null==(h=this.groupIds)?void 0:h.join(",")," track count: ").concat(a.length));this.warn(d.message),this.hls.trigger(O.ERROR,{type:x.MEDIA_ERROR,details:P.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:d})}}}}},{key:"onError",value:function(e,t){!t.fatal&&t.context&&(t.context.type!==B||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}},{key:"allAudioTracks",get:function(){return this.tracks}},{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}},{key:"setAudioOption",value:function(e){var t=this.hls;if(t.config.audioPreference=e,e){var n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){var i=this.currentTrack;if(i&&ti(e,i,tr))return i;var r=tn(e,this.tracksInGroup,tr);if(r>-1){var a=this.tracksInGroup[r];return this.setAudioTrack(r),a}if(i){var s,o,l,u,c,h,d,f,v=t.loadLevel;-1===v&&(v=t.firstAutoLevel);var g=(s=t.levels,l=s[o=v],(u=s.reduce(function(e,t,n){var i=t.uri;return(e[i]||(e[i]=[])).push(n),e},{})[l.uri]).length>1&&(o=Math.max.apply(Math,u)),c=l.videoRange,h=l.frameRate,d=l.codecSet.substring(0,4),(f=ta(s,o,function(t){if(t.videoRange!==c||t.frameRate!==h||t.codecSet.substring(0,4)!==d)return!1;var i=t.audioGroups;return tn(e,n.filter(function(e){return!i||-1!==i.indexOf(e.groupId)}),tr)>-1}))>-1?f:ta(s,o,function(t){var i=t.audioGroups;return tn(e,n.filter(function(e){return!i||-1!==i.indexOf(e.groupId)}),tr)>-1}));if(-1===g)return null;t.nextLoadLevel=g}if(e.channels||e.audioCodec){var m=tn(e,n);if(m>-1)return n[m]}}}return null}},{key:"setAudioTrack",value:function(e){var t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn("Invalid audio track id: ".concat(e));this.selectDefaultTrack=!1;var n=this.currentTrack,i=t[e],r=i.details&&!i.details.live;if((e!==this.trackId||i!==n||!r)&&(this.log("Switching to audio-track ".concat(e,' "').concat(i.name,'" lang:').concat(i.lang," group:").concat(i.groupId," channels:").concat(i.channels)),this.trackId=e,this.currentTrack=i,this.hls.trigger(O.AUDIO_TRACK_SWITCHING,W({},i)),!r)){var a=this.switchParams(i.url,null==n?void 0:n.details,i.details);this.loadPlaylist(a)}}},{key:"findTrackId",value:function(e){for(var t=this.tracksInGroup,n=0;n<t.length;n++){var i=t[n];if((!this.selectDefaultTrack||i.default)&&(!e||ti(e,i,tr)))return n}if(e){for(var r=e.name,a=e.lang,s=e.assocLang,o=e.characteristics,l=e.audioCodec,u=e.channels,c=0;c<t.length;c++)if(ti({name:r,lang:a,assocLang:s,characteristics:o,audioCodec:l,channels:u},t[c],tr))return c;for(var h=0;h<t.length;h++){var d=t[h];if(rh(e.attrs,d.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return h}for(var f=0;f<t.length;f++){var v=t[f];if(rh(e.attrs,v.attrs,["LANGUAGE"]))return f}}return -1}},{key:"loadPlaylist",value:function(e){(0,T._)((0,S._)(t.prototype),"loadPlaylist",this).call(this);var n=this.currentTrack;this.shouldLoadPlaylist(n)&&ts(n.url,this.hls)&&this.scheduleLoading(n,e)}},{key:"loadingPlaylist",value:function(e,n){(0,T._)((0,S._)(t.prototype),"loadingPlaylist",this).call(this,e,n);var i=e.id,r=e.groupId,a=this.getUrlWithDirectives(e.url,n),s=e.details,o=null==s?void 0:s.age;this.log("Loading audio-track ".concat(i,' "').concat(e.name,'" lang:').concat(e.lang," group:").concat(r).concat((null==n?void 0:n.msn)!==void 0?" at sn "+n.msn+" part "+n.part:"").concat(o&&s.live?" age "+o.toFixed(1)+(s.type?" "+s.type:""):""," ").concat(a)),this.hls.trigger(O.AUDIO_TRACK_LOADING,{url:a,id:i,groupId:r,deliveryDirectives:n||null,track:e})}}]),t}(ru),rv=function(){"use strict";function e(t){(0,E._)(this,e),this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=t}return(0,k._)(e,[{key:"destroy",value:function(){this.tracks=this.queues=null}},{key:"append",value:function(e,t,n){if(null!==this.queues&&null!==this.tracks){var i=this.queues[t];i.push(e),1!==i.length||n||this.executeNext(t)}}},{key:"appendBlocker",value:function(e){var t=this;return new Promise(function(n){t.append({label:"async-blocker",execute:n,onStart:function(){},onComplete:function(){},onError:function(){}},e)})}},{key:"prependBlocker",value:function(e){var t=this;return new Promise(function(n){t.queues&&t.queues[e].unshift({label:"async-blocker-prepend",execute:n,onStart:function(){},onComplete:function(){},onError:function(){}})})}},{key:"removeBlockers",value:function(){null!==this.queues&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(function(e){var t,n=null==(t=e[0])?void 0:t.label;("async-blocker"===n||"async-blocker-prepend"===n)&&(e[0].execute(),e.splice(0,1))})}},{key:"unblockAudio",value:function(e){null!==this.queues&&this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}},{key:"executeNext",value:function(e){if(null!==this.queues&&null!==this.tracks){var t=this.queues[e];if(t.length){var n=t[0];try{n.execute()}catch(t){if(n.onError(t),null===this.queues||null===this.tracks)return;var i,r=null==(i=this.tracks[e])?void 0:i.buffer;null!=r&&r.updating||this.shiftAndExecuteNext(e)}}}}},{key:"shiftAndExecuteNext",value:function(e){null!==this.queues&&(this.queues[e].shift(),this.executeNext(e))}},{key:"current",value:function(e){var t;return(null==(t=this.queues)?void 0:t[e][0])||null}},{key:"toString",value:function(){var e=this.queues,t=this.tracks;return null===e||null===t?"<destroyed>":"\n".concat(this.list("video"),"\n").concat(this.list("audio"),"\n").concat(this.list("audiovideo"),"}")}},{key:"list",value:function(e){var t,n;return null!=(t=this.queues)&&t[e]||null!=(n=this.tracks)&&n[e]?"".concat(e,": (").concat(this.listSbInfo(e),") ").concat(this.listOps(e)):""}},{key:"listSbInfo",value:function(e){var t,n=null==(t=this.tracks)?void 0:t[e],i=null==n?void 0:n.buffer;return i?"SourceBuffer".concat(i.updating?" updating":"").concat(n.ended?" ended":"").concat(n.ending?" ending":""):"none"}},{key:"listOps",value:function(e){var t;return(null==(t=this.queues)?void 0:t[e].map(function(e){return e.label}).join(", "))||""}}]),e}(),rg=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,rm="HlsJsTrackRemovedError",rp=function(e){"use strict";function t(e){var n;return(0,E._)(this,t),(n=(0,y._)(this,t,[e])).name=rm,n}return(0,_._)(t,e),t}((0,I._)(Error)),ry=function(e){"use strict";function t(e,n){var i,r;return(0,E._)(this,t),(i=(0,y._)(this,t,["buffer-controller",e.logger])).hls=void 0,i.fragmentTracker=void 0,i.details=null,i._objectUrl=null,i.operationQueue=null,i.bufferCodecEventsTotal=0,i.media=null,i.mediaSource=null,i.lastMpegAudioChunk=null,i.blockedAudioAppend=null,i.lastVideoAppendEnd=0,i.appendSource=void 0,i.transferData=void 0,i.overrides=void 0,i.appendErrors={audio:0,video:0,audiovideo:0},i.tracks={},i.sourceBuffers=[[null,null],[null,null]],i._onEndStreaming=function(e){var t;i.hls&&(null==(t=i.mediaSource)?void 0:t.readyState)==="open"&&i.hls.pauseBuffering()},i._onStartStreaming=function(e){i.hls&&i.hls.resumeBuffering()},i._onMediaSourceOpen=function(e){var t=i.media,n=i.mediaSource;e&&i.log("Media source opened"),t&&n&&(n.removeEventListener("sourceopen",i._onMediaSourceOpen),t.removeEventListener("emptied",i._onMediaEmptied),i.updateDuration(),i.hls.trigger(O.MEDIA_ATTACHED,{media:t,mediaSource:n}),null!==i.mediaSource&&i.checkPendingTracks())},i._onMediaSourceClose=function(){i.log("Media source closed")},i._onMediaSourceEnded=function(){i.log("Media source ended")},i._onMediaEmptied=function(){var e=i.mediaSrc,t=i._objectUrl;e!==t&&i.error("Media element src was set while attaching MediaSource (".concat(t," > ").concat(e,")"))},i.hls=e,i.fragmentTracker=n,r=ee(e.config.preferManagedMediaSource),i.appendSource="undefined"!=typeof self&&r===self.ManagedMediaSource,i.initTracks(),i.registerListeners(),i}return(0,_._)(t,e),(0,k._)(t,[{key:"hasSourceTypes",value:function(){return Object.keys(this.tracks).length>0}},{key:"destroy",value:function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}},{key:"registerListeners",value:function(){var e=this.hls;e.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.BUFFER_RESET,this.onBufferReset,this),e.on(O.BUFFER_APPENDING,this.onBufferAppending,this),e.on(O.BUFFER_CODECS,this.onBufferCodecs,this),e.on(O.BUFFER_EOS,this.onBufferEos,this),e.on(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(O.FRAG_PARSED,this.onFragParsed,this),e.on(O.FRAG_CHANGED,this.onFragChanged,this),e.on(O.ERROR,this.onError,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.BUFFER_RESET,this.onBufferReset,this),e.off(O.BUFFER_APPENDING,this.onBufferAppending,this),e.off(O.BUFFER_CODECS,this.onBufferCodecs,this),e.off(O.BUFFER_EOS,this.onBufferEos,this),e.off(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(O.FRAG_PARSED,this.onFragParsed,this),e.off(O.FRAG_CHANGED,this.onFragChanged,this),e.off(O.ERROR,this.onError,this)}},{key:"transferMedia",value:function(){var e=this,t=this.media,n=this.mediaSource;if(!t)return null;var i={};if(this.operationQueue){var r=this.isUpdating();r||this.operationQueue.removeBlockers();var a=this.isQueued();(r||a)&&this.warn("Transfering MediaSource with".concat(a?" operations in queue":"").concat(r?" updating SourceBuffer(s)":""," ").concat(this.operationQueue)),this.operationQueue.destroy()}var s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===n?q(i,s.tracks):this.sourceBuffers.forEach(function(t){var n=(0,A._)(t,1)[0];n&&(i[n]=q({},e.tracks[n]),e.removeBuffer(n)),t[0]=t[1]=null}),{media:t,mediaSource:n,tracks:i}}},{key:"initTracks",value:function(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}},{key:"onManifestLoading",value:function(){this.bufferCodecEventsTotal=0,this.details=null}},{key:"onManifestParsed",value:function(e,t){var n,i=2;(!t.audio||t.video)&&t.altAudio||(i=1),this.bufferCodecEventsTotal=i,this.log("".concat(i," bufferCodec event(s) expected.")),null!=(n=this.transferData)&&n.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}},{key:"onMediaAttaching",value:function(e,t){var n=this.media=t.media;this.transferData=this.overrides=void 0;var i=ee(this.appendSource);if(i){var r=!!t.mediaSource;(r||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);var a=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(a),r)this._objectUrl=n.src,this.attachTransferred();else{var s=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{n.removeAttribute("src");var o,l,u,c=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||c&&a instanceof c,rE(n),o=n,l=s,(u=self.document.createElement("source")).type="video/mp4",u.src=l,o.appendChild(u),n.load()}catch(e){n.src=s}else n.src=s}n.addEventListener("emptied",this._onMediaEmptied)}}},{key:"assignMediaSource",value:function(e){var t,n;this.log("".concat((null==(t=this.transferData)?void 0:t.mediaSource)===e?"transferred":"created"," media source: ").concat(null==(n=e.constructor)?void 0:n.name)),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}},{key:"attachTransferred",value:function(){var e=this,t=this.media,n=this.transferData;if(n&&t){var i=this.tracks,r=n.tracks,a=r?Object.keys(r):null,s=a?a.length:0,o=function(){Promise.resolve().then(function(){e.media&&e.mediaSourceOpenOrEnded&&e._onMediaSourceOpen()})};if(r&&a&&s){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log("attachTransferred: (bufferCodecEventsTotal ".concat(this.bufferCodecEventsTotal,")\nrequired tracks: ").concat(e9(i,function(e,t){return"initSegment"===e?void 0:t}),";\ntransfer tracks: ").concat(e9(r,function(e,t){return"initSegment"===e?void 0:t}),"}")),!et(r,i)){n.mediaSource=null,n.tracks=void 0;var l=t.currentTime,u=this.details,c=Math.max(l,(null==u?void 0:u.fragments[0].start)||0);return c-l>1?void this.log("attachTransferred: waiting for playback to reach new tracks start time ".concat(l," -> ").concat(c)):(this.warn('attachTransferred: resetting MediaSource for incompatible tracks ("'.concat(Object.keys(r),'"->"').concat(Object.keys(i),'") start time: ').concat(c," currentTime: ").concat(l)),this.onMediaDetaching(O.MEDIA_DETACHING,{}),this.onMediaAttaching(O.MEDIA_ATTACHING,n),void(t.currentTime=c))}this.transferData=void 0,a.forEach(function(t){var n=r[t];if(n){var i=n.buffer;if(i){var a=e.fragmentTracker,s=n.id;if(a.hasFragments(s)||a.hasParts(s)){var o=tG.getBuffered(i);a.detectEvictedFragments(t,o,s,null,!0)}var l=rk(t),u=[t,i];e.sourceBuffers[l]=u,i.updating&&e.operationQueue&&e.operationQueue.prependBlocker(t),e.trackSourceBuffer(t,n)}}}),o(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),o()}}},{key:"mediaSourceOpenOrEnded",get:function(){var e,t=null==(e=this.mediaSource)?void 0:e.readyState;return"open"===t||"ended"===t}},{key:"onMediaDetaching",value:function(e,t){var n=this,i=!!t.transferMedia;this.transferData=this.overrides=void 0;var r=this.media,a=this.mediaSource,s=this._objectUrl;if(a){if(this.log("media source ".concat(i?"transferring":"detaching")),i)this.sourceBuffers.forEach(function(e){var t=(0,A._)(e,1)[0];t&&n.removeBuffer(t)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){var o="open"===a.readyState;try{for(var l=a.sourceBuffers,u=l.length;u--;)o&&l[u].abort(),a.removeSourceBuffer(l[u]);o&&a.endOfStream()}catch(e){this.warn("onMediaDetaching: ".concat(e.message," while calling endOfStream"))}}this.sourceBufferCount&&this.onBufferReset()}a.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("sourceended",this._onMediaSourceEnded),a.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(a.removeEventListener("startstreaming",this._onStartStreaming),a.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),i||(s&&self.URL.revokeObjectURL(s),this.mediaSrc===s?(r.removeAttribute("src"),this.appendSource&&rE(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(O.MEDIA_DETACHED,t)}},{key:"onBufferReset",value:function(){var e=this;this.sourceBuffers.forEach(function(t){var n=(0,A._)(t,1)[0];n&&e.resetBuffer(n)}),this.initTracks()}},{key:"resetBuffer",value:function(e){var t,n,i=null==(t=this.tracks[e])?void 0:t.buffer;if(this.removeBuffer(e),i)try{null!=(n=this.mediaSource)&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(t){this.warn("onBufferReset ".concat(e),t)}delete this.tracks[e]}},{key:"removeBuffer",value:function(e){this.removeBufferListeners(e),this.sourceBuffers[rk(e)]=[null,null];var t=this.tracks[e];t&&(t.buffer=void 0)}},{key:"resetQueue",value:function(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new rv(this.tracks)}},{key:"onBufferCodecs",value:function(e,t){var n,i=this,r=this.tracks,a=Object.keys(t);this.log('BUFFER_CODECS: "'.concat(a,'" (current SB count ').concat(this.sourceBufferCount,")"));var s="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),o=!s&&this.sourceBufferCount&&this.media&&a.some(function(e){return!r[e]});if(s||o)return void this.warn('Unsupported transition between "'.concat(Object.keys(r),'" and "').concat(a,'" SourceBuffers'));a.forEach(function(e){var n,a,s=t[e],o=s.id,l=s.codec,u=s.levelCodec,c=s.container,h=s.metadata,d=s.supplemental,f=r[e],v=null==(n=i.transferData)||null==(n=n.tracks)?void 0:n[e],g=null!=v&&v.buffer?v:f,m=(null==g?void 0:g.pendingCodec)||(null==g?void 0:g.codec),p=null==g?void 0:g.levelCodec;f||(f=r[e]={buffer:void 0,listeners:[],codec:l,supplemental:d,container:c,levelCodec:u,metadata:h,id:o});var y=eY(m,p),E=null==y?void 0:y.replace(rg,"$1"),k=eY(l,u),b=null==(a=k)?void 0:a.replace(rg,"$1");k&&y&&E!==b&&("audio"===e.slice(0,5)&&(k=eq(k,i.appendSource)),i.log("switching codec ".concat(m," to ").concat(k)),k!==(f.pendingCodec||f.codec)&&(f.pendingCodec=k),f.container=c,i.appendChangeType(e,c,k))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(!(this.bufferCodecEventsTotal>1)||this.tracks.video||t.video||(null==(n=t.audio)?void 0:n.id)!=="main"||(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}},{key:"sourceBufferTracks",get:function(){var e=this;return Object.keys(this.tracks).reduce(function(t,n){var i=e.tracks[n];return t[n]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},t},{})}},{key:"appendChangeType",value:function(e,t,n){var i=this,r="".concat(t,";codecs=").concat(n);this.append({label:"change-type=".concat(r),execute:function(){var a=i.tracks[e];if(a){var s=a.buffer;null!=s&&s.changeType&&(i.log("changing ".concat(e," sourceBuffer type to ").concat(r)),s.changeType(r),a.codec=n,a.container=t)}i.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(t){i.warn("Failed to change ".concat(e," SourceBuffer type"),t)}},e,this.isPending(this.tracks[e]))}},{key:"blockAudio",value:function(e){var t,n=this,i=e.start,r=i+.05*e.duration;if((null==(t=this.fragmentTracker.getAppendedFrag(i,j))?void 0:t.gap)!==!0){var a={label:"block-audio",execute:function(){var e,t=n.tracks.video;(n.lastVideoAppendEnd>r||null!=t&&t.buffer&&tG.isBuffered(t.buffer,r)||(null==(e=n.fragmentTracker.getAppendedFrag(r,j))?void 0:e.gap)===!0)&&(n.blockedAudioAppend=null,n.shiftAndExecuteNext("audio"))},onStart:function(){},onComplete:function(){},onError:function(e){n.warn("Error executing block-audio operation",e)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}}},{key:"unblockAudio",value:function(){var e=this.blockedAudioAppend,t=this.operationQueue;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}},{key:"onBufferAppending",value:function(e,t){var n=this,i=this.tracks,r=t.data,a=t.type,s=t.parent,o=t.frag,l=t.part,u=t.chunkMeta,c=t.offset,h=u.buffering[a],d=o.sn,f=o.cc,v=self.performance.now();h.start=v;var g=o.stats.buffering,m=l?l.stats.buffering:null;0===g.start&&(g.start=v),m&&0===m.start&&(m.start=v);var p=i.audio,y=!1;"audio"===a&&(null==p?void 0:p.container)==="audio/mpeg"&&(y=!this.lastMpegAudioChunk||1===u.id||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);var E=i.video,k=null==E?void 0:E.buffer;if(k&&"initSegment"!==d){var b=l||o,T=this.blockedAudioAppend;if("audio"!==a||"main"===s||this.blockedAudioAppend||E.ending||E.ended){if("video"===a){var S=b.end;if(T){var _=T.frag.start;(S>_||S<this.lastVideoAppendEnd||tG.isBuffered(k,_))&&this.unblockAudio()}this.lastVideoAppendEnd=S}}else{var L=b.start+.05*b.duration,w=k.buffered,I=this.currentOp("video");(w.length||I)&&(I||tG.isBuffered(k,L)||!(this.lastVideoAppendEnd<L))||this.blockAudio(b)}}var D=(l||o).start;this.log('queuing "'.concat(a,'" append sn: ').concat(d).concat(l?" p: "+l.index:""," of ").concat(o.type===j?"level":"track"," ").concat(o.level," cc: ").concat(f)),this.append({label:"append-".concat(a),execute:function(){h.executeStart=self.performance.now();var e,t=null==(e=n.tracks[a])?void 0:e.buffer;t&&(y?n.updateTimestampOffset(t,D,.1,a,d,f):void 0!==c&&R(c)&&n.updateTimestampOffset(t,c,1e-6,a,d,f)),n.appendExecutor(r,a)},onStart:function(){},onComplete:function(){var e=self.performance.now();h.executeEnd=h.end=e,0===g.first&&(g.first=e),m&&0===m.first&&(m.first=e);var t={};n.sourceBuffers.forEach(function(e){var n=(0,A._)(e,2),i=n[0],r=n[1];i&&(t[i]=tG.getBuffered(r))}),n.appendErrors[a]=0,"audio"===a||"video"===a?n.appendErrors.audiovideo=0:(n.appendErrors.audio=0,n.appendErrors.video=0),n.hls.trigger(O.BUFFER_APPENDED,{type:a,frag:o,part:l,chunkMeta:u,parent:o.type,timeRanges:t})},onError:function(e){var t,i={type:x.MEDIA_ERROR,parent:o.type,details:P.BUFFER_APPEND_ERROR,sourceBufferName:a,frag:o,part:l,chunkMeta:u,error:e,err:e,fatal:!1},r=null==(t=n.media)?void 0:t.error;if(e.code===DOMException.QUOTA_EXCEEDED_ERR||"QuotaExceededError"==e.name||"quota"in e)i.details=P.BUFFER_FULL_ERROR;else if(e.code===DOMException.INVALID_STATE_ERR&&n.mediaSourceOpenOrEnded&&!r)i.errorAction=tb(!0);else if(e.name===rm&&0===n.sourceBufferCount)i.errorAction=tb(!0);else{var s=++n.appendErrors[a];n.warn("Failed ".concat(s,"/").concat(n.hls.config.appendErrorMaxRetry,' times to append segment in "').concat(a,'" sourceBuffer (').concat(r||"no media error",")")),(s>=n.hls.config.appendErrorMaxRetry||r)&&(i.fatal=!0)}n.hls.trigger(O.ERROR,i)}},a,this.isPending(this.tracks[a]))}},{key:"getFlushOp",value:function(e,t,n){var i=this;return this.log('queuing "'.concat(e,'" remove ').concat(t,"-").concat(n)),{label:"remove",execute:function(){i.removeExecutor(e,t,n)},onStart:function(){},onComplete:function(){i.hls.trigger(O.BUFFER_FLUSHED,{type:e})},onError:function(r){i.warn("Failed to remove ".concat(t,"-").concat(n,' from "').concat(e,'" SourceBuffer'),r)}}}},{key:"onBufferFlushing",value:function(e,t){var n=this,i=t.type,r=t.startOffset,a=t.endOffset;i?this.append(this.getFlushOp(i,r,a),i):this.sourceBuffers.forEach(function(e){var t=(0,A._)(e,1)[0];t&&n.append(n.getFlushOp(t,r,a),t)})}},{key:"onFragParsed",value:function(e,t){var n=this,i=t.frag,r=t.part,a=[],s=r?r.elementaryStreams:i.elementaryStreams;s[ec]?a.push("audiovideo"):(s[el]&&a.push("audio"),s[eu]&&a.push("video")),0===a.length&&this.warn("Fragments must have at least one ElementaryStreamType set. type: ".concat(i.type," level: ").concat(i.level," sn: ").concat(i.sn)),this.blockBuffers(function(){var e=self.performance.now();i.stats.buffering.end=e,r&&(r.stats.buffering.end=e);var t=r?r.stats:i.stats;n.hls.trigger(O.FRAG_BUFFERED,{frag:i,part:r,stats:t,id:i.type})},a).catch(function(e){n.warn("Fragment buffered callback ".concat(e)),n.stepOperationQueue(n.sourceBufferTypes)})}},{key:"onFragChanged",value:function(e,t){this.trimBuffers()}},{key:"bufferedToEnd",get:function(){var e=this;return this.sourceBufferCount>0&&!this.sourceBuffers.some(function(t){var n=(0,A._)(t,1)[0];if(n){var i=e.tracks[n];if(i)return!i.ended||i.ending}return!1})}},{key:"onBufferEos",value:function(e,t){var n,i=this;this.sourceBuffers.forEach(function(e){var n=(0,A._)(e,1)[0];if(n){var r=i.tracks[n];(!t.type||t.type===n)&&(r.ending=!0,r.ended||(r.ended=!0,i.log("".concat(n," buffer reached EOS"))))}});var r=(null==(n=this.overrides)?void 0:n.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(function(e){var t,n=(0,A._)(e,1)[0];return n&&!(null!=(t=i.tracks[n])&&t.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(function(){i.tracksEnded();var e=i.mediaSource;if(!e||"open"!==e.readyState){e&&i.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: ".concat(e.readyState));return}i.log("Calling mediaSource.endOfStream()"),e.endOfStream(),i.hls.trigger(O.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(O.BUFFERED_TO_END,void 0)):"video"===t.type&&this.unblockAudio()}},{key:"tracksEnded",value:function(){var e=this;this.sourceBuffers.forEach(function(t){var n=(0,A._)(t,1)[0];if(null!==n){var i=e.tracks[n];i&&(i.ending=!1)}})}},{key:"onLevelUpdated",value:function(e,t){var n=t.details;n.fragments.length&&(this.details=n,this.updateDuration())}},{key:"updateDuration",value:function(){var e=this;this.blockUntilOpen(function(){var t=e.getDurationAndRange();t&&e.updateMediaSource(t)})}},{key:"onError",value:function(e,t){if(t.details===P.BUFFER_APPEND_ERROR&&t.frag){var n,i=null==(n=t.errorAction)?void 0:n.nextAutoLevel;R(i)&&i!==t.frag.level&&this.resetAppendErrors()}}},{key:"resetAppendErrors",value:function(){this.appendErrors={audio:0,video:0,audiovideo:0}}},{key:"trimBuffers",value:function(){var e=this.hls,t=this.details,n=this.media;if(n&&null!==t&&this.sourceBufferCount){var i=e.config,r=n.currentTime,a=t.levelTargetDuration,s=t.live&&null!==i.liveBackBufferLength?i.liveBackBufferLength:i.backBufferLength;if(R(s)&&s>=0){var o=Math.max(s,a),l=Math.floor(r/a)*a-o;this.flushBackBuffer(r,a,l)}var u=i.frontBufferFlushThreshold;if(R(u)&&u>0){var c=Math.max(Math.max(i.maxBufferLength,u),a),h=Math.floor(r/a)*a+c;this.flushFrontBuffer(r,a,h)}}}},{key:"flushBackBuffer",value:function(e,t,n){var i=this;this.sourceBuffers.forEach(function(e){var t=(0,A._)(e,2),r=t[0],a=t[1];if(a){var s=tG.getBuffered(a);if(s.length>0&&n>s.start(0)){i.hls.trigger(O.BACK_BUFFER_REACHED,{bufferEnd:n});var o,l=i.tracks[r];if(null!=(o=i.details)&&o.live)i.hls.trigger(O.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(null!=l&&l.ended)return void i.log("Cannot flush ".concat(r," back buffer while SourceBuffer is in ended state"));i.hls.trigger(O.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:r})}}})}},{key:"flushFrontBuffer",value:function(e,t,n){var i=this;this.sourceBuffers.forEach(function(t){var r=(0,A._)(t,2),a=r[0],s=r[1];if(s){var o=tG.getBuffered(s),l=o.length;if(l<2)return;var u=o.start(l-1),c=o.end(l-1);if(n>u||e>=u&&e<=c)return;i.hls.trigger(O.BUFFER_FLUSHING,{startOffset:u,endOffset:1/0,type:a})}})}},{key:"getDurationAndRange",value:function(){var e,t=this.details,n=this.mediaSource;if(!t||!this.media||(null==n?void 0:n.readyState)!=="open")return null;var i=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){var r=Math.max(0,t.fragmentStart),a=Math.max(r,i);return{duration:1/0,start:r,end:a}}return{duration:1/0}}var s=null==(e=this.overrides)?void 0:e.duration;if(s)return R(s)?{duration:s}:null;var o=this.media.duration;return i>(R(n.duration)?n.duration:0)&&i>o||!R(o)?{duration:i}:null}},{key:"updateMediaSource",value:function(e){var t=e.duration,n=e.start,i=e.end,r=this.mediaSource;this.media&&r&&"open"===r.readyState&&(r.duration!==t&&(R(t)&&this.log("Updating MediaSource duration to ".concat(t.toFixed(3))),r.duration=t),void 0!==n&&void 0!==i&&(this.log("MediaSource duration is set to ".concat(r.duration,". Setting seekable range to ").concat(n,"-").concat(i,".")),r.setLiveSeekableRange(n,i)))}},{key:"tracksReady",get:function(){var e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}},{key:"checkPendingTracks",value:function(){var e=this.bufferCodecEventsTotal,t=this.pendingTrackCount,n=this.tracks;if(this.log("checkPendingTracks (pending: ".concat(t," codec events expected: ").concat(e,") ").concat(e9(n))),this.tracksReady){var i,r=null==(i=this.transferData)?void 0:i.tracks;r&&Object.keys(r).length?this.attachTransferred():this.createSourceBuffers()}}},{key:"bufferCreated",value:function(){var e=this;if(this.sourceBufferCount){var t={};this.sourceBuffers.forEach(function(n){var i=(0,A._)(n,2),r=i[0],a=i[1];if(r){var s=e.tracks[r];t[r]={buffer:a,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(O.BUFFER_CREATED,{tracks:t}),this.log("SourceBuffers created. Running queue: ".concat(this.operationQueue)),this.sourceBuffers.forEach(function(t){var n=(0,A._)(t,1)[0];e.executeNext(n)})}else{var n=Error("could not create source buffer for media codec(s)");this.hls.trigger(O.ERROR,{type:x.MEDIA_ERROR,details:P.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:n,reason:n.message})}}},{key:"createSourceBuffers",value:function(){var e=this.tracks,t=this.sourceBuffers,n=this.mediaSource;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(var i in e){var r=e[i];if(this.isPending(r)){var a,s=this.getTrackCodec(r,i),o="".concat(r.container,";codecs=").concat(s);r.codec=s,this.log("creating sourceBuffer(".concat(o,")").concat(this.currentOp(i)?" Queued":""," ").concat(e9(r)));try{var l=n.addSourceBuffer(o),u=rk(i),c=[i,l];t[u]=c,r.buffer=l}catch(e){this.error("error while trying to add sourceBuffer: ".concat(e.message)),this.shiftAndExecuteNext(i),null==(a=this.operationQueue)||a.removeBlockers(),delete this.tracks[i],this.hls.trigger(O.ERROR,{type:x.MEDIA_ERROR,details:P.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,sourceBufferName:i,mimeType:o,parent:r.id});return}this.trackSourceBuffer(i,r)}}this.bufferCreated()}},{key:"getTrackCodec",value:function(e,t){var n=e.supplemental,i=e.codec;n&&("video"===t||"audiovideo"===t)&&eB(n,"video")&&(i=function(e,t){var n=[];if(e)for(var i=e.split(","),r=0;r<i.length;r++)eN(i[r],"video")||n.push(i[r]);return t&&n.push(t),n.join(",")}(i,n));var r=eY(i,e.levelCodec);return r?"audio"===t.slice(0,5)?eq(r,this.appendSource):r:""}},{key:"trackSourceBuffer",value:function(e,t){var n=this,i=t.buffer;if(i){var r=this.getTrackCodec(t,e);this.tracks[e]={buffer:i,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",function(e,t){var i=t.removedRanges;null!=i&&i.length&&n.hls.trigger(O.BUFFER_FLUSHED,{type:e})})}}},{key:"mediaSrc",get:function(){var e,t,n=(null==(e=this.media)||null==(t=e.querySelector)?void 0:t.call(e,"source"))||this.media;return null==n?void 0:n.src}},{key:"onSBUpdateStart",value:function(e){var t=this.currentOp(e);t&&t.onStart()}},{key:"onSBUpdateEnd",value:function(e){if((null==(t=this.mediaSource)?void 0:t.readyState)==="closed")return void this.resetBuffer(e);var t,n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}},{key:"onSBUpdateError",value:function(e,t){var n,i=Error("".concat(e," SourceBuffer error. MediaSource readyState: ").concat(null==(n=this.mediaSource)?void 0:n.readyState));this.error("".concat(i),t),this.hls.trigger(O.ERROR,{type:x.MEDIA_ERROR,details:P.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});var r=this.currentOp(e);r&&r.onError(i)}},{key:"updateTimestampOffset",value:function(e,t,n,i,r,a){Math.abs(t-e.timestampOffset)>=n&&(this.log("Updating ".concat(i," SourceBuffer timestampOffset to ").concat(t," (sn: ").concat(r," cc: ").concat(a,")")),e.timestampOffset=t)}},{key:"removeExecutor",value:function(e,t,n){var i=this.media,r=this.mediaSource,a=this.tracks[e],s=null==a?void 0:a.buffer;if(!i||!r||!s){this.warn("Attempting to remove from the ".concat(e," SourceBuffer, but it does not exist")),this.shiftAndExecuteNext(e);return}var o=R(i.duration)?i.duration:1/0,l=R(r.duration)?r.duration:1/0,u=Math.max(0,t),c=Math.min(n,o,l);c>u&&(!a.ending||a.ended)?(a.ended=!1,this.log("Removing [".concat(u,",").concat(c,"] from the ").concat(e," SourceBuffer")),s.remove(u,c)):this.shiftAndExecuteNext(e)}},{key:"appendExecutor",value:function(e,t){var n=this.tracks[t],i=null==n?void 0:n.buffer;if(!i)throw new rp("Attempting to append to the ".concat(t," SourceBuffer, but it does not exist"));n.ending=!1,n.ended=!1,i.appendBuffer(e)}},{key:"blockUntilOpen",value:function(e){var t=this;if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(function(e){t.warn("SourceBuffer blocked callback ".concat(e)),t.stepOperationQueue(t.sourceBufferTypes)});else try{e()}catch(e){this.warn("Callback run without blocking ".concat(this.operationQueue," ").concat(e))}}},{key:"isUpdating",value:function(){return this.sourceBuffers.some(function(e){var t=(0,A._)(e,2),n=t[0],i=t[1];return n&&i.updating})}},{key:"isQueued",value:function(){var e=this;return this.sourceBuffers.some(function(t){var n=(0,A._)(t,1)[0];return n&&!!e.currentOp(n)})}},{key:"isPending",value:function(e){return!!e&&!e.buffer}},{key:"blockBuffers",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sourceBufferTypes;if(!n.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);var i=this.operationQueue,r=n.map(function(e){return t.appendBlocker(e)});return n.length>1&&this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(function(n){i===t.operationQueue&&(e(),t.stepOperationQueue(t.sourceBufferTypes))})}},{key:"stepOperationQueue",value:function(e){var t=this;e.forEach(function(e){var n,i=null==(n=t.tracks[e])?void 0:n.buffer;i&&!i.updating&&t.shiftAndExecuteNext(e)})}},{key:"append",value:function(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}},{key:"appendBlocker",value:function(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}},{key:"currentOp",value:function(e){return this.operationQueue?this.operationQueue.current(e):null}},{key:"executeNext",value:function(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}},{key:"shiftAndExecuteNext",value:function(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}},{key:"pendingTrackCount",get:function(){var e=this;return Object.keys(this.tracks).reduce(function(t,n){return t+ +!!e.isPending(e.tracks[n])},0)}},{key:"sourceBufferCount",get:function(){return this.sourceBuffers.reduce(function(e,t){return e+ +!!(0,A._)(t,1)[0]},0)}},{key:"sourceBufferTypes",get:function(){return this.sourceBuffers.map(function(e){return(0,A._)(e,1)[0]}).filter(function(e){return!!e})}},{key:"addBufferListener",value:function(e,t,n){var i=this.tracks[e];if(i){var r=i.buffer;if(r){var a=n.bind(this,e);i.listeners.push({event:t,listener:a}),r.addEventListener(t,a)}}}},{key:"removeBufferListeners",value:function(e){var t=this.tracks[e];if(t){var n=t.buffer;n&&(t.listeners.forEach(function(e){n.removeEventListener(e.event,e.listener)}),t.listeners.length=0)}}}]),t}(z);function rE(e){var t=e.querySelectorAll("source");[].slice.call(t).forEach(function(t){e.removeChild(t)})}function rk(e){return+("audio"===e)}var rb=function(){"use strict";function e(t){(0,E._)(this,e),this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=t,this.autoLevelCapping=1/0,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}return(0,k._)(e,[{key:"setStreamController",value:function(e){this.streamController=e}},{key:"destroy",value:function(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}},{key:"registerListeners",value:function(){var e=this.hls;e.on(O.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(O.BUFFER_CODECS,this.onBufferCodecs,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this)}},{key:"unregisterListener",value:function(){var e=this.hls;e.off(O.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(O.BUFFER_CODECS,this.onBufferCodecs,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this)}},{key:"onFpsDropLevelCapping",value:function(e,t){var n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}},{key:"onMediaAttaching",value:function(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}},{key:"onManifestParsed",value:function(e,t){var n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}},{key:"onLevelsUpdated",value:function(e,t){this.timer&&R(this.autoLevelCapping)&&this.detectPlayerSize()}},{key:"onBufferCodecs",value:function(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}},{key:"onMediaDetaching",value:function(){this.stopCapping(),this.media=null}},{key:"detectPlayerSize",value:function(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}var e=this.hls.levels;if(e.length){var t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log("Setting autoLevelCapping to ".concat(n,": ").concat(e[n].height,"p@").concat(e[n].bitrate," for media ").concat(this.mediaWidth,"x").concat(this.mediaHeight)),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}},{key:"getMaxLevel",value:function(t){var n=this,i=this.hls.levels;if(!i.length)return -1;var r=i.filter(function(e,i){return n.isLevelAllowed(e)&&i<=t});return this.clientRect=null,e.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}},{key:"startCapping",value:function(){this.timer||(this.autoLevelCapping=1/0,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"stopCapping",value:function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=1/0,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}},{key:"getDimensions",value:function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,t.width||t.height||(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}},{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return Math.min(e,this.hls.config.maxDevicePixelRatio)}},{key:"isLevelAllowed",value:function(e){return!this.restrictedLevels.some(function(t){return e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height})}}],[{key:"getMaxLevelByMediaSize",value:function(e,t,n){if(!(null!=e&&e.length))return -1;for(var i=e.length-1,r=Math.max(t,n),a=0;a<e.length;a+=1){var s,o=e[a];if((o.width>=r||o.height>=r)&&(!(s=e[a+1])||o.width!==s.width||o.height!==s.height)){i=a;break}}return i}}]),e}(),rT=function e(t,n){"use strict";(0,E._)(this,e),Array.isArray(t)&&(t=t.map(function(t){return t instanceof e?t:new e(t)})),this.value=t,this.params=n};function rS(e,t,n){return Error("failed to ".concat("serialize",' "').concat(Array.isArray(e)?JSON.stringify(e):e instanceof Map?"Map{}":e instanceof Set?"Set{}":(void 0===e?"undefined":(0,w._)(e))==="object"?JSON.stringify(e):String(e),'" as ').concat(t),{cause:n})}var r_=function e(t){"use strict";(0,E._)(this,e),this.description=t},rA="Bare Item";function rL(e){if(e<-0x38d7ea4c67fff||0x38d7ea4c67fff<e)throw rS(e,"Integer");return e.toString()}var rw=/[\x00-\x1f\x7f]+/;function rI(e){var t=e.description||e.toString().slice(7,-1);if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw rS(t,"Token");return t}function rR(e){switch(void 0===e?"undefined":(0,w._)(e)){case"number":if(!R(e))throw rS(e,rA);if(Number.isInteger(e))return rL(e);var t,n=function e(t,n){if(t<0)return-e(-t,n);var i=Math.pow(10,n);if(!(Math.abs(t*i%1-.5)<Number.EPSILON))return Math.round(t*i)/i;var r=Math.floor(t*i);return(r%2==0?r:r+1)/i}(e,3);if(Math.floor(Math.abs(n)).toString().length>12)throw rS(e,"Decimal");var i=n.toString();return i.includes(".")?i:"".concat(i,".0");case"string":if(rw.test(e))throw rS(e,"String");return'"'.concat(e.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),'"');case"symbol":return rI(e);case"boolean":if("boolean"!=typeof e)throw rS(e,"Boolean");return e?"?1":"?0";case"object":if(e instanceof Date)return"@".concat(rL(e.getTime()/1e3));if(e instanceof Uint8Array){if(!1===ArrayBuffer.isView(e))throw rS(e,"Byte Sequence");return":".concat(btoa((t=String).fromCharCode.apply(t,(0,L._)(e))),":")}if(e instanceof r_)return rI(e);default:throw rS(e,rA)}}function rD(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw rS(e,"Key");return e}function rC(e){return null==e?"":Object.entries(e).map(function(e){var t=(0,A._)(e,2),n=t[0],i=t[1];return!0===i?";".concat(rD(n)):";".concat(rD(n),"=").concat(rR(i))}).join("")}function rx(e){return e instanceof rT?"".concat(rR(e.value)).concat(rC(e.params)):rR(e)}function rP(e,t){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{whitespace:!0};if((void 0===e?"undefined":(0,w._)(e))!=="object"||null==e)throw rS(e,"Dict");var n=e instanceof Map?e.entries():Object.entries(e),i=(null==t?void 0:t.whitespace)?" ":"";return Array.from(n).map(function(e){var t,n=(0,A._)(e,2),i=n[0],r=n[1];r instanceof rT==!1&&(r=new rT(r));var a=rD(i);return!0===r.value?a+=rC(r.params):(a+="=",Array.isArray(r.value))?a+=(t=r,"(".concat(t.value.map(rx).join(" "),")").concat(rC(t.params))):a+=rx(r),a}).join(",".concat(i))}(e,t)}var rO="CMCD-Object",rM="CMCD-Request",rF="CMCD-Session",rN="CMCD-Status",rB={br:rO,ab:rO,d:rO,ot:rO,tb:rO,tpb:rO,lb:rO,tab:rO,lab:rO,url:rO,pb:rM,bl:rM,tbl:rM,dl:rM,ltc:rM,mtp:rM,nor:rM,nrr:rM,rc:rM,sn:rM,sta:rM,su:rM,ttfb:rM,ttfbb:rM,ttlb:rM,cmsdd:rM,cmsds:rM,smrt:rM,df:rM,cs:rM,ts:rM,cid:rF,pr:rF,sf:rF,sid:rF,st:rF,v:rF,msd:rF,bs:rN,bsd:rN,cdn:rN,rtp:rN,bg:rN,pt:rN,ec:rN,e:rN},rU="event",rj=function(e){return Math.round(e)},rG=function(e,t){return Array.isArray(e)?e.map(function(e){return rG(e,t)}):e instanceof rT&&"string"==typeof e.value?new rT(rG(e.value,t),e.params):(t.baseUrl&&(e=function(e,t){var n=new URL(e),i=new URL(t);if(n.origin!==i.origin)return e;for(var r=n.pathname.split("/").slice(1),a=i.pathname.split("/").slice(1,-1);r[0]===a[0];)r.shift(),a.shift();for(;a.length;)a.shift(),r.unshift("..");return r.join("/")+n.search+n.hash}(e,t.baseUrl)),1===t.version?encodeURIComponent(e):e)},rK=function(e){return 100*rj(e/100)},rH={br:rj,d:rj,bl:rK,dl:rK,mtp:rK,nor:function(e,t){var n=e;return t.version>=2&&(e instanceof rT&&"string"==typeof e.value?n=new rT([e]):"string"==typeof e&&(n=[e])),rG(n,t)},rtp:rK,tb:rj},rV="request",rq="response",rY=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],rW=["e"],rz=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function rX(e){return rz.test(e)}var rQ=["d","dl","nor","ot","rtp","su"],r$=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"],rZ=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function rJ(e){return rZ.includes(e)||rX(e)}var r0=(p={},(0,b._)(p,rq,function(e){return rY.includes(e)||rQ.includes(e)||r$.includes(e)||rX(e)}),(0,b._)(p,rU,function(e){return rY.includes(e)||rW.includes(e)||rX(e)}),(0,b._)(p,rV,function(e){return rY.includes(e)||rQ.includes(e)||rX(e)}),p);function r1(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};if(null==e||(void 0===e?"undefined":(0,w._)(e))!=="object")return n;var i=t.version||e.v||1,r=t.reportingMode||rV,a=1===i?rJ:r0[r],s=Object.keys(e).filter(a),o=t.filter;"function"==typeof o&&(s=s.filter(o));var l=r===rq||r===rU;l&&!s.includes("ts")&&s.push("ts"),i>1&&!s.includes("v")&&s.push("v");var u=q({},rH,t.formatters),c={version:i,reportingMode:r,baseUrl:t.baseUrl};return s.sort().forEach(function(t){var r,a=e[t],s=u[t];if("function"==typeof s&&(a=s(a,c)),"v"===t)if(1===i)return;else a=i;("pr"!=t||1!==a)&&(l&&"ts"===t&&!R(a)&&(a=Date.now()),("number"==typeof(r=a)?R(r):null!=r&&""!==r&&!1!==r)&&(["ot","sf","st","e","sta"].includes(t)&&"string"==typeof a&&(a=new r_(a)),n[t]=a))}),n}var r2=/CMCD=[^&#]+/,r3=function(){"use strict";function e(t){var n=this;(0,E._)(this,e),this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){n.initialized&&(n.starved=!0),n.buffering=!0},this.onPlaying=function(){n.initialized||(n.initialized=!0),n.buffering=!1},this.applyPlaylistData=function(e){try{n.apply(e,{ot:"m",su:!n.initialized})}catch(e){n.hls.logger.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=function(e){try{var t=e.frag,i=e.part,r=n.hls.levels[t.level],a=n.getObjectType(t),s={d:1e3*(i||t).duration,ot:a};("v"===a||"a"===a||"av"==a)&&(s.br=r.bitrate/1e3,s.tb=n.getTopBandwidth(a)/1e3,s.bl=n.getBufferLength(a));var o=i?n.getNextPart(i):n.getNextFrag(t);null!=o&&o.url&&o.url!==t.url&&(s.nor=o.url),n.apply(e,s)}catch(e){n.hls.logger.warn("Could not generate segment CMCD data.",e)}},this.hls=t;var i=this.config=t.config,r=i.cmcd;null!=r&&(i.pLoader=this.createPlaylistLoader(),i.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||t.sessionId,this.cid=r.contentId,this.useHeaders=!0===r.useHeaders,this.includeKeys=r.includeKeys,this.registerListeners())}return(0,k._)(e,[{key:"registerListeners",value:function(){var e=this.hls;e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHED,this.onMediaDetached,this),e.on(O.BUFFER_CREATED,this.onBufferCreated,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHED,this.onMediaDetached,this),e.off(O.BUFFER_CREATED,this.onBufferCreated,this)}},{key:"destroy",value:function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}},{key:"onMediaAttached",value:function(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}},{key:"onMediaDetached",value:function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}},{key:"onBufferCreated",value:function(e,t){var n,i;this.audioBuffer=null==(n=t.tracks.audio)?void 0:n.buffer,this.videoBuffer=null==(i=t.tracks.video)?void 0:i.buffer}},{key:"createData",value:function(){var e;return{v:1,sf:"h",sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}},{key:"apply",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};q(n,this.createData());var i="i"===n.ot||"v"===n.ot||"av"===n.ot;this.starved&&i&&(n.bs=!0,n.su=!0,this.starved=!1),null==n.su&&(n.su=this.buffering);var r=this.includeKeys;r&&(n=Object.keys(n).reduce(function(e,t){return r.includes(t)&&(e[t]=n[t]),e},{}));var a={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),t=e.headers,q(t,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};return e?Object.entries(function(e,t){var n={};if(!e)return n;var i=Object.keys(e),r=t?Object.keys(t).reduce(function(e,n){var i;return null==(i=t[n])||i.forEach(function(t){return e[t]=n}),e},{}):{};return i.reduce(function(t,n){var i,a=rB[n]||r[n]||rM;return(null!=(i=t[a])?i:t[a]={})[n]=e[n],t},n)}(r1(e,t),null==t?void 0:t.customHeaderMap)).reduce(function(e,t){var n=(0,A._)(t,2),i=n[0],r=rP(n[1],{whitespace:!1});return r&&(e[i]=r),e},n):n}(n,a))):e.url=function(e,t,n){var i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return"";var n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e?encodeURIComponent(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e?rP(r1(e,t),{whitespace:!1}):""}(e,t)):""}(e,t);return"".concat("CMCD","=").concat(n)}(t,n);if(!i)return e;if(r2.test(e))return e.replace(r2,i);var r=e.includes("?")?"&":"?";return"".concat(e).concat(r).concat(i)}(e.url,n,a)}},{key:"getNextFrag",value:function(e){var t,n=null==(t=this.hls.levels[e.level])?void 0:t.details;if(n){var i=e.sn-n.startSN;return n.fragments[i+1]}}},{key:"getNextPart",value:function(e){var t,n=e.index,i=e.fragment,r=null==(t=this.hls.levels[i.level])||null==(t=t.details)?void 0:t.partList;if(r)for(var a=i.sn,s=r.length-1;s>=0;s--){var o=r[s];if(o.index===n&&o.fragment.sn===a)return r[s+1]}}},{key:"getObjectType",value:function(e){var t=e.type;return"subtitle"===t?"tt":"initSegment"===e.sn?"i":"audio"===t?"a":"main"===t?this.hls.audioTracks.length?"v":"av":void 0}},{key:"getTopBandwidth",value:function(e){var t,n=0,i=this.hls;if("a"===e)t=i.audioTracks;else{var r=i.maxAutoLevel,a=r>-1?r+1:i.levels.length;t=i.levels.slice(0,a)}return t.forEach(function(e){e.bitrate>n&&(n=e.bitrate)}),n>0?n:NaN}},{key:"getBufferLength",value:function(e){var t=this.media,n="a"===e?this.audioBuffer:this.videoBuffer;return n&&t?1e3*tG.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len:NaN}},{key:"createPlaylistLoader",value:function(){var e=this.config.pLoader,t=this.applyPlaylistData,n=e||this.config.loader;function i(e){(0,E._)(this,i),this.loader=void 0,this.loader=new n(e)}return(0,k._)(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}},{key:"destroy",value:function(){this.loader.destroy()}},{key:"abort",value:function(){this.loader.abort()}},{key:"load",value:function(e,n,i){t(e),this.loader.load(e,n,i)}}]),i}},{key:"createFragmentLoader",value:function(){var e=this.config.fLoader,t=this.applyFragmentData,n=e||this.config.loader;function i(e){(0,E._)(this,i),this.loader=void 0,this.loader=new n(e)}return(0,k._)(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}},{key:"destroy",value:function(){this.loader.destroy()}},{key:"abort",value:function(){this.loader.abort()}},{key:"load",value:function(e,n,i){t(e),this.loader.load(e,n,i)}}]),i}}]),e}(),r5=function(e){"use strict";function t(e){var n;return(0,E._)(this,t),(n=(0,y._)(this,t,["content-steering",e.logger])).hls=void 0,n.loader=null,n.uri=null,n.pathwayId=".",n._pathwayPriority=null,n.timeToLoad=300,n.reloadTimer=-1,n.updated=0,n.started=!1,n.enabled=!0,n.levels=null,n.audioTracks=null,n.subtitleTracks=null,n.penalizedPathways={},n.hls=e,n.registerListeners(),n}return(0,_._)(t,e),(0,k._)(t,[{key:"registerListeners",value:function(){var e=this.hls;e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.ERROR,this.onError,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e&&(e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.ERROR,this.onError,this))}},{key:"pathways",value:function(){return(this.levels||[]).reduce(function(e,t){return -1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e},[])}},{key:"pathwayPriority",get:function(){return this._pathwayPriority},set:function(e){this.updatePathwayPriority(e)}},{key:"startLoad",value:function(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){var e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}}},{key:"stopLoad",value:function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}},{key:"clearTimeout",value:function(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}},{key:"destroy",value:function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}},{key:"removeLevel",value:function(e){var t=this.levels;t&&(this.levels=t.filter(function(t){return t!==e}))}},{key:"onManifestLoading",value:function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}},{key:"onManifestLoaded",value:function(e,t){var n=t.contentSteering;null!==n&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}},{key:"onManifestParsed",value:function(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}},{key:"onError",value:function(e,t){var n=t.errorAction;if((null==n?void 0:n.action)===2&&1===n.flags){var i=this.levels,r=this._pathwayPriority,a=this.pathwayId;if(t.context){var s=t.context,o=s.groupId,l=s.pathwayId,u=s.type;o&&i?a=this.getPathwayForGroupId(o,u,a):l&&(a=l)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!r&&i&&(r=this.pathways()),r&&r.length>1&&(this.updatePathwayPriority(r),n.resolved=this.pathwayId!==a),t.details!==P.BUFFER_APPEND_ERROR||t.fatal?n.resolved||this.warn("Could not resolve ".concat(t.details,' ("').concat(t.error.message,'") with content-steering for Pathway: ').concat(a," levels: ").concat(i?i.length:i," priorities: ").concat(e9(r)," penalized: ").concat(e9(this.penalizedPathways))):n.resolved=!0}}},{key:"filterParsedLevels",value:function(e){this.levels=e;var t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){var n=e[0].pathwayId;this.log("No levels found in Pathway ".concat(this.pathwayId,'. Setting initial Pathway to "').concat(n,'"')),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log("Found ".concat(t.length,"/").concat(e.length,' levels in Pathway "').concat(this.pathwayId,'"')),t}},{key:"getLevelsForPathway",value:function(e){return null===this.levels?[]:this.levels.filter(function(t){return e===t.pathwayId})}},{key:"updatePathwayPriority",value:function(e){this._pathwayPriority=e;var t,n=this.penalizedPathways,i=performance.now();Object.keys(n).forEach(function(e){i-n[e]>3e5&&delete n[e]});for(var r=0;r<e.length;r++){var a=e[r];if(!(a in n)){if(a===this.pathwayId)return;var s=this.hls.nextLoadLevel,o=this.hls.levels[s];if((t=this.getLevelsForPathway(a)).length>0){this.log('Setting Pathway to "'.concat(a,'"')),this.pathwayId=a,nF(t),this.hls.trigger(O.LEVELS_UPDATED,{levels:t});var l=this.hls.levels[s];o&&l&&this.levels&&(l.attrs["STABLE-VARIANT-ID"]!==o.attrs["STABLE-VARIANT-ID"]&&l.bitrate!==o.bitrate&&this.log("Unstable Pathways change from bitrate ".concat(o.bitrate," to ").concat(l.bitrate)),this.hls.nextLoadLevel=s);break}}}}},{key:"getPathwayForGroupId",value:function(e,t,n){for(var i=this.getLevelsForPathway(n).concat(this.levels||[]),r=0;r<i.length;r++)if(t===B&&i[r].hasAudioGroup(e)||t===U&&i[r].hasSubtitleGroup(e))return i[r].pathwayId;return n}},{key:"clonePathways",value:function(e){var t=this,n=this.levels;if(n){var i={},r={};e.forEach(function(e){var a=e.ID,s=e["BASE-ID"],o=e["URI-REPLACEMENT"];if(!n.some(function(e){return e.pathwayId===a})){var l=t.getLevelsForPathway(s).map(function(e){var t=new tW(e.attrs);t["PATHWAY-ID"]=a;var n=t.AUDIO&&"".concat(t.AUDIO,"_clone_").concat(a),s=t.SUBTITLES&&"".concat(t.SUBTITLES,"_clone_").concat(a);n&&(i[t.AUDIO]=n,t.AUDIO=n),s&&(r[t.SUBTITLES]=s,t.SUBTITLES=s);var l=r8(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",o),u=new e4({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(var c=1;c<e.audioGroups.length;c++)u.addGroupId("audio","".concat(e.audioGroups[c],"_clone_").concat(a));if(e.subtitleGroups)for(var h=1;h<e.subtitleGroups.length;h++)u.addGroupId("text","".concat(e.subtitleGroups[h],"_clone_").concat(a));return u});n.push.apply(n,(0,L._)(l)),r4(t.audioTracks,i,o,a),r4(t.subtitleTracks,r,o,a)}})}}},{key:"loadSteeringManifest",value:function(e){var t,n=this,i=this.hls.config,r=i.loader;this.loader&&this.loader.destroy(),this.loader=new r(i);try{t=new self.URL(e)}catch(t){this.enabled=!1,this.log("Failed to parse Steering Manifest URI: ".concat(e));return}if("data:"!==t.protocol){var a=0|(this.hls.bandwidthEstimate||i.abrEwmaDefaultEstimate);t.searchParams.set("_HLS_pathway",this.pathwayId),t.searchParams.set("_HLS_throughput",""+a)}var s={responseType:"json",url:t.href},o=i.steeringManifestLoadPolicy.default,l=o.errorRetry||o.timeoutRetry||{},u={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0};this.log("Requesting steering manifest: ".concat(t)),this.loader.load(s,u,{onSuccess:function(e,i,r,a){n.log('Loaded steering manifest: "'.concat(t,'"'));var s=e.data;if((null==s?void 0:s.VERSION)!==1)return void n.log("Steering VERSION ".concat(s.VERSION," not supported!"));n.updated=performance.now(),n.timeToLoad=s.TTL;var o=s["RELOAD-URI"],l=s["PATHWAY-CLONES"],u=s["PATHWAY-PRIORITY"];if(o)try{n.uri=new self.URL(o,t).href}catch(e){n.enabled=!1,n.log("Failed to parse Steering Manifest RELOAD-URI: ".concat(o));return}n.scheduleRefresh(n.uri||r.url),l&&n.clonePathways(l);var c={steeringManifest:s,url:t.toString()};n.hls.trigger(O.STEERING_MANIFEST_LOADED,c),u&&n.updatePathwayPriority(u)},onError:function(e,t,i,r){if(n.log("Error loading steering manifest: ".concat(e.code," ").concat(e.text," (").concat(t.url,")")),n.stopLoad(),410===e.code){n.enabled=!1,n.log("Steering manifest ".concat(t.url," no longer available"));return}var a=1e3*n.timeToLoad;if(429===e.code){var s=n.loader;if("function"==typeof(null==s?void 0:s.getResponseHeader)){var o=s.getResponseHeader("Retry-After");o&&(a=1e3*parseFloat(o))}n.log("Steering manifest ".concat(t.url," rate limited"));return}n.scheduleRefresh(n.uri||t.url,a)},onTimeout:function(e,t,i){n.log("Timeout loading steering manifest (".concat(t.url,")")),n.scheduleRefresh(n.uri||t.url)}})}},{key:"scheduleRefresh",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3*this.timeToLoad;this.clearTimeout(),this.reloadTimer=self.setTimeout(function(){var n,i=null==(n=t.hls)?void 0:n.media;if(i&&!i.ended)return void t.loadSteeringManifest(e);t.scheduleRefresh(e,1e3*t.timeToLoad)},n)}}]),t}(z);function r4(e,t,n,i){e&&Object.keys(t).forEach(function(r){var a=e.filter(function(e){return e.groupId===r}).map(function(e){var a=q({},e);return a.details=void 0,a.attrs=new tW(a.attrs),a.url=a.attrs.URI=r8(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",n),a.groupId=a.attrs["GROUP-ID"]=t[r],a.attrs["PATHWAY-ID"]=i,a});e.push.apply(e,(0,L._)(a))})}function r8(e,t,n,i){var r,a=i.HOST,s=i.PARAMS,o=i[n];t&&(r=null==o?void 0:o[t])&&(e=r);var l=new self.URL(e);return a&&!r&&(l.host=a),s&&Object.keys(s).sort().forEach(function(e){e&&l.searchParams.set(e,s[e])}),l.href}var r6=function(e){"use strict";function t(e){var n;return(0,E._)(this,t),(n=(0,y._)(this,t,["eme",e.logger])).hls=void 0,n.config=void 0,n.media=null,n.keyFormatPromise=null,n.keySystemAccessPromises={},n._requestLicenseFailureCount=0,n.mediaKeySessions=[],n.keyIdToKeySessionPromise={},n.mediaKeys=null,n.setMediaKeysQueue=t.CDMCleanupPromise?[t.CDMCleanupPromise]:[],n.bannedKeyIds={},n.onMediaEncrypted=function(e){var t=e.initDataType,i=e.initData,r='"'.concat(e.type,'" event: init data type: "').concat(t,'"');if(n.debug(r),null!==i){if(!n.keyFormatPromise){var a=Object.keys(n.keySystemAccessPromises);a.length||(a=na(n.config));var s=a.map(nr).filter(function(e){return!!e});n.keyFormatPromise=n.getKeyFormatPromise(s)}n.keyFormatPromise.then(function(a){var s,o=ni(a);if("sinf"!==t||o!==t8)return void n.log('Ignoring "'.concat(e.type,'" event with init data type: "').concat(t,'" for selected key-system ').concat(o));try{var l=ep(new Uint8Array(i)),u=t0(JSON.parse(l).sinf),c=eR(u);if(!c)throw Error("'schm' box missing or not cbcs/cenc with schi > tenc");s=new Uint8Array(c.subarray(8,24))}catch(e){n.warn("".concat(r," Failed to parse sinf: ").concat(e));return}for(var h=ei(s),d=n.keyIdToKeySessionPromise,f=n.mediaKeySessions,v=d[h],g=0;g<f.length&&"break"!==function(e){var r=f[e],a=r.decryptdata;if(!a.keyId)return"continue";var o=ei(a.keyId);if(tQ(s,a.keyId)||-1!==a.uri.replace(/-/g,"").indexOf(h))return(v=d[o])?(a.pssh||(delete d[o],a.pssh=new Uint8Array(i),a.keyId=s,(v=d[h]=v.then(function(){return n.generateRequestWithPreferredKeySession(r,t,i,"encrypted-event-key-match")})).catch(function(e){return n.handleError(e)})),"break"):"continue"}(g);g++);v||n.handleError(Error("Key ID ".concat(h," not encountered in playlist. Key-system sessions ").concat(f.length,".")))}).catch(function(e){return n.handleError(e)})}},n.onWaitingForKey=function(e){n.log('"'.concat(e.type,'" event'))},n.hls=e,n.config=e.config,n.registerListeners(),n}return(0,_._)(t,e),(0,k._)(t,[{key:"destroy",value:function(){this.onDestroying(),this.onMediaDetached();var e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}},{key:"registerListeners",value:function(){this.hls.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(O.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(O.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(O.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(O.DESTROYING,this.onDestroying,this)}},{key:"unregisterListeners",value:function(){this.hls.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(O.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(O.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(O.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(O.DESTROYING,this.onDestroying,this)}},{key:"getLicenseServerUrl",value:function(e){var t=this.config,n=t.drmSystems,i=t.widevineLicenseUrl,r=null==n?void 0:n[e];return r?r.licenseUrl:e===t9&&i?i:void 0}},{key:"getLicenseServerUrlOrThrow",value:function(e){var t=this.getLicenseServerUrl(e);if(void 0===t)throw Error('no license server URL configured for key-system "'.concat(e,'"'));return t}},{key:"getServerCertificateUrl",value:function(e){var t=this.config.drmSystems,n=null==t?void 0:t[e];if(n)return n.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'.concat(e,'"]'))}},{key:"attemptKeySystemAccess",value:function(e){var t=this,n=this.hls.levels,i=function(e,t,n){return!!e&&n.indexOf(e)===t},r=n.map(function(e){return e.audioCodec}).filter(i),a=n.map(function(e){return e.videoCodec}).filter(i);return r.length+a.length===0&&a.push("avc1.42e01e"),new Promise(function(n,i){var s=function(e){var o=e.shift();t.getMediaKeysPromise(o,r,a).then(function(e){return n({keySystem:o,mediaKeys:e})}).catch(function(t){e.length?s(e):t instanceof r7?i(t):i(new r7({type:x.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))})};s(e)})}},{key:"requestMediaKeySystemAccess",value:function(e,t){var n=this.config.requestMediaKeySystemAccessFunc;if("function"!=typeof n){var i="Configured requestMediaKeySystemAccess is not a function ".concat(n);return null===ns&&"http:"===self.location.protocol&&(i="navigator.requestMediaKeySystemAccess is not available over insecure protocol ".concat(location.protocol)),Promise.reject(Error(i))}return n(e,t)}},{key:"getMediaKeysPromise",value:function(e,t,n){var i,r=this,a=function(e,t,n,i){var r,a,s,o,l;switch(e){case t8:r=["cenc","sinf"];break;case t9:case t6:r=["cenc"];break;case t4:r=["cenc","keyids"];break;default:throw Error("Unknown key-system: ".concat(e))}return a=r,s=t,o=n,[{initDataTypes:a,persistentState:(l=i).persistentState||"optional",distinctiveIdentifier:l.distinctiveIdentifier||"optional",sessionTypes:l.sessionTypes||[l.sessionType||"temporary"],audioCapabilities:s.map(function(e){return{contentType:"audio/mp4; codecs=".concat(e),robustness:l.audioRobustness||"",encryptionScheme:l.audioEncryptionScheme||null}}),videoCapabilities:o.map(function(e){return{contentType:"video/mp4; codecs=".concat(e),robustness:l.videoRobustness||"",encryptionScheme:l.videoEncryptionScheme||null}})}]}(e,t,n,this.config.drmSystemOptions||{}),s=this.keySystemAccessPromises[e],o=null==(i=s)?void 0:i.keySystemAccess;if(!o){this.log('Requesting encrypted media "'.concat(e,'" key-system access with config: ').concat(e9(a))),o=this.requestMediaKeySystemAccess(e,a);var l=s=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(function(t){r.log('Failed to obtain access to key-system "'.concat(e,'": ').concat(t))}),o.then(function(t){r.log('Access for key-system "'.concat(t.keySystem,'" obtained'));var n=r.fetchServerCertificate(e);r.log('Create media-keys for "'.concat(e,'"'));var i=l.mediaKeys=t.createMediaKeys().then(function(t){return r.log('Media-keys created for "'.concat(e,'"')),l.hasMediaKeys=!0,n.then(function(n){return n?r.setMediaKeysServerCertificate(t,e,n):t})});return i.catch(function(t){r.error('Failed to create media-keys for "'.concat(e,'"}: ').concat(t))}),i})}return o.then(function(){return s.mediaKeys})}},{key:"createMediaKeySessionContext",value:function(e){var t=e.decryptdata,n=e.keySystem,i=e.mediaKeys;this.log('Creating key-system session "'.concat(n,'" keyId: ').concat(ei(t.keyId||[])," keyUri: ").concat(t.uri));var r=i.createSession(),a={decryptdata:t,keySystem:n,mediaKeys:i,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(a),a}},{key:"renewKeySession",value:function(e){var t=e.decryptdata;if(t.pssh){var n=this.createMediaKeySessionContext(e),i=r9(t);this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(n,"cenc",t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}},{key:"updateKeySession",value:function(e,t){var n=e.mediaKeysSession;return this.log('Updating key-session "'.concat(n.sessionId,'" for keyId ').concat(ei(e.decryptdata.keyId||[]),"\n      } (data length: ").concat(t.byteLength,")")),n.update(t)}},{key:"getSelectedKeySystemFormats",value:function(){var e=this;return Object.keys(this.keySystemAccessPromises).map(function(t){return{keySystem:t,hasMediaKeys:e.keySystemAccessPromises[t].hasMediaKeys}}).filter(function(e){return!!e.hasMediaKeys}).map(function(e){return nr(e.keySystem)}).filter(function(e){return!!e})}},{key:"getKeySystemAccess",value:function(e){var t=this;return this.getKeySystemSelectionPromise(e).then(function(e){var n=e.keySystem,i=e.mediaKeys;return t.attemptSetMediaKeys(n,i)})}},{key:"selectKeySystem",value:function(e){var t=this;return new Promise(function(n,i){t.getKeySystemSelectionPromise(e).then(function(e){var t=e.keySystem,r=nr(t);r?n(r):i(Error('Unable to find format for key-system "'.concat(t,'"')))}).catch(i)})}},{key:"selectKeySystemFormat",value:function(e){var t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: ".concat(e.sn," ").concat(e.type,": ").concat(e.level,") key formats ").concat(t.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}},{key:"getKeyFormatPromise",value:function(e){var t=na(this.config),n=e.map(ni).filter(function(e){return!!e&&-1!==t.indexOf(e)});return this.selectKeySystem(n)}},{key:"getKeyStatus",value:function(e){for(var t=this.mediaKeySessions,n=0;n<t.length;n++){var i,r,a=(i=e,r=t[n],i.keyId&&r.mediaKeysSession.keyStatuses.has(i.keyId)?r.mediaKeysSession.keyStatuses.get(i.keyId):i.matches(r.decryptdata)?r.keyStatus:void 0);if(a)return a}}},{key:"loadKey",value:function(e){var t=this,n=e.keyInfo.decryptdata,i=r9(n),r=this.bannedKeyIds[i];if(r||"internal-error"===this.getKeyStatus(n)){var a=ae(r||"internal-error",n);return this.handleError(a,e.frag),Promise.reject(a)}var s="(keyId: ".concat(i,' format: "').concat(n.keyFormat,'" method: ').concat(n.method," uri: ").concat(n.uri,")");this.log("Starting session for key ".concat(s));var o=this.keyIdToKeySessionPromise[i];if(!o){var l=this.getKeySystemForKeyPromise(n).then(function(i){var r=i.keySystem,a=i.mediaKeys;return t.throwIfDestroyed(),t.log("Handle encrypted media sn: ".concat(e.frag.sn," ").concat(e.frag.type,": ").concat(e.frag.level," using key ").concat(s)),t.attemptSetMediaKeys(r,a).then(function(){return t.throwIfDestroyed(),t.createMediaKeySessionContext({keySystem:r,mediaKeys:a,decryptdata:n})})}).then(function(e){var i=n.pssh?n.pssh.buffer:null;return t.generateRequestWithPreferredKeySession(e,"cenc",i,"playlist-key")});return l.catch(function(n){return t.handleError(n,e.frag)}),this.keyIdToKeySessionPromise[i]=l,l}return o.catch(function(i){if(i instanceof r7){var r=W({},i.data);"internal-error"===t.getKeyStatus(n)&&(r.decryptdata=n);var a=new r7(r,i.message);t.handleError(a,e.frag)}}),o}},{key:"throwIfDestroyed",value:function(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0],!this.hls)throw Error("invalid state")}},{key:"handleError",value:function(e,t){if(this.hls)if(e instanceof r7){t&&(e.data.frag=t);var n=e.data.decryptdata;this.error("".concat(e.message).concat(n?" (".concat(ei(n.keyId||[]),")"):"")),this.hls.trigger(O.ERROR,e.data)}else this.error(e.message),this.hls.trigger(O.ERROR,{type:x.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}},{key:"getKeySystemForKeyPromise",value:function(e){var t=r9(e),n=this.keyIdToKeySessionPromise[t];if(!n){var i=ni(e.keyFormat),r=i?[i]:na(this.config);return this.attemptKeySystemAccess(r)}return n}},{key:"getKeySystemSelectionPromise",value:function(e){if(e.length||(e=na(this.config)),0===e.length)throw new r7({type:x.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options ".concat(e9({drmSystems:this.config.drmSystems})));return this.attemptKeySystemAccess(e)}},{key:"attemptSetMediaKeys",value:function(e,t){var n=this;if(this.mediaKeys===t)return Promise.resolve();var i=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'.concat(e,'"'));var r=Promise.all(i).then(function(){if(!n.media)throw n.mediaKeys=null,Error("Attempted to set mediaKeys without media element attached");return n.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(function(){n.log('Media-keys set for "'.concat(e,'"')),i.push(r),n.setMediaKeysQueue=n.setMediaKeysQueue.filter(function(e){return -1===i.indexOf(e)})})}},{key:"generateRequestWithPreferredKeySession",value:function(e,t,n,i){var r,a=this,s=null==(r=this.config.drmSystems)||null==(r=r[e.keySystem])?void 0:r.generateRequest;if(s)try{var o=s.call(this.hls,t,n,e);if(!o)throw Error("Invalid response from configured generateRequest filter");t=o.initDataType,n=o.initData?o.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(e){if(this.warn(e.message),this.hls&&this.hls.config.debug)throw e}if(null===n)return this.log('Skipping key-session request for "'.concat(i,'" (no initData)')),Promise.resolve(e);var l=r9(e.decryptdata),u=e.decryptdata.uri;this.log('Generating key-session request for "'.concat(i,'" keyId: ').concat(l," URI: ").concat(u," (init data type: ").concat(t," length: ").concat(n.byteLength,")"));var c=new n9,h=e._onmessage=function(t){var n=e.mediaKeysSession;if(!n)return void c.emit("error",Error("invalid state"));var i=t.messageType,r=t.message;a.log('"'.concat(i,'" message event for session "').concat(n.sessionId,'" message size: ').concat(r.byteLength)),"license-request"===i||"license-renewal"===i?a.renewLicense(e,r).catch(function(e){c.eventNames().length?c.emit("error",e):a.handleError(e)}):"license-release"===i?e.keySystem===t8&&a.updateKeySession(e,t1("acknowledged")).then(function(){return a.removeSession(e)}).catch(function(e){return a.handleError(e)}):a.warn('unhandled media key message type "'.concat(i,'"'))},d=function(e,t){var n;t.keyStatus=e,e.startsWith("usable")?c.emit("resolved"):"internal-error"===e||"output-restricted"===e||"output-downscaled"===e?n=ae(e,t.decryptdata):"expired"===e?n=Error("key expired (keyId: ".concat(l,")")):"released"===e?n=Error("key released"):"status-pending"===e||a.warn('unhandled key status change "'.concat(e,'" (keyId: ').concat(l,")")),n&&(c.eventNames().length?c.emit("error",n):a.handleError(n))},f=e._onkeystatuseschange=function(t){if(!e.mediaKeysSession)return void c.emit("error",Error("invalid state"));var n=a.getKeyStatuses(e);if(Object.keys(n).some(function(e){return"status-pending"!==n[e]})){if("expired"===n[l]){a.log("Expired key ".concat(e9(n),' in key-session "').concat(e.mediaKeysSession.sessionId,'"')),a.renewKeySession(e);return}var i,r=n[l];r?d(r,e):(e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(i=e.keyStatusTimeouts)[l]||(i[l]=self.setTimeout(function(){if(e.mediaKeysSession&&a.mediaKeys){var t=a.getKeyStatus(e.decryptdata);if(t&&"status-pending"!==t)return a.log("No status for keyId ".concat(l,' in key-session "').concat(e.mediaKeysSession.sessionId,'". Using session key-status ').concat(t," from other session.")),d(t,e);a.log("key status for ".concat(l,' in key-session "').concat(e.mediaKeysSession.sessionId,'" timed out after ').concat(1e3,"ms")),d(r="internal-error",e)}},1e3)),a.log("No status for keyId ".concat(l," (").concat(e9(n),").")))}};nH(e.mediaKeysSession,"message",h),nH(e.mediaKeysSession,"keystatuseschange",f);var v=new Promise(function(e,t){c.on("error",t),c.on("resolved",e)});return e.mediaKeysSession.generateRequest(t,n).then(function(){a.log('Request generated for key-session "'.concat(e.mediaKeysSession.sessionId,'" keyId: ').concat(l," URI: ").concat(u))}).catch(function(t){throw new r7({type:x.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_NO_SESSION,error:t,decryptdata:e.decryptdata,fatal:!1},"Error generating key-session request: ".concat(t))}).then(function(){return v}).catch(function(t){return c.removeAllListeners(),a.removeSession(e).then(function(){throw t})}).then(function(){return c.removeAllListeners(),e})}},{key:"getKeyStatuses",value:function(e){var t=this,n={};return e.mediaKeysSession.keyStatuses.forEach(function(i,r){if("string"==typeof r&&(void 0===i?"undefined":(0,w._)(i))==="object"){var a=r;r=i,i=a}var s="buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);e.keySystem===t6&&16===s.length&&t2(s);var o=ei(s);"internal-error"===i&&(t.bannedKeyIds[o]=i),t.log('key status change "'.concat(i,'" for keyStatuses keyId: ').concat(o,' key-session "').concat(e.mediaKeysSession.sessionId,'"')),n[o]=i}),n}},{key:"fetchServerCertificate",value:function(e){var t=this.config,n=new t.loader(t),i=this.getServerCertificateUrl(e);return i?(this.log('Fetching server certificate for "'.concat(e,'"')),new Promise(function(r,a){var s={responseType:"arraybuffer",url:i},o=t.certLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0};n.load(s,l,{onSuccess:function(e,t,n,i){r(e.data)},onError:function(t,n,r,o){a(new r7({type:x.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:W({url:s.url,data:void 0},t)},'"'.concat(e,'" certificate request failed (').concat(i,"). Status: ").concat(t.code," (").concat(t.text,")")))},onTimeout:function(t,n,r){a(new r7({type:x.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:{url:s.url,data:void 0}},'"'.concat(e,'" certificate request timed out (').concat(i,")")))},onAbort:function(e,t,n){a(Error("aborted"))}})})):Promise.resolve()}},{key:"setMediaKeysServerCertificate",value:function(e,t,n){var i=this;return new Promise(function(r,a){e.setServerCertificate(n).then(function(a){i.log("setServerCertificate ".concat(a?"success":"not supported by CDM"," (").concat(n.byteLength,') on "').concat(t,'"')),r(e)}).catch(function(e){a(new r7({type:x.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))})})}},{key:"renewLicense",value:function(e,t){var n=this;return this.requestLicense(e,new Uint8Array(t)).then(function(t){return n.updateKeySession(e,new Uint8Array(t)).catch(function(t){throw new r7({type:x.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:t,fatal:!1},t.message)})})}},{key:"unpackPlayReadyKeyMessage",value:function(e,t){var n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;var i=new DOMParser().parseFromString(n,"application/xml"),r=i.querySelectorAll("HttpHeader");if(r.length>0)for(var a=0,s=r.length;a<s;a++){var o,l,u=r[a],c=null==(o=u.querySelector("name"))?void 0:o.textContent,h=null==(l=u.querySelector("value"))?void 0:l.textContent;c&&h&&e.setRequestHeader(c,h)}var d=i.querySelector("Challenge"),f=null==d?void 0:d.textContent;if(!f)throw Error("Cannot find <Challenge> in key message");return t1(atob(f))}},{key:"setupLicenseXHR",value:function(e,t,n,i){var r=this,a=this.config.licenseXhrSetup;return a?Promise.resolve().then(function(){if(!n.decryptdata)throw Error("Key removed");return a.call(r.hls,e,t,n,i)}).catch(function(s){if(!n.decryptdata)throw s;return e.open("POST",t,!0),a.call(r.hls,e,t,n,i)}).then(function(n){return e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:n||i}}):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}},{key:"requestLicense",value:function(e,t){var n=this,i=this.config.keyLoadPolicy.default;return new Promise(function(r,a){var s=n.getLicenseServerUrlOrThrow(e.keySystem);n.log("Sending license request to URL: ".concat(s));var o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=function(){if(!n.hls||!e.mediaKeysSession)return a(Error("invalid state"));if(4===o.readyState)if(200===o.status){n._requestLicenseFailureCount=0;var l=o.response;n.log("License received ".concat(l instanceof ArrayBuffer?l.byteLength:l));var u=n.config.licenseResponseCallback;if(u)try{l=u.call(n.hls,o,s,e)}catch(e){n.error(e)}r(l)}else{var c=i.errorRetry,h=c?c.maxNumRetry:0;if(n._requestLicenseFailureCount++,n._requestLicenseFailureCount>h||o.status>=400&&o.status<500)a(new r7({type:x.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:o,response:{url:s,data:void 0,code:o.status,text:o.statusText}},"License Request XHR failed (".concat(s,"). Status: ").concat(o.status," (").concat(o.statusText,")")));else{var d=h-n._requestLicenseFailureCount+1;n.warn("Retrying license request, ".concat(d," attempts left")),n.requestLicense(e,t).then(r,a)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,n.setupLicenseXHR(o,s,e,t).then(function(t){var i=t.xhr,r=t.licenseChallenge;e.keySystem==t6&&(r=n.unpackPlayReadyKeyMessage(i,r)),i.send(r)}).catch(a)})}},{key:"onDestroying",value:function(){this.unregisterListeners(),this._clear()}},{key:"onMediaAttached",value:function(e,t){if(this.config.emeEnabled){var n=t.media;this.media=n,nH(n,"encrypted",this.onMediaEncrypted),nH(n,"waitingforkey",this.onWaitingForKey)}}},{key:"onMediaDetached",value:function(){var e=this.media;e&&(nV(e,"encrypted",this.onMediaEncrypted),nV(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}},{key:"_clear",value:function(){var e,n=this;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={},this.mediaKeys||this.mediaKeySessions.length){var i=this.media,r=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,nu.clearKeyUriToKeyIdMap();var a=r.length;t.CDMCleanupPromise=Promise.all(r.map(function(e){return n.removeSession(e)}).concat((null==i||null==(e=i.setMediaKeys(null))?void 0:e.catch(function(e){n.log("Could not clear media keys: ".concat(e)),n.hls&&n.hls.trigger(O.ERROR,{type:x.OTHER_ERROR,details:P.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:Error("Could not clear media keys: ".concat(e))})}))||Promise.resolve())).catch(function(e){n.log("Could not close sessions and clear media keys: ".concat(e)),n.hls&&n.hls.trigger(O.ERROR,{type:x.OTHER_ERROR,details:P.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:Error("Could not close sessions and clear media keys: ".concat(e))})}).then(function(){a&&n.log("finished closing key sessions and clearing media keys")})}}},{key:"onManifestLoading",value:function(){this.keyFormatPromise=null,this.bannedKeyIds={}}},{key:"onManifestLoaded",value:function(e,t){var n=t.sessionKeys;if(n&&this.config.emeEnabled&&!this.keyFormatPromise){var i=n.reduce(function(e,t){return -1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e},[]);this.log("Selecting key-system from session-keys ".concat(i.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(i)}}},{key:"removeSession",value:function(e){var t=this,n=e.mediaKeysSession,i=e.licenseXhr,r=e.decryptdata;if(n){this.log('Remove licenses and keys and close session "'.concat(n.sessionId,'" keyId: ').concat(ei((null==r?void 0:r.keyId)||[]))),e._onmessage&&(n.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(n.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var a,s,o=this.mediaKeySessions.indexOf(e);o>-1&&this.mediaKeySessions.splice(o,1);var l=e.keyStatusTimeouts;return l&&Object.keys(l).forEach(function(e){return self.clearTimeout(l[e])}),((a=this.config.drmSystemOptions)&&("persistent-license"===a.sessionType||null!=(s=a.sessionTypes)&&s.some(function(e){return"persistent-license"===e}))?new Promise(function(e,t){self.setTimeout(function(){return t(Error("MediaKeySession.remove() timeout"))},8e3),n.remove().then(e).catch(t)}):Promise.resolve()).catch(function(e){t.log("Could not remove session: ".concat(e)),t.hls&&t.hls.trigger(O.ERROR,{type:x.OTHER_ERROR,details:P.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:Error("Could not remove session: ".concat(e))})}).then(function(){return n.close()}).catch(function(e){t.log("Could not close session: ".concat(e)),t.hls&&t.hls.trigger(O.ERROR,{type:x.OTHER_ERROR,details:P.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:Error("Could not close session: ".concat(e))})})}return Promise.resolve()}}]),t}(z);function r9(e){if(!e)throw Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw Error("keyId is null");return ei(e.keyId)}r6.CDMCleanupPromise=void 0;var r7=function(e){"use strict";function t(e,n){var i;return(0,E._)(this,t),(i=(0,y._)(this,t,[n])).data=void 0,e.error||(e.error=Error(n)),i.data=e,e.err=e.error,i}return(0,_._)(t,e),t}((0,I._)(Error));function ae(e,t){var n="output-restricted"===e,i=n?P.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:P.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new r7({type:x.KEY_SYSTEM_ERROR,details:i,fatal:!1,decryptdata:t},n?"HDCP level output restricted":'key status changed to "'.concat(e,'"'))}var at=function(){"use strict";function e(t){(0,E._)(this,e),this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}return(0,k._)(e,[{key:"setStreamController",value:function(e){this.streamController=e}},{key:"registerListeners",value:function(){this.hls.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(O.MEDIA_DETACHING,this.onMediaDetaching,this)}},{key:"unregisterListeners",value:function(){this.hls.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(O.MEDIA_DETACHING,this.onMediaDetaching,this)}},{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}},{key:"onMediaAttaching",value:function(e,t){var n=this.hls.config;if(n.capLevelOnFPSDrop){var i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&"function"==typeof i.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}},{key:"onMediaDetaching",value:function(){this.media=null}},{key:"checkFPS",value:function(e,t,n){var i=performance.now();if(t){if(this.lastTime){var r=i-this.lastTime,a=n-this.lastDroppedFrames,s=t-this.lastDecodedFrames,o=1e3*a/r,l=this.hls;if(l.trigger(O.FPS_DROP,{currentDropped:a,currentDecoded:s,totalDroppedFrames:n}),o>0&&a>l.config.fpsDroppedMonitoringThreshold*s){var u=l.currentLevel;l.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=u)&&(u-=1,l.trigger(O.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:l.currentLevel}),l.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}},{key:"checkFPSInterval",value:function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}]),e}();function an(e,t){var n;try{n=new Event("addtrack")}catch(e){(n=document.createEvent("Event")).initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)}function ai(e,t){var n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw Error("addCue is failed for: ".concat(t))}catch(n){J.debug("[texttrack-utils]: ".concat(n));try{var i=new self.TextTrackCue(t.startTime,t.endTime,t.text);i.id=t.id,e.addCue(i)}catch(e){J.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: ".concat(e))}}"disabled"===n&&(e.mode=n)}function ar(e,t){var n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues)for(var i=e.cues.length;i--;)t&&e.cues[i].removeEventListener("enter",t),e.removeCue(e.cues[i]);"disabled"===n&&(e.mode=n)}function aa(e,t,n,i){var r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&e.cues.length>0)for(var a=function(e,t,n){var i=[],r=function(e,t){if(t<=e[0].startTime)return 0;var n,i=e.length-1;if(t>e[i].endTime)return -1;for(var r=0,a=i;r<=a;)if(t<e[n=Math.floor((a+r)/2)].startTime)a=n-1;else{if(!(t>e[n].startTime)||!(r<i))return n;r=n+1}return e[r].startTime-t<t-e[a].startTime?r:a}(e,t);if(r>-1)for(var a=r,s=e.length;a<s;a++){var o=e[a];if(o.startTime>=t&&o.endTime<=n)i.push(o);else if(o.startTime>n)break}return i}(e.cues,t,n),s=0;s<a.length;s++)(!i||i(a[s]))&&e.removeCue(a[s]);"disabled"===r&&(e.mode=r)}function as(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];("subtitles"===i.kind||"captions"===i.kind)&&i.label&&t.push(e[n])}return t}var ao=function(e){"use strict";function t(e){var n;return(0,E._)(this,t),(n=(0,y._)(this,t,[e,"subtitle-track-controller"])).media=null,n.tracks=[],n.groupIds=null,n.tracksInGroup=[],n.trackId=-1,n.currentTrack=null,n.selectDefaultTrack=!0,n.queuedDefaultTrack=-1,n.useTextTrackPolling=!1,n.subtitlePollingInterval=-1,n._subtitleDisplay=!0,n.asyncPollTrackChange=function(){return n.pollTrackChange(0)},n.onTextTracksChanged=function(){if(n.useTextTrackPolling||self.clearInterval(n.subtitlePollingInterval),n.media&&n.hls.config.renderTextTracksNatively){for(var e=null,t=as(n.media.textTracks),i=0;i<t.length;i++)if("hidden"===t[i].mode)e=t[i];else if("showing"===t[i].mode){e=t[i];break}var r=n.findTrackForTextTrack(e);n.subtitleTrack!==r&&n.setSubtitleTrack(r)}},n.registerListeners(),n}return(0,_._)(t,e),(0,k._)(t,[{key:"destroy",value:function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,(0,T._)((0,S._)(t.prototype),"destroy",this).call(this)}},{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}},{key:"registerListeners",value:function(){var e=this.hls;e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.LEVEL_LOADING,this.onLevelLoading,this),e.on(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(O.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(O.ERROR,this.onError,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.LEVEL_LOADING,this.onLevelLoading,this),e.off(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(O.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(O.ERROR,this.onError,this)}},{key:"onMediaAttached",value:function(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}},{key:"pollTrackChange",value:function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}},{key:"onMediaDetaching",value:function(e,t){var n=this.media;if(n){var i=!!t.transferMedia;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i||as(n.textTracks).forEach(function(e){ar(e)})}}},{key:"onManifestLoading",value:function(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}},{key:"onManifestParsed",value:function(e,t){this.tracks=t.subtitleTracks}},{key:"onSubtitleTrackLoaded",value:function(e,t){var n=t.id,i=t.groupId,r=t.details,a=this.tracksInGroup[n];if(!a||a.groupId!==i)return void this.warn("Subtitle track with id:".concat(n," and group:").concat(i," not found in active group ").concat(null==a?void 0:a.groupId));var s=a.details;a.details=t.details,this.log("Subtitle track ".concat(n,' "').concat(a.name,'" lang:').concat(a.lang," group:").concat(i," loaded [").concat(r.startSN,"-").concat(r.endSN,"]")),n===this.trackId&&this.playlistLoaded(n,t,s)}},{key:"onLevelLoading",value:function(e,t){this.switchLevel(t.level)}},{key:"onLevelSwitching",value:function(e,t){this.switchLevel(t.level)}},{key:"switchLevel",value:function(e){var t=this.hls.levels[e];if(t){var n=t.subtitleGroups||null,i=this.groupIds,r=this.currentTrack;if(!n||(null==i?void 0:i.length)!==(null==n?void 0:n.length)||null!=n&&n.some(function(e){return(null==i?void 0:i.indexOf(e))===-1})){this.groupIds=n,this.trackId=-1,this.currentTrack=null;var a=this.tracks.filter(function(e){return!n||-1!==n.indexOf(e.groupId)});if(a.length)this.selectDefaultTrack&&!a.some(function(e){return e.default})&&(this.selectDefaultTrack=!1),a.forEach(function(e,t){e.id=t});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=a;var s=this.hls.config.subtitlePreference;if(!r&&s){this.selectDefaultTrack=!1;var o=tn(s,a);if(o>-1)r=a[o];else{var l=tn(s,this.tracks);r=this.tracks[l]}}var u=this.findTrackId(r);-1===u&&r&&(u=this.findTrackId(null)),this.log("Updating subtitle tracks, ".concat(a.length,' track(s) found in "').concat(null==n?void 0:n.join(","),'" group-id')),this.hls.trigger(O.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:a}),-1!==u&&-1===this.trackId&&this.setSubtitleTrack(u)}}}},{key:"findTrackId",value:function(e){for(var t=this.tracksInGroup,n=this.selectDefaultTrack,i=0;i<t.length;i++){var r=t[i];if((!n||r.default)&&(n||e)&&(!e||ti(r,e)))return i}if(e){for(var a=0;a<t.length;a++){var s=t[a];if(rh(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return a}for(var o=0;o<t.length;o++){var l=t[o];if(rh(e.attrs,l.attrs,["LANGUAGE"]))return o}}return -1}},{key:"findTrackForTextTrack",value:function(e){if(e){for(var t=this.tracksInGroup,n=0;n<t.length;n++)if(rd(t[n],e))return n}return -1}},{key:"onError",value:function(e,t){!t.fatal&&t.context&&(t.context.type!==U||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}},{key:"allSubtitleTracks",get:function(){return this.tracks}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}},{key:"setSubtitleOption",value:function(e){if(this.hls.config.subtitlePreference=e,e){if(-1===e.id)return this.setSubtitleTrack(-1),null;var t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){var n=this.currentTrack;if(n&&ti(e,n))return n;var i=tn(e,this.tracksInGroup);if(i>-1){var r=this.tracksInGroup[i];return this.setSubtitleTrack(i),r}if(n)return null;var a=tn(e,t);if(a>-1)return t[a]}}return null}},{key:"loadPlaylist",value:function(e){(0,T._)((0,S._)(t.prototype),"loadPlaylist",this).call(this),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}},{key:"loadingPlaylist",value:function(e,n){(0,T._)((0,S._)(t.prototype),"loadingPlaylist",this).call(this,e,n);var i=e.id,r=e.groupId,a=this.getUrlWithDirectives(e.url,n),s=e.details,o=null==s?void 0:s.age;this.log("Loading subtitle ".concat(i,' "').concat(e.name,'" lang:').concat(e.lang," group:").concat(r).concat((null==n?void 0:n.msn)!==void 0?" at sn "+n.msn+" part "+n.part:"").concat(o&&s.live?" age "+o.toFixed(1)+(s.type?" "+s.type:""):""," ").concat(a)),this.hls.trigger(O.SUBTITLE_TRACK_LOADING,{url:a,id:i,groupId:r,deliveryDirectives:n||null,track:e})}},{key:"toggleTrackModes",value:function(){var e,t=this.media;if(t){var n=as(t.textTracks),i=this.currentTrack;if(i&&((e=n.filter(function(e){return rd(i,e)})[0])||this.warn('Unable to find subtitle TextTrack with name "'.concat(i.name,'" and language "').concat(i.lang,'"'))),[].slice.call(n).forEach(function(t){"disabled"!==t.mode&&t!==e&&(t.mode="disabled")}),e){var r=this.subtitleDisplay?"showing":"hidden";e.mode!==r&&(e.mode=r)}}}},{key:"setSubtitleTrack",value:function(e){var t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!R(e))return void this.warn("Invalid subtitle track id: ".concat(e));this.selectDefaultTrack=!1;var n=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i)return void this.hls.trigger(O.SUBTITLE_TRACK_SWITCH,{id:e});var r=!!i.details&&!i.details.live;if(e!==this.trackId||i!==n||!r){this.log("Switching to subtitle-track ".concat(e)+(i?' "'.concat(i.name,'" lang:').concat(i.lang," group:").concat(i.groupId):""));var a=i.id,s=i.groupId,o=i.name,l=i.type,u=i.url;this.hls.trigger(O.SUBTITLE_TRACK_SWITCH,{id:a,groupId:void 0===s?"":s,name:o,type:l,url:u});var c=this.switchParams(i.url,null==n?void 0:n.details,i.details);this.loadPlaylist(c)}}}]),t}(ru);function al(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()}var au=((f={})[f.Point=0]="Point",f[f.Range=1]="Range",f),ac=function(){"use strict";function e(t,n){(0,E._)(this,e),this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=n,this.dateRange=t,this.setDateRange(t)}return(0,k._)(e,[{key:"setDateRange",value:function(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}},{key:"reset",value:function(){var e;this.appendInPlaceStarted=!1,null==(e=this.assetListLoader)||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}},{key:"isAssetPastPlayoutLimit",value:function(e){if(e>0&&e>=this.assetList.length)return!0;var t,n=this.playoutLimit;return!(e<=0||isNaN(n))&&(0===n||((null==(t=this.assetList[e])?void 0:t.startOffset)||0)>n)}},{key:"findAssetIndex",value:function(e){return this.assetList.indexOf(e)}},{key:"identifier",get:function(){return this.dateRange.id}},{key:"startDate",get:function(){return this.dateRange.startDate}},{key:"startTime",get:function(){var e=this.dateRange.startTime;if(this.snapOptions.out){var t=this.dateRange.tagAnchor;if(t)return ah(e,t)}return e}},{key:"startOffset",get:function(){return this.cue.pre?0:this.startTime}},{key:"startIsAligned",get:function(){if(0===this.startTime||this.snapOptions.out)return!0;var e=this.dateRange.tagAnchor;if(e){var t=this.dateRange.startTime,n=ah(t,e);return t-n<.1}return!1}},{key:"resumptionOffset",get:function(){var e=this.resumeOffset,t=R(e)?e:this.duration;return this.cumulativeDuration+t}},{key:"resumeTime",get:function(){var e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){var t=this.resumeAnchor;if(t)return ah(e,t)}return e}},{key:"appendInPlace",get:function(){return!!this.appendInPlaceStarted||!this.appendInPlaceDisabled&&!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&.025>Math.abs(this.resumeOffset-this.duration)))},set:function(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}},{key:"timelineStart",get:function(){return null!==this._timelineStart?this._timelineStart:this.startTime},set:function(e){this._timelineStart=e}},{key:"duration",get:function(){var e,t=this.playoutLimit;return e=null!==this._duration?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(t)&&t<e&&(e=t),e},set:function(e){this._duration=e}},{key:"cue",get:function(){return this.dateRange.cue}},{key:"timelineOccupancy",get:function(){return"RANGE"===this.dateRange.attr["X-TIMELINE-OCCUPIES"]?au.Range:au.Point}},{key:"supplementsPrimary",get:function(){return"PRIMARY"===this.dateRange.attr["X-TIMELINE-STYLE"]}},{key:"contentMayVary",get:function(){return"NO"!==this.dateRange.attr["X-CONTENT-MAY-VARY"]}},{key:"assetUrl",get:function(){return this.dateRange.attr["X-ASSET-URI"]}},{key:"assetListUrl",get:function(){return this.dateRange.attr["X-ASSET-LIST"]}},{key:"baseUrl",get:function(){return this.base.url}},{key:"assetListLoaded",get:function(){return this.assetList.length>0||null!==this.assetListResponse}},{key:"toString",value:function(){var e;return e=this,'["'.concat(e.identifier,'" ').concat(e.cue.pre?"<pre>":e.cue.post?"<post>":"").concat(e.timelineStart.toFixed(2),"-").concat(e.resumeTime.toFixed(2),"]")}}]),e}();function ah(e,t){return e-t.start<t.duration/2&&!(.025>Math.abs(e-(t.start+t.duration)))?t.start:t.start+t.duration}function ad(e,t,n){var i=new self.URL(e,n);return"data:"!==i.protocol&&i.searchParams.set("_HLS_primary_id",t),i}function af(e,t){for(;null!=(n=e.assetList[++t])&&n.error;)var n;return t}function av(e){var t=e.timelineStart,n=e.duration||0;return'["'.concat(e.identifier,'" ').concat(t.toFixed(2),"-").concat((t+n).toFixed(2),"]")}var ag=function(){"use strict";function e(t,n,i,r){var a=this;(0,E._)(this,e),this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=function(){a.reachedPlayout(a.currentTime)&&a.hls&&a.hls.trigger(O.PLAYOUT_LIMIT_REACHED,{})};var s=this.hls=new t(n);this.interstitial=i,this.assetItem=r;var o=function(){a.hasDetails=!0};s.once(O.LEVEL_LOADED,o),s.once(O.AUDIO_TRACK_LOADED,o),s.once(O.SUBTITLE_TRACK_LOADED,o),s.on(O.MEDIA_ATTACHING,function(e,t){var n=t.media;a.removeMediaListeners(),a.mediaAttached=n,a.interstitial.playoutLimit&&(n.addEventListener("timeupdate",a.checkPlayout),a.appendInPlace&&s.on(O.BUFFER_APPENDED,function(){var e=a.bufferedEnd;a.reachedPlayout(e)&&(a._bufferedEosTime=e,s.trigger(O.BUFFERED_TO_END,void 0))}))})}return(0,k._)(e,[{key:"appendInPlace",get:function(){return this.interstitial.appendInPlace}},{key:"loadSource",value:function(){var e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{var t=this.assetItem.uri;try{t=ad(t,e.config.primarySessionId||"").href}catch(e){}e.loadSource(t)}}},{key:"bufferedInPlaceToEnd",value:function(e){if(!this.appendInPlace)return!1;if(null!=(t=this.hls)&&t.bufferedToEnd)return!0;if(!e)return!1;var t,n=Math.min(this._bufferedEosTime||1/0,this.duration),i=this.timelineOffset,r=tG.bufferInfo(e,i,0);return this.getAssetTime(r.end)>=n-.02}},{key:"reachedPlayout",value:function(e){var t=this.interstitial.playoutLimit;return this.startOffset+e>=t}},{key:"destroyed",get:function(){var e;return!(null!=(e=this.hls)&&e.userConfig)}},{key:"assetId",get:function(){return this.assetItem.identifier}},{key:"interstitialId",get:function(){return this.assetItem.parentIdentifier}},{key:"media",get:function(){var e;return(null==(e=this.hls)?void 0:e.media)||null}},{key:"bufferedEnd",get:function(){var e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;var t=tG.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}},{key:"currentTime",get:function(){var e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}},{key:"duration",get:function(){var e=this.assetItem.duration;if(!e)return 0;var t=this.interstitial.playoutLimit;if(t){var n=t-this.startOffset;if(n>0&&n<e)return n}return e}},{key:"remaining",get:function(){var e=this.duration;return e?Math.max(0,e-this.currentTime):0}},{key:"startOffset",get:function(){return this.assetItem.startOffset}},{key:"timelineOffset",get:function(){var e;return(null==(e=this.hls)?void 0:e.config.timelineOffset)||0},set:function(e){var t=this.timelineOffset;if(e!==t&&Math.abs(e-t)>1/9e4&&this.hls){if(this.hasDetails)throw Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}},{key:"getAssetTime",value:function(e){return Math.min(Math.max(0,e-this.timelineOffset),this.duration)}},{key:"removeMediaListeners",value:function(){var e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}},{key:"bufferSnapShot",value:function(){if(this.mediaAttached){var e;null!=(e=this.hls)&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}},{key:"destroy",value:function(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}},{key:"attachMedia",value:function(e){var t;this.loadSource(),null==(t=this.hls)||t.attachMedia(e)}},{key:"detachMedia",value:function(){var e;this.removeMediaListeners(),this.mediaAttached=null,null==(e=this.hls)||e.detachMedia()}},{key:"resumeBuffering",value:function(){var e;null==(e=this.hls)||e.resumeBuffering()}},{key:"pauseBuffering",value:function(){var e;null==(e=this.hls)||e.pauseBuffering()}},{key:"transferMedia",value:function(){var e;return this.bufferSnapShot(),(null==(e=this.hls)?void 0:e.transferMedia())||null}},{key:"resetDetails",value:function(){var e=this.hls;if(e&&this.hasDetails){e.stopLoad();var t=function(e){return delete e.details};e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}},{key:"on",value:function(e,t,n){var i;null==(i=this.hls)||i.on(e,t)}},{key:"once",value:function(e,t,n){var i;null==(i=this.hls)||i.once(e,t)}},{key:"off",value:function(e,t,n){var i;null==(i=this.hls)||i.off(e,t)}},{key:"toString",value:function(){var e;return"HlsAssetPlayer: ".concat(av(this.assetItem)," ").concat(null==(e=this.hls)?void 0:e.sessionId," ").concat(this.appendInPlace?"append-in-place":"")}}]),e}(),am=function(e){"use strict";function t(e,n){var i;return(0,E._)(this,t),(i=(0,y._)(this,t,["interstitials-sched",n])).onScheduleUpdate=void 0,i.eventMap={},i.events=null,i.items=null,i.durations={primary:0,playout:0,integrated:0},i.onScheduleUpdate=e,i}return(0,_._)(t,e),(0,k._)(t,[{key:"destroy",value:function(){this.reset(),this.onScheduleUpdate=null}},{key:"reset",value:function(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(function(e){return e.reset()}),this.events=this.items=null}},{key:"resetErrorsInRange",value:function(e,t){return this.events?this.events.reduce(function(n,i){return e<=i.startOffset&&t>i.startOffset?(delete i.error,n+1):n},0):0}},{key:"duration",get:function(){var e=this.items;return e?e[e.length-1].end:0}},{key:"length",get:function(){return this.items?this.items.length:0}},{key:"getEvent",value:function(e){return e&&this.eventMap[e]||null}},{key:"hasEvent",value:function(e){return e in this.eventMap}},{key:"findItemIndex",value:function(e,t){if(e.event)return this.findEventIndex(e.event.identifier);var n,i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);var r=this.items;if(r)for(r[i]||(void 0===t&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&null!=(n=r[i])&&n.event;)i--;return i}},{key:"findItemIndexAtTime",value:function(e,t){var n=this.items;if(n)for(var i=0;i<n.length;i++){var r=n[i];if(t&&"primary"!==t&&(r=r[t]),e===r.start||e>r.start&&e<r.end)return i}return -1}},{key:"findJumpRestrictedIndex",value:function(e,t){var n=this.items;if(n)for(var i=e;i<=t&&n[i];i++){var r=n[i].event;if(null!=r&&r.restrictions.jump&&!r.appendInPlace)return i}return -1}},{key:"findEventIndex",value:function(e){var t,n=this.items;if(n){for(var i=n.length;i--;)if((null==(t=n[i].event)?void 0:t.identifier)===e)return i}return -1}},{key:"findAssetIndex",value:function(e,t){var n=e.assetList,i=n.length;if(i>1)for(var r=0;r<i;r++){var a=n[r];if(!a.error){var s=a.timelineStart;if(t===s||t>s&&(t<s+(a.duration||0)||r===i-1))return r}}return 0}},{key:"assetIdAtEnd",get:function(){var e,t=null==(e=this.items)||null==(e=e[this.length-1])?void 0:e.event;if(t){var n=t.assetList,i=n[n.length-1];if(i)return i.identifier}return null}},{key:"parseInterstitialDateRanges",value:function(e,t){var n=this,i=e.main.details,r=i.dateRanges,a=this.events,s=this.parseDateRanges(r,{url:i.url},t),o=Object.keys(r),l=a?a.filter(function(e){return!o.includes(e.identifier)}):[];s.length&&s.sort(function(e,t){var n=e.cue.pre,i=e.cue.post,r=t.cue.pre,a=t.cue.post;if(n&&!r)return -1;if(r&&!n||i&&!a)return 1;if(a&&!i)return -1;if(!n&&!r&&!i&&!a){var s=e.startTime,o=t.startTime;if(s!==o)return s-o}return e.dateRange.tagOrder-t.dateRange.tagOrder}),this.events=s,l.forEach(function(e){n.removeEvent(e)}),this.updateSchedule(e,l)}},{key:"updateSchedule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.events||[];if(i.length||t.length||this.length<2){var r=this.items,a=this.parseSchedule(i,e);(n||t.length||(null==r?void 0:r.length)!==a.length||a.some(function(e,t){return Math.abs(e.playout.start-r[t].playout.start)>.005||Math.abs(e.playout.end-r[t].playout.end)>.005}))&&(this.items=a,this.onScheduleUpdate(t,r))}}},{key:"parseDateRanges",value:function(e,t,n){for(var i=[],r=Object.keys(e),a=0;a<r.length;a++){var s=r[a],o=e[s];if(o.isInterstitial){var l=this.eventMap[s];l?l.setDateRange(o):(l=new ac(o,t),this.eventMap[s]=l,!1===n&&(l.appendInPlace=n)),i.push(l)}}return i}},{key:"parseSchedule",value:function(e,t){var n=[],i=t.main.details,r=i.live?1/0:i.edge,a=0;if((e=e.filter(function(e){return!e.error&&!(e.cue.once&&e.hasPlayed)})).length){this.resolveOffsets(e,t);var s=0,o=0;if(e.forEach(function(t,i){var l=t.cue.pre,u=t.cue.post,c=e[i-1]||null,h=t.appendInPlace,d=u?r:t.startOffset,f=t.duration,v=t.timelineOccupancy===au.Range?f:0,g=t.resumptionOffset,m=(null==c?void 0:c.startTime)===d,p=d+t.cumulativeDuration,y=h?p+f:d+g;if(l||!u&&d<=0){var E=o;o+=v,t.timelineStart=p;var k=a;a+=f,n.push({event:t,start:p,end:y,playout:{start:k,end:a},integrated:{start:E,end:o}})}else{if(!(d<=r))return;if(!m){var b=d-s;if(b>.033){var T=s,S=o;o+=b;var _=a;a+=b;var A={previousEvent:e[i-1]||null,nextEvent:t,start:T,end:T+b,playout:{start:_,end:a},integrated:{start:S,end:o}};n.push(A)}else b>0&&c&&(c.cumulativeDuration+=b,n[n.length-1].end=d)}u&&(y=p),t.timelineStart=p;var L=o;o+=v;var w=a;a+=f,n.push({event:t,start:p,end:y,playout:{start:w,end:a},integrated:{start:L,end:o}})}var I=t.resumeTime;s=u||I>r?r:I}),s<r){var l,u=s,c=o,h=r-s;o+=h;var d=a;a+=h,n.push({previousEvent:(null==(l=n[n.length-1])?void 0:l.event)||null,nextEvent:null,start:s,end:u+h,playout:{start:d,end:a},integrated:{start:c,end:o}})}this.setDurations(r,a,o)}else n.push({previousEvent:null,nextEvent:null,start:0,end:r,playout:{start:0,end:r},integrated:{start:0,end:r}}),this.setDurations(r,r,r);return n}},{key:"setDurations",value:function(e,t,n){this.durations={primary:e,playout:t,integrated:n}}},{key:"resolveOffsets",value:function(e,t){var n=this,i=t.main.details,r=i.live?1/0:i.edge,a=0,s=-1;e.forEach(function(o,l){var u=o.cue.pre,c=o.cue.post,h=u?0:c?r:o.startTime;n.updateAssetDurations(o),s===h?o.cumulativeDuration=a:(a=0,s=h),!c&&o.snapOptions.in&&(o.resumeAnchor=tu(null,i.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted&&(n.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)),!o.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<.033&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&n.warn("Could not change append strategy for abutting event ".concat(o)));var d=R(o.resumeOffset)?o.resumeOffset:o.duration;a+=d})}},{key:"primaryCanResumeInPlaceAt",value:function(e,t){var n=this,i=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(i-r)>.025?(this.log('"'.concat(e.identifier,'" resumption ').concat(i," not aligned with estimated timeline end ").concat(r)),!1):!Object.keys(t).some(function(r){var a=t[r].details,s=a.edge;if(i>=s)return n.log('"'.concat(e.identifier,'" resumption ').concat(i," past ").concat(r," playlist end ").concat(s)),!1;var o=tu(null,a.fragments,i);if(!o)return n.log('"'.concat(e.identifier,'" resumption ').concat(i," does not align with any fragments in ").concat(r," playlist (").concat(a.fragStart,"-").concat(a.fragmentEnd,")")),!0;var l=.175*("audio"===r);return!(Math.abs(o.start-i)<.025+l||Math.abs(o.end-i)<.025+l)&&(n.log('"'.concat(e.identifier,'" resumption ').concat(i," not aligned with ").concat(r," fragment bounds (").concat(o.start,"-").concat(o.end," sn: ").concat(o.sn," cc: ").concat(o.cc,")")),!0)})}},{key:"updateAssetDurations",value:function(e){if(e.assetListLoaded){for(var t=e.timelineStart,n=0,i=!1,r=!1,a=0;a<e.assetList.length;a++){var s=e.assetList[a],o=t+n;s.startOffset=n,s.timelineStart=o,i||(i=null===s.duration),r||(r=!!s.error),n+=s.error?0:s.duration||0}i&&!r?e.duration=Math.max(n,e.duration):e.duration=n}}},{key:"removeEvent",value:function(e){e.reset(),delete this.eventMap[e.identifier]}}]),t}(z);function ap(e){return"[".concat(e.event?'"'+e.event.identifier+'"':"primary",": ").concat(e.start.toFixed(2),"-").concat(e.end.toFixed(2),"]")}var ay=function(){"use strict";function e(t){(0,E._)(this,e),this.hls=void 0,this.hls=t}return(0,k._)(e,[{key:"destroy",value:function(){this.hls=null}},{key:"loadAssetList",value:function(e,t){var n,i=this,r=e.assetListUrl;try{n=ad(r,this.hls.sessionId,e.baseUrl)}catch(t){var a=this.assignAssetListError(e,P.ASSET_LIST_LOAD_ERROR,t,r);this.hls.trigger(O.ERROR,a);return}t&&"data:"!==n.protocol&&n.searchParams.set("_HLS_start_offset",""+t);var s=this.hls.config,o=new s.loader(s),l={responseType:"json",url:n.href},u=s.interstitialAssetListLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0};return o.load(l,c,{onSuccess:function(t,n,r,a){var s=t.data;if(!Array.isArray(null==s?void 0:s.ASSETS)){var o=i.assignAssetListError(e,P.ASSET_LIST_PARSING_ERROR,Error("Invalid interstitial asset list"),r.url,n,a);i.hls.trigger(O.ERROR,o);return}e.assetListResponse=s,i.hls.trigger(O.ASSET_LIST_LOADED,{event:e,assetListResponse:s,networkDetails:a})},onError:function(t,n,r,a){var s=i.assignAssetListError(e,P.ASSET_LIST_LOAD_ERROR,Error("Error loading X-ASSET-LIST: HTTP status ".concat(t.code," ").concat(t.text," (").concat(n.url,")")),n.url,a,r);i.hls.trigger(O.ERROR,s)},onTimeout:function(t,n,r){var a=i.assignAssetListError(e,P.ASSET_LIST_LOAD_TIMEOUT,Error("Timeout loading X-ASSET-LIST (".concat(n.url,")")),n.url,t,r);i.hls.trigger(O.ERROR,a)}}),this.hls.trigger(O.ASSET_LIST_LOADING,{event:e}),o}},{key:"assignAssetListError",value:function(e,t,n,i,r,a){return e.error=n,{type:x.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:n,networkDetails:a,stats:r}}}]),e}();function aE(e){null==e||e.play().catch(function(){})}function ak(e,t){return"[".concat(e,"] Advancing timeline position to ").concat(t)}var ab=function(e){"use strict";function t(e,n){var i;return(0,E._)(this,t),(i=(0,y._)(this,t,["interstitials",e.logger])).HlsPlayerClass=void 0,i.hls=void 0,i.assetListLoader=void 0,i.mediaSelection=null,i.altSelection=null,i.media=null,i.detachedData=null,i.requiredTracks=null,i.manager=null,i.playerQueue=[],i.bufferedPos=-1,i.timelinePos=-1,i.schedule=void 0,i.playingItem=null,i.bufferingItem=null,i.waitingItem=null,i.endedItem=null,i.playingAsset=null,i.endedAsset=null,i.bufferingAsset=null,i.shouldPlay=!1,i.onPlay=function(){i.shouldPlay=!0},i.onPause=function(){i.shouldPlay=!1},i.onSeeking=function(){var e,t=i.currentTime;if(void 0!==t&&!i.playbackDisabled&&i.schedule){var n=t-i.timelinePos;if(!(Math.abs(n)<1/7056e5)){var r=n<=-.01;i.timelinePos=t,i.bufferedPos=t;var a=i.playingItem;if(!a)return void i.checkBuffer();if(r&&i.schedule.resetErrorsInRange(t,t-n)&&i.updateSchedule(!0),i.checkBuffer(),r&&t<a.start||t>=a.end){var s,o=i.findItemIndex(a),l=i.schedule.findItemIndexAtTime(t);if(-1===l&&(l=o+(r?-1:1),i.log("seeked ".concat(r?"back ":"","to position not covered by schedule ").concat(t," (resolving from ").concat(o," to ").concat(l,")"))),!i.isInterstitial(a)&&null!=(s=i.media)&&s.paused&&(i.shouldPlay=!1),!r&&l>o){var u=i.schedule.findJumpRestrictedIndex(o+1,l);if(u>o)return void i.setSchedulePosition(u)}i.setSchedulePosition(l);return}var c=i.playingAsset;if(!c){if(i.playingLastItem&&i.isInterstitial(a)){var h=a.event.assetList[0];h&&(i.endedItem=i.playingItem,i.playingItem=null,i.setScheduleToAssetAtTime(t,h))}return}var d=c.timelineStart,f=c.duration||0;(r&&t<d||t>=d+f)&&(null!=(e=a.event)&&e.appendInPlace&&(i.clearInterstitial(a.event,a),i.flushFrontBuffer(t)),i.setScheduleToAssetAtTime(t,c))}}},i.onTimeupdate=function(){var e=i.currentTime;if(void 0!==e&&!i.playbackDisabled&&e>i.timelinePos){i.timelinePos=e,e>i.bufferedPos&&i.checkBuffer();var t=i.playingItem;if(t&&!i.playingLastItem){if(e>=t.end){i.timelinePos=t.end;var n=i.findItemIndex(t);i.setSchedulePosition(n+1)}var r=i.playingAsset;r&&e>=r.timelineStart+(r.duration||0)&&i.setScheduleToAssetAtTime(e,r)}}},i.onScheduleUpdate=function(e,t){var n=i.schedule;if(n){var r=i.playingItem,a=n.events||[],s=n.items||[],o=n.durations,l=e.map(function(e){return e.identifier}),u=!!(a.length||l.length);(u||t)&&i.log("INTERSTITIALS_UPDATED (".concat(a.length,"): ").concat(a,"\nSchedule: ").concat(s.map(function(e){return ap(e)})," pos: ").concat(i.timelinePos)),l.length&&i.log("Removed events ".concat(l));var c=null,h=null;r&&(c=i.updateItem(r,i.timelinePos),i.itemsMatch(r,c)?i.playingItem=c:i.waitingItem=i.endedItem=null),i.waitingItem=i.updateItem(i.waitingItem),i.endedItem=i.updateItem(i.endedItem);var d=i.bufferingItem;if(d&&(h=i.updateItem(d,i.bufferedPos),i.itemsMatch(d,h)?i.bufferingItem=h:d.event&&(i.bufferingItem=i.playingItem,i.clearInterstitial(d.event,null))),e.forEach(function(e){e.assetList.forEach(function(e){i.clearAssetPlayer(e.identifier,null)})}),i.playerQueue.forEach(function(e){if(e.interstitial.appendInPlace){var t=e.assetItem.timelineStart,n=e.timelineOffset-t;if(n)try{e.timelineOffset=t}catch(r){Math.abs(n)>.025&&i.warn("".concat(r,' ("').concat(e.assetId,'" ').concat(e.timelineOffset,"->").concat(t,")"))}}}),u||t){if(i.hls.trigger(O.INTERSTITIALS_UPDATED,{events:a.slice(0),schedule:s.slice(0),durations:o,removedIds:l}),i.isInterstitial(r)&&l.includes(r.event.identifier)){i.warn('Interstitial "'.concat(r.event.identifier,'" removed while playing')),i.primaryFallback(r.event);return}r&&i.trimInPlace(c,r),d&&h!==c&&i.trimInPlace(h,d),i.checkBuffer()}}},i.hls=e,i.HlsPlayerClass=n,i.assetListLoader=new ay(e),i.schedule=new am(i.onScheduleUpdate,e.logger),i.registerListeners(),i}return(0,_._)(t,e),(0,k._)(t,[{key:"registerListeners",value:function(){var e=this.hls;e&&(e.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(O.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(O.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(O.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(O.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(O.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(O.BUFFER_APPENDED,this.onBufferAppended,this),e.on(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(O.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(O.MEDIA_ENDED,this.onMediaEnded,this),e.on(O.ERROR,this.onError,this),e.on(O.DESTROYING,this.onDestroying,this))}},{key:"unregisterListeners",value:function(){var e=this.hls;e&&(e.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(O.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(O.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(O.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(O.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(O.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(O.BUFFER_CODECS,this.onBufferCodecs,this),e.off(O.BUFFER_APPENDED,this.onBufferAppended,this),e.off(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(O.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(O.MEDIA_ENDED,this.onMediaEnded,this),e.off(O.ERROR,this.onError,this),e.off(O.DESTROYING,this.onDestroying,this))}},{key:"startLoad",value:function(){this.resumeBuffering()}},{key:"stopLoad",value:function(){this.pauseBuffering()}},{key:"resumeBuffering",value:function(){var e;null==(e=this.getBufferingPlayer())||e.resumeBuffering()}},{key:"pauseBuffering",value:function(){var e;null==(e=this.getBufferingPlayer())||e.pauseBuffering()}},{key:"destroy",value:function(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}},{key:"onDestroying",value:function(){var e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}},{key:"removeMediaListeners",value:function(e){nV(e,"play",this.onPlay),nV(e,"pause",this.onPause),nV(e,"seeking",this.onSeeking),nV(e,"timeupdate",this.onTimeupdate)}},{key:"onMediaAttaching",value:function(e,t){var n=this.media=t.media;nH(n,"seeking",this.onSeeking),nH(n,"timeupdate",this.onTimeupdate),nH(n,"play",this.onPlay),nH(n,"pause",this.onPause)}},{key:"onMediaAttached",value:function(e,t){var n=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,null===n)this.checkStart();else if(!i){this.clearScheduleState();var r=this.findItemIndex(n);this.setSchedulePosition(r)}}},{key:"clearScheduleState",value:function(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}},{key:"onMediaDetaching",value:function(e,t){var n=!!t.transferMedia,i=this.media;if(this.media=null,!n&&(i&&this.removeMediaListeners(i),this.detachedData)){var r=this.getBufferingPlayer();r&&(this.log("Removing schedule state for detachedData and ".concat(r)),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,r.detachMedia()),this.shouldPlay=!1}}},{key:"interstitialsManager",get:function(){if(!this.hls)return null;if(this.manager)return this.manager;var e=this,t=function(){return e.bufferingItem||e.waitingItem},n=function(t){return t?e.getAssetPlayer(t.identifier):t},i=function(t,i,r,s,o){if(t){var l=t[i].start,u=t.event;if(u){if("playout"===i||u.timelineOccupancy!==au.Point){var c=n(r);(null==c?void 0:c.interstitial)===u&&(l+=c.assetItem.startOffset+c[o])}}else l+=("bufferedPos"===s?a():e[s])-t.start;return l}return 0},r=function(t,n){var i;if(0!==t&&"primary"!==n&&null!=(i=e.schedule)&&i.length){var r,a=e.schedule.findItemIndexAtTime(t),s=null==(r=e.schedule.items)?void 0:r[a];if(s)return t+(s[n].start-s.start)}return t},a=function(){var t=e.bufferedPos;return t===Number.MAX_VALUE?s("primary"):Math.max(t,0)},s=function(t){var n,i;return null!=(n=e.primaryDetails)&&n.live?e.primaryDetails.edge:(null==(i=e.schedule)?void 0:i.durations[t])||0},o=function(t,r){var a,s,o=e.effectivePlayingItem;if((null==o||null==(a=o.event)||!a.restrictions.skip)&&e.schedule){e.log("seek to ".concat(t,' "').concat(r,'"'));var l=e.effectivePlayingItem,u=e.schedule.findItemIndexAtTime(t,r),c=null==(s=e.schedule.items)?void 0:s[u],h=e.getBufferingPlayer(),d=null==h?void 0:h.interstitial,f=null==d?void 0:d.appendInPlace,v=l&&e.itemsMatch(l,c);if(l&&(f||v)){var g=n(e.playingAsset),m=(null==g?void 0:g.media)||e.primaryMedia;if(m){var p="primary"===r?m.currentTime:i(l,r,e.playingAsset,"timelinePos","currentTime"),y=t-p,E=(f?p:m.currentTime)+y;if(E>=0&&(!g||f||E<=g.duration)){m.currentTime=E;return}}}if(c){var k=t;if("primary"!==r){var b=t-c[r].start;k=c.start+b}var T=!e.isInterstitial(c);if((!e.isInterstitial(l)||l.event.appendInPlace)&&(T||c.event.appendInPlace)){var S=e.media||(f?null==h?void 0:h.media:null);S&&(S.currentTime=k)}else if(l){var _=e.findItemIndex(l);if(u>_){var A=e.schedule.findJumpRestrictedIndex(_+1,u);if(A>_)return void e.setSchedulePosition(A)}var L=0;if(T)e.timelinePos=k,e.checkBuffer();else for(var w=c.event.assetList,I=t-(c[r]||c).start,R=w.length;R--;){var D=w[R];if(D.duration&&I>=D.startOffset&&I<D.startOffset+D.duration){L=R;break}}e.setSchedulePosition(u,L)}}}},l=function(){var n=e.effectivePlayingItem;if(e.isInterstitial(n))return n;var i=t();return e.isInterstitial(i)?i:null},u={get bufferedEnd(){var c,h=t(),d=e.bufferingItem;if(d&&d===h)return i(d,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-d.playout.start||(null==(c=e.bufferingAsset)?void 0:c.startOffset)||0;return 0},get currentTime(){var f=l(),v=e.effectivePlayingItem;if(v&&v===f)return i(v,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-v.playout.start;return 0},set currentTime(time){var g=l(),m=e.effectivePlayingItem;m&&m===g&&o(time+m.playout.start,"playout")},get duration(){var p=l();if(p)return p.playout.end-p.playout.start;return 0},get assetPlayers(){var y,E=null==(y=l())?void 0:y.event.assetList;if(E)return E.map(function(t){return e.getAssetPlayer(t.identifier)});return[]},get playingIndex(){var k,b=null==(k=l())?void 0:k.event;if(b&&e.effectivePlayingAsset)return b.findAssetIndex(e.effectivePlayingAsset);return -1},get scheduleItem(){return l()}};return this.manager={get events(){var T;return(null==(T=e.schedule)||null==(T=T.events)?void 0:T.slice(0))||[]},get schedule(){var S;return(null==(S=e.schedule)||null==(S=S.items)?void 0:S.slice(0))||[]},get interstitialPlayer(){if(l())return u;return null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){var _=t();return e.findItemIndex(_)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){var A=e.effectivePlayingItem;return e.findItemIndex(A)},primary:{get bufferedEnd(){return a()},get currentTime(){var L=e.timelinePos;return L>0?L:0},set currentTime(time){o(time,"primary")},get duration(){return s("primary")},get seekableStart(){var w;return(null==(w=e.primaryDetails)?void 0:w.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(time){o(time,"integrated")},get duration(){return s("integrated")},get seekableStart(){var I;return r((null==(I=e.primaryDetails)?void 0:I.fragmentStart)||0,"integrated")}},skip:function(){var t=e.effectivePlayingItem,n=null==t?void 0:t.event;if(n&&!n.restrictions.skip){var i=e.findItemIndex(t);n.appendInPlace?o(t.playout.start+t.event.duration+.001,"playout"):e.advanceAfterAssetEnded(n,i,1/0)}}}}},{key:"effectivePlayingItem",get:function(){return this.waitingItem||this.playingItem||this.endedItem}},{key:"effectivePlayingAsset",get:function(){return this.playingAsset||this.endedAsset}},{key:"playingLastItem",get:function(){var e,t=this.playingItem,n=null==(e=this.schedule)?void 0:e.items;return!!this.playbackStarted&&!!t&&!!n&&this.findItemIndex(t)===n.length-1}},{key:"playbackStarted",get:function(){return null!==this.effectivePlayingItem}},{key:"currentTime",get:function(){if(null!==this.mediaSelection){var e,t,n=this.waitingItem||this.playingItem;if(!this.isInterstitial(n)||n.event.appendInPlace){var i=this.media;!i&&null!=(e=this.bufferingItem)&&null!=(e=e.event)&&e.appendInPlace&&(i=this.primaryMedia);var r=null==(t=i)?void 0:t.currentTime;if(void 0!==r&&R(r))return r}}}},{key:"primaryMedia",get:function(){var e;return this.media||(null==(e=this.detachedData)?void 0:e.media)||null}},{key:"isInterstitial",value:function(e){return!!(null!=e&&e.event)}},{key:"retreiveMediaSource",value:function(e,t){var n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}},{key:"transferMediaFromPlayer",value:function(e,t){var n=e.interstitial.appendInPlace,i=e.media;if(n&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i){this.detachedData={media:i};return}var r=e.transferMedia();this.log("transfer MediaSource from ".concat(e," ").concat(e9(r))),this.detachedData=r}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}},{key:"transferMediaTo",value:function(e,t){var n,i,r,a=this;if(e.media!==t){var s=null,o=this.hls,l=e!==o,u=l&&e.interstitial.appendInPlace,c=null==(n=this.detachedData)?void 0:n.mediaSource;if(o.media)u&&(s=o.transferMedia(),this.detachedData=s),r="Primary";else if(c){var h=this.getBufferingPlayer();h?(s=h.transferMedia(),r="".concat(h)):r="detached MediaSource"}else r="detached media";if(!s){if(c)s=this.detachedData,this.log("using detachedData: MediaSource ".concat(e9(s)));else if(!this.detachedData||o.media===t){var d=this.playerQueue;d.length>1&&d.forEach(function(e){if(l&&e.interstitial.appendInPlace!==u){var t=e.interstitial;a.clearInterstitial(e.interstitial,null),t.appendInPlace=!1,t.appendInPlace&&a.warn("Could not change append strategy for queued assets ".concat(t))}}),this.hls.detachMedia(),this.detachedData={media:t}}}var f=s&&"mediaSource"in s&&(null==(i=s.mediaSource)?void 0:i.readyState)!=="closed",v=f&&s?s:t;this.log("".concat(f?"transfering MediaSource":"attaching media"," to ").concat(l?e:"Primary"," from ").concat(r," (media.currentTime: ").concat(t.currentTime,")"));var g=this.schedule;if(v===s&&g){var m=l&&e.assetId===g.assetIdAtEnd;v.overrides={duration:g.duration,endOfStream:!l||m,cueRemoval:!l}}e.attachMedia(v)}}},{key:"onInterstitialCueEnter",value:function(){this.onTimeupdate()}},{key:"checkStart",value:function(){var e=this.schedule,t=null==e?void 0:e.events;if(t&&!this.playbackDisabled&&this.media){-1===this.bufferedPos&&(this.bufferedPos=0);var n=this.timelinePos,i=this.effectivePlayingItem;if(-1===n){var r=this.hls.startPosition;if(this.log(ak("checkStart",r)),this.timelinePos=r,t.length&&t[0].cue.pre){var a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(r>=0||!this.primaryLive){var s=this.timelinePos=r>0?r:0,o=e.findItemIndexAtTime(s);this.setSchedulePosition(o)}}else if(i&&!this.playingItem){var l=e.findItemIndex(i);this.setSchedulePosition(l)}}}},{key:"advanceAssetBuffering",value:function(e,t){var n=e.event,i=n.findAssetIndex(t),r=af(n,i);if(n.isAssetPastPlayoutLimit(r)){if(this.schedule){var a,s=null==(a=this.schedule.items)?void 0:a[this.findItemIndex(e)+1];s&&this.bufferedToItem(s)}}else this.bufferedToEvent(e,r)}},{key:"advanceAfterAssetEnded",value:function(e,t,n){var i=af(e,n);if(e.isAssetPastPlayoutLimit(i)){if(this.schedule){var r=this.schedule.items;if(r){var a=t+1;if(a>=r.length)return void this.setSchedulePosition(-1);var s=e.resumeTime;this.timelinePos<s&&(this.log(ak("advanceAfterAssetEnded",s)),this.timelinePos=s,e.appendInPlace&&this.advanceInPlace(s),this.checkBuffer(this.bufferedPos<s)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){var o=e.assetList[i];o&&this.advanceInPlace(o.timelineStart)}this.setSchedulePosition(t,i)}}},{key:"setScheduleToAssetAtTime",value:function(e,t){var n=this.schedule;if(n){var i=t.parentIdentifier,r=n.getEvent(i);if(r){var a=n.findEventIndex(i),s=n.findAssetIndex(r,e);this.advanceAfterAssetEnded(r,a,s-1)}}}},{key:"setSchedulePosition",value:function(e,t){var n=null==(c=this.schedule)?void 0:c.items;if(n&&!this.playbackDisabled){var i=e>=0?n[e]:null;this.log("setSchedulePosition ".concat(e,", ").concat(t," (").concat(i?ap(i):i,") pos: ").concat(this.timelinePos));var r=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(r)){var s=r.event,o=this.playingAsset,l=null==o?void 0:o.identifier,u=l?this.getAssetPlayer(l):null;if(u&&l&&(!this.eventItemsMatch(r,i)||void 0!==t&&l!==s.assetList[t].identifier)){var c,h,d=s.findAssetIndex(o);if(this.log("INTERSTITIAL_ASSET_ENDED ".concat(d+1,"/").concat(s.assetList.length," ").concat(av(o))),this.endedAsset=o,this.playingAsset=null,this.hls.trigger(O.INTERSTITIAL_ASSET_ENDED,{asset:o,assetListIndex:d,event:s,schedule:n.slice(0),scheduleIndex:e,player:u}),r!==this.playingItem){this.itemsMatch(r,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(s,this.findItemIndex(this.playingItem),d);return}this.retreiveMediaSource(l,i),u.media&&!(null!=(h=this.detachedData)&&h.mediaSource)&&u.detachMedia()}if(!this.eventItemsMatch(r,i)&&(this.endedItem=r,this.playingItem=null,this.log("INTERSTITIAL_ENDED ".concat(s," ").concat(ap(r))),s.hasPlayed=!0,this.hls.trigger(O.INTERSTITIAL_ENDED,{event:s,schedule:n.slice(0),scheduleIndex:e}),s.cue.once)){this.updateSchedule();var f,v=null==(f=this.schedule)?void 0:f.items;if(i&&v){var g=this.findItemIndex(i);this.advanceSchedule(g,v,t,r,a)}return}}this.advanceSchedule(e,n,t,r,a)}}},{key:"advanceSchedule",value:function(e,t,n,i,r){var a=this,s=this.schedule;if(s){var o=t[e]||null,l=this.primaryMedia,u=this.playerQueue;if(u.length&&u.forEach(function(t){var n=t.interstitial,i=s.findEventIndex(n.identifier);(i<e||i>e+1)&&a.clearInterstitial(n,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);var c=o.event;if(void 0===n){n=s.findAssetIndex(c,this.timelinePos);var h=af(c,n-1);if(c.isAssetPastPlayoutLimit(h)||c.appendInPlace&&this.timelinePos===o.end)return void this.advanceAfterAssetEnded(c,e,n);n=h}var d=this.waitingItem;this.assetsBuffered(o,l)||this.setBufferingItem(o);var f=this.preloadAssets(c,n);if(this.eventItemsMatch(o,d||i)||(this.waitingItem=o,this.log("INTERSTITIAL_STARTED ".concat(ap(o)," ").concat(c.appendInPlace?"append in place":"")),this.hls.trigger(O.INTERSTITIAL_STARTED,{event:c,schedule:t.slice(0),scheduleIndex:e})),!c.assetListLoaded)return void this.log("Waiting for ASSET-LIST to complete loading ".concat(c));if(c.assetListLoader&&(c.assetListLoader.destroy(),c.assetListLoader=void 0),!l)return void this.log("Waiting for attachMedia to start Interstitial ".concat(c));this.waitingItem=this.endedItem=null,this.playingItem=o;var v=c.assetList[n];if(!v)return void this.advanceAfterAssetEnded(c,e,n||0);if(f||(f=this.getAssetPlayer(v.identifier)),null===f||f.destroyed){var g=c.assetList.length;this.warn("asset ".concat(n+1,"/").concat(g," player destroyed ").concat(c)),(f=this.createAssetPlayer(c,v,n)).loadSource()}if(!this.eventItemsMatch(o,this.bufferingItem)&&c.appendInPlace&&this.isAssetBuffered(v))return;this.startAssetPlayer(f,n,t,e,l),this.shouldPlay&&aE(f.media)}else o?(this.resumePrimary(o,e,i),this.shouldPlay&&aE(this.hls.media)):r&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(s.durations.primary,null))}}},{key:"playbackDisabled",get:function(){return!1===this.hls.config.enableInterstitialPlayback}},{key:"primaryDetails",get:function(){var e;return null==(e=this.mediaSelection)?void 0:e.main.details}},{key:"primaryLive",get:function(){var e;return!!(null!=(e=this.primaryDetails)&&e.live)}},{key:"resumePrimary",value:function(e,t,n){if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log("resuming ".concat(ap(e))),!(null!=(i=this.detachedData)&&i.mediaSource)){var i,r,a=this.timelinePos;(a<e.start||a>=e.end)&&(a=this.getPrimaryResumption(e,t),this.log(ak("resumePrimary",a)),this.timelinePos=a),this.attachPrimary(a,e)}if(n){var s=null==(r=this.schedule)?void 0:r.items;s&&(this.log("INTERSTITIALS_PRIMARY_RESUMED ".concat(ap(e))),this.hls.trigger(O.INTERSTITIALS_PRIMARY_RESUMED,{schedule:s.slice(0),scheduleIndex:t}),this.checkBuffer())}}},{key:"getPrimaryResumption",value:function(e,t){var n=e.start;if(this.primaryLive){var i=this.primaryDetails;if(0===t)return this.hls.startPosition;if(i&&(n<i.fragmentStart||n>i.edge))return this.hls.liveSyncPosition||-1}return n}},{key:"isAssetBuffered",value:function(e){var t=this.getAssetPlayer(e.identifier);return null!=t&&t.hls?t.hls.bufferedToEnd:tG.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}},{key:"attachPrimary",value:function(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;var i=this.primaryMedia;if(i){var r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,i),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(ak("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}}},{key:"startLoadingPrimaryAt",value:function(e,t){var n,i=this.hls;!i.loadingEnabled||!i.media||Math.abs(((null==(n=i.mainForwardBufferInfo)?void 0:n.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}},{key:"onManifestLoading",value:function(){var e;this.stopLoad(),null==(e=this.schedule)||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(O.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(O.BUFFER_CODECS,this.onBufferCodecs,this)}},{key:"onLevelUpdated",value:function(e,t){if(-1!==t.level&&this.schedule){var n=this.hls.levels[t.level];if(n.details){var i=W(W({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}}}},{key:"onAudioTrackUpdated",value:function(e,t){var n=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=W(W({},this.altSelection),{},{audio:n});return}var r=W(W({},i),{},{audio:n});this.mediaSelection=r}},{key:"onSubtitleTrackUpdated",value:function(e,t){var n=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=W(W({},this.altSelection),{},{subtitles:n});return}var r=W(W({},i),{},{subtitles:n});this.mediaSelection=r}},{key:"onAudioTrackSwitching",value:function(e,t){var n=tt(t);this.playerQueue.forEach(function(e){var i=e.hls;return i&&(i.setAudioOption(t)||i.setAudioOption(n))})}},{key:"onSubtitleTrackSwitch",value:function(e,t){var n=tt(t);this.playerQueue.forEach(function(e){var i=e.hls;return i&&(i.setSubtitleOption(t)||-1!==t.id&&i.setSubtitleOption(n))})}},{key:"onBufferCodecs",value:function(e,t){var n=t.tracks;n&&(this.requiredTracks=n)}},{key:"onBufferAppended",value:function(e,t){this.checkBuffer()}},{key:"onBufferFlushed",value:function(e,t){var n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){var i=this.timelinePos;this.bufferedPos=i,this.checkBuffer()}}},{key:"onBufferedToEnd",value:function(e){if(this.schedule){var t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(var n=0;n<t.length;n++){var i=t[n];if(i.cue.post){var r,a=this.schedule.findEventIndex(i.identifier),s=null==(r=this.schedule.items)?void 0:r[a];this.isInterstitial(s)&&this.eventItemsMatch(s,this.bufferingItem)&&this.bufferedToItem(s,0);break}}this.bufferedPos=Number.MAX_VALUE}}}},{key:"onMediaEnded",value:function(e){var t=this.playingItem;if(!this.playingLastItem&&t){var n=this.findItemIndex(t);this.setSchedulePosition(n+1)}else this.shouldPlay=!1}},{key:"updateItem",value:function(e,t){var n,i=null==(n=this.schedule)?void 0:n.items;return e&&i&&i[this.findItemIndex(e,t)]||null}},{key:"trimInPlace",value:function(e,t){var n=this;if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach(function(t,i){e.event.isAssetPastPlayoutLimit(i)&&n.clearAssetPlayer(t.identifier,null)});var i=e.end+.25,r=tG.bufferInfo(this.primaryMedia,i,0);(r.end>i||(r.nextStart||0)>i)&&(this.log("trim buffered interstitial ".concat(ap(e)," (was ").concat(ap(t),")")),this.attachPrimary(i,null,!0),this.flushFrontBuffer(i))}}},{key:"itemsMatch",value:function(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}},{key:"eventItemsMatch",value:function(e,t){var n;return!!t&&(e===t||e.event.identifier===(null==(n=t.event)?void 0:n.identifier))}},{key:"findItemIndex",value:function(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}},{key:"updateSchedule",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.mediaSelection;n&&(null==(e=this.schedule)||e.updateSchedule(n,[],t))}},{key:"checkBuffer",value:function(e){var t,n=null==(t=this.schedule)?void 0:t.items;if(n){var i=tG.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,n,e)}}},{key:"updateBufferedPos",value:function(e,t,n){var i=this.schedule,r=this.bufferingItem;if(!(this.bufferedPos>e)&&i){if(1===t.length&&this.itemsMatch(t[0],r)){this.bufferedPos=e;return}var a=this.playingItem,s=this.findItemIndex(a),o=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var l,u=this.findItemIndex(r),c=Math.min(u+1,t.length-1),h=t[c];if((-1===o&&r&&e>=r.end||null!=(l=h.event)&&l.appendInPlace&&e+.01>=h.start)&&(o=c),this.isInterstitial(r)){var d=r.event;if(c-s>1&&!1===d.appendInPlace||0===d.assetList.length&&d.assetListLoader)return}if(this.bufferedPos=e,o>u&&o>s)this.bufferedToItem(h);else{var f=this.primaryDetails;this.primaryLive&&f&&e>f.edge-f.targetduration&&h.start<f.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(h)&&this.preloadAssets(h.event,0)}}else n&&a&&!this.itemsMatch(a,r)&&(o===s?this.bufferedToItem(a):o===s+1&&this.bufferedToItem(t[o]))}}},{key:"assetsBuffered",value:function(e,t){var n=this;return 0!==e.event.assetList.length&&!e.event.assetList.some(function(e){var i=n.getAssetPlayer(e.identifier);return!(null!=i&&i.bufferedInPlaceToEnd(t))})}},{key:"setBufferingItem",value:function(e){var t=this,n=this.bufferingItem,i=this.schedule;if(!this.itemsMatch(e,n)&&i){var r=i.items,a=i.events;if(!r||!a)return n;var s=this.isInterstitial(e),o=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));var l=o?o.remaining:n?n.end-this.timelinePos:0;if(this.log("INTERSTITIALS_BUFFERED_TO_BOUNDARY ".concat(ap(e))+(n?" (".concat(l.toFixed(2)," remaining)"):"")),!this.playbackDisabled)if(s){var u=i.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach(function(e,n){var i=t.getAssetPlayer(e.identifier);i&&(n===u&&i.loadSource(),i.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(function(e){return e.pauseBuffering()});this.hls.trigger(O.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:a.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return n}},{key:"bufferedToItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(null!==n){this.bufferingAsset=null;var i=this.detachedData;i&&i.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e)}}}},{key:"preloadPrimary",value:function(e){var t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}},{key:"bufferedToEvent",value:function(e,t){var n=e.event,i=0===n.assetList.length&&!n.assetListLoader,r=n.cue.once;if(i||!r){var a=this.preloadAssets(n,t);if(null!=a&&a.interstitial.appendInPlace){var s=this.primaryMedia;s&&this.bufferAssetPlayer(a,s)}}}},{key:"preloadAssets",value:function(e,t){var n=e.assetUrl,i=e.assetList.length,r=0===i&&!e.assetListLoader,a=e.cue.once;if(r){var s,o=e.timelineStart;if(e.appendInPlace){var l,u=this.playingItem;this.isInterstitial(u)||(null==u||null==(l=u.nextEvent)?void 0:l.identifier)!==e.identifier||this.flushFrontBuffer(o+.25)}var c=0;if(!this.playingItem&&this.primaryLive&&-1===(c=this.hls.startPosition)&&(c=this.hls.liveSyncPosition||0),c&&!(e.cue.pre||e.cue.post)){var h=c-o;h>0&&(s=Math.round(1e3*h)/1e3)}if(this.log("Load interstitial asset ".concat(t+1,"/").concat(n?1:i," ").concat(e).concat(s?" live-start: ".concat(c," start-offset: ").concat(s):"")),n)return this.createAsset(e,0,0,o,e.duration,n);var d=this.assetListLoader.loadAssetList(e,s);d&&(e.assetListLoader=d)}else if(!a&&i){for(var f=t;f<i;f++){var v=e.assetList[f],g=this.getAssetPlayerQueueIndex(v.identifier);(-1===g||this.playerQueue[g].destroyed)&&!v.error&&this.createAssetPlayer(e,v,f)}var m=e.assetList[t];if(m){var p=this.getAssetPlayer(m.identifier);return p&&p.loadSource(),p}}return null}},{key:"flushFrontBuffer",value:function(e){var t=this,n=this.requiredTracks;n&&(this.log("Removing front buffer starting at ".concat(e)),Object.keys(n).forEach(function(n){t.hls.trigger(O.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:n})}))}},{key:"getAssetPlayerQueueIndex",value:function(e){for(var t=this.playerQueue,n=0;n<t.length;n++)if(e===t[n].assetId)return n;return -1}},{key:"getAssetPlayer",value:function(e){var t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}},{key:"getBufferingPlayer",value:function(){var e=this.playerQueue,t=this.primaryMedia;if(t){for(var n=0;n<e.length;n++)if(e[n].media===t)return e[n]}return null}},{key:"createAsset",value:function(e,t,n,i,r,a){var s={parentIdentifier:e.identifier,identifier:"".concat(e.identifier,"-").concat(t+1,"-").concat(al(a)),duration:r,startOffset:n,timelineStart:i,uri:a};return this.createAssetPlayer(e,s,t)}},{key:"createAssetPlayer",value:function(e,t,n){var i=this,r=this.hls,a=r.userConfig,s=a.videoPreference,o=r.loadLevelObj||r.levels[r.currentLevel];(s||o)&&(s=q({},s),o.videoCodec&&(s.videoCodec=o.videoCodec),o.videoRange&&(s.allowedVideoRanges=[o.videoRange]));var l=r.audioTracks[r.audioTrack],u=r.subtitleTracks[r.subtitleTrack],c=0;if(this.primaryLive||e.appendInPlace){var h=this.timelinePos-t.timelineStart;if(h>1){var d=t.duration;d&&h<d&&(c=h)}}var f=t.identifier,v=W(W({},a),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:f,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:s,audioPreference:l||a.audioPreference,subtitlePreference:u||a.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(v.timelineOffset=t.timelineStart));var g=v.cmcd;null!=g&&g.sessionId&&g.contentId&&(v.cmcd=q({},g,{contentId:al(t.uri)})),this.getAssetPlayer(f)&&this.warn("Duplicate date range identifier ".concat(e," and asset ").concat(f));var m=new ag(this.HlsPlayerClass,v,e,t);this.playerQueue.push(m),e.assetList[n]=t;var p=!0,y=function(r){if(r.live){var a,s=Error("Interstitials MUST be VOD assets ".concat(e)),o={fatal:!0,type:x.OTHER_ERROR,details:P.INTERSTITIAL_ASSET_ITEM_ERROR,error:s},l=(null==(a=i.schedule)?void 0:a.findEventIndex(e.identifier))||-1;i.handleAssetItemError(o,e,l,n,s.message);return}var u=r.edge-r.fragmentStart,c=t.duration;(p||null===c||u>c)&&(p=!1,i.log('Interstitial asset "'.concat(f,'" duration change ').concat(c," > ").concat(u)),t.duration=u,i.updateSchedule())};m.on(O.LEVEL_UPDATED,function(e,t){return y(t.details)}),m.on(O.LEVEL_PTS_UPDATED,function(e,t){return y(t.details)}),m.on(O.EVENT_CUE_ENTER,function(){return i.onInterstitialCueEnter()});var E=function(e,t){var n=i.getAssetPlayer(f);if(n&&t.tracks){n.off(O.BUFFER_CODECS,E),n.tracks=t.tracks;var r=i.primaryMedia;i.bufferingAsset===n.assetItem&&r&&!n.media&&i.bufferAssetPlayer(n,r)}};m.on(O.BUFFER_CODECS,E),m.on(O.BUFFERED_TO_END,function(){var n,r=i.getAssetPlayer(f);if(i.log("buffered to end of asset ".concat(r)),r&&i.schedule){var a=i.schedule.findEventIndex(e.identifier),s=null==(n=i.schedule.items)?void 0:n[a];i.isInterstitial(s)&&i.advanceAssetBuffering(s,t)}});var k=function(t){return function(){if(i.getAssetPlayer(f)&&i.schedule){i.shouldPlay=!0;var n=i.schedule.findEventIndex(e.identifier);i.advanceAfterAssetEnded(e,n,t)}}};return m.once(O.MEDIA_ENDED,k(n)),m.once(O.PLAYOUT_LIMIT_REACHED,k(1/0)),m.on(O.ERROR,function(t,r){if(i.schedule){var a=i.getAssetPlayer(f);if(r.details===P.BUFFER_STALLED_ERROR)return null!=a&&a.appendInPlace?void i.handleInPlaceStall(e):(i.onTimeupdate(),void i.checkBuffer(!0));i.handleAssetItemError(r,e,i.schedule.findEventIndex(e.identifier),n,"Asset player error ".concat(r.error," ").concat(e))}}),m.on(O.DESTROYING,function(){if(i.getAssetPlayer(f)&&i.schedule){var t=Error("Asset player destroyed unexpectedly ".concat(f)),r={fatal:!0,type:x.OTHER_ERROR,details:P.INTERSTITIAL_ASSET_ITEM_ERROR,error:t};i.handleAssetItemError(r,e,i.schedule.findEventIndex(e.identifier),n,t.message)}}),this.log("INTERSTITIAL_ASSET_PLAYER_CREATED ".concat(av(t))),this.hls.trigger(O.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:m}),m}},{key:"clearInterstitial",value:function(e,t){var n=this;e.assetList.forEach(function(e){n.clearAssetPlayer(e.identifier,t)}),e.reset()}},{key:"resetAssetPlayer",value:function(e){var t=this.getAssetPlayerQueueIndex(e);if(-1!==t){this.log('reset asset player "'.concat(e,'" after error'));var n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}},{key:"clearAssetPlayer",value:function(e,t){var n=this.getAssetPlayerQueueIndex(e);if(-1!==n){var i=this.playerQueue[n];this.log("clear ".concat(i," toSegment: ").concat(t?ap(t):t)),this.transferMediaFromPlayer(i,t),this.playerQueue.splice(n,1),i.destroy()}}},{key:"emptyPlayerQueue",value:function(){for(var e;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}},{key:"startAssetPlayer",value:function(e,t,n,i,r){var a=e.interstitial,s=e.assetItem,o=e.assetId,l=a.assetList.length,u=this.playingAsset;this.endedAsset=null,this.playingAsset=s,u&&u.identifier===o||(u&&(this.clearAssetPlayer(u.identifier,n[i]),delete u.error),this.log("INTERSTITIAL_ASSET_STARTED ".concat(t+1,"/").concat(l," ").concat(av(s))),this.hls.trigger(O.INTERSTITIAL_ASSET_STARTED,{asset:s,assetListIndex:t,event:a,schedule:n.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,r)}},{key:"bufferAssetPlayer",value:function(e,t){if(!this.schedule)return;var n,i,r=e.interstitial,a=e.assetItem,s=this.schedule.findEventIndex(r.identifier),o=null==(n=this.schedule.items)?void 0:n[s];if(o){e.loadSource(),this.setBufferingItem(o),this.bufferingAsset=a;var l=this.getBufferingPlayer();if(l!==e){var u=r.appendInPlace;if(!u||(null==l?void 0:l.interstitial.appendInPlace)!==!1){var c=(null==l?void 0:l.tracks)||(null==(i=this.detachedData)?void 0:i.tracks)||this.requiredTracks;if(u&&a!==this.playingAsset){if(!e.tracks)return void this.log("Waiting for track info before buffering ".concat(e));if(c&&!et(c,e.tracks)){var h=Error("Asset ".concat(av(a)," SourceBuffer tracks ('").concat(Object.keys(e.tracks),"') are not compatible with primary content tracks ('").concat(Object.keys(c),"')")),d={fatal:!0,type:x.OTHER_ERROR,details:P.INTERSTITIAL_ASSET_ITEM_ERROR,error:h},f=r.findAssetIndex(a);this.handleAssetItemError(d,r,s,f,h.message);return}}this.transferMediaTo(e,t)}}}}},{key:"handleInPlaceStall",value:function(e){var t=this.schedule,n=this.primaryMedia;if(t&&n){var i=n.currentTime,r=t.findAssetIndex(e,i),a=e.assetList[r];if(a){var s=this.getAssetPlayer(a.identifier);if(s){var o=s.currentTime||i-a.timelineStart,l=s.duration-o;if(this.warn("Stalled at ".concat(o," of ").concat(o+l," in ").concat(s," ").concat(e," (media.currentTime: ").concat(i,")")),o&&(l/n.playbackRate<.5||s.bufferedInPlaceToEnd(n))&&s.hls){var u=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,u,r)}}}}}},{key:"advanceInPlace",value:function(e){var t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}},{key:"handleAssetItemError",value:function(e,t,n,i,r){if(e.details!==P.BUFFER_STALLED_ERROR){var a=t.assetList[i]||null;if(this.warn("INTERSTITIAL_ASSET_ERROR ".concat(a?av(a):a," ").concat(e.error)),this.schedule){var s=(null==a?void 0:a.identifier)||"",o=this.getAssetPlayerQueueIndex(s),l=this.playerQueue[o]||null,u=this.schedule.items,c=q({},e,{fatal:!1,errorAction:tb(!0),asset:a,assetListIndex:i,event:t,schedule:u,scheduleIndex:n,player:l});if(this.hls.trigger(O.INTERSTITIAL_ASSET_ERROR,c),e.fatal){var h=this.playingAsset,d=this.bufferingAsset,f=Error(r);if(a&&(this.clearAssetPlayer(s,null),a.error=f),t.assetList.some(function(e){return!e.error}))for(var v=i;v<t.assetList.length;v++)this.resetAssetPlayer(t.assetList[v].identifier);else t.error=f;this.updateSchedule(!0),t.error?this.primaryFallback(t):h&&h.identifier===s?this.advanceAfterAssetEnded(t,n,i):d&&d.identifier===s&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,d)}}}}},{key:"primaryFallback",value:function(e){var t=e.timelineStart,n=this.effectivePlayingItem;if(n){this.log('Fallback to primary from event "'.concat(e.identifier,'" start: ').concat(t," pos: ").concat(this.timelinePos," playing: ").concat(ap(n)," error: ").concat(e.error));var i=this.timelinePos;-1===i&&(i=this.hls.startPosition);var r=this.updateItem(n,i);if(this.itemsMatch(n,r)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t)),!this.schedule)return;var a=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(a)}else this.checkStart()}},{key:"onAssetListLoaded",value:function(e,t){var n=this,i=t.event,r=i.identifier,a=t.assetListResponse.ASSETS;if(null!=(d=this.schedule)&&d.hasEvent(r)){var s=i.timelineStart,o=i.duration,l=0;a.forEach(function(e,t){var r=parseFloat(e.DURATION);n.createAsset(i,t,l,s+l,r,e.URI),l+=r}),i.duration=l,this.log("Loaded asset-list with duration: ".concat(l," (was: ").concat(o,") ").concat(i));var u=this.waitingItem,c=(null==u?void 0:u.event.identifier)===r;this.updateSchedule();var h=null==(f=this.bufferingItem)?void 0:f.event;if(c){var d,f,v,g=this.schedule.findEventIndex(r),m=null==(v=this.schedule.items)?void 0:v[g];if(m){if(!this.playingItem&&this.timelinePos>m.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==g){i.error=Error("Interstitial no longer within playback range ".concat(this.timelinePos," ").concat(i)),this.updateSchedule(!0),this.primaryFallback(i);return}this.setBufferingItem(m)}this.setSchedulePosition(g)}else if((null==h?void 0:h.identifier)===r){var p=i.assetList[0];if(p){var y=this.getAssetPlayer(p.identifier);if(h.appendInPlace){var E=this.primaryMedia;y&&E&&this.bufferAssetPlayer(y,E)}else y&&y.loadSource()}}}}},{key:"onError",value:function(e,t){if(this.schedule)switch(t.details){case P.ASSET_LIST_PARSING_ERROR:case P.ASSET_LIST_LOAD_ERROR:case P.ASSET_LIST_LOAD_TIMEOUT:var n=t.interstitial;n&&(this.updateSchedule(!0),this.primaryFallback(n));break;case P.BUFFER_STALLED_ERROR:var i=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&i.event.appendInPlace)return void this.handleInPlaceStall(i.event);this.log("Primary player stall @".concat(this.timelinePos," bufferedPos: ").concat(this.bufferedPos)),this.onTimeupdate(),this.checkBuffer(!0)}}}]),t}(z),aT=function(e){"use strict";function t(e,n,i){var r;return(0,E._)(this,t),(r=(0,y._)(this,t,[e,n,i,"subtitle-stream-controller",K])).currentTrackId=-1,r.tracksBuffered=[],r.mainDetails=null,r.registerListeners(),r}return(0,_._)(t,e),(0,k._)(t,[{key:"onHandlerDestroying",value:function(){this.unregisterListeners(),(0,T._)((0,S._)(t.prototype),"onHandlerDestroying",this).call(this),this.mainDetails=null}},{key:"registerListeners",value:function(){(0,T._)((0,S._)(t.prototype),"registerListeners",this).call(this);var e=this.hls;e.on(O.LEVEL_LOADED,this.onLevelLoaded,this),e.on(O.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(O.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(O.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(O.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(O.BUFFER_FLUSHING,this.onBufferFlushing,this)}},{key:"unregisterListeners",value:function(){(0,T._)((0,S._)(t.prototype),"unregisterListeners",this).call(this);var e=this.hls;e.off(O.LEVEL_LOADED,this.onLevelLoaded,this),e.off(O.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(O.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(O.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(O.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(O.BUFFER_FLUSHING,this.onBufferFlushing,this)}},{key:"startLoad",value:function(e,t){this.stopLoad(),this.state=nW,this.setInterval(500),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}},{key:"onManifestLoading",value:function(){(0,T._)((0,S._)(t.prototype),"onManifestLoading",this).call(this),this.mainDetails=null}},{key:"onMediaDetaching",value:function(e,n){this.tracksBuffered=[],(0,T._)((0,S._)(t.prototype),"onMediaDetaching",this).call(this,e,n)}},{key:"onLevelLoaded",value:function(e,t){this.mainDetails=t.details}},{key:"onSubtitleFragProcessed",value:function(e,t){var n,i=t.frag,r=t.success;if(this.fragContextChanged(i)||(ed(i)&&(this.fragPrevious=i),this.state=nW),r){var a=this.tracksBuffered[this.currentTrackId];if(a){for(var s=i.start,o=0;o<a.length;o++)if(s>=a[o].start&&s<=a[o].end){n=a[o];break}var l=i.start+i.duration;n?n.end=l:(n={start:s,end:l},a.push(n)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}}}},{key:"onBufferFlushing",value:function(e,t){var n=t.startOffset,i=t.endOffset;if(0===n&&i!==1/0){var r=i-1;if(r<=0)return;t.endOffsetSubtitles=Math.max(0,r),this.tracksBuffered.forEach(function(e){for(var t=0;t<e.length;){if(e[t].end<=r){e.shift();continue}if(e[t].start<r)e[t].start=r;else break;t++}}),this.fragmentTracker.removeFragmentsInRange(n,r,K)}}},{key:"onError",value:function(e,t){var n=t.frag;(null==n?void 0:n.type)===K&&(t.details===P.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==nY&&(this.state=nW))}},{key:"onSubtitleTracksUpdated",value:function(e,t){var n=this,i=t.subtitleTracks;if(this.levels&&rc(this.levels,i)){this.levels=i.map(function(e){return new e4(e)});return}this.tracksBuffered=[],this.levels=i.map(function(e){var t=new e4(e);return n.tracksBuffered[t.id]=[],t}),this.fragmentTracker.removeFragmentsInRange(0,1/0,K),this.fragPrevious=null,this.mediaBuffer=null}},{key:"onSubtitleTrackSwitch",value:function(e,t){if(this.currentTrackId=t.id,!(null!=(n=this.levels)&&n.length)||-1===this.currentTrackId)return void this.clearInterval();var n,i=this.levels[this.currentTrackId];null!=i&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==nY&&this.setInterval(500)}},{key:"onSubtitleTrackLoaded",value:function(e,t){var n=this.currentTrackId,i=this.levels,r=t.details,a=t.id;if(!i)return void this.warn("Subtitle tracks were reset while loading level ".concat(a));var s=i[a];if(!(a>=i.length)&&s){this.log("Subtitle track ".concat(a," loaded [").concat(r.startSN,",").concat(r.endSN,"]").concat(r.lastPartSn?"[part-".concat(r.lastPartSn,"-").concat(r.lastPartIndex,"]"):"",",duration:").concat(r.totalduration)),this.mediaBuffer=this.mediaBufferTimeRanges;var o=0;if(r.live||null!=(l=s.details)&&l.live){if(r.deltaUpdateFailed)return;var l,u,c=this.mainDetails;if(!c){this.startFragRequested=!1;return}var h=c.fragments[0];s.details?0===(o=this.alignPlaylists(r,s.details,null==(u=this.levelLastLoaded)?void 0:u.details))&&h&&nC(r,o=h.start):r.hasProgramDateTime&&c.hasProgramDateTime?(nK(r,c),o=r.fragmentStart):h&&nC(r,o=h.start),c&&!this.startFragRequested&&this.setStartPosition(c,o)}s.details=r,this.levelLastLoaded=s,a===n&&(this.hls.trigger(O.SUBTITLE_TRACK_UPDATED,{details:r,id:a,groupId:t.groupId}),this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===nW&&(tu(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),s.details=void 0)))}}},{key:"_handleFragmentLoadComplete",value:function(e){var t=this,n=e.frag,i=e.payload,r=n.decryptdata,a=this.hls;if(!this.fragContextChanged(n)&&i&&i.byteLength>0&&null!=r&&r.key&&r.iv&&tZ(r.method)){var s=performance.now();this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer,tJ(r.method)).catch(function(e){throw a.trigger(O.ERROR,{type:x.MEDIA_ERROR,details:P.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:n}),e}).then(function(e){var t=performance.now();a.trigger(O.FRAG_DECRYPTED,{frag:n,payload:e,stats:{tstart:s,tdecrypt:t}})}).catch(function(e){t.warn("".concat(e.name,": ").concat(e.message)),t.state=nW})}}},{key:"doTick",value:function(){if(!this.media){this.state=nW;return}if(this.state===nW){var e=this.currentTrackId,t=this.levels,n=null==t?void 0:t[e];if(!n||!t.length||!n.details||this.waitForLive(n))return;var i=this.config,r=this.getLoadPosition(),a=tG.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,i.maxBufferHole),s=a.end,o=a.len,l=n.details;if(o>this.hls.maxBufferLength+l.levelTargetDuration)return;var u=l.fragments,c=u.length,h=l.edge,d=null,f=this.fragPrevious;if(s<h){var v=i.maxFragLookUpTolerance;(d=tu(f,u,Math.max(u[0].start,s),s>h-v?0:v))||!f||!(f.start<u[0].start)||(d=u[0])}else d=u[c-1];if(!(d=this.filterReplacedPrimary(d,n.details)))return;var g=u[d.sn-l.startSN-1];if(g&&g.cc===d.cc&&this.fragmentTracker.getState(g)===tT&&(d=g),this.fragmentTracker.getState(d)===tT){var m=this.mapToInitFragWhenRequired(d);m&&this.loadFragment(m,n,s)}}}},{key:"loadFragment",value:function(e,n,i){ed(e)?(0,T._)((0,S._)(t.prototype),"loadFragment",this).call(this,e,n,i):this._loadInitSegment(e,n)}},{key:"mediaBufferTimeRanges",get:function(){return new aS(this.tracksBuffered[this.currentTrackId]||[])}}]),t}(n5),aS=function e(t){"use strict";(0,E._)(this,e),this.buffered=void 0;var n=function(e,n,i){if((n>>>=0)>i-1)throw new DOMException("Failed to execute '".concat(e,"' on 'TimeRanges': The index provided (").concat(n,") is greater than the maximum bound (").concat(i,")"));return t[n][e]};this.buffered={get length(){return t.length},end:function(e){return n("end",e,t.length)},start:function(e){return n("start",e,t.length)}}},a_={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},aA=function(e){return String.fromCharCode(a_[e]||e)},aL={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},aw={17:2,18:4,21:6,22:8,23:10,19:13,20:15},aI={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},aR={25:2,26:4,29:6,30:8,31:10,27:13,28:15},aD=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],aC=function(){"use strict";function e(){(0,E._)(this,e),this.time=null,this.verboseLevel=0}return(0,k._)(e,[{key:"log",value:function(e,t){if(this.verboseLevel>=e){var n="function"==typeof t?t():t;J.log("".concat(this.time," [").concat(e,"] ").concat(n))}}}]),e}(),ax=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].toString(16));return t},aP=function(){"use strict";function e(){(0,E._)(this,e),this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}return(0,k._)(e,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(e){for(var t=["foreground","underline","italics","background","flash"],n=0;n<t.length;n++){var i=t[n];e.hasOwnProperty(i)&&(this[i]=e[i])}}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}},{key:"copy",value:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),e}(),aO=function(){"use strict";function e(){(0,E._)(this,e),this.uchar=" ",this.penState=new aP}return(0,k._)(e,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(e,t){this.uchar=e,this.penState.copy(t)}},{key:"setPenState",value:function(e){this.penState.copy(e)}},{key:"equals",value:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}},{key:"copy",value:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),e}(),aM=function(){"use strict";function e(t){(0,E._)(this,e),this.chars=[],this.pos=0,this.currPenState=new aP,this.cueStartTime=null,this.logger=void 0;for(var n=0;n<100;n++)this.chars.push(new aO);this.logger=t}return(0,k._)(e,[{key:"equals",value:function(e){for(var t=0;t<100;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}},{key:"copy",value:function(e){for(var t=0;t<100;t++)this.chars[t].copy(e.chars[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<100;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}},{key:"setCursor",value:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>100&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=100)}},{key:"moveCursor",value:function(e){var t=this.pos+e;if(e>1)for(var n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(e){var t=this;e>=144&&this.backSpace();var n=aA(e);if(this.pos>=100)return void this.logger.log(0,function(){return"Cannot insert "+e.toString(16)+" ("+n+") at position "+t.pos+". Skipping it!"});this.chars[this.pos].setChar(n,this.currPenState),this.moveCursor(1)}},{key:"clearFromPos",value:function(e){var t;for(t=e;t<100;t++)this.chars[t].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var e=[],t=!0,n=0;n<100;n++){var i=this.chars[n].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")}},{key:"setPenStyles",value:function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}]),e}(),aF=function(){"use strict";function e(t){(0,E._)(this,e),this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(var n=0;n<15;n++)this.rows.push(new aM(t));this.logger=t}return(0,k._)(e,[{key:"reset",value:function(){for(var e=0;e<15;e++)this.rows[e].clear();this.currRow=14}},{key:"equals",value:function(e){for(var t=!0,n=0;n<15;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<15;t++)this.rows[t].copy(e.rows[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<15;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}},{key:"backSpace",value:function(){this.rows[this.currRow].backSpace()}},{key:"clearToEndOfRow",value:function(){this.rows[this.currRow].clearToEndOfRow()}},{key:"insertChar",value:function(e){this.rows[this.currRow].insertChar(e)}},{key:"setPen",value:function(e){this.rows[this.currRow].setPenStyles(e)}},{key:"moveCursor",value:function(e){this.rows[this.currRow].moveCursor(e)}},{key:"setCursor",value:function(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}},{key:"setPAC",value:function(e){this.logger.log(2,function(){return"pacData = "+e9(e)});var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var n=0;n<15;n++)this.rows[n].clear();var i=this.currRow+1-this.nrRollUpRows,r=this.lastOutputScreen;if(r){var a=r.rows[i].cueStartTime,s=this.logger.time;if(null!==a&&null!==s&&a<s)for(var o=0;o<this.nrRollUpRows;o++)this.rows[t-this.nrRollUpRows+o+1].copy(r.rows[i+o])}}this.currRow=t;var l=this.rows[this.currRow];if(null!==e.indent){var u=Math.max(e.indent-1,0);l.setCursor(e.indent),e.color=l.chars[u].penState.foreground}var c={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(c)}},{key:"setBkgData",value:function(e){this.logger.log(2,function(){return"bkgData = "+e9(e)}),this.backSpace(),this.setPen(e),this.insertChar(32)}},{key:"setRollUpRows",value:function(e){this.nrRollUpRows=e}},{key:"rollUp",value:function(){var e=this;if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,function(){return e.getDisplayText()});var t=this.currRow+1-this.nrRollUpRows,n=this.rows.splice(t,1)[0];n.clear(),this.rows.splice(this.currRow,0,n),this.logger.log(2,"Rolling up")}},{key:"getDisplayText",value:function(e){e=e||!1;for(var t=[],n="",i=-1,r=0;r<15;r++){var a=this.rows[r].getTextString();a&&(i=r+1,e?t.push("Row "+i+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n}},{key:"getTextAndFormat",value:function(){return this.rows}}]),e}(),aN=function(){"use strict";function e(t,n,i){(0,E._)(this,e),this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=n,this.mode=null,this.verbose=0,this.displayedMemory=new aF(i),this.nonDisplayedMemory=new aF(i),this.lastOutputScreen=new aF(i),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}return(0,k._)(e,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(e){this.outputFilter=e}},{key:"setPAC",value:function(e){this.writeScreen.setPAC(e)}},{key:"setBkgData",value:function(e){this.writeScreen.setBkgData(e)}},{key:"setMode",value:function(e){e!==this.mode&&(this.mode=e,this.logger.log(2,function(){return"MODE="+e}),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}},{key:"insertChars",value:function(e){for(var t=this,n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,function(){return i+": "+t.writeScreen.getDisplayText(!0)}),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&(this.logger.log(1,function(){return"DISPLAYED: "+t.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())}},{key:"ccRCL",value:function(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}},{key:"ccFON",value:function(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}},{key:"ccCR",value:function(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}},{key:"ccENM",value:function(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){var e=this;if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,function(){return"DISP: "+e.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)}},{key:"ccTO",value:function(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}},{key:"ccMIDROW",value:function(e){var t={flash:!1};(t.underline=e%2==1,t.italics=e>=46,t.italics)?t.foreground="white":t.foreground=["white","green","blue","cyan","red","yellow","magenta"][Math.floor(e/2)-16],this.logger.log(2,"MIDROW: "+e9(t)),this.writeScreen.setPen(t)}},{key:"outputDataUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(e){this.outputFilter&&!this.displayedMemory.isEmpty()&&(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e)}}]),e}(),aB=function(){"use strict";function e(t,n,i){(0,E._)(this,e),this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;var r=this.logger=new aC;this.channels=[null,new aN(t,n,r),new aN(t+1,i,r)]}return(0,k._)(e,[{key:"getHandler",value:function(e){return this.channels[e].getHandler()}},{key:"setHandler",value:function(e,t){this.channels[e].setHandler(t)}},{key:"addData",value:function(e,t){var n,i=function(e){var i,r,a,s,o,l,u,c,h,d,f,v,g=127&t[e],m=127&t[e+1],p=!1,y=null;if(0===g&&0===m)return"continue";n.logger.log(3,function(){return"["+ax([t[e],t[e+1]])+"] -> ("+ax([g,m])+")"});var E=n.cmdHistory;if(g>=16&&g<=31){if(i=g,r=m,(a=E).a===i&&a.b===r){return s=null,o=null,(l=E).a=null,l.b=null,n.logger.log(3,function(){return"Repeated command ("+ax([g,m])+") is dropped"}),"continue"}u=g,c=m,(h=n.cmdHistory).a=u,h.b=c,(p=n.parseCmd(g,m))||(p=n.parseMidrow(g,m)),p||(p=n.parsePAC(g,m)),p||(p=n.parseBackgroundAttributes(g,m))}else{d=null,f=null,(v=E).a=null,v.b=null}if(!p&&(y=n.parseChars(g,m))){var k=n.currentChannel;k&&k>0?n.channels[k].insertChars(y):n.logger.log(2,"No channel found yet. TEXT-MODE?")}p||y||n.logger.log(2,function(){return"Couldn't parse cleaned data "+ax([g,m])+" orig: "+ax([t[e],t[e+1]])})};this.logger.time=e;for(var r=0;r<t.length;r+=2)n=this,i(r)}},{key:"parseCmd",value:function(e,t){if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=33&&t<=35))return!1;var n=20===e||21===e||23===e?1:2,i=this.channels[n];return 20===e||21===e||28===e||29===e?32===t?i.ccRCL():33===t?i.ccBS():34===t?i.ccAOF():35===t?i.ccAON():36===t?i.ccDER():37===t?i.ccRU(2):38===t?i.ccRU(3):39===t?i.ccRU(4):40===t?i.ccFON():41===t?i.ccRDC():42===t?i.ccTR():43===t?i.ccRTD():44===t?i.ccEDM():45===t?i.ccCR():46===t?i.ccENM():47===t&&i.ccEOC():i.ccTO(t-32),this.currentChannel=n,!0}},{key:"parseMidrow",value:function(e,t){var n=0;if((17===e||25===e)&&t>=32&&t<=47){if((n=17===e?1:2)!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;var i=this.channels[n];return!!i&&(i.ccMIDROW(t),this.logger.log(3,function(){return"MIDROW ("+ax([e,t])+")"}),!0)}return!1}},{key:"parsePAC",value:function(e,t){var n,i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,r=(16===e||24===e)&&t>=64&&t<=95;if(!(i||r))return!1;var a=e<=23?1:2;n=t>=64&&t<=95?1===a?aL[e]:aI[e]:1===a?aw[e]:aR[e];var s=this.channels[a];return!!s&&(s.setPAC(this.interpretPAC(n,t)),this.currentChannel=a,!0)}},{key:"interpretPAC",value:function(e,t){var n,i={color:null,italics:!1,indent:null,underline:!1,row:e};return i.underline=(1&(n=t>95?t-96:t-64))==1,n<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((n-16)/2),i}},{key:"parseChars",value:function(e,t){var n,i,r=null,a=null;return e>=25?(n=2,a=e-8):(n=1,a=e),a>=17&&a<=19?(i=17===a?t+80:18===a?t+112:t+144,this.logger.log(2,function(){return"Special char '"+aA(i)+"' in channel "+n}),r=[i]):e>=32&&e<=127&&(r=0===t?[e]:[e,t]),r&&this.logger.log(3,function(){return"Char codes =  "+ax(r).join(",")}),r}},{key:"parseBackgroundAttributes",value:function(e,t){if(!((16===e||24===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=45&&t<=47))return!1;var n={};return 16===e||24===e?(n.background=aD[Math.floor((t-32)/2)],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0)),this.channels[e<=23?1:2].setBkgData(n),!0}},{key:"reset",value:function(){for(var e,t,n,i=0;i<Object.keys(this.channels).length;i++){var r=this.channels[i];r&&r.reset()}e=null,t=null,(n=this.cmdHistory).a=null,n.b=null}},{key:"cueSplitAtTime",value:function(e){for(var t=0;t<this.channels.length;t++){var n=this.channels[t];n&&n.cueSplitAtTime(e)}}}]),e}(),aU=function(){if(null!=t5&&t5.VTTCue)return self.VTTCue;var e=["","lr","rl"],t=["start","middle","end","left","right"];function n(e,t){if("string"!=typeof t||!Array.isArray(e))return!1;var n=t.toLowerCase();return!!~e.indexOf(n)&&n}function i(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var s in a)e[s]=a[s]}return e}function r(r,a,s){var o={enumerable:!0};this.hasBeenReset=!1;var l="",u=!1,c=r,h=a,d=s,f=null,v="",g=!0,m="auto",p="start",y=50,E="middle",k=50,b="middle";Object.defineProperty(this,"id",i({},o,{get:function(){return l},set:function(e){l=""+e}})),Object.defineProperty(this,"pauseOnExit",i({},o,{get:function(){return u},set:function(e){u=!!e}})),Object.defineProperty(this,"startTime",i({},o,{get:function(){return c},set:function(e){if("number"!=typeof e)throw TypeError("Start time must be set to a number.");c=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"endTime",i({},o,{get:function(){return h},set:function(e){if("number"!=typeof e)throw TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"text",i({},o,{get:function(){return d},set:function(e){d=""+e,this.hasBeenReset=!0}})),Object.defineProperty(this,"region",i({},o,{get:function(){return f},set:function(e){f=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"vertical",i({},o,{get:function(){return v},set:function(t){var i=n(e,t);if(!1===i)throw SyntaxError("An invalid or illegal string was specified.");v=i,this.hasBeenReset=!0}})),Object.defineProperty(this,"snapToLines",i({},o,{get:function(){return g},set:function(e){g=!!e,this.hasBeenReset=!0}})),Object.defineProperty(this,"line",i({},o,{get:function(){return m},set:function(e){if("number"!=typeof e&&"auto"!==e)throw SyntaxError("An invalid number or illegal string was specified.");m=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"lineAlign",i({},o,{get:function(){return p},set:function(e){var i=n(t,e);if(!i)throw SyntaxError("An invalid or illegal string was specified.");p=i,this.hasBeenReset=!0}})),Object.defineProperty(this,"position",i({},o,{get:function(){return y},set:function(e){if(e<0||e>100)throw Error("Position must be between 0 and 100.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"positionAlign",i({},o,{get:function(){return E},set:function(e){var i=n(t,e);if(!i)throw SyntaxError("An invalid or illegal string was specified.");E=i,this.hasBeenReset=!0}})),Object.defineProperty(this,"size",i({},o,{get:function(){return k},set:function(e){if(e<0||e>100)throw Error("Size must be between 0 and 100.");k=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"align",i({},o,{get:function(){return b},set:function(e){var i=n(t,e);if(!i)throw SyntaxError("An invalid or illegal string was specified.");b=i,this.hasBeenReset=!0}})),this.displayState=void 0}return r.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},r}(),aj=function(){"use strict";function e(){(0,E._)(this,e)}return(0,k._)(e,[{key:"decode",value:function(e,t){if(!e)return"";if("string"!=typeof e)throw Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}]),e}();function aG(e){function t(e,t,n,i){return(0|e)*3600+(0|t)*60+(0|n)+parseFloat(i||0)}var n=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?t(n[2],n[3],0,n[4]):t(n[1],n[2],n[3],n[4]):null}var aK=function(){"use strict";function e(){(0,E._)(this,e),this.values=Object.create(null)}return(0,k._)(e,[{key:"set",value:function(e,t){this.get(e)||""===t||(this.values[e]=t)}},{key:"get",value:function(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}},{key:"has",value:function(e){return e in this.values}},{key:"alt",value:function(e,t,n){for(var i=0;i<n.length;++i)if(t===n[i]){this.set(e,t);break}}},{key:"integer",value:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}},{key:"percent",value:function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}]),e}();function aH(e,t,n,i){var r=i?e.split(i):[e];for(var a in r)if("string"==typeof r[a]){var s=r[a].split(n);2===s.length&&t(s[0],s[1])}}var aV=new aU(0,0,""),aq="middle"===aV.align?"middle":"center";function aY(e){return e.replace(/<br(?: \/)?>/gi,"\n")}var aW=function(){"use strict";function e(){(0,E._)(this,e),this.state="INITIAL",this.buffer="",this.decoder=new aj,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}return(0,k._)(e,[{key:"parse",value:function(e){var t=this;function n(){var e=t.buffer,n=0;for(e=aY(e);n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;var i=e.slice(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.slice(n),i}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var i,r="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var a=(r=n()).match(/^()?WEBVTT([ \t].*)?$/);if(!(null!=a&&a[0]))throw Error("Malformed WebVTT signature.");t.state="HEADER"}for(var s=!1;t.buffer&&/\r\n|\n/.test(t.buffer);)switch(s?s=!1:r=n(),t.state){case"HEADER":/:/.test(r)?(i=r,aH(i,function(e,t){},/:/)):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;if(t.cue=new aU(0,0,""),t.state="CUE",-1===r.indexOf("--\x3e")){t.cue.id=r;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{!function(e,t,n){var i,r,a,s,o=e;function l(){var t=aG(e);if(null===t)throw Error("Malformed timestamp: "+o);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function u(){e=e.replace(/^\s+/,"")}if(u(),t.startTime=l(),u(),"--\x3e"!==e.slice(0,3))throw Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+o);e=e.slice(3),u(),t.endTime=l(),u(),i=e,r=new aK,aH(i,function(e,t){var i;switch(e){case"region":for(var a=n.length-1;a>=0;a--)if(n[a].id===t){r.set(e,n[a].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":i=t.split(","),r.integer(e,i[0]),r.percent(e,i[0])&&r.set("snapToLines",!1),r.alt(e,i[0],["auto"]),2===i.length&&r.alt("lineAlign",i[1],["start",aq,"end"]);break;case"position":i=t.split(","),r.percent(e,i[0]),2===i.length&&r.alt("positionAlign",i[1],["start",aq,"end","line-left","line-right","auto"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start",aq,"end","left","right"])}},/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical",""),"auto"===(a=r.get("line","auto"))&&-1===aV.line&&(a=-1),t.line=a,t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100),t.align=r.get("align",aq),"auto"===(s=r.get("position","auto"))&&50===aV.position&&(s="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=s}(r,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var o=-1!==r.indexOf("--\x3e");if(!r||o&&(s=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=r;continue;case"BADCUE":r||(t.state="ID")}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}},{key:"flush",value:function(){try{if((this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state||"BADWEBVTT"===this.state)throw Error("Malformed WebVTT signature.")}catch(e){this.onparsingerror&&this.onparsingerror(e)}return this.onflush&&this.onflush(),this}}]),e}(),az=/\r\n|\n\r|\n|\r/g,aX=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.slice(n,n+t.length)===t},aQ=function(e){var t=parseInt(e.slice(-3)),n=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!R(t)||!R(n)||!R(i)||!R(r))throw Error("Malformed X-TIMESTAMP-MAP: Local:".concat(e));return t+=1e3*n,t+=6e4*i,t+=36e5*r};function a$(e,t,n){return al(e.toString())+al(t.toString())+al(n)}var aZ=function(e,t,n){var i,r=e[t],a=e[r.prevCC];if(!a||!a.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;null!=(i=a)&&i.new;)e.ccOffset+=r.start-a.start,r.new=!1,a=e[(r=a).prevCC];e.presentationOffset=n},aJ="stpp.ttml.im1t",a0=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,a1=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,a2={left:"start",center:"center",right:"end",start:"start",end:"end"};function a3(e,t,n,i){var r=eT(new Uint8Array(e),["mdat"]);if(0===r.length)return void i(Error("Could not parse IMSC1 mdat"));var a=r.map(function(e){return en(e)}),s=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return i$(e,t,1/n,i)}(t.baseTime,1,t.timescale);try{a.forEach(function(e){return n(function(e,t){var n=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("tt")[0];if(!n)throw Error("Invalid ttml");var i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},r=Object.keys(i).reduce(function(e,t){return e[t]=n.getAttribute("ttp:".concat(t))||i[t],e},{}),a="preserve"!==n.getAttribute("xml:space"),s=a4(a5(n,"styling","style")),o=a4(a5(n,"layout","region")),l=a5(n,"body","[begin]");return[].map.call(l,function(e){var n,i,l,u,c,h,d=function e(t,n){return[].slice.call(t.childNodes).reduce(function(t,i,r){var a;return"br"===i.nodeName&&r?t+"\n":null!=(a=i.childNodes)&&a.length?e(i,n):n?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}(e,a);if(!d||!e.hasAttribute("begin"))return null;var f=a9(e.getAttribute("begin"),r),v=a9(e.getAttribute("dur"),r),g=a9(e.getAttribute("end"),r);if(null===f)throw a6(e);if(null===g){if(null===v)throw a6(e);g=f+v}var m=new aU(f-t,g-t,d);m.id=a$(m.startTime,m.endTime,m.text);var p=(n=o[e.getAttribute("region")],i=s[e.getAttribute("style")],l=s,u="http://www.w3.org/ns/ttml#styling",c=null,(h=null!=n&&n.hasAttribute("style")?n.getAttribute("style"):null)&&l.hasOwnProperty(h)&&(c=l[h]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(e,t){var r=a8(i,u,t)||a8(n,u,t)||a8(c,u,t);return r&&(e[t]=r),e},{})),y=p.textAlign;if(y){var E=a2[y];E&&(m.lineAlign=E),m.align=y}return q(m,p),m}).filter(function(e){return null!==e})}(e,s))})}catch(e){i(e)}}function a5(e,t,n){var i=e.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(n)):[]}function a4(e){return e.reduce(function(e,t){var n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function a8(e,t,n){return e&&e.hasAttributeNS(t,n)?e.getAttributeNS(t,n):null}function a6(e){return Error("Could not parse ttml timestamp ".concat(e))}function a9(e,t){if(!e)return null;var n,i,r,a,s=aG(e);return null===s&&(a0.test(e)?(n=e,i=t,a=(0|(r=a0.exec(n))[4])+(0|r[5])/i.subFrameRate,s=(0|r[1])*3600+(0|r[2])*60+(0|r[3])+a/i.frameRate):a1.test(e)&&(s=function(e,t){var n=a1.exec(e),i=Number(n[1]);switch(n[2]){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}(e,t))),s}var a7=function(){"use strict";function e(t,n){(0,E._)(this,e),this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=n}return(0,k._)(e,[{key:"dispatchCue",value:function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}},{key:"newCue",value:function(e,t,n){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}},{key:"reset",value:function(){this.cueRanges=[],this.startTime=null}}]),e}(),se=function(){"use strict";function e(t){(0,E._)(this,e),this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=si(),this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},t.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(O.MANIFEST_LOADING,this.onManifestLoading,this),t.on(O.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(O.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(O.FRAG_LOADING,this.onFragLoading,this),t.on(O.FRAG_LOADED,this.onFragLoaded,this),t.on(O.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(O.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(O.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(O.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(O.BUFFER_FLUSHING,this.onBufferFlushing,this)}return(0,k._)(e,[{key:"destroy",value:function(){var e=this.hls;e.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(O.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(O.FRAG_LOADING,this.onFragLoading,this),e.off(O.FRAG_LOADED,this.onFragLoaded,this),e.off(O.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(O.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(O.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(O.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(O.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}},{key:"initCea608Parsers",value:function(){var e=new a7(this,"textTrack1"),t=new a7(this,"textTrack2"),n=new a7(this,"textTrack3"),i=new a7(this,"textTrack4");this.cea608Parser1=new aB(1,e,t),this.cea608Parser2=new aB(3,n,i)}},{key:"addCues",value:function(e,t,n,i,r){for(var a=!1,s=r.length;s--;){var o,l,u=r[s],c=(o=u[0],l=u[1],Math.min(l,n)-Math.max(o,t));if(c>=0&&(u[0]=Math.min(u[0],t),u[1]=Math.max(u[1],n),a=!0,c/(n-t)>.5))return}if(a||r.push([t,n]),this.config.renderTextTracksNatively){var h=this.captionsTracks[e];this.Cues.newCue(h,t,n,i)}else{var d=this.Cues.newCue(null,t,n,i);this.hls.trigger(O.CUES_PARSED,{type:"captions",cues:d,track:e})}}},{key:"onInitPtsFound",value:function(e,t){var n=this,i=t.frag,r=t.id,a=t.initPTS,s=t.timescale,o=t.trackId,l=this.unparsedVttFrags;r===j&&(this.initPTS[i.cc]={baseTime:a,timescale:s,trackId:o}),l.length&&(this.unparsedVttFrags=[],l.forEach(function(e){n.initPTS[e.frag.cc]?n.onFragLoaded(O.FRAG_LOADED,e):n.hls.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e.frag,error:Error("Subtitle discontinuity domain does not match main")})}))}},{key:"getExistingTrack",value:function(e,t){var n=this.media;if(n)for(var i=0;i<n.textTracks.length;i++){var r=n.textTracks[i];if(sn(r,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}},{key:"createCaptionsTrack",value:function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}},{key:"createNativeTrack",value:function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,n=this.captionsTracks,i=this.media,r=t[e],a=r.label,s=r.languageCode,o=this.getExistingTrack(a,s);if(o)n[e]=o,ar(n[e]),an(n[e],i);else{var l=this.createTextTrack("captions",a,s);l&&(l[e]=!0,n[e]=l)}}}},{key:"createNonNativeTrack",value:function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var n={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(O.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}}}},{key:"createTextTrack",value:function(e,t,n){var i=this.media;if(i)return i.addTextTrack(e,t,n)}},{key:"onMediaAttaching",value:function(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}},{key:"onMediaDetaching",value:function(e,t){var n=!!t.transferMedia;if(this.media=null,!n){var i=this.captionsTracks;Object.keys(i).forEach(function(e){ar(i[e]),delete i[e]}),this.nonNativeCaptionsTracks={}}}},{key:"onManifestLoading",value:function(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=si(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}},{key:"_cleanTracks",value:function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var n=0;n<t.length;n++)ar(t[n])}}},{key:"onSubtitleTracksUpdated",value:function(e,t){var n=this,i=t.subtitleTracks||[],r=i.some(function(e){return e.textCodec===aJ});if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(rc(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){var a=this.media,s=a?as(a.textTracks):null;if(this.tracks.forEach(function(e,t){var i;if(s){for(var r=null,a=0;a<s.length;a++)if(s[a]&&sn(s[a],e)){r=s[a],s[a]=null;break}r&&(i=r)}if(i)ar(i);else{var o=st(e);(i=n.createTextTrack(o,e.name,e.lang))&&(i.mode="disabled")}i&&n.textTracks.push(i)}),null!=s&&s.length){var o=s.filter(function(e){return null!==e}).map(function(e){return e.label});o.length&&this.hls.logger.warn("Media element contains unused subtitle tracks: ".concat(o.join(", "),". Replace media element for each source to clear TextTracks and captions menu."))}}else if(this.tracks.length){var l=this.tracks.map(function(e){return{label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}});this.hls.trigger(O.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}}},{key:"onManifestLoaded",value:function(e,t){var n=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(function(e){var t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(t){var i="textTrack".concat(t[1]),r=n.captionsProperties[i];r&&(r.label=e.name,e.lang&&(r.languageCode=e.lang),r.media=e)}})}},{key:"closedCaptionsForLevel",value:function(e){var t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}},{key:"onFragLoading",value:function(e,t){if(this.enabled&&t.frag.type===j){var n,i,r=this.cea608Parser1,a=this.cea608Parser2,s=this.lastSn,o=t.frag,l=o.cc,u=o.sn,c=null!=(n=null==(i=t.part)?void 0:i.index)?n:-1;r&&a&&(u!==s+1||u===s&&c!==this.lastPartIndex+1||l!==this.lastCc)&&(r.reset(),a.reset()),this.lastCc=l,this.lastSn=u,this.lastPartIndex=c}}},{key:"onFragLoaded",value:function(e,t){var n=t.frag,i=t.payload;if(n.type===K)if(i.byteLength){var r=n.decryptdata,a="stats"in t;if(null==r||!r.encrypted||a){var s=this.tracks[n.level],o=this.vttCCs;o[n.cc]||(o[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),s&&s.textCodec===aJ?this._parseIMSC1(n,i):this._parseVTTs(t)}}else this.hls.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:Error("Empty subtitle payload")})}},{key:"_parseIMSC1",value:function(e,t){var n=this,i=this.hls;a3(t,this.initPTS[e.cc],function(t){n._appendCues(t,e.level),i.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(t){i.logger.log("Failed to parse IMSC1: ".concat(t)),i.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})}},{key:"_parseVTTs",value:function(e){var t,n,i,r,a,s,o,l,u,c,h,d,f,v,g,m,p,y=this,E=e.frag,k=e.payload,b=this.initPTS,T=this.unparsedVttFrags,S=b.length-1;if(!b[E.cc]&&-1===S)return void T.push(e);var _=this.hls;t=null!=(p=E.initSegment)&&p.data?eD(E.initSegment.data,new Uint8Array(k)).buffer:k,n=this.initPTS[E.cc],i=this.vttCCs,r=E.cc,a=E.start,s=function(e){y._appendCues(e,E.level),_.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:E})},o=function(t){var n="Missing initPTS for VTT MPEGTS"===t.message;n?T.push(e):y._fallbackToIMSC1(E,k),_.logger.log("Failed to parse VTT cue: ".concat(t)),n&&S>E.cc||_.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:E,error:t})},u=new aW,c=en(new Uint8Array(t)).trim().replace(az,"\n").split("\n"),h=[],d=n?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return i$(e,9e4,1/t)}(n.baseTime,n.timescale):0,f="00:00.000",v=0,g=0,m=!0,u.oncue=function(e){var t=i[r],s=i.ccOffset,o=(v-d)/9e4;if(null!=t&&t.new&&(void 0!==g?s=i.ccOffset=t.start:aZ(i,r,o)),o){if(!n){l=Error("Missing initPTS for VTT MPEGTS");return}s=o-i.presentationOffset}var u=e.endTime-e.startTime,c=i5((e.startTime+s-g)*9e4,9e4*a)/9e4;e.startTime=Math.max(c,0),e.endTime=Math.max(c+u,0);var f=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(f)),e.id||(e.id=a$(e.startTime,e.endTime,f)),e.endTime>0&&h.push(e)},u.onparsingerror=function(e){l=e},u.onflush=function(){if(l)return void o(l);s(h)},c.forEach(function(e){if(m)if(aX(e,"X-TIMESTAMP-MAP=")){m=!1,e.slice(16).split(",").forEach(function(e){aX(e,"LOCAL:")?f=e.slice(6):aX(e,"MPEGTS:")&&(v=parseInt(e.slice(7)))});try{g=aQ(f)/1e3}catch(e){l=e}return}else""===e&&(m=!1);u.parse(e+"\n")}),u.flush()}},{key:"_fallbackToIMSC1",value:function(e,t){var n=this,i=this.tracks[e.level];i.textCodec||a3(t,this.initPTS[e.cc],function(){i.textCodec=aJ,n._parseIMSC1(e,t)},function(){i.textCodec="wvtt"})}},{key:"_appendCues",value:function(e,t){var n=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[t];if(!i||"disabled"===i.mode)return;e.forEach(function(e){return ai(i,e)})}else{var r=this.tracks[t];if(!r)return;var a=r.default?"default":"subtitles"+t;n.trigger(O.CUES_PARSED,{type:"subtitles",cues:e,track:a})}}},{key:"onFragDecrypted",value:function(e,t){t.frag.type===K&&this.onFragLoaded(O.FRAG_LOADED,t)}},{key:"onSubtitleTracksCleared",value:function(){this.tracks=[],this.captionsTracks={}}},{key:"onFragParsingUserdata",value:function(e,t){if(this.enabled&&this.config.enableCEA708Captions){var n=t.frag,i=t.samples;if(n.type!==j||"NONE"!==this.closedCaptionsForLevel(n))for(var r=0;r<i.length;r++){var a=i[r].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();var s=this.extractCea608Data(a);this.cea608Parser1.addData(i[r].pts,s[0]),this.cea608Parser2.addData(i[r].pts,s[1])}}}}},{key:"onBufferFlushing",value:function(e,t){var n=t.startOffset,i=t.endOffset,r=t.endOffsetSubtitles,a=t.type,s=this.media;if(s&&!(s.currentTime<i)){if(!a||"video"===a){var o=this.captionsTracks;Object.keys(o).forEach(function(e){return aa(o[e],n,i)})}if(this.config.renderTextTracksNatively&&0===n&&void 0!==r){var l=this.textTracks;Object.keys(l).forEach(function(e){return aa(l[e],n,r)})}}}},{key:"extractCea608Data",value:function(e){for(var t=[[],[]],n=31&e[0],i=2,r=0;r<n;r++){var a=e[i++],s=127&e[i++],o=127&e[i++];if((0!==s||0!==o)&&(4&a)!=0){var l=3&a;(0===l||1===l)&&(t[l].push(s),t[l].push(o))}}return t}}]),e}();function st(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function sn(e,t){return!!e&&e.kind===st(t)&&rd(t,e)}function si(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}var sr=/\s/,sa={newCue:function(e,t,n,i){for(var r=[],a=self.VTTCue||self.TextTrackCue,s=0;s<i.rows.length;s++)if(o=i.rows[s],u=!0,c=0,h="",!o.isEmpty()){for(var o,l,u,c,h,d,f=0;f<o.chars.length;f++)sr.test(o.chars[f].uchar)&&u?c++:(h+=o.chars[f].uchar,u=!1);o.cueStartTime=t,t===n&&(n+=1e-4),c>=16?c--:c++;var v=aY(h.trim()),g=a$(t,n,v);null!=e&&null!=(d=e.cues)&&d.getCueById(g)||((l=new a(t,n,v)).id=g,l.line=s+1,l.align="left",l.position=10+Math.min(80,10*Math.floor(8*c/32)),r.push(l))}return e&&r.length&&(r.sort(function(e,t){return"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line}),r.forEach(function(t){return ai(e,t)})),r}},ss=/(\d+)-(\d+)\/(\d+)/,so=function(){"use strict";function e(t){(0,E._)(this,e),this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||sl,this.controller=new self.AbortController,this.stats=new eo}return(0,k._)(e,[{key:"destroy",value:function(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}},{key:"abortInternal",value:function(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}},{key:"abort",value:function(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}},{key:"load",value:function(e,t,n){var i,r,a=this,s=this.stats;if(s.loading.start)throw Error("Loader can only be used once.");s.loading.start=self.performance.now();var o=(i=e,r={method:"GET",mode:"cors",credentials:"same-origin",signal:this.controller.signal,headers:new self.Headers(q({},i.headers))},i.rangeEnd&&r.headers.set("Range","bytes="+i.rangeStart+"-"+String(i.rangeEnd-1)),r),l="arraybuffer"===e.responseType,u=l?"byteLength":"length",c=t.loadPolicy,h=c.maxTimeToFirstByteMs,d=c.maxLoadTimeMs;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,o),self.clearTimeout(this.requestTimeout),t.timeout=h&&R(h)?h:d,this.requestTimeout=self.setTimeout(function(){a.callbacks&&(a.abortInternal(),a.callbacks.onTimeout(s,e,a.response))},t.timeout),(ri(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(function(n){a.response=a.loader=n;var i,r=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(a.requestTimeout),t.timeout=d,a.requestTimeout=self.setTimeout(function(){a.callbacks&&(a.abortInternal(),a.callbacks.onTimeout(s,e,a.response))},d-(r-s.loading.start)),!n.ok){var o=n.status;throw new su(n.statusText||"fetch, bad network response",o,n)}s.loading.first=r,s.total=function(e){var t=e.get("Content-Range");if(t){var n=function(e){var t=ss.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(R(n))return n}var i=e.get("Content-Length");if(i)return parseInt(i)}(n.headers)||s.total;var u=null==(i=a.callbacks)?void 0:i.onProgress;return u&&R(t.highWaterMark)?a.loadProgressively(n,s,e,t.highWaterMark,u):l?n.arrayBuffer():"json"===e.responseType?n.json():n.text()}).then(function(n){var i,r,o=a.response;if(!o)throw Error("loader destroyed");self.clearTimeout(a.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);var l=n[u];l&&(s.loaded=s.total=l);var c={url:o.url,data:n,code:o.status},h=null==(i=a.callbacks)?void 0:i.onProgress;h&&!R(t.highWaterMark)&&h(s,e,n,o),null==(r=a.callbacks)||r.onSuccess(c,s,e,o)}).catch(function(t){if(self.clearTimeout(a.requestTimeout),!s.aborted){var n,i=t&&t.code||0,r=t?t.message:null;null==(n=a.callbacks)||n.onError({code:i,text:r},e,t?t.details:null,s)}})}},{key:"getCacheAge",value:function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}},{key:"getResponseHeader",value:function(e){return this.response?this.response.headers.get(e):null}},{key:"loadProgressively",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4?arguments[4]:void 0,a=new n8,s=e.body.getReader(),o=function(){return s.read().then(function(s){if(s.done)return a.dataLength&&r(t,n,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));var l=s.value,u=l.length;return t.loaded+=u,u<i||a.dataLength?(a.push(l),a.dataLength>=i&&r(t,n,a.flush().buffer,e)):r(t,n,l.buffer,e),o()}).catch(function(){return Promise.reject()})};return o()}}]),e}();function sl(e,t){return new self.Request(e.url,t)}var su=function(e){"use strict";function t(e,n,i){var r;return(0,E._)(this,t),(r=(0,y._)(this,t,[e])).code=void 0,r.details=void 0,r.code=n,r.details=i,r}return(0,_._)(t,e),t}((0,I._)(Error)),sc=/^age:\s*[\d.]+\s*$/im,sh=function(){"use strict";function e(t){(0,E._)(this,e),this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=t&&t.xhrSetup||null,this.stats=new eo,this.retryDelay=0}return(0,k._)(e,[{key:"destroy",value:function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}},{key:"abortInternal",value:function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}},{key:"abort",value:function(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}},{key:"load",value:function(e,t,n){if(this.stats.loading.start)throw Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}},{key:"loadInternal",value:function(){var e=this,t=this.config,n=this.context;if(t&&n){var i=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;var a=this.xhrSetup;a?Promise.resolve().then(function(){if(e.loader===i&&!e.stats.aborted)return a(i,n.url)}).catch(function(t){if(e.loader===i&&!e.stats.aborted)return i.open("GET",n.url,!0),a(i,n.url)}).then(function(){e.loader!==i||e.stats.aborted||e.openAndSendXhr(i,n,t)}).catch(function(t){var a;null==(a=e.callbacks)||a.onError({code:i.status,text:t.message},n,i,r)}):this.openAndSendXhr(i,n,t)}}},{key:"openAndSendXhr",value:function(e,t,n){e.readyState||e.open("GET",t.url,!0);var i=t.headers,r=n.loadPolicy,a=r.maxTimeToFirstByteMs,s=r.maxLoadTimeMs;if(i)for(var o in i)e.setRequestHeader(o,i[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=a&&R(a)?a:s,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}},{key:"readystatechange",value:function(){var e=this.context,t=this.loader,n=this.stats;if(e&&t){var i=t.readyState,r=this.config;if(!n.aborted&&i>=2&&(0===n.loading.first&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),4===i)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;var a,s=t.status,o="text"===t.responseType?t.responseText:null;if(s>=200&&s<300){var l=null!=o?o:t.response;if(null!=l){n.loading.end=Math.max(self.performance.now(),n.loading.first),n.loaded=n.total="arraybuffer"===t.responseType?l.byteLength:l.length,n.bwEstimate=8e3*n.total/(n.loading.end-n.loading.first);var u,c,h=null==(u=this.callbacks)?void 0:u.onProgress;h&&h(n,e,l,t);var d={url:t.responseURL,data:l,code:s};null==(c=this.callbacks)||c.onSuccess(d,n,e,t);return}}var f=r.loadPolicy.errorRetry;ty(f,n.retry,!1,{url:e.url,data:void 0,code:s})?this.retry(f):(J.error("".concat(s," while loading ").concat(e.url)),null==(a=this.callbacks)||a.onError({code:s,text:t.statusText},e,t,n))}}}},{key:"loadtimeout",value:function(){if(this.config){var e=this.config.loadPolicy.timeoutRetry;if(ty(e,this.stats.retry,!0))this.retry(e);else{J.warn("timeout while loading ".concat(null==(t=this.context)?void 0:t.url));var t,n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))}}}},{key:"retry",value:function(e){var t=this.context,n=this.stats;this.retryDelay=tm(e,n.retry),n.retry++,J.warn("".concat(status?"HTTP Status "+status:"Timeout"," while loading ").concat(null==t?void 0:t.url,", retrying ").concat(n.retry,"/").concat(e.maxNumRetry," in ").concat(this.retryDelay,"ms")),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}},{key:"loadprogress",value:function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}},{key:"getCacheAge",value:function(){var e=null;if(this.loader&&sc.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}},{key:"getResponseHeader",value:function(e){return this.loader&&RegExp("^".concat(e,":\\s*[\\d.]+\\s*$"),"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}]),e}(),sd=W(W({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:1/0,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:6e7,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:sh,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:to,bufferController:ry,capLevelController:rb,errorController:tk,fpsController:at,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:ns,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:sa,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:aT,subtitleTrackController:ao,timelineController:se,audioStreamController:rl,audioTrackController:rf,emeController:r6,cmcdController:r3,contentSteeringController:r5,interstitialsController:ab}),sf=function(e){"use strict";function t(e,n){var i;return(0,E._)(this,t),(i=(0,y._)(this,t,["gap-controller",e.logger])).hls=void 0,i.fragmentTracker=void 0,i.media=null,i.mediaSource=void 0,i.nudgeRetry=0,i.stallReported=!1,i.stalled=null,i.moved=!1,i.seeking=!1,i.buffered={},i.lastCurrentTime=0,i.ended=0,i.waiting=0,i.onMediaPlaying=function(){i.ended=0,i.waiting=0},i.onMediaWaiting=function(){var e;null!=(e=i.media)&&e.seeking||(i.waiting=self.performance.now(),i.tick())},i.onMediaEnded=function(){if(i.hls){var e;i.ended=(null==(e=i.media)?void 0:e.currentTime)||1,i.hls.trigger(O.MEDIA_ENDED,{stalled:!1})}},i.hls=e,i.fragmentTracker=n,i.registerListeners(),i}return(0,_._)(t,e),(0,k._)(t,[{key:"registerListeners",value:function(){var e=this.hls;e&&(e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.BUFFER_APPENDED,this.onBufferAppended,this))}},{key:"unregisterListeners",value:function(){var e=this.hls;e&&(e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.BUFFER_APPENDED,this.onBufferAppended,this))}},{key:"destroy",value:function(){(0,T._)((0,S._)(t.prototype),"destroy",this).call(this),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}},{key:"onMediaAttached",value:function(e,t){this.setInterval(100),this.mediaSource=t.mediaSource;var n=this.media=t.media;nH(n,"playing",this.onMediaPlaying),nH(n,"waiting",this.onMediaWaiting),nH(n,"ended",this.onMediaEnded)}},{key:"onMediaDetaching",value:function(e,t){this.clearInterval();var n=this.media;n&&(nV(n,"playing",this.onMediaPlaying),nV(n,"waiting",this.onMediaWaiting),nV(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}},{key:"onBufferAppended",value:function(e,t){this.buffered=t.timeRanges}},{key:"hasBuffered",get:function(){return Object.keys(this.buffered).length>0}},{key:"tick",value:function(){if(null!=(e=this.media)&&e.readyState&&this.hasBuffered){var e,t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}}},{key:"poll",value:function(e,t){var n,i,r,a=null==(n=this.hls)?void 0:n.config;if(a){var s=this.media;if(s){var o=s.seeking,l=this.seeking&&!o,u=!this.seeking&&o,c=s.paused&&!o||s.ended||0===s.playbackRate;if(this.seeking=o,e!==t){t&&(this.ended=0),this.moved=!0,!o&&(this.nudgeRetry=0,a.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),0===this.waiting&&this.stallResolved(e);return}if(u||l){l&&this.stallResolved(e);return}if(c){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&s.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(O.MEDIA_ENDED,{stalled:!1}));return}if(!tG.getBuffered(s).length){this.nudgeRetry=0;return}var h=tG.bufferInfo(s,e,0),d=h.nextStart||0,f=this.fragmentTracker;if(o&&f&&this.hls){var v=sv(this.hls.inFlightFragments,e),g=h.len>2,m=!d||v||d-e>2&&!f.getPartialFragment(e);if(g||m)return;this.moved=!1}var p=null==(i=this.hls)?void 0:i.latestLevelDetails;if(!this.moved&&null!==this.stalled&&f){if(!(h.len>0)&&!d)return;var y=Math.max(d,h.start||0)-e,E=null!=p&&p.live?2*p.targetduration:2,k=sm(e,f);if(y>0&&(y<=E||k)){s.paused||this._trySkipBufferHole(k);return}}var b=a.detectStallWithCurrentTimeMs,T=self.performance.now(),S=this.waiting,_=this.stalled;if(null===_)if(S>0&&T-S<b)_=this.stalled=S;else{this.stalled=T;return}var A=T-_;if(!o&&(A>=b||S)&&this.hls){if((null==(r=this.mediaSource)?void 0:r.readyState)==="ended"&&!(null!=p&&p.live)&&1>Math.abs(e-((null==p?void 0:p.edge)||0))){if(this.ended)return;this.ended=e||1,this.hls.trigger(O.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(h),!this.media||!this.hls)return}var L=tG.bufferInfo(s,e,a.maxBufferHole);this._tryFixBufferStall(L,A,e)}}}},{key:"stallResolved",value:function(e){var t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){var n=self.performance.now()-t;this.log("playback not stuck anymore @".concat(e,", after ").concat(Math.round(n),"ms")),this.stallReported=!1,this.waiting=0,this.hls.trigger(O.STALL_RESOLVED,{})}}},{key:"nudgeOnVideoHole",value:function(e,t){var n,i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&null!=(n=this.buffered.audio)&&n.length&&i&&i.length>1&&e>i.end(0)){var r=tG.bufferedInfo(tG.timeRangesToArray(this.buffered.audio),e,0);if(r.len>1&&t>=r.start){var a=tG.timeRangesToArray(i),s=tG.bufferedInfo(a,t,0).bufferedIndex;if(s>-1&&s<a.length-1){var o=tG.bufferedInfo(a,e,0).bufferedIndex,l=a[s].end,u=a[s+1].start;if((-1===o||o>s)&&u-l<1&&e-l<2){var c=Error("nudging playhead to flush pipeline after video hole. currentTime: ".concat(e," hole: ").concat(l," -> ").concat(u," buffered index: ").concat(o));this.warn(c.message),this.media.currentTime+=1e-6;var h=sm(e,this.fragmentTracker);h&&"fragment"in h?h=h.fragment:h||(h=void 0);var d=tG.bufferInfo(this.media,e,0);this.hls.trigger(O.ERROR,{type:x.MEDIA_ERROR,details:P.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:c,reason:c.message,frag:h,buffer:d.len,bufferInfo:d})}}}}}},{key:"_tryFixBufferStall",value:function(e,t,n){var i,r,a=this.fragmentTracker,s=this.media,o=null==(i=this.hls)?void 0:i.config;if(s&&a&&o){var l=null==(r=this.hls)?void 0:r.latestLevelDetails,u=sm(n,a);if((u||null!=l&&l.live&&n<l.fragmentStart)&&(this._trySkipBufferHole(u)||!this.media))return;var c=e.buffered,h=this.adjacentTraversal(e,n);(c&&c.length>1&&e.len>o.maxBufferHole||e.nextStart&&(e.nextStart-n<o.maxBufferHole||h))&&(t>1e3*o.highBufferWatchdogPeriod||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}}},{key:"adjacentTraversal",value:function(e,t){var n=this.fragmentTracker,i=e.nextStart;if(n&&i){var r=n.getFragAtPos(t,j),a=n.getFragAtPos(i,j);if(r&&a)return a.sn-r.sn<2}return!1}},{key:"_reportStall",value:function(e){var t=this.hls,n=this.media,i=this.stallReported,r=this.stalled;if(!i&&null!==r&&n&&t){this.stallReported=!0;var a=Error("Playback stalling at @".concat(n.currentTime," due to low buffer (").concat(e9(e),")"));this.warn(a.message),t.trigger(O.ERROR,{type:x.MEDIA_ERROR,details:P.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:r}})}}},{key:"_trySkipBufferHole",value:function(e){var t=this.fragmentTracker,n=this.media,i=null==(d=this.hls)?void 0:d.config;if(!n||!t||!i)return 0;var r=n.currentTime,a=tG.bufferInfo(n,r,0),s=r<a.start?a.start:a.nextStart;if(s&&this.hls){var o=a.len<=i.maxBufferHole,l=a.len>0&&a.len<1&&n.readyState<3,u=s-r;if(u>0&&(o||l)){if(u>i.maxBufferHole){var c=!1;if(0===r){var h=t.getAppendedFrag(0,j);h&&s<h.end&&(c=!0)}if(!c&&e){if(!(null!=(f=this.hls.loadLevelObj)&&f.details)||sv(this.hls.inFlightFragments,s))return 0;for(var d,f,v=!1,g=e.end;g<s;){var m=sm(g,t);if(m)g+=m.duration;else{v=!0;break}}if(v)return 0}}var p=Math.max(s+.05,r+.1);if(this.warn("skipping hole, adjusting currentTime from ".concat(r," to ").concat(p)),this.moved=!0,n.currentTime=p,!(null!=e&&e.gap)){var y=Error("fragment loaded with buffer holes, seeking from ".concat(r," to ").concat(p)),E={type:x.MEDIA_ERROR,details:P.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:y,reason:y.message,buffer:a.len,bufferInfo:a};e&&("fragment"in e?E.part=e:E.frag=e),this.hls.trigger(O.ERROR,E)}return p}}return 0}},{key:"_tryNudgeBuffer",value:function(e){var t=this.hls,n=this.media,i=this.nudgeRetry,r=null==t?void 0:t.config;if(!n||!r)return 0;var a=n.currentTime;if(this.nudgeRetry++,i<r.nudgeMaxRetry){var s=a+(i+1)*r.nudgeOffset,o=Error("Nudging 'currentTime' from ".concat(a," to ").concat(s));this.warn(o.message),n.currentTime=s,t.trigger(O.ERROR,{type:x.MEDIA_ERROR,details:P.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1,buffer:e.len,bufferInfo:e})}else{var l=Error("Playhead still not moving while enough data buffered @".concat(a," after ").concat(r.nudgeMaxRetry," nudges"));this.error(l.message),t.trigger(O.ERROR,{type:x.MEDIA_ERROR,details:P.BUFFER_STALLED_ERROR,error:l,fatal:!0,buffer:e.len,bufferInfo:e})}}}]),t}(tN);function sv(e,t){var n=sg(e.main);if(n&&n.start<=t)return n;var i=sg(e.audio);return i&&i.start<=t?i:null}function sg(e){if(!e)return null;switch(e.state){case nW:case nY:case n0:case n1:return null}return e.frag}function sm(e,t){return t.getAppendedFrag(e,j)||t.getPartialFragment(e)}function sp(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function sy(e,t,n,i,r){var a=new e(t,n,"");try{a.value=i,r&&(a.type=r)}catch(s){a=new e(t,n,e9(r?W({type:r},i):i))}return a}var sE=function(){var e=sp();try{e&&new e(0,1/0,"")}catch(e){return Number.MAX_VALUE}return 1/0}(),sk=function(){"use strict";function e(t){var n=this;(0,E._)(this,e),this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=function(){n.hls&&n.hls.trigger(O.EVENT_CUE_ENTER,{})},this.hls=t,this._registerListeners()}return(0,k._)(e,[{key:"destroy",value:function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}},{key:"_registerListeners",value:function(){var e=this.hls;e&&(e.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(O.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}},{key:"_unregisterListeners",value:function(){var e=this.hls;e&&(e.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(O.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}},{key:"onMediaAttaching",value:function(e,t){var n;this.media=t.media,(null==(n=t.overrides)?void 0:n.cueRemoval)===!1&&(this.removeCues=!1)}},{key:"onMediaAttached",value:function(){var e,t=null==(e=this.hls)?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}},{key:"onMediaDetaching",value:function(e,t){this.media=null,t.transferMedia||(this.id3Track&&(this.removeCues&&ar(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}},{key:"onManifestLoading",value:function(){this.dateRangeCuesAppended={}}},{key:"createTrack",value:function(e){var t=this.getID3Track(e.textTracks);return t.mode="hidden",t}},{key:"getID3Track",value:function(e){if(this.media){for(var t=0;t<e.length;t++){var n=e[t];if("metadata"===n.kind&&"id3"===n.label)return an(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}},{key:"onFragParsingMetadata",value:function(e,t){if(this.media&&this.hls){var n=this.hls.config,i=n.enableEmsgMetadataCues,r=n.enableID3MetadataCues;if(i||r){var a=t.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));var s=sp();if(s)for(var o=0;o<a.length;o++){var l=a[o].type;if((l!==ip.emsg||i)&&r){var u=iv(a[o].data),c=a[o].pts,h=c+a[o].duration;h>sE&&(h=sE),h-c<=0&&(h=c+.25);for(var d=0;d<u.length;d++){var f=u[d];if(!ig(f)){this.updateId3CueEnds(c,l);var v=sy(s,c,h,f,l);v&&this.id3Track.addCue(v)}}}}}}}},{key:"updateId3CueEnds",value:function(e,t){var n,i=null==(n=this.id3Track)?void 0:n.cues;if(i)for(var r=i.length;r--;){var a=i[r];a.type===t&&a.startTime<e&&a.endTime===sE&&(a.endTime=e)}}},{key:"onBufferFlushing",value:function(e,t){var n=t.startOffset,i=t.endOffset,r=t.type,a=this.id3Track,s=this.hls;if(s){var o=s.config,l=o.enableEmsgMetadataCues,u=o.enableID3MetadataCues;a&&(l||u)&&aa(a,n,i,"audio"===r?function(e){return e.type===ip.audioId3&&u}:"video"===r?function(e){return e.type===ip.emsg&&l}:function(e){return e.type===ip.audioId3&&u||e.type===ip.emsg&&l})}}},{key:"onLevelUpdated",value:function(e,t){var n=t.details;this.updateDateRangeCues(n,!0)}},{key:"onLevelPtsUpdated",value:function(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}},{key:"updateDateRangeCues",value:function(e,t){var n,i,r=this;if(!this.hls||!this.media)return;var a=this.hls.config,s=a.assetPlayerId,o=a.timelineOffset,l=a.enableDateRangeMetadataCues,u=a.interstitialsController;if(l){var c=sp();if(s&&o&&!u){var h=e.fragmentStart,d=e.fragmentEnd,f=this.assetCue;f?(f.startTime=h,f.endTime=d):c&&(f=this.assetCue=sy(c,h,d,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"))&&(f.id=s,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(f),f.addEventListener("enter",this.onEventCueEnter))}if(e.hasProgramDateTime){var v=this.id3Track,g=e.dateRanges,m=Object.keys(g),p=this.dateRangeCuesAppended;if(v&&t)if(null!=(n=v.cues)&&n.length)for(var y=Object.keys(p).filter(function(e){return!m.includes(e)}),E=y.length;E--;)!function(e){var t,n=y[e],i=null==(t=p[n])?void 0:t.cues;delete p[n],i&&Object.keys(i).forEach(function(e){var t=i[e];if(t){t.removeEventListener("enter",r.onEventCueEnter);try{v.removeCue(t)}catch(e){}}})}(E);else p=this.dateRangeCuesAppended={};var k=e.fragments[e.fragments.length-1];if(0!==m.length&&R(null==k?void 0:k.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var b=0;b<m.length;b++)i=this,function(e){var t=m[e],n=g[t],r=n.startTime,a=p[t],s=(null==a?void 0:a.cues)||{},o=(null==a?void 0:a.durationKnown)||!1,l=sE,h=n.duration;if(n.endDate&&null!==h)l=r+h,o=!0;else if(n.endOnNext&&!o){var d=m.reduce(function(e,t){if(t!==n.id){var i=g[t];if(i.class===n.class&&i.startDate>n.startDate&&(!e||n.startDate<e.startDate))return i}return e},null);d&&(l=d.startTime,o=!0)}for(var f=Object.keys(n.attr),v=0;v<f.length;v++){var y=f[v];if("ID"!==y&&"CLASS"!==y&&"CUE"!==y&&"START-DATE"!==y&&"DURATION"!==y&&"END-DATE"!==y&&"END-ON-NEXT"!==y){var E=s[y];if(E)o&&!(null!=a&&a.durationKnown)?E.endTime=l:Math.abs(E.startTime-r)>.01&&(E.startTime=r,E.endTime=l);else if(c){var k=n.attr[y];("SCTE35-OUT"===y||"SCTE35-IN"===y||"SCTE35-CMD"===y)&&(k=er(k));var b=sy(c,r,l,{key:y,data:k},ip.dateRange);b&&(b.id=t,i.id3Track.addCue(b),s[y]=b,u&&("X-ASSET-LIST"===y||"X-ASSET-URL"===y)&&b.addEventListener("enter",i.onEventCueEnter))}}}p[t]={cues:s,dateRange:n,durationKnown:o}}(b)}}}}}]),e}(),sb=function(){"use strict";function e(t){var n=this;(0,E._)(this,e),this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=function(){var e=n.media,t=n.levelDetails;if(!e||!t)return;n.currentTime=e.currentTime;var i=n.computeLatency();if(null!==i){n._latency=i;var r=n.config,a=r.lowLatencyMode,s=r.maxLiveSyncPlaybackRate;if(a&&1!==s&&t.live){var o=n.targetLatency;if(null!==o){var l=i-o;if(l<Math.min(n.maxLatency,o+t.targetduration)&&l>.05&&n.forwardBufferLength>1){var u=Math.min(Math.min(2,Math.max(1,s)),Math.max(1,Math.round(2/(1+Math.exp(-.75*l-n.edgeStalled))*20)/20));n.changeMediaPlaybackRate(e,u)}else 1!==e.playbackRate&&0!==e.playbackRate&&n.changeMediaPlaybackRate(e,1)}}}},this.hls=t,this.config=t.config,this.registerListeners()}return(0,k._)(e,[{key:"levelDetails",get:function(){var e;return(null==(e=this.hls)?void 0:e.latestLevelDetails)||null}},{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var e=this.config;if(void 0!==e.liveMaxLatencyDuration)return e.liveMaxLatencyDuration;var t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var e=this.levelDetails;if(null===e||null===this.hls)return null;var t=e.holdBack,n=e.partHoldBack,i=e.targetduration,r=this.config,a=r.liveSyncDuration,s=r.liveSyncDurationCount,o=r.lowLatencyMode,l=this.hls.userConfig,u=o&&n||t;return(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||0===u)&&(u=void 0!==a?a:s*i),u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,i)},set:function(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}},{key:"liveSyncPosition",get:function(){var e=this.estimateLiveEdge(),t=this.targetLatency;if(null===e||null===t)return null;var n=this.levelDetails;if(null===n)return null;var i=n.edge,r=e-t-this.edgeStalled;return Math.min(Math.max(i-n.totalduration,r),i-(this.config.lowLatencyMode&&n.partTarget||n.targetduration))}},{key:"drift",get:function(){var e=this.levelDetails;return null===e?1:e.drift}},{key:"edgeStalled",get:function(){var e=this.levelDetails;if(null===e)return 0;var t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}},{key:"forwardBufferLength",get:function(){var e=this.media,t=this.levelDetails;if(!e||!t)return 0;var n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}},{key:"destroy",value:function(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}},{key:"registerListeners",value:function(){var e=this.hls;e&&(e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(O.ERROR,this.onError,this))}},{key:"unregisterListeners",value:function(){var e=this.hls;e&&(e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(O.ERROR,this.onError,this))}},{key:"onMediaAttached",value:function(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}},{key:"onMediaDetaching",value:function(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}},{key:"onManifestLoading",value:function(){this._latency=null,this.stallCount=0}},{key:"onLevelUpdated",value:function(e,t){var n=t.details;n.advanced&&this.onTimeupdate(),!n.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}},{key:"onError",value:function(e,t){var n;t.details===P.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&null!=(n=this.levelDetails)&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}},{key:"changeMediaPlaybackRate",value:function(e,t){var n,i;e.playbackRate!==t&&(null==(n=this.hls)||n.logger.debug("[latency-controller]: latency=".concat(this.latency.toFixed(3),", targetLatency=").concat(null==(i=this.targetLatency)?void 0:i.toFixed(3),", forwardBufferLength=").concat(this.forwardBufferLength.toFixed(3),": adjusting playback rate from ").concat(e.playbackRate," to ").concat(t)),e.playbackRate=t)}},{key:"estimateLiveEdge",value:function(){var e=this.levelDetails;return null===e?null:e.edge+e.age}},{key:"computeLatency",value:function(){var e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}]),e}(),sT=function(e){"use strict";function t(e,n){var i;return(0,E._)(this,t),(i=(0,y._)(this,t,[e,"level-controller"]))._levels=[],i._firstLevel=-1,i._maxAutoLevel=-1,i._startLevel=void 0,i.currentLevel=null,i.currentLevelIndex=-1,i.manualLevelIndex=-1,i.steering=void 0,i.onParsedComplete=void 0,i.steering=n,i._registerListeners(),i}return(0,_._)(t,e),(0,k._)(t,[{key:"_registerListeners",value:function(){var e=this.hls;e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(O.LEVEL_LOADED,this.onLevelLoaded,this),e.on(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(O.FRAG_BUFFERED,this.onFragBuffered,this),e.on(O.ERROR,this.onError,this)}},{key:"_unregisterListeners",value:function(){var e=this.hls;e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(O.LEVEL_LOADED,this.onLevelLoaded,this),e.off(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(O.FRAG_BUFFERED,this.onFragBuffered,this),e.off(O.ERROR,this.onError,this)}},{key:"destroy",value:function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),(0,T._)((0,S._)(t.prototype),"destroy",this).call(this)}},{key:"stopLoad",value:function(){this._levels.forEach(function(e){e.loadError=0,e.fragmentError=0}),(0,T._)((0,S._)(t.prototype),"stopLoad",this).call(this)}},{key:"resetLevels",value:function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}},{key:"onManifestLoading",value:function(e,t){this.resetLevels()}},{key:"onManifestLoaded",value:function(e,t){var n=this,i=this.hls.config.preferManagedMediaSource,r=[],a={},s={},o=!1,l=!1,u=!1;t.levels.forEach(function(e){var t=e.attrs,c=e.audioCodec,h=e.videoCodec;c&&(e.audioCodec=c=eq(c,i)||void 0),h&&(h=e.videoCodec=function(e){for(var t=e.split(","),n=0;n<t.length;n++){var i=t[n].split(".");i.length>2&&"avc1"===i[0]&&(t[n]="avc1.".concat(parseInt(i[1]).toString(16)).concat(("000"+parseInt(i[2]).toString(16)).slice(-4)))}return t.join(",")}(h));var d=e.width,f=e.height,v=e.unknownCodecs,g=(null==v?void 0:v.length)||0;if(o||(o=!!(d&&f)),l||(l=!!h),u||(u=!!c),g||c&&!n.isAudioSupported(c)||h&&!n.isVideoSupported(h))return void n.log('Some or all CODECS not supported "'.concat(t.CODECS,'"'));var m=t.CODECS,p=t["FRAME-RATE"],y=t["HDCP-LEVEL"],E=t["PATHWAY-ID"],k=t.RESOLUTION,b=t["VIDEO-RANGE"],T="".concat("".concat(E||".","-")).concat(e.bitrate,"-").concat(k,"-").concat(p,"-").concat(m,"-").concat(b,"-").concat(y);if(a[T])if(a[T].uri===e.url||e.attrs["PATHWAY-ID"])a[T].addGroupId("audio",t.AUDIO),a[T].addGroupId("text",t.SUBTITLES);else{var S=s[T]+=1;e.attrs["PATHWAY-ID"]=Array(S+1).join(".");var _=n.createLevel(e);a[T]=_,r.push(_)}else{var A=n.createLevel(e);a[T]=A,s[T]=1,r.push(A)}}),this.filterAndSortMediaOptions(r,t,o,l,u)}},{key:"createLevel",value:function(e){var t=new e4(e),n=e.supplemental;if(null!=n&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){var i=Error('SUPPLEMENTAL-CODECS not supported "'.concat(n.videoCodec,'"'));this.log(i.message),t.supportedResult=eZ(i,[])}return t}},{key:"isAudioSupported",value:function(e){return eB(e,"audio",this.hls.config.preferManagedMediaSource)}},{key:"isVideoSupported",value:function(e){return eB(e,"video",this.hls.config.preferManagedMediaSource)}},{key:"filterAndSortMediaOptions",value:function(e,t,n,i,r){var a=this,s=[],o=[],l=e,u=(null==(v=t.stats)?void 0:v.parsing)||{};if((n||i)&&r&&(l=l.filter(function(e){var t,n=e.videoCodec,i=e.videoRange,r=e.width,a=e.height;return(!!n||!!(r&&a))&&!!(t=i)&&e2.indexOf(t)>-1})),0===l.length){Promise.resolve().then(function(){if(a.hls){var e="no level with compatible codecs found in manifest",n=e;t.levels.length&&(n="one or more CODECS in variant not supported: ".concat(e9(t.levels.map(function(e){return e.attrs.CODECS}).filter(function(e,t,n){return n.indexOf(e)===t}))),a.warn(n),e+=" (".concat(n,")"));var i=Error(e);a.hls.trigger(O.ERROR,{type:x.MEDIA_ERROR,details:P.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:i,reason:n})}}),u.end=performance.now();return}t.audioTracks&&sS(s=t.audioTracks.filter(function(e){return!e.audioCodec||a.isAudioSupported(e.audioCodec)})),t.subtitles&&sS(o=t.subtitles);var c=l.slice(0);l.sort(function(e,t){if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return e2.indexOf(e.videoRange)-e2.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){var i=eG(e.videoCodec),r=eG(t.videoCodec);if(i!==r)return r-i}if(e.uri===t.uri&&e.codecSet!==t.codecSet){var a=eK(e.codecSet),s=eK(t.codecSet);if(a!==s)return s-a}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0});var h=c[0];if(this.steering&&(l=this.steering.filterParsedLevels(l)).length!==c.length){for(var d=0;d<c.length;d++)if(c[d].pathwayId===l[0].pathwayId){h=c[d];break}}this._levels=l;for(var f=0;f<l.length;f++)if(l[f]===h){this._firstLevel=f;var v,g,m=h.bitrate,p=this.hls.bandwidthEstimate;if(this.log("manifest loaded, ".concat(l.length," level(s) found, first bitrate: ").concat(m)),(null==(g=this.hls.userConfig)?void 0:g.abrEwmaDefaultEstimate)===void 0){var y=Math.min(m,this.hls.config.abrEwmaDefaultEstimateMax);y>p&&p===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=y)}break}var E=r&&!i,k=this.hls.config,b=!!(k.audioStreamController&&k.audioTrackController),T={levels:l,audioTracks:s,subtitleTracks:o,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:i,altAudio:b&&!E&&s.some(function(e){return!!e.url})};u.end=performance.now(),this.hls.trigger(O.MANIFEST_PARSED,T)}},{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"loadLevelObj",get:function(){return this.currentLevel}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;if(0!==t.length){if(e<0||e>=t.length){var n=Error("invalid level idx"),i=e<0;if(this.hls.trigger(O.ERROR,{type:x.OTHER_ERROR,details:P.LEVEL_SWITCH_ERROR,level:e,fatal:i,error:n,reason:n.message}),i)return;e=Math.min(e,t.length-1)}var r=this.currentLevelIndex,a=this.currentLevel,s=a?a.attrs["PATHWAY-ID"]:void 0,o=t[e],l=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,r!==e||!a||s!==l){this.log("Switching to level ".concat(e," (").concat(o.height?o.height+"p ":"").concat(o.videoRange?o.videoRange+" ":"").concat(o.codecSet?o.codecSet+" ":"","@").concat(o.bitrate,")").concat(l?" with Pathway "+l:""," from level ").concat(r).concat(s?" with Pathway "+s:""));var u={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(O.LEVEL_SWITCHING,u);var c=o.details;if(!c||c.live){var h=this.switchParams(o.uri,null==a?void 0:a.details,c);this.loadPlaylist(h)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"pathways",get:function(){return this.steering?this.steering.pathways():[]}},{key:"pathwayPriority",get:function(){return this.steering?this.steering.pathwayPriority:null},set:function(e){if(this.steering){var t=this.steering.pathways(),n=e.filter(function(e){return -1!==t.indexOf(e)});if(e.length<1)return void this.warn("pathwayPriority ".concat(e," should contain at least one pathway from list: ").concat(t));this.steering.pathwayPriority=n}}},{key:"onError",value:function(e,t){!t.fatal&&t.context&&t.context.type===F&&t.context.level===this.level&&this.checkRetry(t)}},{key:"onFragBuffered",value:function(e,t){var n=t.frag;if(void 0!==n&&n.type===j){var i=n.elementaryStreams;if(!Object.keys(i).some(function(e){return!!i[e]}))return;var r=this._levels[n.level];null!=r&&r.loadError&&(this.log("Resetting level error count of ".concat(r.loadError," on frag buffered")),r.loadError=0)}}},{key:"onLevelLoaded",value:function(e,t){var n,i,r=t.level,a=t.details,s=t.levelInfo;if(!s){this.warn("Invalid level index ".concat(r)),null!=(i=t.deliveryDirectives)&&i.skip&&(a.deltaUpdateFailed=!0);return}if(s===this.currentLevel||t.withoutMultiVariant){0===s.fragmentError&&(s.loadError=0);var o=s.details;o===t.details&&o.advanced&&(o=void 0),this.playlistLoaded(r,t,o)}else null!=(n=t.deliveryDirectives)&&n.skip&&(a.deltaUpdateFailed=!0)}},{key:"loadPlaylist",value:function(e){(0,T._)((0,S._)(t.prototype),"loadPlaylist",this).call(this),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}},{key:"loadingPlaylist",value:function(e,n){(0,T._)((0,S._)(t.prototype),"loadingPlaylist",this).call(this,e,n);var i=this.getUrlWithDirectives(e.uri,n),r=this.currentLevelIndex,a=e.attrs["PATHWAY-ID"],s=e.details,o=null==s?void 0:s.age;this.log("Loading level index ".concat(r).concat((null==n?void 0:n.msn)!==void 0?" at sn "+n.msn+" part "+n.part:"").concat(a?" Pathway "+a:"").concat(o&&s.live?" age "+o.toFixed(1)+(s.type?" "+s.type:""):""," ").concat(i)),this.hls.trigger(O.LEVEL_LOADING,{url:i,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:n||null})}},{key:"nextLoadLevel",get:function(){return -1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}},{key:"removeLevel",value:function(e){var t,n=this;if(1!==this._levels.length){var i=this._levels.filter(function(t,i){return i!==e||(n.steering&&n.steering.removeLevel(t),t===n.currentLevel&&(n.currentLevel=null,n.currentLevelIndex=-1,t.details&&t.details.fragments.forEach(function(e){return e.level=-1})),!1)});nF(i),this._levels=i,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);var r=i.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(O.LEVELS_UPDATED,{levels:i})}}},{key:"onLevelsUpdated",value:function(e,t){var n=t.levels;this._levels=n}},{key:"checkMaxAutoUpdated",value:function(){var e=this.hls,t=e.autoLevelCapping,n=e.maxAutoLevel,i=e.maxHdcpLevel;this._maxAutoLevel!==n&&(this._maxAutoLevel=n,this.hls.trigger(O.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:t,levels:this.levels,maxAutoLevel:n,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}]),t}(ru);function sS(e){var t={};e.forEach(function(e){var n=e.groupId||"";e.id=t[n]=t[n]||0,t[n]++})}function s_(){return self.SourceBuffer||self.WebKitSourceBuffer}function sA(){if(!ee())return!1;var e=s_();return!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove}var sL=function(e){"use strict";function t(e,n,i){var r;return(0,E._)(this,t),(r=(0,y._)(this,t,[e,n,i,"stream-controller",j])).audioCodecSwap=!1,r.level=-1,r._forceStartLoad=!1,r._hasEnoughToStart=!1,r.altAudio=0,r.audioOnly=!1,r.fragPlaying=null,r.fragLastKbps=0,r.couldBacktrack=!1,r.backtrackFragment=null,r.audioCodecSwitch=!1,r.videoBuffer=null,r.onMediaPlaying=function(){r.tick()},r.onMediaSeeked=function(){var e=r.media,t=e?e.currentTime:null;if(null!==t&&R(t)&&(r.log("Media seeked to ".concat(t.toFixed(3))),r.getBufferedFrag(t))){var n=r.getFwdBufferInfoAtPos(e,t,j,0);if(null===n||0===n.len)return void r.warn("Main forward buffer length at ".concat(t,' on "seeked" event ').concat(n?n.len:"empty",")"));r.tick()}},r.registerListeners(),r}return(0,_._)(t,e),(0,k._)(t,[{key:"registerListeners",value:function(){(0,T._)((0,S._)(t.prototype),"registerListeners",this).call(this);var e=this.hls;e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.LEVEL_LOADING,this.onLevelLoading,this),e.on(O.LEVEL_LOADED,this.onLevelLoaded,this),e.on(O.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(O.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(O.BUFFER_CREATED,this.onBufferCreated,this),e.on(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(O.FRAG_BUFFERED,this.onFragBuffered,this)}},{key:"unregisterListeners",value:function(){(0,T._)((0,S._)(t.prototype),"unregisterListeners",this).call(this);var e=this.hls;e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.LEVEL_LOADED,this.onLevelLoaded,this),e.off(O.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(O.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(O.BUFFER_CREATED,this.onBufferCreated,this),e.off(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(O.FRAG_BUFFERED,this.onFragBuffered,this)}},{key:"onHandlerDestroying",value:function(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),(0,T._)((0,S._)(t.prototype),"onHandlerDestroying",this).call(this)}},{key:"startLoad",value:function(e,t){if(this.levels){var n=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){var r=i.startLevel;-1===r&&(i.config.testBandwidth&&this.levels.length>1?(r=0,this.bitrateTest=!0):r=i.firstAutoLevel),i.nextLoadLevel=r,this.level=i.loadLevel,this._hasEnoughToStart=!!t}n>0&&-1===e&&!t&&(this.log("Override startPosition with lastCurrentTime @".concat(n.toFixed(3))),e=n),this.state=nW,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=nY}},{key:"stopLoad",value:function(){this._forceStartLoad=!1,(0,T._)((0,S._)(t.prototype),"stopLoad",this).call(this)}},{key:"doTick",value:function(){switch(this.state){case n3:var e=this.levels,t=this.level,n=null==e?void 0:e[t],i=null==n?void 0:n.details;if(!i||i.live&&(this.levelLastLoaded!==n||this.waitForLive(n)))this.hls.nextLoadLevel!==this.level&&(this.state=nW);else{if(this.waitForCdnTuneIn(i))break;this.state=nW}break;case nQ:this.checkRetryDate()}this.state===nW&&this.doTickIdle(),this.onTickEnd()}},{key:"onTickEnd",value:function(){var e;(0,T._)((0,S._)(t.prototype),"onTickEnd",this).call(this),null!=(e=this.media)&&e.readyState&&!1===this.media.seeking&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}},{key:"doTickIdle",value:function(){var e=this.hls,t=this.levelLastLoaded,n=this.levels,i=this.media;if(null===t||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;var r=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(null!=n&&n[r]))return;var a=n[r],s=this.getMainFwdBufferInfo();if(null===s)return;var o=this.getLevelDetails();if(o&&this._streamEnded(s,o)){var l={};2===this.altAudio&&(l.type="video"),this.hls.trigger(O.BUFFER_EOS,l),this.state=n0;return}if(this.buffering){e.loadLevel!==r&&-1===e.manualLevel&&this.log("Adapting to level ".concat(r," from level ").concat(this.level)),this.level=e.nextLoadLevel=r;var u=a.details;if(!u||this.state===n3||this.waitForLive(a)){this.level=r,this.state=n3,this.startFragRequested=!1;return}var c=s.len,h=this.getMaxBufferLength(a.maxBitrate);if(!(c>=h)){this.backtrackFragment&&this.backtrackFragment.start>s.end&&(this.backtrackFragment=null);var d=this.backtrackFragment?this.backtrackFragment.start:s.end,f=this.getNextFragment(d,u);if(this.couldBacktrack&&!this.fragPrevious&&f&&ed(f)&&"OK"!==this.fragmentTracker.getState(f)){var v,g=(null!=(v=this.backtrackFragment)?v:f).sn-u.startSN,m=u.fragments[g-1];m&&f.cc===m.cc&&(f=m,this.fragmentTracker.removeFragment(m))}else this.backtrackFragment&&s.len&&(this.backtrackFragment=null);if(f&&this.isLoopLoading(f,d)){if(!f.gap){var p=this.audioOnly&&!this.altAudio?el:eu,y=(p===eu?this.videoBuffer:this.mediaBuffer)||this.media;y&&this.afterBufferFlushed(y,p,j)}f=this.getNextFragmentLoopLoading(f,u,s,j,h)}f&&(!f.initSegment||f.initSegment.data||this.bitrateTest||(f=f.initSegment),this.loadFragment(f,a,d))}}}},{key:"loadFragment",value:function(e,n,i){var r=this.fragmentTracker.getState(e);r===tT||r===t_?ed(e)?this.bitrateTest?(this.log("Fragment ".concat(e.sn," of level ").concat(e.level," is being downloaded to test bitrate and will not be buffered")),this._loadBitrateTestFrag(e,n)):(0,T._)((0,S._)(t.prototype),"loadFragment",this).call(this,e,n,i):this._loadInitSegment(e,n):this.clearTrackerIfNeeded(e)}},{key:"getBufferedFrag",value:function(e){return this.fragmentTracker.getBufferedFrag(e,j)}},{key:"followingBufferedFrag",value:function(e){return e?this.getBufferedFrag(e.end+.5):null}},{key:"immediateLevelSwitch",value:function(){this.abortCurrentFrag(),this.flushMainBuffer(0,1/0)}},{key:"nextLevelSwitch",value:function(){var e=this.levels,t=this.media;if(null!=t&&t.readyState){var n,i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);var r=this.getLevelDetails();if(null!=r&&r.live){var a=this.getMainFwdBufferInfo();if(!a||a.len<2*r.targetduration)return}if(!t.paused&&e){var s=e[this.hls.nextLoadLevel],o=this.fragLastKbps;n=o&&this.fragCurrent?this.fragCurrent.duration*s.maxBitrate/(1e3*o)+1:0}else n=0;var l=this.getBufferedFrag(t.currentTime+n);if(l){var u=this.followingBufferedFrag(l);if(u){this.abortCurrentFrag();var c=u.maxStartPTS?u.maxStartPTS:u.start,h=u.duration,d=Math.max(l.end,c+Math.min(Math.max(h-this.config.maxFragLookUpTolerance,h*(this.couldBacktrack?.5:.125)),h*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(d,1/0)}}}}},{key:"abortCurrentFrag",value:function(){var e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case nz:case nX:case nQ:case nZ:case nJ:this.state=nW}this.nextLoadPosition=this.getLoadPosition()}},{key:"flushMainBuffer",value:function(e,n){(0,T._)((0,S._)(t.prototype),"flushMainBuffer",this).call(this,e,n,2===this.altAudio?"video":null)}},{key:"onMediaAttached",value:function(e,n){(0,T._)((0,S._)(t.prototype),"onMediaAttached",this).call(this,e,n);var i=n.media;nH(i,"playing",this.onMediaPlaying),nH(i,"seeked",this.onMediaSeeked)}},{key:"onMediaDetaching",value:function(e,n){var i=this.media;i&&(nV(i,"playing",this.onMediaPlaying),nV(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,(0,T._)((0,S._)(t.prototype),"onMediaDetaching",this).call(this,e,n),n.transferMedia||(this._hasEnoughToStart=!1)}},{key:"onManifestLoading",value:function(){(0,T._)((0,S._)(t.prototype),"onManifestLoading",this).call(this),this.log("Trigger BUFFER_RESET"),this.hls.trigger(O.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}},{key:"onManifestParsed",value:function(e,t){for(var n,i,r=!1,a=!1,s=0;s<t.levels.length;s++){var o=t.levels[s].audioCodec;o&&(r=r||-1!==o.indexOf("mp4a.40.2"),a=a||-1!==o.indexOf("mp4a.40.5"))}this.audioCodecSwitch=r&&a&&"function"!=typeof(null==(i=s_())||null==(n=i.prototype)?void 0:n.changeType),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}},{key:"onLevelLoading",value:function(e,t){if(this.levels&&this.state===nW){var n=t.levelInfo;(!n.details||n.details.live&&(this.levelLastLoaded!==n||n.details.expired)||this.waitForCdnTuneIn(n.details))&&(this.state=n3)}}},{key:"onLevelLoaded",value:function(e,t){var n,i,r=this.levels,a=this.startFragRequested,s=t.level,o=t.details,l=o.totalduration;if(!r)return void this.warn("Levels were reset while loading level ".concat(s));this.log("Level ".concat(s," loaded [").concat(o.startSN,",").concat(o.endSN,"]").concat(o.lastPartSn?"[part-".concat(o.lastPartSn,"-").concat(o.lastPartIndex,"]"):"",", cc [").concat(o.startCC,", ").concat(o.endCC,"] duration:").concat(l));var u=t.levelInfo,c=this.fragCurrent;c&&(this.state===nX||this.state===nQ)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();var h=0;if(o.live||null!=(n=u.details)&&n.live){if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;h=this.alignPlaylists(o,u.details,null==(i=this.levelLastLoaded)?void 0:i.details)}if(u.details=o,this.levelLastLoaded=u,a||this.setStartPosition(o,h),this.hls.trigger(O.LEVEL_UPDATED,{details:o,level:s}),this.state===n3){if(this.waitForCdnTuneIn(o))return;this.state=nW}a&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}},{key:"synchronizeToLiveEdge",value:function(e){var t=this.config,n=this.media;if(n){var i=this.hls.liveSyncPosition,r=this.getLoadPosition(),a=e.fragmentStart,s=e.edge,o=r>=a-t.maxFragLookUpTolerance&&r<=s;if(null!==i&&n.duration>i&&(r<i||!o)){var l=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!o&&n.readyState<4||r<s-l)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),n.readyState))if(this.warn("Playback: ".concat(r.toFixed(3)," is located too far from the end of live sliding playlist: ").concat(s,", reset currentTime to : ").concat(i.toFixed(3))),"buffered"===this.config.liveSyncMode){var u,c=tG.bufferInfo(n,i,0);if(!(null!=(u=c.buffered)&&u.length)||c.start<=r){n.currentTime=i;return}var h=tG.bufferedInfo(c.buffered,r,0).nextStart;h&&(n.currentTime=h)}else n.currentTime=i}}}},{key:"_handleFragmentLoadProgress",value:function(e){var t,n=e.frag,i=e.part,r=e.payload,a=this.levels;if(!a)return void this.warn("Levels were reset while fragment load was in progress. Fragment ".concat(n.sn," of level ").concat(n.level," will not be buffered"));var s=a[n.level];if(!s)return void this.warn("Level ".concat(n.level," not found on progress"));var o=s.details;if(!o){this.warn("Dropping fragment ".concat(n.sn," of level ").concat(n.level," after level details were reset")),this.fragmentTracker.removeFragment(n);return}var l=s.videoCodec,u=o.PTSKnown||!o.live,c=null==(t=n.initSegment)?void 0:t.data,h=this._getAudioCodec(s),d=this.transmuxer=this.transmuxer||new ro(this.hls,j,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=i?i.index:-1,v=new tB(n.level,n.sn,n.stats.chunkCount,r.byteLength,f,-1!==f),g=this.initPTS[n.cc];d.push(r,c,h,l,n,i,o.totalduration,u,v,g)}},{key:"onAudioTrackSwitching",value:function(e,t){var n=this,i=this.hls,r=2===this.altAudio;if(ts(t.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.fragmentTracker.removeAllFragments(),i.once(O.BUFFER_FLUSHED,function(){n.hls&&n.hls.trigger(O.AUDIO_TRACK_SWITCHED,t)}),i.trigger(O.BUFFER_FLUSHING,{startOffset:0,endOffset:1/0,type:null});return}i.trigger(O.AUDIO_TRACK_SWITCHED,t)}}},{key:"onAudioTrackSwitched",value:function(e,t){var n=ts(t.url,this.hls);if(n){var i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=2*!!n,this.tick()}},{key:"onBufferCreated",value:function(e,t){var n,i,r=t.tracks,a=!1;for(var s in r){var o=r[s];if("main"===o.id){if(i=s,n=o,"video"===s){var l=r[s];l&&(this.videoBuffer=l.buffer)}}else a=!0}a&&n?(this.log("Alternate track found, use ".concat(i,".buffered to schedule main fragment loading")),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}},{key:"onFragBuffered",value:function(e,t){var n=t.frag,i=t.part,r=n.type===j;if(r){if(this.fragContextChanged(n)){this.warn("Fragment ".concat(n.sn).concat(i?" p: "+i.index:""," of level ").concat(n.level," finished buffering, but was aborted. state: ").concat(this.state)),this.state===nJ&&(this.state=nW);return}var a=i?i.stats:n.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),ed(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,i)}var s=this.media;s&&(!this._hasEnoughToStart&&tG.getBuffered(s).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}},{key:"hasEnoughToStart",get:function(){return this._hasEnoughToStart}},{key:"onError",value:function(e,t){var n;if(t.fatal){this.state=n1;return}switch(t.details){case P.FRAG_GAP:case P.FRAG_PARSING_ERROR:case P.FRAG_DECRYPT_ERROR:case P.FRAG_LOAD_ERROR:case P.FRAG_LOAD_TIMEOUT:case P.KEY_LOAD_ERROR:case P.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(j,t);break;case P.LEVEL_LOAD_ERROR:case P.LEVEL_LOAD_TIMEOUT:case P.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==n3||(null==(n=t.context)?void 0:n.type)!==F||(this.state=nW);break;case P.BUFFER_ADD_CODEC_ERROR:case P.BUFFER_APPEND_ERROR:if("main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case P.BUFFER_FULL_ERROR:if("main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,1/0));break;case P.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=nW,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}},{key:"onBufferFlushed",value:function(e,t){var n=t.type;if(n!==el||!this.altAudio){var i=(n===eu?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,n,j),this.tick())}}},{key:"onLevelsUpdated",value:function(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,-1===this.level&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"seekToStartPos",value:function(){var e=this.media;if(e){var t=e.currentTime,n=this.startPosition;if(n>=0&&t<n){if(e.seeking)return void this.log("could not seek to ".concat(n,", already seeking at ").concat(t));var i=this.timelineOffset;i&&n&&(n+=i);var r=this.getLevelDetails(),a=tG.getBuffered(e),s=a.length?a.start(0):0,o=s-n,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||o>0&&(o<l||this.loadingParts&&o<2*((null==r?void 0:r.partTarget)||0)))&&(this.log("adjusting start position by ".concat(o," to match buffer start")),n+=o,this.startPosition=n),t<n&&(this.log("seek to target start position ".concat(n," from current time ").concat(t," buffer start ").concat(s)),e.currentTime=n)}}}},{key:"_getAudioCodec",value:function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}},{key:"_loadBitrateTestFrag",value:function(e,t){var n=this;e.bitrateTest=!0,this._doFragLoad(e,t).then(function(e){var i=n.hls,r=null==e?void 0:e.frag;if(!(!r||n.fragContextChanged(r))){t.fragmentError=0,n.state=nW,n.startFragRequested=!1,n.bitrateTest=!1;var a=r.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),i.trigger(O.FRAG_LOADED,e),r.bitrateTest=!1}}).catch(function(t){n.state!==nY&&n.state!==n1&&(n.warn(t),n.resetFragmentLoading(e))})}},{key:"_handleTransmuxComplete",value:function(e){var t=this.playlistType,n=this.hls,i=e.remuxResult,r=e.chunkMeta,a=this.getCurrentContext(r);if(!a)return void this.resetWhenMissingContext(r);var s=a.frag,o=a.part,l=a.level,u=i.video,c=i.text,h=i.id3,d=i.initSegment,f=l.details,v=this.altAudio?void 0:i.audio;if(this.fragContextChanged(s))return void this.fragmentTracker.removeFragment(s);if(this.state=nZ,d){var g=d.tracks;if(g){var m=s.initSegment||s;if(this.unhandledEncryptionError(d,s))return;this._bufferInitSegment(l,g,m,r),n.trigger(O.FRAG_PARSING_INIT_SEGMENT,{frag:m,id:t,tracks:g})}var p=d.initPTS,y=d.timescale,E=this.initPTS[s.cc];if(R(p)&&(!E||E.baseTime!==p||E.timescale!==y)){var k=d.trackId;this.initPTS[s.cc]={baseTime:p,timescale:y,trackId:k},n.trigger(O.INIT_PTS_FOUND,{frag:s,id:t,initPTS:p,timescale:y,trackId:k})}}if(u&&f){v&&"audiovideo"===u.type&&this.logMuxedErr(s);var b=f.fragments[s.sn-1-f.startSN],T=s.sn===f.startSN,S=!b||s.cc>b.cc;if(!1!==i.independent){var _=u.startPTS,A=u.endPTS,L=u.startDTS,w=u.endDTS;if(o)o.elementaryStreams[u.type]={startPTS:_,endPTS:A,startDTS:L,endDTS:w};else if(u.firstKeyFrame&&u.independent&&1===r.id&&!S&&(this.couldBacktrack=!0),u.dropped&&u.independent){var I=this.getMainFwdBufferInfo(),D=(I?I.end:this.getLoadPosition())+this.config.maxBufferHole,C=u.firstKeyFramePTS?u.firstKeyFramePTS:_;if(!T&&D<C-this.config.maxBufferHole&&!S)return void this.backtrack(s);S&&(s.gap=!0),s.setElementaryStreamInfo(u.type,s.start,A,s.start,w,!0)}else T&&_-(f.appliedTimelineOffset||0)>2&&(s.gap=!0);s.setElementaryStreamInfo(u.type,_,A,L,w),this.backtrackFragment&&(this.backtrackFragment=s),this.bufferFragmentData(u,s,o,r,T||S)}else{if(!T&&!S)return void this.backtrack(s);s.gap=!0}}if(v){var x=v.startPTS,P=v.endPTS,M=v.startDTS,F=v.endDTS;o&&(o.elementaryStreams[el]={startPTS:x,endPTS:P,startDTS:M,endDTS:F}),s.setElementaryStreamInfo(el,x,P,M,F),this.bufferFragmentData(v,s,o,r)}if(f&&null!=h&&h.samples.length){var N={id:t,frag:s,details:f,samples:h.samples};n.trigger(O.FRAG_PARSING_METADATA,N)}if(f&&c){var B={id:t,frag:s,details:f,samples:c.samples};n.trigger(O.FRAG_PARSING_USERDATA,B)}}},{key:"logMuxedErr",value:function(e){this.warn("".concat(ed(e)?"Media":"Init"," segment with muxed audiovideo where only video expected: ").concat(e.url))}},{key:"_bufferInitSegment",value:function(e,t,n,i){var r=this;if(this.state===nZ){this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));var a=t.audio,s=t.video,o=t.audiovideo;if(a){var l=e.audioCodec,u=eY(a.codec,l);"mp4a"===u&&(u="mp4a.40.5");var c=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){u&&(u=-1!==u.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");var h=a.metadata;h&&"channelCount"in h&&1!==(h.channelCount||1)&&-1===c.indexOf("firefox")&&(u="mp4a.40.5")}u&&-1!==u.indexOf("mp4a.40.5")&&-1!==c.indexOf("android")&&"audio/mpeg"!==a.container&&(u="mp4a.40.2",this.log("Android: force audio codec to ".concat(u))),l&&l!==u&&this.log('Swapping manifest audio codec "'.concat(l,'" for "').concat(u,'"')),a.levelCodec=u,a.id=j,this.log("Init audio buffer, container:".concat(a.container,", codecs[selected/level/parsed]=[").concat(u||"","/").concat(l||"","/").concat(a.codec,"]")),delete t.audiovideo}if(s){s.levelCodec=e.videoCodec,s.id=j;var d=s.codec;if((null==d?void 0:d.length)===4)switch(d){case"hvc1":case"hev1":s.codec="hvc1.1.6.L120.90";break;case"av01":s.codec="av01.0.04M.08";break;case"avc1":s.codec="avc1.42e01e"}this.log("Init video buffer, container:".concat(s.container,", codecs[level/parsed]=[").concat(e.videoCodec||"","/").concat(d,"]").concat(s.codec!==d?" parsed-corrected="+s.codec:"").concat(s.supplemental?" supplemental="+s.supplemental:"")),delete t.audiovideo}o&&(this.log("Init audiovideo buffer, container:".concat(o.container,", codecs[level/parsed]=[").concat(e.codecs,"/").concat(o.codec,"]")),delete t.video,delete t.audio);var f=Object.keys(t);if(f.length){if(this.hls.trigger(O.BUFFER_CODECS,t),!this.hls)return;f.forEach(function(e){var a=t[e].initSegment;null!=a&&a.byteLength&&r.hls.trigger(O.BUFFER_APPENDING,{type:e,data:a,frag:n,part:null,chunkMeta:i,parent:n.type})})}this.tickImmediate()}}},{key:"getMainFwdBufferInfo",value:function(){var e=this.mediaBuffer&&2===this.altAudio?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,j)}},{key:"maxBufferLength",get:function(){var e=this.levels,t=this.level,n=null==e?void 0:e[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}},{key:"backtrack",value:function(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=nW}},{key:"checkFragmentChanged",value:function(){var e=this.media,t=null;if(e&&e.readyState>1&&!1===e.seeking){var n=e.currentTime;if(tG.isBuffered(e,n)?t=this.getAppendedFrag(n):tG.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;var i=this.fragPlaying,r=t.level;(!i||t.sn!==i.sn||i.level!==r)&&(this.fragPlaying=t,this.hls.trigger(O.FRAG_CHANGED,{frag:t}),i&&i.level===r||this.hls.trigger(O.LEVEL_SWITCHED,{level:r}))}}}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentFrag",get:function(){if(this.fragPlaying)return this.fragPlaying;var e,t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;return R(t)?this.getAppendedFrag(t):null}},{key:"currentProgramDateTime",get:function(){var e,t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;if(R(t)){var n=this.getLevelDetails(),i=this.currentFrag||(n?tu(null,n.fragments,t):null);if(i){var r=i.programDateTime;if(null!==r)return new Date(r+(t-i.start)*1e3)}}return null}},{key:"currentLevel",get:function(){var e=this.currentFrag;return e?e.level:-1}},{key:"nextBufferedFrag",get:function(){var e=this.currentFrag;return e?this.followingBufferedFrag(e):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),t}(n5),sw=function(e){"use strict";function t(e,n){var i;return(0,E._)(this,t),(i=(0,y._)(this,t,["key-loader",n])).config=void 0,i.keyIdToKeyInfo={},i.emeController=null,i.config=e,i}return(0,_._)(t,e),(0,k._)(t,[{key:"abort",value:function(e){for(var t in this.keyIdToKeyInfo){var n,i=this.keyIdToKeyInfo[t].loader;if(i){if(e&&e!==(null==(n=i.context)?void 0:n.frag.type))return;i.abort()}}}},{key:"detach",value:function(){for(var e in this.keyIdToKeyInfo){var t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}},{key:"destroy",value:function(){for(var e in this.detach(),this.keyIdToKeyInfo){var t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}},{key:"createKeyLoadError",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.KEY_LOAD_ERROR,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;return new tF({type:x.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:n,networkDetails:i})}},{key:"loadClear",value:function(e,t,n){var i,r=this;if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(var a=0,s=t.length;a<s;a++){var o=(i=this,function(a,s){var o=t[a];if(e.cc<=o.cc&&(!ed(e)||!ed(o)||e.sn<o.sn)||!n&&a==s-1)return{v:i.emeController.selectKeySystemFormat(o).then(function(e){if(r.emeController){o.setKeyFormat(e);var t=ni(e);if(t)return r.emeController.getKeySystemAccess([t])}})}}(a,s));if("object"===(0,w._)(o))return o.v}if(this.config.requireKeySystemAccessOnStart){var l=na(this.config);if(l.length)return this.emeController.getKeySystemAccess(l)}}return null}},{key:"load",value:function(e){var t=this;return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(function(n){return t.loadInternal(e,n)}):this.loadInternal(e)}},{key:"loadInternal",value:function(e,t){t&&e.setKeyFormat(t);var n,i,r=e.decryptdata;if(!r){var a=Error(t?"Expected frag.decryptdata to be defined after setting format ".concat(t):"Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ".concat(this.emeController&&this.config.emeEnabled,")"));return Promise.reject(this.createKeyLoadError(e,P.KEY_LOAD_ERROR,a))}var s=r.uri;if(!s)return Promise.reject(this.createKeyLoadError(e,P.KEY_LOAD_ERROR,Error('Invalid key URI: "'.concat(s,'"'))));var o=sI(r),l=this.keyIdToKeyInfo[o];if(null!=(n=l)&&n.decryptdata.key)return r.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&null!=(i=l)&&i.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(function(t){var n=t.keyInfo;return r.key=n.decryptdata.key,{frag:e,keyInfo:n}})}switch(this.log("".concat(this.keyIdToKeyInfo[o]?"Rel":"L","oading").concat(r.keyId?" keyId: "+ei(r.keyId):""," URI: ").concat(r.uri," from ").concat(e.type," ").concat(e.level)),l=this.keyIdToKeyInfo[o]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":if("identity"===r.keyFormat)return this.loadKeyHTTP(l,e);return this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,P.KEY_LOAD_ERROR,Error('Key supplied with unsupported METHOD: "'.concat(r.method,'"'))))}}},{key:"loadKeyEME",value:function(e,t){var n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){if(!e.decryptdata.keyId&&null!=(a=t.initSegment)&&a.data){var i,r,a,s=(i=t.initSegment.data,r=[],eI(i,function(e){return r.push(e.subarray(8,24))}),r);if(s.length){var o=s[0];o.some(function(e){return 0!==e})&&(this.log("Using keyId found in init segment ".concat(ei(o))),e.decryptdata.keyId=o,nu.setKeyIdForUri(e.decryptdata.uri,o))}}return(e.keyLoadPromise=this.emeController.loadKey(n).then(function(t){return e.mediaKeySessionContext=t,n})).catch(function(n){throw e.keyLoadPromise=null,"data"in n&&(n.data.frag=t),n})}return Promise.resolve(n)}},{key:"loadKeyHTTP",value:function(e,t){var n=this,i=this.config,r=new i.loader(i);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise(function(a,s){var o={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},l=i.keyLoadPolicy.default,u={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0};r.load(o,u,{onSuccess:function(e,t,i,r){var o=i.frag,l=i.keyInfo,u=sI(l.decryptdata);if(!o.decryptdata||l!==n.keyIdToKeyInfo[u])return s(n.createKeyLoadError(o,P.KEY_LOAD_ERROR,Error("after key load, decryptdata unset or changed"),r));l.decryptdata.key=o.decryptdata.key=new Uint8Array(e.data),o.keyLoader=null,l.loader=null,a({frag:o,keyInfo:l})},onError:function(e,i,r,a){n.resetLoader(i),s(n.createKeyLoadError(t,P.KEY_LOAD_ERROR,Error("HTTP Error ".concat(e.code," loading key ").concat(e.text)),r,W({url:o.url,data:void 0},e)))},onTimeout:function(e,i,r){n.resetLoader(i),s(n.createKeyLoadError(t,P.KEY_LOAD_TIMEOUT,Error("key loading timed out"),r))},onAbort:function(e,i,r){n.resetLoader(i),s(n.createKeyLoadError(t,P.INTERNAL_ABORTED,Error("key loading aborted"),r))}})})}},{key:"resetLoader",value:function(e){var t=e.frag,n=e.keyInfo,i=e.url,r=n.loader;t.keyLoader===r&&(t.keyLoader=null,n.loader=null);var a=sI(n.decryptdata)||i;delete this.keyIdToKeyInfo[a],r&&r.destroy()}}]),t}(z);function sI(e){if(e.keyFormat!==ne){var t=e.keyId;if(t)return ei(t)}return e.uri}function sR(e){switch(e.type){case B:return G;case U:return K;default:return j}}function sD(e,t){var n=e.url;return(void 0===n||0===n.indexOf("data:"))&&(n=t.url),n}var sC=function(){"use strict";function e(t){(0,E._)(this,e),this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=t,this.registerListeners()}return(0,k._)(e,[{key:"startLoad",value:function(e){}},{key:"stopLoad",value:function(){this.destroyInternalLoaders()}},{key:"registerListeners",value:function(){var e=this.hls;e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.LEVEL_LOADING,this.onLevelLoading,this),e.on(O.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(O.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(O.LEVELS_UPDATED,this.onLevelsUpdated,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.LEVEL_LOADING,this.onLevelLoading,this),e.off(O.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(O.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(O.LEVELS_UPDATED,this.onLevelsUpdated,this)}},{key:"createInternalLoader",value:function(e){var t=this.hls.config,n=t.pLoader,i=t.loader,r=new(n||i)(t);return this.loaders[e.type]=r,r}},{key:"getInternalLoader",value:function(e){return this.loaders[e.type]}},{key:"resetInternalLoader",value:function(e){this.loaders[e]&&delete this.loaders[e]}},{key:"destroyInternalLoaders",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}},{key:"destroy",value:function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}},{key:"onManifestLoading",value:function(e,t){var n=t.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:M,url:n,deliveryDirectives:null,levelOrTrack:null})}},{key:"onLevelLoading",value:function(e,t){var n=t.id,i=t.level,r=t.pathwayId,a=t.url,s=t.deliveryDirectives,o=t.levelInfo;this.load({id:n,level:i,pathwayId:r,responseType:"text",type:F,url:a,deliveryDirectives:s,levelOrTrack:o})}},{key:"onAudioTrackLoading",value:function(e,t){var n=t.id,i=t.groupId,r=t.url,a=t.deliveryDirectives,s=t.track;this.load({id:n,groupId:i,level:null,responseType:"text",type:B,url:r,deliveryDirectives:a,levelOrTrack:s})}},{key:"onSubtitleTrackLoading",value:function(e,t){var n=t.id,i=t.groupId,r=t.url,a=t.deliveryDirectives,s=t.track;this.load({id:n,groupId:i,level:null,responseType:"text",type:U,url:r,deliveryDirectives:a,levelOrTrack:s})}},{key:"onLevelsUpdated",value:function(e,t){var n=this.loaders[F];if(n){var i=n.context;i&&!t.levels.some(function(e){return e===i.levelOrTrack})&&(n.abort(),delete this.loaders[F])}}},{key:"load",value:function(e){var t,n,i,r=this,a=this.hls.config,s=this.getInternalLoader(e);if(s){var o=this.hls.logger,l=s.context;if(l&&l.levelOrTrack===e.levelOrTrack&&(l.url===e.url||l.deliveryDirectives&&!e.deliveryDirectives))return void(l.url===e.url?o.log("[playlist-loader]: ignore ".concat(e.url," ongoing request")):o.log("[playlist-loader]: ignore ".concat(e.url," in favor of ").concat(l.url)));o.log("[playlist-loader]: aborting previous loader for type: ".concat(e.type)),s.abort()}if(n=e.type===M?a.manifestLoadPolicy.default:q({},a.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),R(null==(t=e.deliveryDirectives)?void 0:t.part)&&(e.type===F&&null!==e.level?i=this.hls.levels[e.level].details:e.type===B&&null!==e.id?i=this.hls.audioTracks[e.id].details:e.type===U&&null!==e.id&&(i=this.hls.subtitleTracks[e.id].details),i)){var u=i.partTarget,c=i.targetduration;if(u&&c){var h=1e3*Math.max(3*u,.8*c);n=q({},n,{maxTimeToFirstByteMs:Math.min(h,n.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(h,n.maxTimeToFirstByteMs)})}}var d=n.errorRetry||n.timeoutRetry||{},f={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:d.maxNumRetry||0,retryDelay:d.retryDelayMs||0,maxRetryDelay:d.maxRetryDelayMs||0};s.load(e,f,{onSuccess:function(e,t,n,i){var a=r.getInternalLoader(n);r.resetInternalLoader(n.type);var s=e.data;t.parsing.start=performance.now(),nm.isMediaPlaylist(s)||n.type!==M?r.handleTrackOrLevelPlaylist(e,t,n,i||null,a):r.handleMasterPlaylist(e,t,n,i)},onError:function(e,t,n,i){r.handleNetworkError(t,n,!1,e,i)},onTimeout:function(e,t,n){r.handleNetworkError(t,n,!0,void 0,e)}})}},{key:"checkAutostartLoad",value:function(){if(this.hls){var e=this.hls,t=e.config,n=t.autoStartLoad,i=t.startPosition,r=e.forceStartLoad;(n||r)&&(this.hls.logger.log("".concat(n?"auto":"force"," startLoad with configured startPosition ").concat(i)),this.hls.startLoad(i))}}},{key:"handleMasterPlaylist",value:function(e,t,n,i){var r=this,a=this.hls,s=e.data,o=sD(e,n),l=nm.parseMasterPlaylist(s,o);if(l.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,n,l.playlistParsingError,i,t);return}var u=l.contentSteering,c=l.levels,h=l.sessionData,d=l.sessionKeys,f=l.startTimeOffset,v=l.variableList;this.variableList=v,c.forEach(function(e){var t=e.unknownCodecs;if(t)for(var n=r.hls.config.preferManagedMediaSource,i=e.audioCodec,a=e.videoCodec,s=t.length;s--;){var o=t[s];eB(o,"audio",n)?(e.audioCodec=i=i?"".concat(i,",").concat(o):o,eF.audio[i.substring(0,4)]=2,t.splice(s,1)):eB(o,"video",n)&&(e.videoCodec=a=a?"".concat(a,",").concat(o):o,eF.video[a.substring(0,4)]=2,t.splice(s,1))}});var g=nm.parseMasterPlaylistMedia(s,o,l),m=g.AUDIO,p=void 0===m?[]:m,y=g.SUBTITLES,E=g["CLOSED-CAPTIONS"];p.length&&(p.some(function(e){return!e.url})||!c[0].audioCodec||c[0].attrs.AUDIO||(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new tW({}),bitrate:0,url:""}))),a.trigger(O.MANIFEST_LOADED,{levels:c,audioTracks:p,subtitles:y,captions:E,contentSteering:u,url:o,stats:t,networkDetails:i,sessionData:h,sessionKeys:d,startTimeOffset:f,variableList:v})}},{key:"handleTrackOrLevelPlaylist",value:function(e,t,n,i,r){var a=this.hls,s=n.id,o=n.level,l=n.type,u=sD(e,n),c=R(o)?o:R(s)?s:0,h=sR(n),d=nm.parseLevelPlaylist(e.data,u,c,h,0,this.variableList);if(l===M){var f={attrs:new tW({}),bitrate:0,details:d,name:"",url:u};d.requestScheduled=t.loading.start+nx(d,0),a.trigger(O.MANIFEST_LOADED,{levels:[f],audioTracks:[],url:u,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=d,this.handlePlaylistLoaded(d,e,t,n,i,r)}},{key:"handleManifestParsingError",value:function(e,t,n,i,r){this.hls.trigger(O.ERROR,{type:x.NETWORK_ERROR,details:P.MANIFEST_PARSING_ERROR,fatal:t.type===M,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:i,stats:r})}},{key:"handleNetworkError",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,a="A network ".concat(n?"timeout":"error"+(i?" (status "+i.code+")":"")," occurred while loading ").concat(e.type);e.type===F?a+=": ".concat(e.level," id: ").concat(e.id):(e.type===B||e.type===U)&&(a+=" id: ".concat(e.id,' group-id: "').concat(e.groupId,'"'));var s=Error(a);this.hls.logger.warn("[playlist-loader]: ".concat(a));var o=P.UNKNOWN,l=!1,u=this.getInternalLoader(e);switch(e.type){case M:o=n?P.MANIFEST_LOAD_TIMEOUT:P.MANIFEST_LOAD_ERROR,l=!0;break;case F:o=n?P.LEVEL_LOAD_TIMEOUT:P.LEVEL_LOAD_ERROR,l=!1;break;case B:o=n?P.AUDIO_TRACK_LOAD_TIMEOUT:P.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case U:o=n?P.SUBTITLE_TRACK_LOAD_TIMEOUT:P.SUBTITLE_LOAD_ERROR,l=!1}u&&this.resetInternalLoader(e.type);var c={type:x.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:u,context:e,error:s,networkDetails:t,stats:r};i&&(c.response=W({url:(null==t?void 0:t.url)||e.url,data:void 0},i)),this.hls.trigger(O.ERROR,c)}},{key:"handlePlaylistLoaded",value:function(e,t,n,i,r,a){var s=this.hls,o=i.type,l=i.level,u=i.levelOrTrack,c=i.id,h=i.groupId,d=i.deliveryDirectives,f=sD(t,i),v=sR(i),g="number"==typeof i.level&&v===j?l:void 0,m=e.playlistParsingError;if(m){if(this.hls.logger.warn("".concat(m," ").concat(e.url)),!s.config.ignorePlaylistParsingErrors)return void s.trigger(O.ERROR,{type:x.NETWORK_ERROR,details:P.LEVEL_PARSING_ERROR,fatal:!1,url:f,error:m,reason:m.message,response:t,context:i,level:g,parent:v,networkDetails:r,stats:n});e.playlistParsingError=null}if(!e.fragments.length){var p=e.playlistParsingError=Error("No Segments found in Playlist");s.trigger(O.ERROR,{type:x.NETWORK_ERROR,details:P.LEVEL_EMPTY_ERROR,fatal:!1,url:f,error:p,reason:p.message,response:t,context:i,level:g,parent:v,networkDetails:r,stats:n});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),o){case M:case F:if(g)if(u){if(u!==s.levels[g]){var y=s.levels.indexOf(u);y>-1&&(g=y)}}else g=0;s.trigger(O.LEVEL_LOADED,{details:e,levelInfo:u||s.levels[0],level:g||0,id:c||0,stats:n,networkDetails:r,deliveryDirectives:d,withoutMultiVariant:o===M});break;case B:s.trigger(O.AUDIO_TRACK_LOADED,{details:e,track:u,id:c||0,groupId:h||"",stats:n,networkDetails:r,deliveryDirectives:d});break;case U:s.trigger(O.SUBTITLE_TRACK_LOADED,{details:e,track:u,id:c||0,groupId:h||"",stats:n,networkDetails:r,deliveryDirectives:d})}}}]),e}();(function(){"use strict";function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,E._)(this,e),this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new n9,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;var i=this.logger=function(e,t,n){var i=$();if(("undefined"==typeof console?"undefined":(0,w._)(console))==="object"&&!0===e||(void 0===e?"undefined":(0,w._)(e))==="object"){var r=["debug","log","info","warn","error"];r.forEach(function(t){i[t]=Z(t,e,n)});try{i.log('Debug logs enabled for "'.concat(t,'" in hls.js version ',"1.6.13"))}catch(e){return $()}r.forEach(function(t){J[t]=Z(t,e)})}else q(J,i);return i}(n.debug||!1,"Hls instance",n.assetPlayerId),r=this.config=function(e,t,n){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var i=function e(t){return t&&(void 0===t?"undefined":(0,w._)(t))==="object"?Array.isArray(t)?t.map(e):Object.keys(t).reduce(function(n,i){return n[i]=e(t[i]),n},{}):t}(e),r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(function(e){var a="".concat("level"===e?"playlist":e,"LoadPolicy"),s=void 0===t[a],o=[];r.forEach(function(n){var r="".concat(e,"Loading").concat(n),l=t[r];if(void 0!==l&&s){o.push(r);var u=i[a].default;switch(t[a]={default:u},n){case"TimeOut":u.maxLoadTimeMs=l,u.maxTimeToFirstByteMs=l;break;case"MaxRetry":u.errorRetry.maxNumRetry=l,u.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":u.errorRetry.retryDelayMs=l,u.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":u.errorRetry.maxRetryDelayMs=l,u.timeoutRetry.maxRetryDelayMs=l}}}),o.length&&n.warn('hls.js config: "'.concat(o.join('", "'),'" setting(s) are deprecated, use "').concat(a,'": ').concat(e9(t[a])))}),W(W({},i),t)}(e.DefaultConfig,n,i);this.userConfig=n,r.progressive&&((t=r.loader)!==so&&t!==sh?(i.log("[config]: Custom loader detected, cannot enable progressive streaming"),r.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}()&&(r.loader=so,r.progressive=!0,r.enableSoftwareAES=!0,i.log("[config]: Progressive streaming enabled, using FetchLoader")));var a=r.abrController,s=r.bufferController,o=r.capLevelController,l=r.errorController,u=r.fpsController,c=new l(this),h=this.abrController=new a(this),d=new tA(this),f=r.interstitialsController,v=f?this.interstitialsController=new f(this,e):null,g=this.bufferController=new s(this,d),m=this.capLevelController=new o(this),p=new u(this),y=new sC(this),k=r.contentSteeringController,b=k?new k(this):null,T=this.levelController=new sT(this,b),S=new sk(this),_=new sw(this.config,this.logger),A=this.streamController=new sL(this,d,_),L=this.gapController=new sf(this,d);m.setStreamController(A),p.setStreamController(A);var I=[y,T,A];v&&I.splice(1,0,v),b&&I.splice(1,0,b),this.networkControllers=I;var R=[h,g,L,m,p,S,d];this.audioTrackController=this.createController(r.audioTrackController,I);var D=r.audioStreamController;D&&I.push(this.audioStreamController=new D(this,d,_)),this.subtitleTrackController=this.createController(r.subtitleTrackController,I);var C=r.subtitleStreamController;C&&I.push(this.subtititleStreamController=new C(this,d,_)),this.createController(r.timelineController,R),_.emeController=this.emeController=this.createController(r.emeController,R),this.cmcdController=this.createController(r.cmcdController,R),this.latencyController=this.createController(sb,R),this.coreComponents=R,I.push(c);var x=c.onErrorOut;"function"==typeof x&&this.on(O.ERROR,x,c),this.on(O.MANIFEST_LOADED,y.onManifestLoaded,y)}return(0,k._)(e,[{key:"createController",value:function(e,t){if(e){var n=new e(this);return t&&t.push(n),n}return null}},{key:"on",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.on(e,t,n)}},{key:"once",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.once(e,t,n)}},{key:"removeAllListeners",value:function(e){this._emitter.removeAllListeners(e)}},{key:"off",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,i=arguments.length>3?arguments[3]:void 0;this._emitter.off(e,t,n,i)}},{key:"listeners",value:function(e){return this._emitter.listeners(e)}},{key:"emit",value:function(e,t,n){return this._emitter.emit(e,t,n)}},{key:"trigger",value:function(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),!this.triggeringException){this.triggeringException=!0;var n=e===O.ERROR;this.trigger(O.ERROR,{type:x.OTHER_ERROR,details:P.INTERNAL_EXCEPTION,fatal:n,event:e,error:t}),this.triggeringException=!1}}return!1}},{key:"listenerCount",value:function(e){return this._emitter.listenerCount(e)}},{key:"destroy",value:function(){this.logger.log("destroy"),this.trigger(O.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(function(e){return e.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(e){return e.destroy()}),this.coreComponents.length=0;var e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}},{key:"attachMedia",value:function(e){if(!e||"media"in e&&!e.media){var t=Error("attachMedia failed: invalid argument (".concat(e,")"));this.trigger(O.ERROR,{type:x.OTHER_ERROR,details:P.ATTACH_MEDIA_ERROR,fatal:!0,error:t});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());var n="media"in e,i=n?e.media:e,r=n?e:{media:i};this._media=i,this.trigger(O.MEDIA_ATTACHING,r)}},{key:"detachMedia",value:function(){this.logger.log("detachMedia"),this.trigger(O.MEDIA_DETACHING,{}),this._media=null}},{key:"transferMedia",value:function(){this._media=null;var e=this.bufferController.transferMedia();return this.trigger(O.MEDIA_DETACHING,{transferMedia:e}),e}},{key:"loadSource",value:function(e){this.stopLoad();var t=this.media,n=this._url,i=this._url=es.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log("loadSource:".concat(i)),t&&n&&(n!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(O.MANIFEST_LOADING,{url:e})}},{key:"url",get:function(){return this._url}},{key:"hasEnoughToStart",get:function(){return this.streamController.hasEnoughToStart}},{key:"startPosition",get:function(){return this.streamController.startPositionValue}},{key:"startLoad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1?arguments[1]:void 0;this.logger.log("startLoad(".concat(e+(t?", <skip seek to start>":""),")")),this.started=!0,this.resumeBuffering();for(var n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),this.started&&this.networkControllers);n++);}},{key:"stopLoad",value:function(){this.logger.log("stopLoad"),this.started=!1;for(var e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!this.started&&this.networkControllers);e++);}},{key:"loadingEnabled",get:function(){return this.started}},{key:"bufferingEnabled",get:function(){return this.streamController.bufferingEnabled}},{key:"resumeBuffering",value:function(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(function(e){e.resumeBuffering&&e.resumeBuffering()}))}},{key:"pauseBuffering",value:function(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(function(e){e.pauseBuffering&&e.pauseBuffering()}))}},{key:"inFlightFragments",get:function(){var e=(0,b._)({},j,this.streamController.inFlightFrag);return this.audioStreamController&&(e[G]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[K]=this.subtititleStreamController.inFlightFrag),e}},{key:"swapAudioCodec",value:function(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){this.logger.log("recoverMediaError");var e=this._media,t=null==e?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}},{key:"removeLevel",value:function(e){this.levelController.removeLevel(e)}},{key:"sessionId",get:function(){var e=this._sessionId;return e||(e=this._sessionId=function(){try{return crypto.randomUUID()}catch(i){try{var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(e){var n=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==e?t:3&t|8).toString(16)})}}}()),e}},{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"latestLevelDetails",get:function(){return this.streamController.getLevelDetails()||null}},{key:"loadLevelObj",get:function(){return this.levelController.loadLevelObj}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){this.logger.log("set currentLevel:".concat(e)),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){this.logger.log("set nextLevel:".concat(e)),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){this.logger.log("set loadLevel:".concat(e)),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){this.logger.log("set firstLevel:".concat(e)),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){var e=this.levelController.startLevel;return -1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e},set:function(e){this.logger.log("set startLevel:".concat(e)),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(this.logger.log("set autoLevelCapping:".concat(e)),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN},set:function(e){this.abrController.resetEstimator(e)}},{key:"abrEwmaDefaultEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.defaultEstimate:NaN}},{key:"ttfbEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(e){e1.indexOf(e)>-1&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}},{key:"autoLevelEnabled",get:function(){return -1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,t=this.config.minAutoBitrate;if(!e)return 0;for(var n=e.length,i=0;i<n;i++)if(e[i].maxBitrate>=t)return i;return 0}},{key:"maxAutoLevel",get:function(){var e,t=this.levels,n=this.autoLevelCapping,i=this.maxHdcpLevel;if(e=-1===n&&null!=t&&t.length?t.length-1:n,i)for(var r=e;r--;){var a=t[r].attrs["HDCP-LEVEL"];if(a&&a<=i)return r}return e}},{key:"firstAutoLevel",get:function(){return this.abrController.firstAutoLevel}},{key:"nextAutoLevel",get:function(){return this.abrController.nextAutoLevel},set:function(e){this.abrController.nextAutoLevel=e}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"maxBufferLength",get:function(){return this.streamController.maxBufferLength}},{key:"setAudioOption",value:function(e){var t;return(null==(t=this.audioTrackController)?void 0:t.setAudioOption(e))||null}},{key:"setSubtitleOption",value:function(e){var t;return(null==(t=this.subtitleTrackController)?void 0:t.setSubtitleOption(e))||null}},{key:"allAudioTracks",get:function(){var e=this.audioTrackController;return e?e.allAudioTracks:[]}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"allSubtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency},set:function(e){this.latencyController.targetLatency=e}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}},{key:"pathways",get:function(){return this.levelController.pathways}},{key:"pathwayPriority",get:function(){return this.levelController.pathwayPriority},set:function(e){this.levelController.pathwayPriority=e}},{key:"bufferedToEnd",get:function(){var e;return!!(null!=(e=this.bufferController)&&e.bufferedToEnd)}},{key:"interstitialsManager",get:function(){var e;return(null==(e=this.interstitialsController)?void 0:e.interstitialsManager)||null}},{key:"getMediaDecodingInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.allAudioTracks;return eJ(e,te(t),navigator.mediaCapabilities)}}],[{key:"version",get:function(){return n7}},{key:"isMSESupported",value:function(){return sA()}},{key:"isSupported",value:function(){if(!sA())return!1;var e=ee();return"function"==typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(function(t){return e.isTypeSupported(ej(t,"video"))})||["mp4a.40.2","fLaC"].some(function(t){return e.isTypeSupported(ej(t,"audio"))}))}},{key:"getMediaSource",value:function(){return ee()}},{key:"Events",get:function(){return O}},{key:"MetadataSchema",get:function(){return ip}},{key:"ErrorTypes",get:function(){return x}},{key:"ErrorDetails",get:function(){return P}},{key:"DefaultConfig",get:function(){return e.defaultConfig?e.defaultConfig:sd},set:function(t){e.defaultConfig=t}}]),e})().defaultConfig=void 0}),B("375Sc",function(t,n){e(t.exports,"_",function(){return s});var i=N("drHcY"),r=N("4Ju10"),a=N("fSXjZ");function s(e,t,n){return t=(0,i._)(t),(0,a._)(e,(0,r._)()?Reflect.construct(t,n||[],(0,i._)(e).constructor):t.apply(e,n))}}),B("drHcY",function(t,n){e(t.exports,"_",function(){return i});function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}}),B("4Ju10",function(t,n){e(t.exports,"_",function(){return i});function i(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(i=function(){return!!e})()}}),B("fSXjZ",function(t,n){e(t.exports,"_",function(){return a});var i=N("djoxE"),r=N("16gB1");function a(e,t){return t&&("object"===(0,r._)(t)||"function"==typeof t)?t:(0,i._)(e)}}),B("djoxE",function(t,n){e(t.exports,"_",function(){return i});function i(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}}),B("16gB1",function(t,n){e(t.exports,"_",function(){return i});function i(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}}),B("6M8s5",function(t,n){e(t.exports,"_",function(){return i});function i(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}}),B("8ro5P",function(t,n){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}e(t.exports,"_",function(){return r})}),B("eh14X",function(t,n){e(t.exports,"_",function(){return i});function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}}),B("fd2TQ",function(t,n){e(t.exports,"_",function(){return r});var i=N("eYpoN");function r(e,t,n){return(r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=(0,i._)(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n||e):a.value}})(e,t,n||e)}}),B("eYpoN",function(t,n){e(t.exports,"_",function(){return r});var i=N("drHcY");function r(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=(0,i._)(e)););return e}}),B("3w2eu",function(t,n){e(t.exports,"_",function(){return r});var i=N("4fNDj");function r(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&(0,i._)(e,t)}}),B("4fNDj",function(t,n){e(t.exports,"_",function(){return i});function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}}),B("1Zvtp",function(t,n){e(t.exports,"_",function(){return o});var i=N("efqdA"),r=N("cSZPF"),a=N("h12We"),s=N("4HolW");function o(e,t){return(0,i._)(e)||(0,r._)(e,t)||(0,s._)(e,t)||(0,a._)()}}),B("efqdA",function(t,n){e(t.exports,"_",function(){return i});function i(e){if(Array.isArray(e))return e}}),B("cSZPF",function(t,n){e(t.exports,"_",function(){return i});function i(e,t){var n,i,r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a=[],s=!0,o=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==r.return||r.return()}finally{if(o)throw i}}return a}}}),B("h12We",function(t,n){e(t.exports,"_",function(){return i});function i(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}}),B("4HolW",function(t,n){e(t.exports,"_",function(){return r});var i=N("e7jIW");function r(e,t){if(e){if("string"==typeof e)return(0,i._)(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return(0,i._)(e,t)}}}),B("e7jIW",function(t,n){e(t.exports,"_",function(){return i});function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}}),B("l9etm",function(t,n){e(t.exports,"_",function(){return o});var i=N("5sZUG"),r=N("2VTqR"),a=N("iKVQj"),s=N("4HolW");function o(e){return(0,i._)(e)||(0,r._)(e)||(0,s._)(e)||(0,a._)()}}),B("5sZUG",function(t,n){e(t.exports,"_",function(){return r});var i=N("e7jIW");function r(e){if(Array.isArray(e))return(0,i._)(e)}}),B("2VTqR",function(t,n){e(t.exports,"_",function(){return i});function i(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}}),B("iKVQj",function(t,n){e(t.exports,"_",function(){return i});function i(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}}),B("lA74D",function(t,n){e(t.exports,"_",function(){return o});var i=N("khOIG"),r=N("drHcY"),a=N("bUCLw"),s=N("4fNDj");function o(e){var t="function"==typeof Map?new Map:void 0;return(o=function(e){if(null===e||!(0,a._)(e))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return(0,i._)(e,arguments,(0,r._)(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),(0,s._)(n,e)})(e)}}),B("khOIG",function(t,n){e(t.exports,"_",function(){return a});var i=N("4Ju10"),r=N("4fNDj");function a(e,t,n){return(a=(0,i._)()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var a=new(Function.bind.apply(e,i));return n&&(0,r._)(a,n.prototype),a}).apply(null,arguments)}}),B("bUCLw",function(t,n){e(t.exports,"_",function(){return i});function i(e){return -1!==Function.toString.call(e).indexOf("[native code]")}});var G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),V=N("eh14X"),q=N("fd2TQ"),Y=N("drHcY"),W=N("3w2eu"),z=N("1Zvtp"),X=N("l9etm"),Q=(N("16gB1"),N("16gB1"));function $(e,t){var n,i,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){var u=[o,l];if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(a=0)),a;)try{if(n=1,i&&(r=2&u[0]?i.return:u[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,u[1])).done)return r;switch(i=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,i=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===u[0]||2===u[0])){a=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){a.label=u[1];break}if(6===u[0]&&a.label<r[1]){a.label=r[1],r=u;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(u);break}r[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],i=0}finally{n=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}}function Z(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}"function"==typeof SuppressedError&&SuppressedError;var J=function(){"use strict";function e(t,n,i){(0,K._)(this,e),this.eventTarget=t,this.eventName=n,this.eventOptions=i,this.unorderedBindings=new Set}return(0,H._)(e,[{key:"connect",value:function(){this.eventTarget.addEventListener(this.eventName,this,this.eventOptions)}},{key:"disconnect",value:function(){this.eventTarget.removeEventListener(this.eventName,this,this.eventOptions)}},{key:"bindingConnected",value:function(e){this.unorderedBindings.add(e)}},{key:"bindingDisconnected",value:function(e){this.unorderedBindings.delete(e)}},{key:"handleEvent",value:function(e){var t=function(e){if("immediatePropagationStopped"in e)return e;var t=e.stopImmediatePropagation;return Object.assign(e,{immediatePropagationStopped:!1,stopImmediatePropagation:function(){this.immediatePropagationStopped=!0,t.call(this)}})}(e),n=!0,i=!1,r=void 0;try{for(var a,s=this.bindings[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value;if(t.immediatePropagationStopped)break;o.handleEvent(t)}}catch(e){i=!0,r=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}}},{key:"hasBindings",value:function(){return this.unorderedBindings.size>0}},{key:"bindings",get:function(){return Array.from(this.unorderedBindings).sort(function(e,t){var n=e.index,i=t.index;return n<i?-1:+(n>i)})}}]),e}(),ee=function(){"use strict";function e(t){(0,K._)(this,e),this.application=t,this.eventListenerMaps=new Map,this.started=!1}return(0,H._)(e,[{key:"start",value:function(){this.started||(this.started=!0,this.eventListeners.forEach(function(e){return e.connect()}))}},{key:"stop",value:function(){this.started&&(this.started=!1,this.eventListeners.forEach(function(e){return e.disconnect()}))}},{key:"eventListeners",get:function(){return Array.from(this.eventListenerMaps.values()).reduce(function(e,t){return e.concat(Array.from(t.values()))},[])}},{key:"bindingConnected",value:function(e){this.fetchEventListenerForBinding(e).bindingConnected(e)}},{key:"bindingDisconnected",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.fetchEventListenerForBinding(e).bindingDisconnected(e),t&&this.clearEventListenersForBinding(e)}},{key:"handleError",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.application.handleError(e,"Error ".concat(t),n)}},{key:"clearEventListenersForBinding",value:function(e){var t=this.fetchEventListenerForBinding(e);t.hasBindings()||(t.disconnect(),this.removeMappedEventListenerFor(e))}},{key:"removeMappedEventListenerFor",value:function(e){var t=e.eventTarget,n=e.eventName,i=e.eventOptions,r=this.fetchEventListenerMapForEventTarget(t),a=this.cacheKey(n,i);r.delete(a),0==r.size&&this.eventListenerMaps.delete(t)}},{key:"fetchEventListenerForBinding",value:function(e){var t=e.eventTarget,n=e.eventName,i=e.eventOptions;return this.fetchEventListener(t,n,i)}},{key:"fetchEventListener",value:function(e,t,n){var i=this.fetchEventListenerMapForEventTarget(e),r=this.cacheKey(t,n),a=i.get(r);return a||(a=this.createEventListener(e,t,n),i.set(r,a)),a}},{key:"createEventListener",value:function(e,t,n){var i=new J(e,t,n);return this.started&&i.connect(),i}},{key:"fetchEventListenerMapForEventTarget",value:function(e){var t=this.eventListenerMaps.get(e);return t||(t=new Map,this.eventListenerMaps.set(e,t)),t}},{key:"cacheKey",value:function(e,t){var n=[e];return Object.keys(t).sort().forEach(function(e){n.push("".concat(t[e]?"":"!").concat(e))}),n.join(":")}}]),e}(),et={stop:function(e){var t=e.event;return e.value&&t.stopPropagation(),!0},prevent:function(e){var t=e.event;return e.value&&t.preventDefault(),!0},self:function(e){var t=e.event,n=e.value,i=e.element;return!n||i===t.target}},en=/^(?:(?:([^.]+?)\+)?(.+?)(?:\.(.+?))?(?:@(window|document))?->)?(.+?)(?:#([^:]+?))(?::(.+))?$/;function ei(e){return e.replace(/(?:[_-])([a-z0-9])/g,function(e,t){return t.toUpperCase()})}function er(e){return ei(e.replace(/--/g,"-").replace(/__/g,"_"))}function ea(e){return e.charAt(0).toUpperCase()+e.slice(1)}function es(e){return e.replace(/([A-Z])/g,function(e,t){return"-".concat(t.toLowerCase())})}function eo(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var el=["meta","ctrl","alt","shift"],eu=function(){"use strict";function e(t,n,i,r){(0,K._)(this,e),this.element=t,this.index=n,this.eventTarget=i.eventTarget||t,this.eventName=i.eventName||function(e){var t=e.tagName.toLowerCase();if(t in ec)return ec[t](e)}(t)||eh("missing event name"),this.eventOptions=i.eventOptions||{},this.identifier=i.identifier||eh("missing identifier"),this.methodName=i.methodName||eh("missing method name"),this.keyFilter=i.keyFilter||"",this.schema=r}return(0,H._)(e,[{key:"toString",value:function(){var e=this.keyFilter?".".concat(this.keyFilter):"",t=this.eventTargetName?"@".concat(this.eventTargetName):"";return"".concat(this.eventName).concat(e).concat(t,"->").concat(this.identifier,"#").concat(this.methodName)}},{key:"shouldIgnoreKeyboardEvent",value:function(e){if(!this.keyFilter)return!1;var t=this.keyFilter.split("+");if(this.keyFilterDissatisfied(e,t))return!0;var n=t.filter(function(e){return!el.includes(e)})[0];return!!n&&(eo(this.keyMappings,n)||eh("contains unknown key filter: ".concat(this.keyFilter)),this.keyMappings[n].toLowerCase()!==e.key.toLowerCase())}},{key:"shouldIgnoreMouseEvent",value:function(e){if(!this.keyFilter)return!1;var t=[this.keyFilter];return!!this.keyFilterDissatisfied(e,t)}},{key:"params",get:function(){var e={},t=RegExp("^data-".concat(this.identifier,"-(.+)-param$"),"i"),n=!0,i=!1,r=void 0;try{for(var a,s=Array.from(this.element.attributes)[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value,l=o.name,u=o.value,c=l.match(t),h=c&&c[1];h&&(e[ei(h)]=function(e){try{return JSON.parse(e)}catch(t){return e}}(u))}}catch(e){i=!0,r=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}return e}},{key:"eventTargetName",get:function(){var e;return(e=this.eventTarget)==window?"window":e==document?"document":void 0}},{key:"keyMappings",get:function(){return this.schema.keyMappings}},{key:"keyFilterDissatisfied",value:function(e,t){var n=(0,z._)(el.map(function(e){return t.includes(e)}),4),i=n[0],r=n[1],a=n[2],s=n[3];return e.metaKey!==i||e.ctrlKey!==r||e.altKey!==a||e.shiftKey!==s}}],[{key:"forToken",value:function(e,t){var n,i,r,a;return new this(e.element,e.index,(i=(n=e.content.trim().match(en)||[])[2],(r=n[3])&&!["keydown","keyup","keypress"].includes(i)&&(i+=".".concat(r),r=""),{eventTarget:"window"==(a=n[4])?window:"document"==a?document:void 0,eventName:i,eventOptions:n[7]?n[7].split(":").reduce(function(e,t){return Object.assign(e,(0,V._)({},t.replace(/^!/,""),!/^!/.test(t)))},{}):{},identifier:n[5],methodName:n[6],keyFilter:n[1]||r}),t)}}]),e}(),ec={a:function(){return"click"},button:function(){return"click"},form:function(){return"submit"},details:function(){return"toggle"},input:function(e){return"submit"==e.getAttribute("type")?"click":"input"},select:function(){return"change"},textarea:function(){return"input"}};function eh(e){throw Error(e)}var ed=function(){"use strict";function e(t,n){(0,K._)(this,e),this.context=t,this.action=n}return(0,H._)(e,[{key:"index",get:function(){return this.action.index}},{key:"eventTarget",get:function(){return this.action.eventTarget}},{key:"eventOptions",get:function(){return this.action.eventOptions}},{key:"identifier",get:function(){return this.context.identifier}},{key:"handleEvent",value:function(e){var t=this.prepareActionEvent(e);this.willBeInvokedByEvent(e)&&this.applyEventModifiers(t)&&this.invokeWithEvent(t)}},{key:"eventName",get:function(){return this.action.eventName}},{key:"method",get:function(){var e=this.controller[this.methodName];if("function"==typeof e)return e;throw Error('Action "'.concat(this.action,'" references undefined method "').concat(this.methodName,'"'))}},{key:"applyEventModifiers",value:function(e){var t=this.action.element,n=this.context.application.actionDescriptorFilters,i=this.context.controller,r=!0,a=!0,s=!1,o=void 0;try{for(var l,u=Object.entries(this.eventOptions)[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var c=(0,z._)(l.value,2),h=c[0],d=c[1];if(h in n){var f=n[h];r=r&&f({name:h,value:d,event:e,element:t,controller:i})}}}catch(e){s=!0,o=e}finally{try{a||null==u.return||u.return()}finally{if(s)throw o}}return r}},{key:"prepareActionEvent",value:function(e){return Object.assign(e,{params:this.action.params})}},{key:"invokeWithEvent",value:function(e){var t=e.target,n=e.currentTarget;try{this.method.call(this.controller,e),this.context.logDebugActivity(this.methodName,{event:e,target:t,currentTarget:n,action:this.methodName})}catch(t){var i=this.identifier,r=this.controller,a=this.element,s=this.index;this.context.handleError(t,'invoking action "'.concat(this.action,'"'),{identifier:i,controller:r,element:a,index:s,event:e})}}},{key:"willBeInvokedByEvent",value:function(e){var t=e.target;return!(e instanceof KeyboardEvent&&this.action.shouldIgnoreKeyboardEvent(e)||e instanceof MouseEvent&&this.action.shouldIgnoreMouseEvent(e))&&(this.element===t||(t instanceof Element&&this.element.contains(t)?this.scope.containsElement(t):this.scope.containsElement(this.action.element)))}},{key:"controller",get:function(){return this.context.controller}},{key:"methodName",get:function(){return this.action.methodName}},{key:"element",get:function(){return this.scope.element}},{key:"scope",get:function(){return this.context.scope}}]),e}(),ef=function(){"use strict";function e(t,n){var i=this;(0,K._)(this,e),this.mutationObserverInit={attributes:!0,childList:!0,subtree:!0},this.element=t,this.started=!1,this.delegate=n,this.elements=new Set,this.mutationObserver=new MutationObserver(function(e){return i.processMutations(e)})}return(0,H._)(e,[{key:"start",value:function(){this.started||(this.started=!0,this.mutationObserver.observe(this.element,this.mutationObserverInit),this.refresh())}},{key:"pause",value:function(e){this.started&&(this.mutationObserver.disconnect(),this.started=!1),e(),this.started||(this.mutationObserver.observe(this.element,this.mutationObserverInit),this.started=!0)}},{key:"stop",value:function(){this.started&&(this.mutationObserver.takeRecords(),this.mutationObserver.disconnect(),this.started=!1)}},{key:"refresh",value:function(){if(this.started){var e=new Set(this.matchElementsInTree()),t=!0,n=!1,i=void 0;try{for(var r,a=Array.from(this.elements)[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var s=r.value;e.has(s)||this.removeElement(s)}}catch(e){n=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}var o=!0,l=!1,u=void 0;try{for(var c,h=Array.from(e)[Symbol.iterator]();!(o=(c=h.next()).done);o=!0){var d=c.value;this.addElement(d)}}catch(e){l=!0,u=e}finally{try{o||null==h.return||h.return()}finally{if(l)throw u}}}}},{key:"processMutations",value:function(e){var t=!0,n=!1,i=void 0;if(this.started)try{for(var r,a=e[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var s=r.value;this.processMutation(s)}}catch(e){n=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"processMutation",value:function(e){"attributes"==e.type?this.processAttributeChange(e.target,e.attributeName):"childList"==e.type&&(this.processRemovedNodes(e.removedNodes),this.processAddedNodes(e.addedNodes))}},{key:"processAttributeChange",value:function(e,t){this.elements.has(e)?this.delegate.elementAttributeChanged&&this.matchElement(e)?this.delegate.elementAttributeChanged(e,t):this.removeElement(e):this.matchElement(e)&&this.addElement(e)}},{key:"processRemovedNodes",value:function(e){var t=!0,n=!1,i=void 0;try{for(var r,a=Array.from(e)[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var s=r.value,o=this.elementFromNode(s);o&&this.processTree(o,this.removeElement)}}catch(e){n=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"processAddedNodes",value:function(e){var t=!0,n=!1,i=void 0;try{for(var r,a=Array.from(e)[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var s=r.value,o=this.elementFromNode(s);o&&this.elementIsActive(o)&&this.processTree(o,this.addElement)}}catch(e){n=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"matchElement",value:function(e){return this.delegate.matchElement(e)}},{key:"matchElementsInTree",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.element;return this.delegate.matchElementsInTree(e)}},{key:"processTree",value:function(e,t){var n=!0,i=!1,r=void 0;try{for(var a,s=this.matchElementsInTree(e)[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value;t.call(this,o)}}catch(e){i=!0,r=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}}},{key:"elementFromNode",value:function(e){if(e.nodeType==Node.ELEMENT_NODE)return e}},{key:"elementIsActive",value:function(e){return e.isConnected==this.element.isConnected&&this.element.contains(e)}},{key:"addElement",value:function(e){!this.elements.has(e)&&this.elementIsActive(e)&&(this.elements.add(e),this.delegate.elementMatched&&this.delegate.elementMatched(e))}},{key:"removeElement",value:function(e){this.elements.has(e)&&(this.elements.delete(e),this.delegate.elementUnmatched&&this.delegate.elementUnmatched(e))}}]),e}(),ev=function(){"use strict";function e(t,n,i){(0,K._)(this,e),this.attributeName=n,this.delegate=i,this.elementObserver=new ef(t,this)}return(0,H._)(e,[{key:"element",get:function(){return this.elementObserver.element}},{key:"selector",get:function(){return"[".concat(this.attributeName,"]")}},{key:"start",value:function(){this.elementObserver.start()}},{key:"pause",value:function(e){this.elementObserver.pause(e)}},{key:"stop",value:function(){this.elementObserver.stop()}},{key:"refresh",value:function(){this.elementObserver.refresh()}},{key:"started",get:function(){return this.elementObserver.started}},{key:"matchElement",value:function(e){return e.hasAttribute(this.attributeName)}},{key:"matchElementsInTree",value:function(e){var t=this.matchElement(e)?[e]:[],n=Array.from(e.querySelectorAll(this.selector));return t.concat(n)}},{key:"elementMatched",value:function(e){this.delegate.elementMatchedAttribute&&this.delegate.elementMatchedAttribute(e,this.attributeName)}},{key:"elementUnmatched",value:function(e){this.delegate.elementUnmatchedAttribute&&this.delegate.elementUnmatchedAttribute(e,this.attributeName)}},{key:"elementAttributeChanged",value:function(e,t){this.delegate.elementAttributeValueChanged&&this.attributeName==t&&this.delegate.elementAttributeValueChanged(e,t)}}]),e}();function eg(e,t){var n=e.get(t);return n||(n=new Set,e.set(t,n)),n}var em=function(){"use strict";function e(){(0,K._)(this,e),this.valuesByKey=new Map}return(0,H._)(e,[{key:"keys",get:function(){return Array.from(this.valuesByKey.keys())}},{key:"values",get:function(){return Array.from(this.valuesByKey.values()).reduce(function(e,t){return e.concat(Array.from(t))},[])}},{key:"size",get:function(){return Array.from(this.valuesByKey.values()).reduce(function(e,t){return e+t.size},0)}},{key:"add",value:function(e,t){var n;n=this.valuesByKey,eg(n,e).add(t)}},{key:"delete",value:function(e,t){var n,i,r,a;n=this.valuesByKey,eg(n,e).delete(t),i=n,r=e,null!=(a=i.get(r))&&0==a.size&&i.delete(r)}},{key:"has",value:function(e,t){var n=this.valuesByKey.get(e);return null!=n&&n.has(t)}},{key:"hasKey",value:function(e){return this.valuesByKey.has(e)}},{key:"hasValue",value:function(e){return Array.from(this.valuesByKey.values()).some(function(t){return t.has(e)})}},{key:"getValuesForKey",value:function(e){var t=this.valuesByKey.get(e);return t?Array.from(t):[]}},{key:"getKeysForValue",value:function(e){return Array.from(this.valuesByKey).filter(function(t){var n=(0,z._)(t,2);return(n[0],n[1]).has(e)}).map(function(e){var t=(0,z._)(e,2),n=t[0];return t[1],n})}}]),e}(),ep=function(){"use strict";function e(t,n,i,r){(0,K._)(this,e),this._selector=n,this.details=r,this.elementObserver=new ef(t,this),this.delegate=i,this.matchesByElement=new em}return(0,H._)(e,[{key:"started",get:function(){return this.elementObserver.started}},{key:"selector",get:function(){return this._selector},set:function(e){this._selector=e,this.refresh()}},{key:"start",value:function(){this.elementObserver.start()}},{key:"pause",value:function(e){this.elementObserver.pause(e)}},{key:"stop",value:function(){this.elementObserver.stop()}},{key:"refresh",value:function(){this.elementObserver.refresh()}},{key:"element",get:function(){return this.elementObserver.element}},{key:"matchElement",value:function(e){var t=this.selector;if(!t)return!1;var n=e.matches(t);return this.delegate.selectorMatchElement?n&&this.delegate.selectorMatchElement(e,this.details):n}},{key:"matchElementsInTree",value:function(e){var t=this,n=this.selector;if(!n)return[];var i=this.matchElement(e)?[e]:[],r=Array.from(e.querySelectorAll(n)).filter(function(e){return t.matchElement(e)});return i.concat(r)}},{key:"elementMatched",value:function(e){var t=this.selector;t&&this.selectorMatched(e,t)}},{key:"elementUnmatched",value:function(e){var t=this.matchesByElement.getKeysForValue(e),n=!0,i=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value;this.selectorUnmatched(e,o)}}catch(e){i=!0,r=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}}},{key:"elementAttributeChanged",value:function(e,t){var n=this.selector;if(n){var i=this.matchElement(e),r=this.matchesByElement.has(n,e);i&&!r?this.selectorMatched(e,n):!i&&r&&this.selectorUnmatched(e,n)}}},{key:"selectorMatched",value:function(e,t){this.delegate.selectorMatched(e,t,this.details),this.matchesByElement.add(t,e)}},{key:"selectorUnmatched",value:function(e,t){this.delegate.selectorUnmatched(e,t,this.details),this.matchesByElement.delete(t,e)}}]),e}(),ey=function(){"use strict";function e(t,n){var i=this;(0,K._)(this,e),this.element=t,this.delegate=n,this.started=!1,this.stringMap=new Map,this.mutationObserver=new MutationObserver(function(e){return i.processMutations(e)})}return(0,H._)(e,[{key:"start",value:function(){this.started||(this.started=!0,this.mutationObserver.observe(this.element,{attributes:!0,attributeOldValue:!0}),this.refresh())}},{key:"stop",value:function(){this.started&&(this.mutationObserver.takeRecords(),this.mutationObserver.disconnect(),this.started=!1)}},{key:"refresh",value:function(){var e=!0,t=!1,n=void 0;if(this.started)try{for(var i,r=this.knownAttributeNames[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var a=i.value;this.refreshAttribute(a,null)}}catch(e){t=!0,n=e}finally{try{e||null==r.return||r.return()}finally{if(t)throw n}}}},{key:"processMutations",value:function(e){var t=!0,n=!1,i=void 0;if(this.started)try{for(var r,a=e[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var s=r.value;this.processMutation(s)}}catch(e){n=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"processMutation",value:function(e){var t=e.attributeName;t&&this.refreshAttribute(t,e.oldValue)}},{key:"refreshAttribute",value:function(e,t){var n=this.delegate.getStringMapKeyForAttribute(e);if(null!=n){this.stringMap.has(e)||this.stringMapKeyAdded(n,e);var i=this.element.getAttribute(e);if(this.stringMap.get(e)!=i&&this.stringMapValueChanged(i,n,t),null==i){var r=this.stringMap.get(e);this.stringMap.delete(e),r&&this.stringMapKeyRemoved(n,e,r)}else this.stringMap.set(e,i)}}},{key:"stringMapKeyAdded",value:function(e,t){this.delegate.stringMapKeyAdded&&this.delegate.stringMapKeyAdded(e,t)}},{key:"stringMapValueChanged",value:function(e,t,n){this.delegate.stringMapValueChanged&&this.delegate.stringMapValueChanged(e,t,n)}},{key:"stringMapKeyRemoved",value:function(e,t,n){this.delegate.stringMapKeyRemoved&&this.delegate.stringMapKeyRemoved(e,t,n)}},{key:"knownAttributeNames",get:function(){return Array.from(new Set(this.currentAttributeNames.concat(this.recordedAttributeNames)))}},{key:"currentAttributeNames",get:function(){return Array.from(this.element.attributes).map(function(e){return e.name})}},{key:"recordedAttributeNames",get:function(){return Array.from(this.stringMap.keys())}}]),e}(),eE=function(){"use strict";function e(t,n,i){(0,K._)(this,e),this.attributeObserver=new ev(t,n,this),this.delegate=i,this.tokensByElement=new em}return(0,H._)(e,[{key:"started",get:function(){return this.attributeObserver.started}},{key:"start",value:function(){this.attributeObserver.start()}},{key:"pause",value:function(e){this.attributeObserver.pause(e)}},{key:"stop",value:function(){this.attributeObserver.stop()}},{key:"refresh",value:function(){this.attributeObserver.refresh()}},{key:"element",get:function(){return this.attributeObserver.element}},{key:"attributeName",get:function(){return this.attributeObserver.attributeName}},{key:"elementMatchedAttribute",value:function(e){this.tokensMatched(this.readTokensForElement(e))}},{key:"elementAttributeValueChanged",value:function(e){var t=(0,z._)(this.refreshTokensForElement(e),2),n=t[0],i=t[1];this.tokensUnmatched(n),this.tokensMatched(i)}},{key:"elementUnmatchedAttribute",value:function(e){this.tokensUnmatched(this.tokensByElement.getValuesForKey(e))}},{key:"tokensMatched",value:function(e){var t=this;e.forEach(function(e){return t.tokenMatched(e)})}},{key:"tokensUnmatched",value:function(e){var t=this;e.forEach(function(e){return t.tokenUnmatched(e)})}},{key:"tokenMatched",value:function(e){this.delegate.tokenMatched(e),this.tokensByElement.add(e.element,e)}},{key:"tokenUnmatched",value:function(e){this.delegate.tokenUnmatched(e),this.tokensByElement.delete(e.element,e)}},{key:"refreshTokensForElement",value:function(e){var t,n,i=this.tokensByElement.getValuesForKey(e),r=this.readTokensForElement(e),a=(t=i,n=r,Array.from({length:Math.max(t.length,n.length)},function(e,i){return[t[i],n[i]]})).findIndex(function(e){var t,n,i=(0,z._)(e,2);return t=i[0],n=i[1],!t||!n||t.index!=n.index||t.content!=n.content});return -1==a?[[],[]]:[i.slice(a),r.slice(a)]}},{key:"readTokensForElement",value:function(e){var t,n,i,r=this.attributeName;return t=e.getAttribute(r)||"",n=e,i=r,t.trim().split(/\s+/).filter(function(e){return e.length}).map(function(e,t){return{element:n,attributeName:i,content:e,index:t}})}}]),e}(),ek=function(){"use strict";function e(t,n,i){(0,K._)(this,e),this.tokenListObserver=new eE(t,n,this),this.delegate=i,this.parseResultsByToken=new WeakMap,this.valuesByTokenByElement=new WeakMap}return(0,H._)(e,[{key:"started",get:function(){return this.tokenListObserver.started}},{key:"start",value:function(){this.tokenListObserver.start()}},{key:"stop",value:function(){this.tokenListObserver.stop()}},{key:"refresh",value:function(){this.tokenListObserver.refresh()}},{key:"element",get:function(){return this.tokenListObserver.element}},{key:"attributeName",get:function(){return this.tokenListObserver.attributeName}},{key:"tokenMatched",value:function(e){var t=e.element,n=this.fetchParseResultForToken(e).value;n&&(this.fetchValuesByTokenForElement(t).set(e,n),this.delegate.elementMatchedValue(t,n))}},{key:"tokenUnmatched",value:function(e){var t=e.element,n=this.fetchParseResultForToken(e).value;n&&(this.fetchValuesByTokenForElement(t).delete(e),this.delegate.elementUnmatchedValue(t,n))}},{key:"fetchParseResultForToken",value:function(e){var t=this.parseResultsByToken.get(e);return t||(t=this.parseToken(e),this.parseResultsByToken.set(e,t)),t}},{key:"fetchValuesByTokenForElement",value:function(e){var t=this.valuesByTokenByElement.get(e);return t||(t=new Map,this.valuesByTokenByElement.set(e,t)),t}},{key:"parseToken",value:function(e){try{return{value:this.delegate.parseValueForToken(e)}}catch(e){return{error:e}}}}]),e}(),eb=function(){"use strict";function e(t,n){(0,K._)(this,e),this.context=t,this.delegate=n,this.bindingsByAction=new Map}return(0,H._)(e,[{key:"start",value:function(){this.valueListObserver||(this.valueListObserver=new ek(this.element,this.actionAttribute,this),this.valueListObserver.start())}},{key:"stop",value:function(){this.valueListObserver&&(this.valueListObserver.stop(),delete this.valueListObserver,this.disconnectAllActions())}},{key:"element",get:function(){return this.context.element}},{key:"identifier",get:function(){return this.context.identifier}},{key:"actionAttribute",get:function(){return this.schema.actionAttribute}},{key:"schema",get:function(){return this.context.schema}},{key:"bindings",get:function(){return Array.from(this.bindingsByAction.values())}},{key:"connectAction",value:function(e){var t=new ed(this.context,e);this.bindingsByAction.set(e,t),this.delegate.bindingConnected(t)}},{key:"disconnectAction",value:function(e){var t=this.bindingsByAction.get(e);t&&(this.bindingsByAction.delete(e),this.delegate.bindingDisconnected(t))}},{key:"disconnectAllActions",value:function(){var e=this;this.bindings.forEach(function(t){return e.delegate.bindingDisconnected(t,!0)}),this.bindingsByAction.clear()}},{key:"parseValueForToken",value:function(e){var t=eu.forToken(e,this.schema);if(t.identifier==this.identifier)return t}},{key:"elementMatchedValue",value:function(e,t){this.connectAction(t)}},{key:"elementUnmatchedValue",value:function(e,t){this.disconnectAction(t)}}]),e}(),eT=function(){"use strict";function e(t,n){(0,K._)(this,e),this.context=t,this.receiver=n,this.stringMapObserver=new ey(this.element,this),this.valueDescriptorMap=this.controller.valueDescriptorMap}return(0,H._)(e,[{key:"start",value:function(){this.stringMapObserver.start(),this.invokeChangedCallbacksForDefaultValues()}},{key:"stop",value:function(){this.stringMapObserver.stop()}},{key:"element",get:function(){return this.context.element}},{key:"controller",get:function(){return this.context.controller}},{key:"getStringMapKeyForAttribute",value:function(e){if(e in this.valueDescriptorMap)return this.valueDescriptorMap[e].name}},{key:"stringMapKeyAdded",value:function(e,t){var n=this.valueDescriptorMap[t];this.hasValue(e)||this.invokeChangedCallback(e,n.writer(this.receiver[e]),n.writer(n.defaultValue))}},{key:"stringMapValueChanged",value:function(e,t,n){var i=this.valueDescriptorNameMap[t];null!==e&&(null===n&&(n=i.writer(i.defaultValue)),this.invokeChangedCallback(t,e,n))}},{key:"stringMapKeyRemoved",value:function(e,t,n){var i=this.valueDescriptorNameMap[e];this.hasValue(e)?this.invokeChangedCallback(e,i.writer(this.receiver[e]),n):this.invokeChangedCallback(e,i.writer(i.defaultValue),n)}},{key:"invokeChangedCallbacksForDefaultValues",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,r=this.valueDescriptors[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var a=i.value,s=a.key,o=a.name,l=a.defaultValue,u=a.writer;void 0==l||this.controller.data.has(s)||this.invokeChangedCallback(o,u(l),void 0)}}catch(e){t=!0,n=e}finally{try{e||null==r.return||r.return()}finally{if(t)throw n}}}},{key:"invokeChangedCallback",value:function(e,t,n){var i=this.receiver["".concat(e,"Changed")];if("function"==typeof i){var r=this.valueDescriptorNameMap[e];try{var a=r.reader(t),s=n;n&&(s=r.reader(n)),i.call(this.receiver,a,s)}catch(e){throw e instanceof TypeError&&(e.message='Stimulus Value "'.concat(this.context.identifier,".").concat(r.name,'" - ').concat(e.message)),e}}}},{key:"valueDescriptors",get:function(){var e=this.valueDescriptorMap;return Object.keys(e).map(function(t){return e[t]})}},{key:"valueDescriptorNameMap",get:function(){var e=this,t={};return Object.keys(this.valueDescriptorMap).forEach(function(n){var i=e.valueDescriptorMap[n];t[i.name]=i}),t}},{key:"hasValue",value:function(e){var t=this.valueDescriptorNameMap[e],n="has".concat(ea(t.name));return this.receiver[n]}}]),e}(),eS=function(){"use strict";function e(t,n){(0,K._)(this,e),this.context=t,this.delegate=n,this.targetsByName=new em}return(0,H._)(e,[{key:"start",value:function(){this.tokenListObserver||(this.tokenListObserver=new eE(this.element,this.attributeName,this),this.tokenListObserver.start())}},{key:"stop",value:function(){this.tokenListObserver&&(this.disconnectAllTargets(),this.tokenListObserver.stop(),delete this.tokenListObserver)}},{key:"tokenMatched",value:function(e){var t=e.element,n=e.content;this.scope.containsElement(t)&&this.connectTarget(t,n)}},{key:"tokenUnmatched",value:function(e){var t=e.element,n=e.content;this.disconnectTarget(t,n)}},{key:"connectTarget",value:function(e,t){var n,i=this;this.targetsByName.has(t,e)||(this.targetsByName.add(t,e),null==(n=this.tokenListObserver)||n.pause(function(){return i.delegate.targetConnected(e,t)}))}},{key:"disconnectTarget",value:function(e,t){var n,i=this;this.targetsByName.has(t,e)&&(this.targetsByName.delete(t,e),null==(n=this.tokenListObserver)||n.pause(function(){return i.delegate.targetDisconnected(e,t)}))}},{key:"disconnectAllTargets",value:function(){var e=!0,t=!1,n=void 0,i=!0,r=!1,a=void 0;try{for(var s,o=this.targetsByName.keys[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var l=s.value;try{for(var u,c=this.targetsByName.getValuesForKey(l)[Symbol.iterator]();!(e=(u=c.next()).done);e=!0){var h=u.value;this.disconnectTarget(h,l)}}catch(e){t=!0,n=e}finally{try{e||null==c.return||c.return()}finally{if(t)throw n}}}}catch(e){r=!0,a=e}finally{try{i||null==o.return||o.return()}finally{if(r)throw a}}}},{key:"attributeName",get:function(){return"data-".concat(this.context.identifier,"-target")}},{key:"element",get:function(){return this.context.element}},{key:"scope",get:function(){return this.context.scope}}]),e}();function e_(e,t){return Array.from(eA(e).reduce(function(e,n){var i;return(Array.isArray(i=n[t])?i:[]).forEach(function(t){return e.add(t)}),e},new Set))}function eA(e){for(var t=[];e;)t.push(e),e=Object.getPrototypeOf(e);return t.reverse()}var eL=function(){"use strict";function e(t,n){(0,K._)(this,e),this.started=!1,this.context=t,this.delegate=n,this.outletsByName=new em,this.outletElementsByName=new em,this.selectorObserverMap=new Map,this.attributeObserverMap=new Map}return(0,H._)(e,[{key:"start",value:function(){var e=this;this.started||(this.outletDefinitions.forEach(function(t){e.setupSelectorObserverForOutlet(t),e.setupAttributeObserverForOutlet(t)}),this.started=!0,this.dependentContexts.forEach(function(e){return e.refresh()}))}},{key:"refresh",value:function(){this.selectorObserverMap.forEach(function(e){return e.refresh()}),this.attributeObserverMap.forEach(function(e){return e.refresh()})}},{key:"stop",value:function(){this.started&&(this.started=!1,this.disconnectAllOutlets(),this.stopSelectorObservers(),this.stopAttributeObservers())}},{key:"stopSelectorObservers",value:function(){this.selectorObserverMap.size>0&&(this.selectorObserverMap.forEach(function(e){return e.stop()}),this.selectorObserverMap.clear())}},{key:"stopAttributeObservers",value:function(){this.attributeObserverMap.size>0&&(this.attributeObserverMap.forEach(function(e){return e.stop()}),this.attributeObserverMap.clear())}},{key:"selectorMatched",value:function(e,t,n){var i=n.outletName,r=this.getOutlet(e,i);r&&this.connectOutlet(r,e,i)}},{key:"selectorUnmatched",value:function(e,t,n){var i=n.outletName,r=this.getOutletFromMap(e,i);r&&this.disconnectOutlet(r,e,i)}},{key:"selectorMatchElement",value:function(e,t){var n=t.outletName,i=this.selector(n),r=this.hasOutlet(e,n),a=e.matches("[".concat(this.schema.controllerAttribute,"~=").concat(n,"]"));return!!i&&r&&a&&e.matches(i)}},{key:"elementMatchedAttribute",value:function(e,t){var n=this.getOutletNameFromOutletAttributeName(t);n&&this.updateSelectorObserverForOutlet(n)}},{key:"elementAttributeValueChanged",value:function(e,t){var n=this.getOutletNameFromOutletAttributeName(t);n&&this.updateSelectorObserverForOutlet(n)}},{key:"elementUnmatchedAttribute",value:function(e,t){var n=this.getOutletNameFromOutletAttributeName(t);n&&this.updateSelectorObserverForOutlet(n)}},{key:"connectOutlet",value:function(e,t,n){var i,r=this;this.outletElementsByName.has(n,t)||(this.outletsByName.add(n,e),this.outletElementsByName.add(n,t),null==(i=this.selectorObserverMap.get(n))||i.pause(function(){return r.delegate.outletConnected(e,t,n)}))}},{key:"disconnectOutlet",value:function(e,t,n){var i,r=this;this.outletElementsByName.has(n,t)&&(this.outletsByName.delete(n,e),this.outletElementsByName.delete(n,t),null==(i=this.selectorObserverMap.get(n))||i.pause(function(){return r.delegate.outletDisconnected(e,t,n)}))}},{key:"disconnectAllOutlets",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,r=this.outletElementsByName.keys[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var a=i.value,s=!0,o=!1,l=void 0,u=!0,c=!1,h=void 0;try{for(var d,f=this.outletElementsByName.getValuesForKey(a)[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var v=d.value;try{for(var g,m=this.outletsByName.getValuesForKey(a)[Symbol.iterator]();!(s=(g=m.next()).done);s=!0){var p=g.value;this.disconnectOutlet(p,v,a)}}catch(e){o=!0,l=e}finally{try{s||null==m.return||m.return()}finally{if(o)throw l}}}}catch(e){c=!0,h=e}finally{try{u||null==f.return||f.return()}finally{if(c)throw h}}}}catch(e){t=!0,n=e}finally{try{e||null==r.return||r.return()}finally{if(t)throw n}}}},{key:"updateSelectorObserverForOutlet",value:function(e){var t=this.selectorObserverMap.get(e);t&&(t.selector=this.selector(e))}},{key:"setupSelectorObserverForOutlet",value:function(e){var t=this.selector(e),n=new ep(document.body,t,this,{outletName:e});this.selectorObserverMap.set(e,n),n.start()}},{key:"setupAttributeObserverForOutlet",value:function(e){var t=this.attributeNameForOutletName(e),n=new ev(this.scope.element,t,this);this.attributeObserverMap.set(e,n),n.start()}},{key:"selector",value:function(e){return this.scope.outlets.getSelectorForOutletName(e)}},{key:"attributeNameForOutletName",value:function(e){return this.scope.schema.outletAttributeForScope(this.identifier,e)}},{key:"getOutletNameFromOutletAttributeName",value:function(e){var t=this;return this.outletDefinitions.find(function(n){return t.attributeNameForOutletName(n)===e})}},{key:"outletDependencies",get:function(){var e=new em;return this.router.modules.forEach(function(t){e_(t.definition.controllerConstructor,"outlets").forEach(function(n){return e.add(n,t.identifier)})}),e}},{key:"outletDefinitions",get:function(){return this.outletDependencies.getKeysForValue(this.identifier)}},{key:"dependentControllerIdentifiers",get:function(){return this.outletDependencies.getValuesForKey(this.identifier)}},{key:"dependentContexts",get:function(){var e=this.dependentControllerIdentifiers;return this.router.contexts.filter(function(t){return e.includes(t.identifier)})}},{key:"hasOutlet",value:function(e,t){return!!this.getOutlet(e,t)||!!this.getOutletFromMap(e,t)}},{key:"getOutlet",value:function(e,t){return this.application.getControllerForElementAndIdentifier(e,t)}},{key:"getOutletFromMap",value:function(e,t){return this.outletsByName.getValuesForKey(t).find(function(t){return t.element===e})}},{key:"scope",get:function(){return this.context.scope}},{key:"schema",get:function(){return this.context.schema}},{key:"identifier",get:function(){return this.context.identifier}},{key:"application",get:function(){return this.context.application}},{key:"router",get:function(){return this.application.router}}]),e}(),ew=function(){"use strict";function e(t,n){var i=this;(0,K._)(this,e),this.logDebugActivity=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=Object.assign({identifier:i.identifier,controller:i.controller,element:i.element},t),i.application.logDebugActivity(i.identifier,e,t)},this.module=t,this.scope=n,this.controller=new t.controllerConstructor(this),this.bindingObserver=new eb(this,this.dispatcher),this.valueObserver=new eT(this,this.controller),this.targetObserver=new eS(this,this),this.outletObserver=new eL(this,this);try{this.controller.initialize(),this.logDebugActivity("initialize")}catch(e){this.handleError(e,"initializing controller")}}return(0,H._)(e,[{key:"connect",value:function(){this.bindingObserver.start(),this.valueObserver.start(),this.targetObserver.start(),this.outletObserver.start();try{this.controller.connect(),this.logDebugActivity("connect")}catch(e){this.handleError(e,"connecting controller")}}},{key:"refresh",value:function(){this.outletObserver.refresh()}},{key:"disconnect",value:function(){try{this.controller.disconnect(),this.logDebugActivity("disconnect")}catch(e){this.handleError(e,"disconnecting controller")}this.outletObserver.stop(),this.targetObserver.stop(),this.valueObserver.stop(),this.bindingObserver.stop()}},{key:"application",get:function(){return this.module.application}},{key:"identifier",get:function(){return this.module.identifier}},{key:"schema",get:function(){return this.application.schema}},{key:"dispatcher",get:function(){return this.application.dispatcher}},{key:"element",get:function(){return this.scope.element}},{key:"parentElement",get:function(){return this.element.parentElement}},{key:"handleError",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n=Object.assign({identifier:this.identifier,controller:this.controller,element:this.element},n),this.application.handleError(e,"Error ".concat(t),n)}},{key:"targetConnected",value:function(e,t){this.invokeControllerMethod("".concat(t,"TargetConnected"),e)}},{key:"targetDisconnected",value:function(e,t){this.invokeControllerMethod("".concat(t,"TargetDisconnected"),e)}},{key:"outletConnected",value:function(e,t,n){this.invokeControllerMethod("".concat(er(n),"OutletConnected"),e,t)}},{key:"outletDisconnected",value:function(e,t,n){this.invokeControllerMethod("".concat(er(n),"OutletDisconnected"),e,t)}},{key:"invokeControllerMethod",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var r=this.controller;"function"==typeof r[e]&&r[e].apply(r,(0,X._)(n))}}]),e}(),eI="function"==typeof Object.getOwnPropertySymbols?function(e){return(0,X._)(Object.getOwnPropertyNames(e)).concat((0,X._)(Object.getOwnPropertySymbols(e)))}:Object.getOwnPropertyNames,eR=function(){var e,t=function(e){function t(){return Reflect.construct(e,arguments,this instanceof t?this.constructor:void 0)}return t.prototype=Object.create(e.prototype,{constructor:{value:t}}),Reflect.setPrototypeOf(t,e),t};try{return(e=t(function(){this.a.call(this)})).prototype.a=function(){},new e,t}catch(e){return function(e){return function(e){"use strict";function t(){return(0,K._)(this,t),(0,G._)(this,t,arguments)}return(0,W._)(t,e),t}(e)}}}(),eD=function(){"use strict";function e(t,n){var i,r,a,s,o,l,u,c;(0,K._)(this,e),this.application=t,this.definition={identifier:n.identifier,controllerConstructor:(a=i=n.controllerConstructor,s=e_(r=i,"blessings").reduce(function(e,t){var n=t(r);for(var i in n){var a=e[i]||{};e[i]=Object.assign(a,n[i])}return e},{}),u=eR(a),c=(o=a.prototype,eI(l=s).reduce(function(e,t){var n=function(e,t,n){var i=Object.getOwnPropertyDescriptor(e,n);if(!(i&&"value"in i)){var r=Object.getOwnPropertyDescriptor(t,n).value;return i&&(r.get=i.get||r.get,r.set=i.set||r.set),r}}(o,l,t);return n&&Object.assign(e,(0,V._)({},t,n)),e},{})),Object.defineProperties(u.prototype,c),u)},this.contextsByScope=new WeakMap,this.connectedContexts=new Set}return(0,H._)(e,[{key:"identifier",get:function(){return this.definition.identifier}},{key:"controllerConstructor",get:function(){return this.definition.controllerConstructor}},{key:"contexts",get:function(){return Array.from(this.connectedContexts)}},{key:"connectContextForScope",value:function(e){var t=this.fetchContextForScope(e);this.connectedContexts.add(t),t.connect()}},{key:"disconnectContextForScope",value:function(e){var t=this.contextsByScope.get(e);t&&(this.connectedContexts.delete(t),t.disconnect())}},{key:"fetchContextForScope",value:function(e){var t=this.contextsByScope.get(e);return t||(t=new ew(this,e),this.contextsByScope.set(e,t)),t}}]),e}(),eC=function(){"use strict";function e(t){(0,K._)(this,e),this.scope=t}return(0,H._)(e,[{key:"has",value:function(e){return this.data.has(this.getDataKey(e))}},{key:"get",value:function(e){return this.getAll(e)[0]}},{key:"getAll",value:function(e){return(this.data.get(this.getDataKey(e))||"").match(/[^\s]+/g)||[]}},{key:"getAttributeName",value:function(e){return this.data.getAttributeNameForKey(this.getDataKey(e))}},{key:"getDataKey",value:function(e){return"".concat(e,"-class")}},{key:"data",get:function(){return this.scope.data}}]),e}(),ex=function(){"use strict";function e(t){(0,K._)(this,e),this.scope=t}return(0,H._)(e,[{key:"element",get:function(){return this.scope.element}},{key:"identifier",get:function(){return this.scope.identifier}},{key:"get",value:function(e){var t=this.getAttributeNameForKey(e);return this.element.getAttribute(t)}},{key:"set",value:function(e,t){var n=this.getAttributeNameForKey(e);return this.element.setAttribute(n,t),this.get(e)}},{key:"has",value:function(e){var t=this.getAttributeNameForKey(e);return this.element.hasAttribute(t)}},{key:"delete",value:function(e){if(!this.has(e))return!1;var t=this.getAttributeNameForKey(e);return this.element.removeAttribute(t),!0}},{key:"getAttributeNameForKey",value:function(e){return"data-".concat(this.identifier,"-").concat(es(e))}}]),e}(),eP=function(){"use strict";function e(t){(0,K._)(this,e),this.warnedKeysByObject=new WeakMap,this.logger=t}return(0,H._)(e,[{key:"warn",value:function(e,t,n){var i=this.warnedKeysByObject.get(e);i||(i=new Set,this.warnedKeysByObject.set(e,i)),i.has(t)||(i.add(t),this.logger.warn(n,e))}}]),e}();function eO(e,t){return"[".concat(e,'~="').concat(t,'"]')}var eM=function(){"use strict";function e(t){(0,K._)(this,e),this.scope=t}return(0,H._)(e,[{key:"element",get:function(){return this.scope.element}},{key:"identifier",get:function(){return this.scope.identifier}},{key:"schema",get:function(){return this.scope.schema}},{key:"has",value:function(e){return null!=this.find(e)}},{key:"find",value:function(){for(var e=this,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return n.reduce(function(t,n){return t||e.findTarget(n)||e.findLegacyTarget(n)},void 0)}},{key:"findAll",value:function(){for(var e=this,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return n.reduce(function(t,n){return(0,X._)(t).concat((0,X._)(e.findAllTargets(n)),(0,X._)(e.findAllLegacyTargets(n)))},[])}},{key:"findTarget",value:function(e){var t=this.getSelectorForTargetName(e);return this.scope.findElement(t)}},{key:"findAllTargets",value:function(e){var t=this.getSelectorForTargetName(e);return this.scope.findAllElements(t)}},{key:"getSelectorForTargetName",value:function(e){return eO(this.schema.targetAttributeForScope(this.identifier),e)}},{key:"findLegacyTarget",value:function(e){var t=this.getLegacySelectorForTargetName(e);return this.deprecate(this.scope.findElement(t),e)}},{key:"findAllLegacyTargets",value:function(e){var t=this,n=this.getLegacySelectorForTargetName(e);return this.scope.findAllElements(n).map(function(n){return t.deprecate(n,e)})}},{key:"getLegacySelectorForTargetName",value:function(e){var t="".concat(this.identifier,".").concat(e);return eO(this.schema.targetAttribute,t)}},{key:"deprecate",value:function(e,t){if(e){var n=this.identifier,i=this.schema.targetAttribute,r=this.schema.targetAttributeForScope(n);this.guide.warn(e,"target:".concat(t),"Please replace ".concat(i,'="').concat(n,".").concat(t,'" with ').concat(r,'="').concat(t,'". ')+"The ".concat(i," attribute is deprecated and will be removed in a future version of Stimulus."))}return e}},{key:"guide",get:function(){return this.scope.guide}}]),e}(),eF=function(){"use strict";function e(t,n){(0,K._)(this,e),this.scope=t,this.controllerElement=n}return(0,H._)(e,[{key:"element",get:function(){return this.scope.element}},{key:"identifier",get:function(){return this.scope.identifier}},{key:"schema",get:function(){return this.scope.schema}},{key:"has",value:function(e){return null!=this.find(e)}},{key:"find",value:function(){for(var e=this,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return n.reduce(function(t,n){return t||e.findOutlet(n)},void 0)}},{key:"findAll",value:function(){for(var e=this,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return n.reduce(function(t,n){return(0,X._)(t).concat((0,X._)(e.findAllOutlets(n)))},[])}},{key:"getSelectorForOutletName",value:function(e){var t=this.schema.outletAttributeForScope(this.identifier,e);return this.controllerElement.getAttribute(t)}},{key:"findOutlet",value:function(e){var t=this.getSelectorForOutletName(e);if(t)return this.findElement(t,e)}},{key:"findAllOutlets",value:function(e){var t=this.getSelectorForOutletName(e);return t?this.findAllElements(t,e):[]}},{key:"findElement",value:function(e,t){var n=this;return this.scope.queryElements(e).filter(function(i){return n.matchesElement(i,e,t)})[0]}},{key:"findAllElements",value:function(e,t){var n=this;return this.scope.queryElements(e).filter(function(i){return n.matchesElement(i,e,t)})}},{key:"matchesElement",value:function(e,t,n){var i=e.getAttribute(this.scope.schema.controllerAttribute)||"";return e.matches(t)&&i.split(" ").includes(n)}}]),e}(),eN=function(){"use strict";function e(t,n,i,r){var a=this;(0,K._)(this,e),this.targets=new eM(this),this.classes=new eC(this),this.data=new ex(this),this.containsElement=function(e){return e.closest(a.controllerSelector)===a.element},this.schema=t,this.element=n,this.identifier=i,this.guide=new eP(r),this.outlets=new eF(this.documentScope,n)}return(0,H._)(e,[{key:"findElement",value:function(e){return this.element.matches(e)?this.element:this.queryElements(e).find(this.containsElement)}},{key:"findAllElements",value:function(e){return(0,X._)(this.element.matches(e)?[this.element]:[]).concat((0,X._)(this.queryElements(e).filter(this.containsElement)))}},{key:"queryElements",value:function(e){return Array.from(this.element.querySelectorAll(e))}},{key:"controllerSelector",get:function(){return eO(this.schema.controllerAttribute,this.identifier)}},{key:"isDocumentScope",get:function(){return this.element===document.documentElement}},{key:"documentScope",get:function(){return this.isDocumentScope?this:new e(this.schema,document.documentElement,this.identifier,this.guide.logger)}}]),e}(),eB=function(){"use strict";function e(t,n,i){(0,K._)(this,e),this.element=t,this.schema=n,this.delegate=i,this.valueListObserver=new ek(this.element,this.controllerAttribute,this),this.scopesByIdentifierByElement=new WeakMap,this.scopeReferenceCounts=new WeakMap}return(0,H._)(e,[{key:"start",value:function(){this.valueListObserver.start()}},{key:"stop",value:function(){this.valueListObserver.stop()}},{key:"controllerAttribute",get:function(){return this.schema.controllerAttribute}},{key:"parseValueForToken",value:function(e){var t=e.element,n=e.content;return this.parseValueForElementAndIdentifier(t,n)}},{key:"parseValueForElementAndIdentifier",value:function(e,t){var n=this.fetchScopesByIdentifierForElement(e),i=n.get(t);return i||(i=this.delegate.createScopeForElementAndIdentifier(e,t),n.set(t,i)),i}},{key:"elementMatchedValue",value:function(e,t){var n=(this.scopeReferenceCounts.get(t)||0)+1;this.scopeReferenceCounts.set(t,n),1==n&&this.delegate.scopeConnected(t)}},{key:"elementUnmatchedValue",value:function(e,t){var n=this.scopeReferenceCounts.get(t);n&&(this.scopeReferenceCounts.set(t,n-1),1==n&&this.delegate.scopeDisconnected(t))}},{key:"fetchScopesByIdentifierForElement",value:function(e){var t=this.scopesByIdentifierByElement.get(e);return t||(t=new Map,this.scopesByIdentifierByElement.set(e,t)),t}}]),e}(),eU=function(){"use strict";function e(t){(0,K._)(this,e),this.application=t,this.scopeObserver=new eB(this.element,this.schema,this),this.scopesByIdentifier=new em,this.modulesByIdentifier=new Map}return(0,H._)(e,[{key:"element",get:function(){return this.application.element}},{key:"schema",get:function(){return this.application.schema}},{key:"logger",get:function(){return this.application.logger}},{key:"controllerAttribute",get:function(){return this.schema.controllerAttribute}},{key:"modules",get:function(){return Array.from(this.modulesByIdentifier.values())}},{key:"contexts",get:function(){return this.modules.reduce(function(e,t){return e.concat(t.contexts)},[])}},{key:"start",value:function(){this.scopeObserver.start()}},{key:"stop",value:function(){this.scopeObserver.stop()}},{key:"loadDefinition",value:function(e){this.unloadIdentifier(e.identifier);var t=new eD(this.application,e);this.connectModule(t);var n=e.controllerConstructor.afterLoad;n&&n.call(e.controllerConstructor,e.identifier,this.application)}},{key:"unloadIdentifier",value:function(e){var t=this.modulesByIdentifier.get(e);t&&this.disconnectModule(t)}},{key:"getContextForElementAndIdentifier",value:function(e,t){var n=this.modulesByIdentifier.get(t);if(n)return n.contexts.find(function(t){return t.element==e})}},{key:"proposeToConnectScopeForElementAndIdentifier",value:function(e,t){var n=this.scopeObserver.parseValueForElementAndIdentifier(e,t);n?this.scopeObserver.elementMatchedValue(n.element,n):console.error("Couldn't find or create scope for identifier: \"".concat(t,'" and element:'),e)}},{key:"handleError",value:function(e,t,n){this.application.handleError(e,t,n)}},{key:"createScopeForElementAndIdentifier",value:function(e,t){return new eN(this.schema,e,t,this.logger)}},{key:"scopeConnected",value:function(e){this.scopesByIdentifier.add(e.identifier,e);var t=this.modulesByIdentifier.get(e.identifier);t&&t.connectContextForScope(e)}},{key:"scopeDisconnected",value:function(e){this.scopesByIdentifier.delete(e.identifier,e);var t=this.modulesByIdentifier.get(e.identifier);t&&t.disconnectContextForScope(e)}},{key:"connectModule",value:function(e){this.modulesByIdentifier.set(e.identifier,e),this.scopesByIdentifier.getValuesForKey(e.identifier).forEach(function(t){return e.connectContextForScope(t)})}},{key:"disconnectModule",value:function(e){this.modulesByIdentifier.delete(e.identifier),this.scopesByIdentifier.getValuesForKey(e.identifier).forEach(function(t){return e.disconnectContextForScope(t)})}}]),e}(),ej={controllerAttribute:"data-controller",actionAttribute:"data-action",targetAttribute:"data-target",targetAttributeForScope:function(e){return"data-".concat(e,"-target")},outletAttributeForScope:function(e,t){return"data-".concat(e,"-").concat(t,"-outlet")},keyMappings:Object.assign(Object.assign({enter:"Enter",tab:"Tab",esc:"Escape",space:" ",up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",home:"Home",end:"End",page_up:"PageUp",page_down:"PageDown"},eG("abcdefghijklmnopqrstuvwxyz".split("").map(function(e){return[e,e]}))),eG("0123456789".split("").map(function(e){return[e,e]})))};function eG(e){return e.reduce(function(e,t){var n=(0,z._)(t,2),i=n[0],r=n[1];return Object.assign(Object.assign({},e),(0,V._)({},i,r))},{})}var eK=function(){"use strict";function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.documentElement,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ej,i=this;(0,K._)(this,e),this.logger=console,this.debug=!1,this.logDebugActivity=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i.debug&&i.logFormattedMessage(e,t,n)},this.element=t,this.schema=n,this.dispatcher=new ee(this),this.router=new eU(this),this.actionDescriptorFilters=Object.assign({},et)}return(0,H._)(e,[{key:"start",value:function(){return j(function(){return $(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){"loading"==document.readyState?document.addEventListener("DOMContentLoaded",function(){return e()}):e()})];case 1:return e.sent(),this.logDebugActivity("application","starting"),this.dispatcher.start(),this.router.start(),this.logDebugActivity("application","start"),[2]}})}).call(this)}},{key:"stop",value:function(){this.logDebugActivity("application","stopping"),this.dispatcher.stop(),this.router.stop(),this.logDebugActivity("application","stop")}},{key:"register",value:function(e,t){this.load({identifier:e,controllerConstructor:t})}},{key:"registerActionOption",value:function(e,t){this.actionDescriptorFilters[e]=t}},{key:"load",value:function(e){for(var t=this,n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(Array.isArray(e)?e:[e].concat((0,X._)(i))).forEach(function(e){e.controllerConstructor.shouldLoad&&t.router.loadDefinition(e)})}},{key:"unload",value:function(e){for(var t=this,n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(Array.isArray(e)?e:[e].concat((0,X._)(i))).forEach(function(e){return t.router.unloadIdentifier(e)})}},{key:"controllers",get:function(){return this.router.contexts.map(function(e){return e.controller})}},{key:"getControllerForElementAndIdentifier",value:function(e,t){var n=this.router.getContextForElementAndIdentifier(e,t);return n?n.controller:null}},{key:"handleError",value:function(e,t,n){var i;this.logger.error("%s\n\n%o\n\n%o",t,e,n),null==(i=window.onerror)||i.call(window,t,"",0,0,e)}},{key:"logFormattedMessage",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n=Object.assign({application:this},n),this.logger.groupCollapsed("".concat(e," #").concat(t)),this.logger.log("details:",Object.assign({},n)),this.logger.groupEnd()}}],[{key:"start",value:function(e,t){var n=new this(e,t);return n.start(),n}}]),e}();function eH(e,t,n){return e.application.getControllerForElementAndIdentifier(t,n)}function eV(e,t,n){var i=eH(e,t,n);return i||(e.application.router.proposeToConnectScopeForElementAndIdentifier(t,n),i=eH(e,t,n))?i:void 0}function eq(e,t){var n,i,r,a,s,o=(0,z._)(e,2);return i=(n={controller:t,token:o[0],typeDefinition:o[1]}).token,r=n.typeDefinition,a="".concat(es(i),"-value"),{type:s=function(e){var t=e.controller,n=e.token,i=e.typeDefinition,r=function(e){var t=e.controller,n=e.token,i=e.typeObject,r=null!=i.type,a=null!=i.default,s=eY(i.type),o=eW(e.typeObject.default);if(r&&!a)return s;if(!r&&a)return o;if(s!==o){var l=t?"".concat(t,".").concat(n):n;throw Error('The specified default value for the Stimulus Value "'.concat(l,'" must match the defined type "').concat(s,'". The provided default value of "').concat(i.default,'" is of type "').concat(o,'".'))}if(r&&a)return s}({controller:t,token:n,typeObject:i}),a=eW(i),s=eY(i),o=r||a||s;if(o)return o;var l=t?"".concat(t,".").concat(i):n;throw Error('Unknown value type "'.concat(l,'" for "').concat(n,'" value'))}(n),key:a,name:ei(a),get defaultValue(){var l=eY(r);if(l)return ez[l];var u=eo(r,"default"),c=eo(r,"type");if(u)return r.default;if(c){var h=eY(r.type);if(h)return ez[h]}return r},get hasCustomDefaultValue(){return void 0!==eW(r)},reader:eX[s],writer:eQ[s]||eQ.default}}function eY(e){switch(e){case Array:return"array";case Boolean:return"boolean";case Number:return"number";case Object:return"object";case String:return"string"}}function eW(e){switch(void 0===e?"undefined":(0,Q._)(e)){case"boolean":return"boolean";case"number":return"number";case"string":return"string"}return Array.isArray(e)?"array":"[object Object]"===Object.prototype.toString.call(e)?"object":void 0}var ez={get array(){return[]},boolean:!1,number:0,get object(){return{}},string:""},eX={array:function(e){var t=JSON.parse(e);if(!Array.isArray(t))throw TypeError('expected value of type "array" but instead got value "'.concat(e,'" of type "').concat(eW(t),'"'));return t},boolean:function(e){return"0"!=e&&"false"!=String(e).toLowerCase()},number:function(e){return Number(e.replace(/_/g,""))},object:function(e){var t=JSON.parse(e);if(null===t||(void 0===t?"undefined":(0,Q._)(t))!="object"||Array.isArray(t))throw TypeError('expected value of type "object" but instead got value "'.concat(e,'" of type "').concat(eW(t),'"'));return t},string:function(e){return e}},eQ={default:function(e){return"".concat(e)},array:e$,object:e$};function e$(e){return JSON.stringify(e)}var eZ=function(){"use strict";function e(t){(0,K._)(this,e),this.context=t}return(0,H._)(e,[{key:"application",get:function(){return this.context.application}},{key:"scope",get:function(){return this.context.scope}},{key:"element",get:function(){return this.scope.element}},{key:"identifier",get:function(){return this.scope.identifier}},{key:"targets",get:function(){return this.scope.targets}},{key:"outlets",get:function(){return this.scope.outlets}},{key:"classes",get:function(){return this.scope.classes}},{key:"data",get:function(){return this.scope.data}},{key:"initialize",value:function(){}},{key:"connect",value:function(){}},{key:"disconnect",value:function(){}},{key:"dispatch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.target,i=void 0===n?this.element:n,r=t.detail,a=t.prefix,s=void 0===a?this.identifier:a,o=t.bubbles,l=t.cancelable,u=new CustomEvent(s?"".concat(s,":").concat(e):e,{detail:void 0===r?{}:r,bubbles:void 0===o||o,cancelable:void 0===l||l});return i.dispatchEvent(u),u}}],[{key:"shouldLoad",get:function(){return!0}},{key:"afterLoad",value:function(e,t){}}]),e}();eZ.blessings=[function(e){return e_(e,"classes").reduce(function(e,t){var n,i;return Object.assign(e,(n=t,i={},(0,V._)(i,"".concat(n,"Class"),{get:function(){var e=this.classes;if(e.has(n))return e.get(n);var t=e.getAttributeName(n);throw Error('Missing attribute "'.concat(t,'"'))}}),(0,V._)(i,"".concat(n,"Classes"),{get:function(){return this.classes.getAll(n)}}),(0,V._)(i,"has".concat(ea(n),"Class"),{get:function(){return this.classes.has(n)}}),i))},{})},function(e){return e_(e,"targets").reduce(function(e,t){var n,i;return Object.assign(e,(n=t,i={},(0,V._)(i,"".concat(n,"Target"),{get:function(){var e=this.targets.find(n);if(e)return e;throw Error('Missing target element "'.concat(n,'" for "').concat(this.identifier,'" controller'))}}),(0,V._)(i,"".concat(n,"Targets"),{get:function(){return this.targets.findAll(n)}}),(0,V._)(i,"has".concat(ea(n),"Target"),{get:function(){return this.targets.has(n)}}),i))},{})},function(e){var t=eA(e).reduce(function(e,t){var n;return e.push.apply(e,(0,X._)((n=t.values)?Object.keys(n).map(function(e){return[e,n[e]]}):[])),e},[]);return t.reduce(function(e,t){var n,i,r,a,s,o;return Object.assign(e,(r=(i=eq(t,void 0)).key,a=i.name,s=i.reader,o=i.writer,n={},(0,V._)(n,a,{get:function(){var e=this.data.get(r);return null!==e?s(e):i.defaultValue},set:function(e){void 0===e?this.data.delete(r):this.data.set(r,o(e))}}),(0,V._)(n,"has".concat(ea(a)),{get:function(){return this.data.has(r)||i.hasCustomDefaultValue}}),n))},{valueDescriptorMap:{get:function(){var e=this;return t.reduce(function(t,n){var i=eq(n,e.identifier),r=e.data.getAttributeNameForKey(i.key);return Object.assign(t,(0,V._)({},r,i))},{})}}})},function(e){return e_(e,"outlets").reduce(function(e,t){var n,i,r;return Object.assign(e,(r=er(n=t),i={},(0,V._)(i,"".concat(r,"Outlet"),{get:function(){var e=this.outlets.find(n),t=this.outlets.getSelectorForOutletName(n);if(e){var i=eV(this,e,n);if(i)return i;throw Error('The provided outlet element is missing an outlet controller "'.concat(n,'" instance for host controller "').concat(this.identifier,'"'))}throw Error('Missing outlet element "'.concat(n,'" for host controller "').concat(this.identifier,'". Stimulus couldn\'t find a matching outlet element using selector "').concat(t,'".'))}}),(0,V._)(i,"".concat(r,"Outlets"),{get:function(){var e=this,t=this.outlets.findAll(n);return t.length>0?t.map(function(t){var i=eV(e,t,n);if(i)return i;console.warn('The provided outlet element is missing an outlet controller "'.concat(n,'" instance for host controller "').concat(e.identifier,'"'),t)}).filter(function(e){return e}):[]}}),(0,V._)(i,"".concat(r,"OutletElement"),{get:function(){var e=this.outlets.find(n),t=this.outlets.getSelectorForOutletName(n);if(e)return e;throw Error('Missing outlet element "'.concat(n,'" for host controller "').concat(this.identifier,'". Stimulus couldn\'t find a matching outlet element using selector "').concat(t,'".'))}}),(0,V._)(i,"".concat(r,"OutletElements"),{get:function(){return this.outlets.findAll(n)}}),(0,V._)(i,"has".concat(ea(r),"Outlet"),{get:function(){return this.outlets.has(n)}}),i))},{})}],eZ.targets=[],eZ.outlets=[],eZ.values={};var G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),X=N("l9etm"),Q=N("16gB1"),eJ=function(e){"use strict";function t(){for(var e,n,i,r,a,s=arguments.length,o=Array(s),l=0;l<s;l++)o[l]=arguments[l];return(0,K._)(this,t),n=a=(0,G._)(this,t,(0,X._)(o)),r=[],(i="symbol"==(void 0===(e=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i="items","string"))?"undefined":(0,Q._)(e))?e:e+"")in n?Object.defineProperty(n,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[i]=r,a}return(0,W._)(t,e),(0,H._)(t,[{key:"connect",value:function(){for(var e=this.element.getElementsByClassName("accordion-item"),t=0;t<e.length;t++)this.items.push(e[t]);console.log(e)}},{key:"closeAll",value:function(e){this.items.forEach(function(e){e.classList.remove("active")})}},{key:"toggle",value:function(e){console.log(e);var t=e.currentTarget.dataset.key,n=this.items[t];if(n){var i=n.getElementsByClassName("accordion-content");(i=i.length?i[0]:null)&&(n.classList.contains("active")?n.classList.remove("active"):(n.classList.remove("active"),n.classList.add("active")))}}}]),t}(eZ),G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),Q=N("16gB1"),X=N("l9etm"),e0=function(e){var t=e.innerWidth&&e.document.documentElement.clientWidth?Math.min(e.innerWidth,e.document.documentElement.clientWidth):e.innerWidth||e.document.documentElement.clientWidth||e.document.getElementsByTagName("body")[0].clientWidth;return{h:e.document.documentElement.clientHeight,w:t}},e1=function(e){return e.scrollY||e.document.documentElement.scrollTop},e2=function(e){var t;return function(){t&&window.cancelAnimationFrame(t),t=window.requestAnimationFrame(e)}},e3=function(e){"use strict";function t(){return(0,K._)(this,t),(0,G._)(this,t,arguments)}return(0,W._)(t,e),(0,H._)(t,[{key:"connect",value:function(){this.body=document.getElementsByTagName("body")[0],this.top=0,this.element.burgerController=this}},{key:"reset",value:function(){this.navOpenTarget.classList.remove("active"),this.navCloseTarget.classList.remove("active")}},{key:"open",value:function(e,t){t?(this.modalTarget.classList.remove("active"),this.modalTarget.classList.add("active"),this.menuTarget.classList.remove("active"),this.navTarget.classList.remove("menu"),this.navTarget.classList.remove("modal"),this.navTarget.classList.add("modal")):(this.modalTarget.classList.remove("active"),this.navTarget.classList.remove("modal"),this.navTarget.classList.remove("menu"),this.navTarget.classList.add("menu"),this.menuTarget.classList.remove("active"),this.menuTarget.classList.add("active")),this.reset(),this.top=e1(window),this.navTarget.classList.remove("active"),this.navTarget.classList.add("active"),this.navCloseTarget.classList.add("active"),this.body.classList.remove("menuOpen"),this.body.classList.add("menuOpen")}},{key:"openUrl",value:function(e){var t=this;fetch(e).then(function(e){return e.text()}).then(function(e){var n=new DOMParser().parseFromString(e,"text/html").getElementById("modalContent");t.modalContentTarget.innerHTML=n.innerHTML,t.open(null,!0)})}},{key:"openModal",value:function(e){var t=e.currentTarget,n=t.getAttribute("href");t&&(e.preventDefault(),this.openUrl(n))}},{key:"close",value:function(){var e=this;this.reset(),this.navTarget.classList.remove("fadeInLeft"),this.navTarget.classList.add("fadeOutLeft"),this.body.classList.remove("menuOpen"),window.scroll(0,this.top),setTimeout(function(){e.navTarget.classList.remove("active"),e.navTarget.classList.remove("fadeOutLeft"),e.navTarget.classList.add("fadeInLeft"),e.navTarget.classList.remove("active"),e.navOpenTarget.classList.add("active")},250)}},{key:"top",value:function(){window.scrollTop=0}}]),t}(eZ);h=["navOpen","navClose","nav","menu","modal","modalContent"],(c="symbol"==(void 0===(t=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(c="targets","string"))?"undefined":(0,Q._)(t))?t:t+"")in e3?Object.defineProperty(e3,c,{value:h,enumerable:!0,configurable:!0,writable:!0}):e3[c]=h;var G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),X=N("l9etm"),Q=N("16gB1"),V=N("eh14X"),X=N("l9etm");function e5(e){return"number"==typeof e}function e4(e){return"string"==typeof e}function e8(e){return"boolean"==typeof e}function e6(e){return"[object Object]"===Object.prototype.toString.call(e)}function e9(e){return Math.abs(e)}function e7(e){return Math.sign(e)}function te(e){return tr(e).map(Number)}function tt(e){return e[tn(e)]}function tn(e){return Math.max(0,e.length-1)}function ti(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Array.from(Array(e),function(e,n){return t+n})}function tr(e){return Object.keys(e)}function ta(e,t){return void 0!==t.MouseEvent&&e instanceof t.MouseEvent}function ts(){var e=[],t={add:function(n,i,r){var a,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{passive:!0};return"addEventListener"in n?(n.addEventListener(i,r,s),a=function(){return n.removeEventListener(i,r,s)}):(n.addListener(r),a=function(){return n.removeListener(r)}),e.push(a),t},clear:function(){e=e.filter(function(e){return e()})}};return t}function to(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e9(e-t);function i(n){return n<e||n>t}return{length:n,max:t,min:e,constrain:function(n){return i(n)?n<e?e:t:n},reachedAny:i,reachedMax:function(e){return e>t},reachedMin:function(t){return t<e},removeOffset:function(e){return n?e-n*Math.ceil((e-t)/n):e}}}function tl(e){var t=e;function n(e){return e5(e)?e:e.get()}return{get:function(){return t},set:function(e){t=n(e)},add:function(e){t+=n(e)},subtract:function(e){t-=n(e)}}}function tu(e,t){var n="x"===e.scroll?function(e){return"translate3d(".concat(e,"px,0px,0px)")}:function(e){return"translate3d(0px,".concat(e,"px,0px)")},i=t.style,r=null,a=!1;return{clear:function(){!a&&(i.transform="",t.getAttribute("style")||t.removeAttribute("style"))},to:function(t){if(!a){var s=Math.round(100*e.direction(t))/100;s!==r&&(i.transform=n(s),r=s)}},toggleActive:function(e){a=!e}}}var tc={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function th(e,t,n){var i,r,a,s,o,l,u,c,h=e.ownerDocument,d=h.defaultView,f=function(e){function t(e,t){return function e(t,n){return[t,n].reduce(function(t,n){return tr(n).forEach(function(i){var r=t[i],a=n[i],s=e6(r)&&e6(a);t[i]=s?e(r,a):a}),t},{})}(e,t||{})}return{mergeOptions:t,optionsAtMedia:function(n){var i=n.breakpoints||{},r=tr(i).filter(function(t){return e.matchMedia(t).matches}).map(function(e){return i[e]}).reduce(function(e,n){return t(e,n)},{});return t(n,r)},optionsMediaQueries:function(t){return t.map(function(e){return tr(e.breakpoints||{})}).reduce(function(e,t){return e.concat(t)},[]).map(e.matchMedia)}}}(d),v=(s=[],{init:function(e,t){return(s=t.filter(function(e){var t=e.options;return!1!==f.optionsAtMedia(t).active})).forEach(function(t){return t.init(e,f)}),t.reduce(function(e,t){return Object.assign(e,(0,V._)({},t.name,t))},{})},destroy:function(){s=s.filter(function(e){return e.destroy()})}}),g=ts(),m=(r={},a={init:function(e){i=e},emit:function(e){return(r[e]||[]).forEach(function(t){return t(i,e)}),a},off:function(e,t){return r[e]=(r[e]||[]).filter(function(e){return e!==t}),a},on:function(e,t){return r[e]=(r[e]||[]).concat([t]),a},clear:function(){r={}}}),p=f.mergeOptions,y=f.optionsAtMedia,E=f.optionsMediaQueries,k=m.on,b=m.off,T=m.emit,S=!1,_=p(tc,th.globalOptions),A=p(_),L=[];function w(t,n){var i,r,a;!S&&(A=y(_=p(_,t)),L=n||L,i=A.container,r=A.slides,u=(e4(i)?e.querySelector(i):i)||e.children[0],a=e4(r)?u.querySelectorAll(r):r,c=[].slice.call(a||u.children),o=function t(n){var i=function(e,t,n,i,r,a,s){var o,l,u,c,h,d,f,v,g,m,p,y,E,k,b,T,S,_,A,L,w,I,R,D,C,x,P,O,M,F,N,B,U,j,G,K,H,V,q,Y,W,z,X,Q,$=a.align,Z=a.axis,J=a.direction,ee=a.startIndex,et=a.loop,en=a.duration,ei=a.dragFree,er=a.dragThreshold,ea=a.inViewThreshold,es=a.slidesToScroll,eo=a.skipSnaps,el=a.containScroll,eu=a.watchResize,ec=a.watchSlides,eh=a.watchDrag,ed=a.watchFocus,ef={measure:function(e){var t=e.offsetTop,n=e.offsetLeft,i=e.offsetWidth,r=e.offsetHeight;return{top:t,right:n+i,bottom:t+r,left:n,width:i,height:r}}},ev=ef.measure(t),eg=n.map(ef.measure),em=(h="rtl"===J,f=(d="y"===Z)||!h?1:-1,v=d?"top":h?"right":"left",g=d?"bottom":h?"left":"right",{scroll:d?"y":"x",cross:d?"x":"y",startEdge:v,endEdge:g,measureSize:function(e){var t=e.height,n=e.width;return d?t:n},direction:function(e){return e*f}}),ep=em.measureSize(ev),ey={measure:function(e){return e/100*ep}},eE=(o=$,l=ep,u={start:function(){return 0},center:function(e){return(l-e)/2},end:function(e){return l-e}},{measure:function(e,t){return e4(o)?u[o](e):o(l,e,t)}}),ek=!et&&!!el,eb=et||!!el,eT=(m=em.measureSize,p=em.startEdge,y=em.endEdge,E=eg[0]&&eb,k=function(){if(!E)return 0;var e=eg[0];return e9(ev[p]-e[p])}(),b=E?parseFloat(r.getComputedStyle(tt(n)).getPropertyValue("margin-".concat(y))):0,T=eg.map(m),S=eg.map(function(e,t,n){var i=t===tn(n);return t?i?T[t]+b:n[t+1][p]-e[p]:T[t]+k}).map(e9),{slideSizes:T,slideSizesWithGaps:S,startGap:k,endGap:b}),eS=eT.slideSizes,e_=eT.slideSizesWithGaps,eA=eT.startGap,eL=eT.endGap,ew=(_=em.startEdge,A=em.endEdge,L=em.direction,w=e5(es),{groupSlides:function(e){return w?te(e).filter(function(e){return e%es==0}).map(function(t){return e.slice(t,t+es)}):e.length?te(e).reduce(function(t,n,i){var r=tt(t)||0,a=n===tn(e),s=ev[_]-eg[r][_],o=ev[_]-eg[n][A],l=et||0!==r?0:L(eA),u=e9(o-(!et&&a?L(eL):0)-(s+l));return i&&u>ep+2&&t.push(n),a&&t.push(e.length),t},[]).map(function(t,n,i){var r=Math.max(i[n-1]||0);return e.slice(r,t)}):[]}}),eI=(I=em.startEdge,R=em.endEdge,C=(D=ew.groupSlides)(eg).map(function(e){return tt(e)[R]-e[0][I]}).map(e9).map(eE.measure),P=D(x=eg.map(function(e){return ev[I]-e[I]}).map(function(e){return-e9(e)})).map(function(e){return e[0]}).map(function(e,t){return e+C[t]}),{snaps:x,snapsAligned:P}),eR=eI.snaps,eD=eI.snapsAligned,eC=-tt(eR)+tt(e_),ex=function(e,t,n,i,r){var a,s,o=to(-t+e,0),l=n.map(function(e,t){var i=o.min,r=o.max,a=o.constrain(e),s=t===tn(n);return t?s||function(e,t){return 1>=e9(e-t)}(i,a)?i:function(e,t){return 1>=e9(e-t)}(r,a)?r:a:r}).map(function(e){return parseFloat(e.toFixed(3))}),u=(a=l[0],s=tt(l),to(l.lastIndexOf(a),l.indexOf(s)+1));return{snapsContained:function(){if(t<=e+2)return[o.max];if("keepSnaps"===i)return l;var n=u.min,r=u.max;return l.slice(n,r)}(),scrollContainLimit:u}}(ep,eC,eD,el,0),eP=ex.snapsContained,eO=ex.scrollContainLimit,eM=ek?eP:eD,eF=(O=eM[0],{limit:to(et?O-eC:tt(eM),O)}).limit,eN=function e(t,n,i){var r=to(0,t).constrain,a=t+1,s=o(n);function o(e){return i?e9((a+e)%a):r(e)}function l(){return e(t,s,i)}var u={get:function(){return s},set:function(e){return s=o(e),u},add:function(e){return l().set(s+e)},clone:l};return u}(tn(eM),ee,et),eB=eN.clone(),eU=te(n),ej=function(e){var t=e.dragHandler,n=e.scrollBody,i=e.scrollBounds;e.options.loop||i.constrain(t.pointerDown()),n.seek()},eG=function(e,t){var n=e.scrollBody,i=e.translate,r=e.location,a=e.offsetLocation,s=e.previousLocation,o=e.scrollLooper,l=e.slideLooper,u=e.dragHandler,c=e.animation,h=e.eventHandler,d=e.scrollBounds,f=e.options.loop,v=n.settled(),g=!d.shouldConstrain(),m=f?v:v&&g,p=m&&!u.pointerDown();p&&c.stop();var y=r.get()*t+s.get()*(1-t);a.set(y),f&&(o.loop(n.direction()),l.loop()),i.to(a.get()),p&&h.emit("settle"),m||h.emit("scroll")},eK=function(e,t,n,i){var r=ts(),a=1e3/60,s=null,o=0,l=0;function u(e){if(l){s||(s=e,n(),n());var r=e-s;for(s=e,o+=r;o>=a;)n(),o-=a;i(o/a),l&&(l=t.requestAnimationFrame(u))}}function c(){t.cancelAnimationFrame(l),s=null,o=0,l=0}return{init:function(){r.add(e,"visibilitychange",function(){e.hidden&&(s=null,o=0)})},destroy:function(){c(),r.clear()},start:function(){l||(l=t.requestAnimationFrame(u))},stop:c,update:n,render:i}}(i,r,function(){return ej(e2)},function(e){return eG(e2,e)}),eH=eM[eN.get()],eV=tl(eH),eq=tl(eH),eY=tl(eH),eW=tl(eH),ez=function(e,t,n,i,r,a){var s=0,o=0,l=r,u=.68,c=e.get(),h=0;function d(e){return l=e,v}function f(e){return u=e,v}var v={direction:function(){return o},duration:function(){return l},velocity:function(){return s},seek:function(){var t=i.get()-e.get(),r=0;return l?(n.set(e),s+=t/l,s*=u,c+=s,e.add(s),r=c-h):(s=0,n.set(i),e.set(i),r=t),o=e7(r),h=c,v},settled:function(){return .001>e9(i.get()-t.get())},useBaseFriction:function(){return f(.68)},useBaseDuration:function(){return d(r)},useFriction:f,useDuration:d};return v}(eV,eY,eq,eW,en,.68),eX=function(e,t,n,i,r){var a=i.reachedAny,s=i.removeOffset,o=i.constrain;function l(e){return e.concat().sort(function(e,t){return e9(e)-e9(t)})[0]}function u(t,i){var r=[t,t+n,t-n];if(!e)return t;if(!i)return l(r);var a=r.filter(function(e){return e7(e)===i});return a.length?l(a):tt(r)-n}return{byDistance:function(n,i){var l,c=r.get()+n,h=(l=e?s(c):o(c),{index:t.map(function(e,t){return{diff:u(e-l,0),index:t}}).sort(function(e,t){return e9(e.diff)-e9(t.diff)})[0].index,distance:l}),d=h.index,f=h.distance,v=!e&&a(c);if(!i||v)return{index:d,distance:n};var g=n+u(t[d]-f,0);return{index:d,distance:g}},byIndex:function(e,n){var i=u(t[e]-r.get(),n);return{index:e,distance:i}},shortcut:u}}(et,eM,eC,eF,eW),eQ=function(e,t,n,i,r,a,s){function o(r){var o=r.distance,l=r.index!==t.get();a.add(o),o&&(i.duration()?e.start():(e.update(),e.render(1),e.update())),l&&(n.set(t.get()),t.set(r.index),s.emit("select"))}return{distance:function(e,t){o(r.byDistance(e,t))},index:function(e,n){var i=t.clone().set(e);o(r.byIndex(i.get(),n))}}}(eK,eN,eB,ez,eX,eW,s),e$=(M=eF.max,F=eF.length,{get:function(e){return F?-((e-M)/F):0}}),eZ=ts(),eJ=(B={},U=null,j=null,G=!1,{init:function(){N=new IntersectionObserver(function(e){G||(e.forEach(function(e){B[n.indexOf(e.target)]=e}),U=null,j=null,s.emit("slidesInView"))},{root:t.parentElement,threshold:ea}),n.forEach(function(e){return N.observe(e)})},destroy:function(){N&&N.disconnect(),G=!0},get:function(){var e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(e&&U)return U;if(!e&&j)return j;var t=tr(B).reduce(function(t,n){var i=parseInt(n),r=B[i].isIntersecting;return(e&&r||!e&&!r)&&t.push(i),t},[]);return e&&(U=t),e||(j=t),t}}),e0=(K=ew.groupSlides,H=eO.min,V=eO.max,{slideRegistry:(c=K(eU),1===eM.length?[eU]:ek&&"keepSnaps"!==el?c.slice(H,V).map(function(e,t,n){var i=t===tn(n);return t?i?ti(tn(eU)-tt(n)[0]+1,tt(n)[0]):e:ti(tt(n[0])+1)}):c)}).slideRegistry,e1=function(e,t,n,i,r,a,s,o){var l={passive:!0,capture:!0},u=0;function c(e){"Tab"===e.code&&(u=new Date().getTime())}return{init:function(h){o&&(a.add(document,"keydown",c,!1),t.forEach(function(t,c){a.add(t,"focus",function(t){(e8(o)||o(h,t))&&function(t){if(!(new Date().getTime()-u>10)){s.emit("slideFocusStart"),e.scrollLeft=0;var a=n.findIndex(function(e){return e.includes(t)});e5(a)&&(r.useDuration(0),i.index(a,0),s.emit("slideFocus"))}}(c)},l)}))}}}(e,n,e0,eQ,ez,eZ,s,ed),e2={ownerDocument:i,ownerWindow:r,eventHandler:s,containerRect:ev,slideRects:eg,animation:eK,axis:em,dragHandler:function(e,t,n,i,r,a,s,o,l,u,c,h,d,f,v,g,m,p,y){var E=e.cross,k=e.direction,b=["INPUT","SELECT","TEXTAREA"],T={passive:!1},S=ts(),_=ts(),A=to(50,225).constrain(f.measure(20)),L={mouse:300,touch:400},w={mouse:500,touch:600},I=v?43:25,R=!1,D=0,C=0,x=!1,P=!1,O=!1,M=!1;function F(e){if(!ta(e,i)&&e.touches.length>=2)return N(e);var t=a.readPoint(e),n=a.readPoint(e,E),s=e9(t-D),l=e9(n-C);if(!P&&!M&&(!e.cancelable||!(P=s>l)))return N(e);var c=a.pointerMove(e);s>g&&(O=!0),u.useFriction(.3).useDuration(.75),o.start(),r.add(k(c)),e.preventDefault()}function N(e){var t,n,i,r=c.byDistance(0,!1).index!==h.get(),s=a.pointerUp(e)*(v?w:L)[M?"mouse":"touch"],o=(t=k(s),n=h.add(-1*e7(t)),i=c.byDistance(t,!v).distance,v||e9(t)<A?i:m&&r?.5*i:c.byIndex(n.get(),0).distance),f=function(e,t){if(0===e||0===t||e9(e)<=e9(t))return 0;var n,i,r=(n=e9(e),i=e9(t),e9(n-i));return e9(r/e)}(s,o);P=!1,x=!1,_.clear(),u.useDuration(I-10*f).useFriction(.68+f/50),l.distance(o,!v),M=!1,d.emit("pointerUp")}function B(e){O&&(e.stopPropagation(),e.preventDefault(),O=!1)}return{init:function(e){y&&S.add(t,"dragstart",function(e){return e.preventDefault()},T).add(t,"touchmove",function(){},T).add(t,"touchend",function(){}).add(t,"touchstart",o).add(t,"mousedown",o).add(t,"touchcancel",N).add(t,"contextmenu",N).add(t,"click",B,!0);function o(o){var l,c,h,f;(e8(y)||y(e,o))&&(M=f=ta(l=o,i),O=v&&f&&!l.buttons&&R,R=e9(r.get()-s.get())>=2,(!f||0===l.button)&&(c=l.target.nodeName||"",b.includes(c)||(x=!0,a.pointerDown(l),u.useFriction(0).useDuration(0),r.set(s),h=M?n:t,_.add(h,"touchmove",F,T).add(h,"touchend",N).add(h,"mousemove",F,T).add(h,"mouseup",N),D=a.readPoint(l),C=a.readPoint(l,E),d.emit("pointerDown"))))}},destroy:function(){S.clear(),_.clear()},pointerDown:function(){return x}}}(em,e,i,r,eW,function(e,t){var n,i;function r(e){return e.timeStamp}function a(n,i){var r=i||e.scroll;return(ta(n,t)?n:n.touches[0])["client".concat("x"===r?"X":"Y")]}return{pointerDown:function(e){return n=e,i=e,a(e)},pointerMove:function(e){var t=a(e)-a(i),s=r(e)-r(n)>170;return i=e,s&&(n=e),t},pointerUp:function(e){if(!n||!i)return 0;var t=a(i)-a(n),s=r(e)-r(n),o=r(e)-r(i)>170,l=t/s;return s&&!o&&e9(l)>.1?l:0},readPoint:a}}(em,r),eV,eK,eQ,ez,eX,eN,s,ey,ei,er,eo,0,eh),eventStore:eZ,percentOfView:ey,index:eN,indexPrevious:eB,limit:eF,location:eV,offsetLocation:eY,previousLocation:eq,options:a,resizeHandler:function(e,t,n,i,r,a,s){var o,l,u=[e].concat(i),c=[],h=!1;function d(e){return r.measureSize(s.measure(e))}return{init:function(r){a&&(l=d(e),c=i.map(d),o=new ResizeObserver(function(n){(e8(a)||a(r,n))&&function(n){var a=!0,s=!1,o=void 0;try{for(var u,f=n[Symbol.iterator]();!(a=(u=f.next()).done);a=!0){var v=u.value;if(h)return;var g=v.target===e,m=i.indexOf(v.target),p=g?l:c[m],y=d(g?e:i[m]);if(e9(y-p)>=.5){r.reInit(),t.emit("resize");break}}}catch(e){s=!0,o=e}finally{try{a||null==f.return||f.return()}finally{if(s)throw o}}}(n)}),n.requestAnimationFrame(function(){u.forEach(function(e){return o.observe(e)})}))},destroy:function(){h=!0,o&&o.disconnect()}}}(t,s,r,n,em,eu,ef),scrollBody:ez,scrollBounds:function(e,t,n,i,r){var a=r.measure(10),s=r.measure(50),o=to(.1,.99),l=!1;function u(){return!l&&!!e.reachedAny(n.get())&&!!e.reachedAny(t.get())}return{shouldConstrain:u,constrain:function(r){if(u()){var l=e.reachedMin(t.get())?"min":"max",c=e9(e[l]-t.get()),h=n.get()-t.get(),d=o.constrain(c/s);n.subtract(h*d),!r&&e9(h)<a&&(n.set(e.constrain(n.get())),i.useDuration(25).useBaseFriction())}},toggleActive:function(e){l=!e}}}(eF,eY,eW,ez,ey),scrollLooper:(q=[eV,eY,eq,eW],W=(Y=to(eF.min+.1,eF.max+.1)).reachedMin,z=Y.reachedMax,{loop:function(e){if(1===e?z(eY.get()):-1===e&&W(eY.get())){var t=-1*e*eC;q.forEach(function(e){return e.add(t)})}}}),scrollProgress:e$,scrollSnapList:eM.map(e$.get),scrollSnaps:eM,scrollTarget:eX,scrollTo:eQ,slideLooper:function(e,t,n,i,r,a,s,o,l){var u=te(r),c=te(r).reverse(),h=v(f(c,s[0]),n,!1).concat(v(f(u,t-s[0]-1),-n,!0));function d(e,t){return e.reduce(function(e,t){return e-r[t]},t)}function f(e,t){return e.reduce(function(e,n){return d(e,t)>0?e.concat([n]):e},[])}function v(r,s,u){var c=a.map(function(e,n){return{start:e-i[n]+.5+s,end:e+t-.5+s}});return r.map(function(t){var i=u?0:-n,r=u?n:0,a=c[t][u?"end":"start"];return{index:t,loopPoint:a,slideLocation:tl(-1),translate:tu(e,l[t]),target:function(){return o.get()>a?i:r}}})}return{canLoop:function(){return h.every(function(e){var n=e.index;return .1>=d(u.filter(function(e){return e!==n}),t)})},clear:function(){h.forEach(function(e){return e.translate.clear()})},loop:function(){h.forEach(function(e){var t=e.target,n=e.translate,i=e.slideLocation,r=t();r!==i.get()&&(n.to(r),i.set(r))})},loopPoints:h}}(em,ep,eC,eS,e_,eR,eM,eY,n),slideFocus:e1,slidesHandler:(Q=!1,{init:function(e){ec&&(X=new MutationObserver(function(t){!Q&&(e8(ec)||ec(e,t))&&function(t){var n=!0,i=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var l=a.value;if("childList"===l.type){e.reInit(),s.emit("slidesChanged");break}}}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}}(t)})).observe(t,{childList:!0})},destroy:function(){X&&X.disconnect(),Q=!0}}),slidesInView:eJ,slideIndexes:eU,slideRegistry:e0,slidesToScroll:ew,target:eW,translate:tu(em,t)};return e2}(e,u,c,h,d,n,m);return n.loop&&!i.slideLooper.canLoop()?t(Object.assign({},n,{loop:!1})):i}(A),E([_].concat((0,X._)(L.map(function(e){return e.options})))).forEach(function(e){return g.add(e,"change",I)}),A.active&&(o.translate.to(o.location.get()),o.animation.init(),o.slidesInView.init(),o.slideFocus.init(x),o.eventHandler.init(x),o.resizeHandler.init(x),o.slidesHandler.init(x),o.options.loop&&o.slideLooper.loop(),u.offsetParent&&c.length&&o.dragHandler.init(x),l=v.init(x,L)))}function I(e,t){var n=C();R(),w(p({startIndex:n},e),t),m.emit("reInit")}function R(){o.dragHandler.destroy(),o.eventStore.clear(),o.translate.clear(),o.slideLooper.clear(),o.resizeHandler.destroy(),o.slidesHandler.destroy(),o.slidesInView.destroy(),o.animation.destroy(),v.destroy(),g.clear()}function D(e,t,n){A.active&&!S&&(o.scrollBody.useBaseFriction().useDuration(!0===t?0:A.duration),o.scrollTo.index(e,n||0))}function C(){return o.index.get()}var x={canScrollNext:function(){return o.index.add(1).get()!==C()},canScrollPrev:function(){return o.index.add(-1).get()!==C()},containerNode:function(){return u},internalEngine:function(){return o},destroy:function(){S||(S=!0,g.clear(),R(),m.emit("destroy"),m.clear())},off:b,on:k,emit:T,plugins:function(){return l},previousScrollSnap:function(){return o.indexPrevious.get()},reInit:I,rootNode:function(){return e},scrollNext:function(e){D(o.index.add(1).get(),e,-1)},scrollPrev:function(e){D(o.index.add(-1).get(),e,1)},scrollProgress:function(){return o.scrollProgress.get(o.offsetLocation.get())},scrollSnapList:function(){return o.scrollSnapList},scrollTo:D,selectedScrollSnap:C,slideNodes:function(){return c},slidesInView:function(){return o.slidesInView.get()},slidesNotInView:function(){return o.slidesInView.get(!1)}};return w(t,n),setTimeout(function(){return m.emit("init")},0),x}th.globalOptions=void 0;var td=function(e,t,n){var i=function(){e.canScrollPrev()?t.removeAttribute("disabled"):t.setAttribute("disabled","disabled"),e.canScrollNext()?n.removeAttribute("disabled"):n.setAttribute("disabled","disabled")};return e.on("select",i).on("init",i).on("reInit",i),function(){t.removeAttribute("disabled"),n.removeAttribute("disabled")}},tf=function(e,t,n){var i=function(){e.scrollPrev()},r=function(){e.scrollNext()};t.addEventListener("click",i,!1),n.addEventListener("click",r,!1);var a=td(e,t,n);return function(){a(),t.removeEventListener("click",i,!1),n.removeEventListener("click",r,!1)}},tv=function(e,t){var n=[],i=function(){t.innerHTML=e.scrollSnapList().map(function(){return'<button class="embla__dot" type="button"></button>'}).join("");var i=function(t){e.scrollTo(t)};(n=Array.from(t.querySelectorAll(".embla__dot"))).forEach(function(e,t){e.addEventListener("click",function(){return i(t)},!1)})},r=function(){var t=e.previousScrollSnap(),i=e.selectedScrollSnap();n[t].classList.remove("embla__dot--selected"),n[i].classList.add("embla__dot--selected")};return e.on("init",i).on("reInit",i).on("init",r).on("reInit",r).on("select",r),function(){t.innerHTML=""}},tg=function(e){"use strict";function t(){for(var e,n,i,r,a,s=arguments.length,o=Array(s),l=0;l<s;l++)o[l]=arguments[l];return(0,K._)(this,t),n=a=(0,G._)(this,t,(0,X._)(o)),r=[],(i="symbol"==(void 0===(e=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i="items","string"))?"undefined":(0,Q._)(e))?e:e+"")in n?Object.defineProperty(n,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[i]=r,a}return(0,W._)(t,e),(0,H._)(t,[{key:"connect",value:function(){var e,t={slidesToScroll:null!=(e=JSON.parse(atob(this.element.dataset.config)).slidesToScroll)?e:1},n=this.element,i=n.querySelector(".embla__viewport"),r=n.querySelector(".embla__button--prev"),a=n.querySelector(".embla__button--next"),s=n.querySelector(".embla__dots"),o=th(i,t),l=tf(o,r,a),u=tv(o,s);o.on("destroy",l),o.on("destroy",u)}}]),t}(eZ),G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),tm=function(e){"use strict";function t(){return(0,K._)(this,t),(0,G._)(this,t,arguments)}return(0,W._)(t,e),(0,H._)(t,[{key:"connect",value:function(){-1===document.cookie.indexOf("cookie-note=1")&&this.show()}},{key:"show",value:function(){this.element.classList.add("active")}},{key:"hide",value:function(){this.element.classList.remove("active")}},{key:"ok",value:function(){document.cookie="cookie-note=1;path=/;max-age=864000",this.hide()}}]),t}(eZ),G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),X=N("l9etm"),Q=N("16gB1"),G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),V=N("eh14X"),W=N("3w2eu"),X=N("l9etm"),Q=N("16gB1"),tp=function(e,t){return(tp=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function ty(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}tp(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var tE=function(){return(tE=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var tk="ADD_CHOICE",tb="REMOVE_CHOICE",tT="FILTER_CHOICES",tS="ACTIVATE_CHOICES",t_="CLEAR_CHOICES",tA="ADD_GROUP",tL="ADD_ITEM",tw="REMOVE_ITEM",tI="HIGHLIGHT_ITEM",tR="search",tD="removeItem",tC="highlightItem",tx=["fuseOptions","classNames"],tP="select-one",tO="select-multiple",tM=function(e){return{type:tk,choice:e}},tF=function(e){return{type:tL,item:e}},tN=function(e){return{type:tw,item:e}},tB=function(e,t){return{type:tI,item:e,highlighted:t}},tU=function(e){return Array.from({length:e},function(){return Math.floor(36*Math.random()+0).toString(36)}).join("")},tj=function(e,t){var n=e.id||e.name&&"".concat(e.name,"-").concat(tU(2))||tU(4);return n=n.replace(/(:|\.|\[|\]|,)/g,""),n="".concat(t,"-").concat(n)},tG=function(e,t,n){void 0===n&&(n=1);for(var i="".concat(n>0?"next":"previous","ElementSibling"),r=e[i];r;){if(r.matches(t))return r;r=r[i]}return null},tK=function(e,t,n){return void 0===n&&(n=1),n>0?t.scrollTop+t.offsetHeight>=e.offsetTop+e.offsetHeight:e.offsetTop>=t.scrollTop},tH=function(e){if("string"!=typeof e){if(null==e)return"";if((void 0===e?"undefined":(0,Q._)(e))==="object"){if("raw"in e)return tH(e.raw);if("trusted"in e)return e.trusted}return e}return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;")},tV=(d=document.createElement("div"),function(e){d.innerHTML=e.trim();for(var t=d.children[0];d.firstChild;)d.removeChild(d.firstChild);return t}),tq=function(e,t){return"function"==typeof e?e(tH(t),t):e},tY=function(e){return"function"==typeof e?e():e},tW=function(e){if("string"==typeof e)return e;if((void 0===e?"undefined":(0,Q._)(e))==="object"){if("trusted"in e)return e.trusted;if("raw"in e)return e.raw}return""},tz=function(e){if("string"==typeof e)return e;if((void 0===e?"undefined":(0,Q._)(e))==="object"){if("escaped"in e)return e.escaped;if("trusted"in e)return e.trusted}return""},tX=function(e,t){return e?tz(t):tH(t)},tQ=function(e,t,n){e.innerHTML=tX(t,n)},t$=function(e,t){return e.rank-t.rank},tZ=function(e,t,n){void 0===n&&(n=null);var i=new CustomEvent(t,{detail:n,bubbles:!0,cancelable:!0});return e.dispatchEvent(i)},tJ=function(e,t){var n=Object.keys(e).sort(),i=Object.keys(t).sort();return n.filter(function(e){return 0>i.indexOf(e)})},t0=function(e){return Array.isArray(e)?e:[e]},t1=function(e){return e&&Array.isArray(e)?e.map(function(e){return".".concat(e)}).join(""):".".concat(e)},t2=function(e,t){var n;(n=e.classList).add.apply(n,t0(t))},t3=function(e,t){var n;(n=e.classList).remove.apply(n,t0(t))},t5=function(e){if(void 0!==e)try{return JSON.parse(e)}catch(t){return e}return{}},t4=function(e,t,n){var i=e.itemEl;i&&(t3(i,n),t2(i,t))},t8=function(){function e(e){var t=e.element,n=e.type,i=e.classNames;this.element=t,this.classNames=i,this.type=n,this.isActive=!1}return e.prototype.show=function(){return t2(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","true"),this.isActive=!0,this},e.prototype.hide=function(){return t3(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","false"),this.isActive=!1,this},e}(),t6=function(){function e(e){var t=e.element,n=e.type,i=e.classNames,r=e.position;this.element=t,this.classNames=i,this.type=n,this.position=r,this.isOpen=!1,this.isFlipped=!1,this.isDisabled=!1,this.isLoading=!1}return e.prototype.shouldFlip=function(e,t){var n=!1;return"auto"===this.position?n=this.element.getBoundingClientRect().top-t>=0&&!window.matchMedia("(min-height: ".concat(e+1,"px)")).matches:"top"===this.position&&(n=!0),n},e.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},e.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},e.prototype.open=function(e,t){t2(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","true"),this.isOpen=!0,this.shouldFlip(e,t)&&(t2(this.element,this.classNames.flippedState),this.isFlipped=!0)},e.prototype.close=function(){t3(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","false"),this.removeActiveDescendant(),this.isOpen=!1,this.isFlipped&&(t3(this.element,this.classNames.flippedState),this.isFlipped=!1)},e.prototype.addFocusState=function(){t2(this.element,this.classNames.focusState)},e.prototype.removeFocusState=function(){t3(this.element,this.classNames.focusState)},e.prototype.enable=function(){t3(this.element,this.classNames.disabledState),this.element.removeAttribute("aria-disabled"),this.type===tP&&this.element.setAttribute("tabindex","0"),this.isDisabled=!1},e.prototype.disable=function(){t2(this.element,this.classNames.disabledState),this.element.setAttribute("aria-disabled","true"),this.type===tP&&this.element.setAttribute("tabindex","-1"),this.isDisabled=!0},e.prototype.wrap=function(e){var t=this.element,n=e.parentNode;n&&(e.nextSibling?n.insertBefore(t,e.nextSibling):n.appendChild(t)),t.appendChild(e)},e.prototype.unwrap=function(e){var t=this.element,n=t.parentNode;n&&(n.insertBefore(e,t),n.removeChild(t))},e.prototype.addLoadingState=function(){t2(this.element,this.classNames.loadingState),this.element.setAttribute("aria-busy","true"),this.isLoading=!0},e.prototype.removeLoadingState=function(){t3(this.element,this.classNames.loadingState),this.element.removeAttribute("aria-busy"),this.isLoading=!1},e}(),t9=function(){function e(e){var t=e.element,n=e.type,i=e.classNames,r=e.preventPaste;this.element=t,this.type=n,this.classNames=i,this.preventPaste=r,this.isFocussed=this.element.isEqualNode(document.activeElement),this.isDisabled=t.disabled,this._onPaste=this._onPaste.bind(this),this._onInput=this._onInput.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this)}return Object.defineProperty(e.prototype,"placeholder",{set:function(e){this.element.placeholder=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.value=e},enumerable:!1,configurable:!0}),e.prototype.addEventListeners=function(){var e=this.element;e.addEventListener("paste",this._onPaste),e.addEventListener("input",this._onInput,{passive:!0}),e.addEventListener("focus",this._onFocus,{passive:!0}),e.addEventListener("blur",this._onBlur,{passive:!0})},e.prototype.removeEventListeners=function(){var e=this.element;e.removeEventListener("input",this._onInput),e.removeEventListener("paste",this._onPaste),e.removeEventListener("focus",this._onFocus),e.removeEventListener("blur",this._onBlur)},e.prototype.enable=function(){this.element.removeAttribute("disabled"),this.isDisabled=!1},e.prototype.disable=function(){this.element.setAttribute("disabled",""),this.isDisabled=!0},e.prototype.focus=function(){this.isFocussed||this.element.focus()},e.prototype.blur=function(){this.isFocussed&&this.element.blur()},e.prototype.clear=function(e){return void 0===e&&(e=!0),this.element.value="",e&&this.setWidth(),this},e.prototype.setWidth=function(){var e=this.element;e.style.minWidth="".concat(e.placeholder.length+1,"ch"),e.style.width="".concat(e.value.length+1,"ch")},e.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},e.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},e.prototype._onInput=function(){this.type!==tP&&this.setWidth()},e.prototype._onPaste=function(e){this.preventPaste&&e.preventDefault()},e.prototype._onFocus=function(){this.isFocussed=!0},e.prototype._onBlur=function(){this.isFocussed=!1},e}(),t7=function(){function e(e){var t=e.element;this.element=t,this.scrollPos=this.element.scrollTop,this.height=this.element.offsetHeight}return e.prototype.prepend=function(e){var t=this.element.firstElementChild;t?this.element.insertBefore(e,t):this.element.append(e)},e.prototype.scrollToTop=function(){this.element.scrollTop=0},e.prototype.scrollToChildElement=function(e,t){var n=this;if(e){var i=this.element.offsetHeight,r=this.element.scrollTop+i,a=e.offsetHeight,s=e.offsetTop+a,o=t>0?this.element.scrollTop+s-r:e.offsetTop;requestAnimationFrame(function(){n._animateScroll(o,t)})}},e.prototype._scrollDown=function(e,t,n){var i=(n-e)/t;this.element.scrollTop=e+(i>1?i:1)},e.prototype._scrollUp=function(e,t,n){var i=(e-n)/t;this.element.scrollTop=e-(i>1?i:1)},e.prototype._animateScroll=function(e,t){var n=this,i=this.element.scrollTop,r=!1;t>0?(this._scrollDown(i,4,e),i<e&&(r=!0)):(this._scrollUp(i,4,e),i>e&&(r=!0)),r&&requestAnimationFrame(function(){n._animateScroll(e,t)})},e}(),ne=function(){function e(e){var t=e.element,n=e.classNames;this.element=t,this.classNames=n,this.isDisabled=!1}return Object.defineProperty(e.prototype,"isActive",{get:function(){return"active"===this.element.dataset.choice},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dir",{get:function(){return this.element.dir},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.setAttribute("value",e),this.element.value=e},enumerable:!1,configurable:!0}),e.prototype.conceal=function(){var e=this.element;t2(e,this.classNames.input),e.hidden=!0,e.tabIndex=-1;var t=e.getAttribute("style");t&&e.setAttribute("data-choice-orig-style",t),e.setAttribute("data-choice","active")},e.prototype.reveal=function(){var e=this.element;t3(e,this.classNames.input),e.hidden=!1,e.removeAttribute("tabindex");var t=e.getAttribute("data-choice-orig-style");t?(e.removeAttribute("data-choice-orig-style"),e.setAttribute("style",t)):e.removeAttribute("style"),e.removeAttribute("data-choice")},e.prototype.enable=function(){this.element.removeAttribute("disabled"),this.element.disabled=!1,this.isDisabled=!1},e.prototype.disable=function(){this.element.setAttribute("disabled",""),this.element.disabled=!0,this.isDisabled=!0},e.prototype.triggerEvent=function(e,t){tZ(this.element,e,t||{})},e}(),nt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ty(t,e),t}(ne),nn=function(e,t){return void 0===t&&(t=!0),void 0===e?t:!!e},ni=function(e){if("string"==typeof e&&(e=e.split(" ").filter(function(e){return e.length})),Array.isArray(e)&&e.length)return e},nr=function(e,t,n){if(void 0===n&&(n=!0),"string"==typeof e){var i=tH(e),r=n||i===e?e:{escaped:i,raw:e};return nr({value:e,label:r,selected:!0},!1)}if("choices"in e){if(!t)throw TypeError("optGroup is not allowed");var a=e.choices.map(function(e){return nr(e,!1)});return{id:0,label:tW(e.label)||e.value,active:!!a.length,disabled:!!e.disabled,choices:a}}return{id:0,group:null,score:0,rank:0,value:e.value,label:e.label||e.value,active:nn(e.active),selected:nn(e.selected,!1),disabled:nn(e.disabled,!1),placeholder:nn(e.placeholder,!1),highlighted:!1,labelClass:ni(e.labelClass),labelDescription:e.labelDescription,customProperties:e.customProperties}},na=function(e){return"SELECT"===e.tagName},ns=function(e){function t(t){var n=t.element,i=t.classNames,r=t.template,a=t.extractPlaceholder,s=e.call(this,{element:n,classNames:i})||this;return s.template=r,s.extractPlaceholder=a,s}return ty(t,e),Object.defineProperty(t.prototype,"placeholderOption",{get:function(){return this.element.querySelector('option[value=""]')||this.element.querySelector("option[placeholder]")},enumerable:!1,configurable:!0}),t.prototype.addOptions=function(e){var t=this,n=document.createDocumentFragment();e.forEach(function(e){if(!e.element){var i=t.template(e);n.appendChild(i),e.element=i}}),this.element.appendChild(n)},t.prototype.optionsAsChoices=function(){var e=this,t=[];return this.element.querySelectorAll(":scope > option, :scope > optgroup").forEach(function(n){"OPTION"===n.tagName?t.push(e._optionToChoice(n)):"OPTGROUP"===n.tagName&&t.push(e._optgroupToChoice(n))}),t},t.prototype._optionToChoice=function(e){return!e.hasAttribute("value")&&e.hasAttribute("placeholder")&&(e.setAttribute("value",""),e.value=""),{id:0,group:null,score:0,rank:0,value:e.value,label:e.label,element:e,active:!0,selected:this.extractPlaceholder?e.selected:e.hasAttribute("selected"),disabled:e.disabled,highlighted:!1,placeholder:this.extractPlaceholder&&(!e.value||e.hasAttribute("placeholder")),labelClass:void 0!==e.dataset.labelClass?ni(e.dataset.labelClass):void 0,labelDescription:void 0!==e.dataset.labelDescription?e.dataset.labelDescription:void 0,customProperties:t5(e.dataset.customProperties)}},t.prototype._optgroupToChoice=function(e){var t=this,n=Array.from(e.querySelectorAll("option")).map(function(e){return t._optionToChoice(e)});return{id:0,label:e.label||"",element:e,active:!!n.length,disabled:e.disabled,choices:n}},t}(ne),no={items:[],choices:[],silent:!1,renderChoiceLimit:-1,maxItemCount:-1,closeDropdownOnSelect:"auto",singleModeForMultiSelect:!1,addChoices:!1,addItems:!0,addItemFilter:function(e){return!!e&&""!==e},removeItems:!0,removeItemButton:!1,removeItemButtonAlignLeft:!1,editItems:!1,allowHTML:!1,allowHtmlUserInput:!1,duplicateItemsAllowed:!0,delimiter:",",paste:!0,searchEnabled:!0,searchChoices:!0,searchFloor:1,searchResultLimit:4,searchFields:["label","value"],position:"auto",resetScrollPosition:!0,shouldSort:!0,shouldSortItems:!1,sorter:function(e,t){var n=e.value,i=e.label,r=t.value,a=t.label;return tW(void 0===i?n:i).localeCompare(tW(void 0===a?r:a),[],{sensitivity:"base",ignorePunctuation:!0,numeric:!0})},shadowRoot:null,placeholder:!0,placeholderValue:null,searchPlaceholderValue:null,prependValue:null,appendValue:null,renderSelectedChoices:"auto",loadingText:"Loading...",noResultsText:"No results found",noChoicesText:"No choices to choose from",itemSelectText:"Press to select",uniqueItemText:"Only unique values can be added",customAddItemText:"Only values matching specific conditions can be added",addItemText:function(e){return'Press Enter to add <b>"'.concat(e,'"</b>')},removeItemIconText:function(){return"Remove item"},removeItemLabelText:function(e){return"Remove item: ".concat(e)},maxItemText:function(e){return"Only ".concat(e," values can be added")},valueComparer:function(e,t){return e===t},fuseOptions:{includeScore:!0},labelId:"",callbackOnInit:null,callbackOnCreateTemplates:null,classNames:{containerOuter:["choices"],containerInner:["choices__inner"],input:["choices__input"],inputCloned:["choices__input--cloned"],list:["choices__list"],listItems:["choices__list--multiple"],listSingle:["choices__list--single"],listDropdown:["choices__list--dropdown"],item:["choices__item"],itemSelectable:["choices__item--selectable"],itemDisabled:["choices__item--disabled"],itemChoice:["choices__item--choice"],description:["choices__description"],placeholder:["choices__placeholder"],group:["choices__group"],groupHeading:["choices__heading"],button:["choices__button"],activeState:["is-active"],focusState:["is-focused"],openState:["is-open"],disabledState:["is-disabled"],highlightedState:["is-highlighted"],selectedState:["is-selected"],flippedState:["is-flipped"],loadingState:["is-loading"],notice:["choices__notice"],addChoice:["choices__item--selectable","add-choice"],noResults:["has-no-results"],noChoices:["has-no-choices"]},appendGroupInSearch:!1},nl=function(e){var t=e.itemEl;t&&(t.remove(),e.itemEl=void 0)},nu={groups:function(e,t){var n=e,i=!0;switch(t.type){case tA:n.push(t.group);break;case t_:n=[];break;default:i=!1}return{state:n,update:i}},items:function(e,t,n){var i=e,r=!0;switch(t.type){case tL:t.item.selected=!0;var a=t.item.element;a&&(a.selected=!0,a.setAttribute("selected","")),i.push(t.item);break;case tw:t.item.selected=!1;var a=t.item.element;if(a){a.selected=!1,a.removeAttribute("selected");var s=a.parentElement;s&&na(s)&&s.type===tP&&(s.value="")}nl(t.item),i=i.filter(function(e){return e.id!==t.item.id});break;case tb:nl(t.choice),i=i.filter(function(e){return e.id!==t.choice.id});break;case tI:var o=t.highlighted,l=i.find(function(e){return e.id===t.item.id});l&&l.highlighted!==o&&(l.highlighted=o,n&&t4(l,o?n.classNames.highlightedState:n.classNames.selectedState,o?n.classNames.selectedState:n.classNames.highlightedState));break;default:r=!1}return{state:i,update:r}},choices:function(e,t,n){var i=e,r=!0;switch(t.type){case tk:i.push(t.choice);break;case tb:t.choice.choiceEl=void 0,t.choice.group&&(t.choice.group.choices=t.choice.group.choices.filter(function(e){return e.id!==t.choice.id})),i=i.filter(function(e){return e.id!==t.choice.id});break;case tL:case tw:t.item.choiceEl=void 0;break;case tT:var a=[];t.results.forEach(function(e){a[e.item.id]=e}),i.forEach(function(e){var t=a[e.id];void 0!==t?(e.score=t.score,e.rank=t.rank,e.active=!0):(e.score=0,e.rank=0,e.active=!1),n&&n.appendGroupInSearch&&(e.choiceEl=void 0)});break;case tS:i.forEach(function(e){e.active=t.active,n&&n.appendGroupInSearch&&(e.choiceEl=void 0)});break;case t_:i=[];break;default:r=!1}return{state:i,update:r}}},nc=function(){function e(e){this._state=this.defaultState,this._listeners=[],this._txn=0,this._context=e}return Object.defineProperty(e.prototype,"defaultState",{get:function(){return{groups:[],items:[],choices:[]}},enumerable:!1,configurable:!0}),e.prototype.changeSet=function(e){return{groups:e,items:e,choices:e}},e.prototype.reset=function(){this._state=this.defaultState;var e=this.changeSet(!0);this._txn?this._changeSet=e:this._listeners.forEach(function(t){return t(e)})},e.prototype.subscribe=function(e){return this._listeners.push(e),this},e.prototype.dispatch=function(e){var t=this,n=this._state,i=!1,r=this._changeSet||this.changeSet(!1);Object.keys(nu).forEach(function(a){var s=nu[a](n[a],e,t._context);s.update&&(i=!0,r[a]=!0,n[a]=s.state)}),i&&(this._txn?this._changeSet=r:this._listeners.forEach(function(e){return e(r)}))},e.prototype.withTxn=function(e){this._txn++;try{e()}finally{if(this._txn=Math.max(0,this._txn-1),!this._txn){var t=this._changeSet;t&&(this._changeSet=void 0,this._listeners.forEach(function(e){return e(t)}))}}},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this.state.items},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightedActiveItems",{get:function(){return this.items.filter(function(e){return e.active&&e.highlighted})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"choices",{get:function(){return this.state.choices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeChoices",{get:function(){return this.choices.filter(function(e){return e.active})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"searchableChoices",{get:function(){return this.choices.filter(function(e){return!e.disabled&&!e.placeholder})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groups",{get:function(){return this.state.groups},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeGroups",{get:function(){var e=this;return this.state.groups.filter(function(t){var n=t.active&&!t.disabled,i=e.state.choices.some(function(e){return e.active&&!e.disabled});return n&&i},[])},enumerable:!1,configurable:!0}),e.prototype.inTxn=function(){return this._txn>0},e.prototype.getChoiceById=function(e){return this.activeChoices.find(function(t){return t.id===e})},e.prototype.getGroupById=function(e){return this.groups.find(function(t){return t.id===e})},e}(),nh="no-choices",nd="no-results",nf="add-choice";function nv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function ng(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nv(Object(n),!0).forEach(function(t){var i,r;i=t,r=n[t],(i=function(e){var t=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,Q._)(t))?t:t+""}(i))in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nv(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function nm(e){return Array.isArray?Array.isArray(e):"[object Array]"===nS(e)}var np=1/0;function ny(e){return"string"==typeof e}function nE(e){return"number"==typeof e}function nk(e){return(void 0===e?"undefined":(0,Q._)(e))==="object"}function nb(e){return null!=e}function nT(e){return!e.trim().length}function nS(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}var n_=Object.prototype.hasOwnProperty,nA=function(){"use strict";function e(t){var n=this;(0,K._)(this,e),this._keys=[],this._keyMap={};var i=0;t.forEach(function(e){var t=nL(e);n._keys.push(t),n._keyMap[t.id]=t,i+=t.weight}),this._keys.forEach(function(e){e.weight/=i})}return(0,H._)(e,[{key:"get",value:function(e){return this._keyMap[e]}},{key:"keys",value:function(){return this._keys}},{key:"toJSON",value:function(){return JSON.stringify(this._keys)}}]),e}();function nL(e){var t=null,n=null,i=null,r=1,a=null;if(ny(e)||nm(e))i=e,t=nw(e),n=nI(e);else{if(!n_.call(e,"name"))throw Error("Missing ".concat("name"," property in key"));var s=e.name;if(i=s,n_.call(e,"weight")&&(r=e.weight)<=0)throw Error("Property 'weight' in key '".concat(s,"' must be a positive integer"));t=nw(s),n=nI(s),a=e.getFn}return{path:t,id:n,weight:r,src:i,getFn:a}}function nw(e){return nm(e)?e:e.split(".")}function nI(e){return nm(e)?e.join("."):e}var nR=ng(ng(ng(ng({},{isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:function(e,t){return e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1}}),{includeMatches:!1,findAllMatches:!1,minMatchCharLength:1}),{location:0,threshold:.6,distance:100}),{useExtendedSearch:!1,getFn:function(e,t){var n=[],i=!1,r=function(e,t,a){if(nb(e))if(t[a]){var s,o,l=e[t[a]];if(!nb(l))return;if(a===t.length-1&&(ny(l)||nE(l)||!0===(o=l)||!1===o||nk(s=o)&&null!==s&&"[object Boolean]"==nS(o)))n.push(null==l?"":function(e){if("string"==typeof e)return e;var t=e+"";return"0"==t&&1/e==-np?"-0":t}(l));else if(nm(l)){i=!0;for(var u=0,c=l.length;u<c;u+=1)r(l[u],t,a+1)}else t.length&&r(l,t,a+1)}else n.push(e)};return r(e,ny(t)?t.split("."):t,0),i?n:n[0]},ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1}),nD=/[^ ]+/g,nC=function(){"use strict";function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.getFn,i=void 0===n?nR.getFn:n,r=t.fieldNormWeight,a=void 0===r?nR.fieldNormWeight:r;(0,K._)(this,e),this.norm=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=new Map,i=Math.pow(10,t);return{get:function(t){var r=t.match(nD).length;if(n.has(r))return n.get(r);var a=parseFloat(Math.round(1/Math.pow(r,.5*e)*i)/i);return n.set(r,a),a},clear:function(){n.clear()}}}(a,3),this.getFn=i,this.isCreated=!1,this.setIndexRecords()}return(0,H._)(e,[{key:"setSources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.docs=e}},{key:"setIndexRecords",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.records=e}},{key:"setKeys",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.keys=t,this._keysMap={},t.forEach(function(t,n){e._keysMap[t.id]=n})}},{key:"create",value:function(){var e=this;!this.isCreated&&this.docs.length&&(this.isCreated=!0,ny(this.docs[0])?this.docs.forEach(function(t,n){e._addString(t,n)}):this.docs.forEach(function(t,n){e._addObject(t,n)}),this.norm.clear())}},{key:"add",value:function(e){var t=this.size();ny(e)?this._addString(e,t):this._addObject(e,t)}},{key:"removeAt",value:function(e){this.records.splice(e,1);for(var t=e,n=this.size();t<n;t+=1)this.records[t].i-=1}},{key:"getValueForItemAtKeyId",value:function(e,t){return e[this._keysMap[t]]}},{key:"size",value:function(){return this.records.length}},{key:"_addString",value:function(e,t){if(!(!nb(e)||nT(e))){var n={v:e,i:t,n:this.norm.get(e)};this.records.push(n)}}},{key:"_addObject",value:function(e,t){var n=this,i={i:t,$:{}};this.keys.forEach(function(t,r){var a=t.getFn?t.getFn(e):n.getFn(e,t.path);if(nb(a)){if(nm(a)){for(var s=[],o=[{nestedArrIndex:-1,value:a}];o.length;){var l=o.pop(),u=l.nestedArrIndex,c=l.value;if(nb(c))if(ny(c)&&!nT(c)){var h={v:c,i:u,n:n.norm.get(c)};s.push(h)}else nm(c)&&c.forEach(function(e,t){o.push({nestedArrIndex:t,value:e})})}i.$[r]=s}else if(ny(a)&&!nT(a)){var d={v:a,n:n.norm.get(a)};i.$[r]=d}}}),this.records.push(i)}},{key:"toJSON",value:function(){return{keys:this.keys,records:this.records}}}]),e}();function nx(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.getFn,r=void 0===i?nR.getFn:i,a=n.fieldNormWeight,s=new nC({getFn:r,fieldNormWeight:void 0===a?nR.fieldNormWeight:a});return s.setKeys(e.map(nL)),s.setSources(t),s.create(),s}function nP(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.errors,i=t.currentLocation,r=t.expectedLocation,a=t.distance,s=void 0===a?nR.distance:a,o=t.ignoreLocation,l=void 0===o?nR.ignoreLocation:o,u=(void 0===n?0:n)/e.length;if(l)return u;var c=Math.abs((void 0===r?0:r)-(void 0===i?0:i));return s?u+c/s:c?1:u}var nO=function(){"use strict";function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.location,a=void 0===r?nR.location:r,s=i.threshold,o=void 0===s?nR.threshold:s,l=i.distance,u=void 0===l?nR.distance:l,c=i.includeMatches,h=void 0===c?nR.includeMatches:c,d=i.findAllMatches,f=void 0===d?nR.findAllMatches:d,v=i.minMatchCharLength,g=void 0===v?nR.minMatchCharLength:v,m=i.isCaseSensitive,p=void 0===m?nR.isCaseSensitive:m,y=i.ignoreLocation,E=void 0===y?nR.ignoreLocation:y;if((0,K._)(this,e),this.options={location:a,threshold:o,distance:u,includeMatches:h,findAllMatches:f,minMatchCharLength:g,isCaseSensitive:p,ignoreLocation:E},this.pattern=p?t:t.toLowerCase(),this.chunks=[],this.pattern.length){var k=function(e,t){n.chunks.push({pattern:e,alphabet:function(e){for(var t={},n=0,i=e.length;n<i;n+=1){var r=e.charAt(n);t[r]=(t[r]||0)|1<<i-n-1}return t}(e),startIndex:t})},b=this.pattern.length;if(b>32){for(var T=0,S=b%32,_=b-S;T<_;)k(this.pattern.substr(T,32),T),T+=32;if(S){var A=b-32;k(this.pattern.substr(A),A)}}else k(this.pattern,0)}}return(0,H._)(e,[{key:"searchIn",value:function(e){var t=this.options,n=t.isCaseSensitive,i=t.includeMatches;if(n||(e=e.toLowerCase()),this.pattern===e){var r={isMatch:!0,score:0};return i&&(r.indices=[[0,e.length-1]]),r}var a=this.options,s=a.location,o=a.distance,l=a.threshold,u=a.findAllMatches,c=a.minMatchCharLength,h=a.ignoreLocation,d=[],f=0,v=!1;this.chunks.forEach(function(t){var n=t.pattern,r=t.alphabet,a=t.startIndex,g=function(e,t,n){var i,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=r.location,s=void 0===a?nR.location:a,o=r.distance,l=void 0===o?nR.distance:o,u=r.threshold,c=void 0===u?nR.threshold:u,h=r.findAllMatches,d=void 0===h?nR.findAllMatches:h,f=r.minMatchCharLength,v=void 0===f?nR.minMatchCharLength:f,g=r.includeMatches,m=void 0===g?nR.includeMatches:g,p=r.ignoreLocation,y=void 0===p?nR.ignoreLocation:p;if(t.length>32)throw Error("Pattern length exceeds max of ".concat(32,"."));for(var E=t.length,k=e.length,b=Math.max(0,Math.min(s,k)),T=c,S=b,_=v>1||m,A=_?Array(k):[];(i=e.indexOf(t,S))>-1;)if(T=Math.min(nP(t,{currentLocation:i,expectedLocation:b,distance:l,ignoreLocation:y}),T),S=i+E,_)for(var L=0;L<E;)A[i+L]=1,L+=1;S=-1;for(var w=[],I=1,R=E+k,D=1<<E-1,C=0;C<E;C+=1){for(var x=0,P=R;x<P;)nP(t,{errors:C,currentLocation:b+P,expectedLocation:b,distance:l,ignoreLocation:y})<=T?x=P:R=P,P=Math.floor((R-x)/2+x);R=P;var O=Math.max(1,b-P+1),M=d?k:Math.min(b+P,k)+E,F=Array(M+2);F[M+1]=(1<<C)-1;for(var N=M;N>=O;N-=1){var B=N-1,U=n[e.charAt(B)];if(_&&(A[B]=+!!U),F[N]=(F[N+1]<<1|1)&U,C&&(F[N]|=(w[N+1]|w[N])<<1|1|w[N+1]),F[N]&D&&(I=nP(t,{errors:C,currentLocation:B,expectedLocation:b,distance:l,ignoreLocation:y}))<=T){if(T=I,(S=B)<=b)break;O=Math.max(1,2*b-S)}}if(nP(t,{errors:C+1,currentLocation:b,expectedLocation:b,distance:l,ignoreLocation:y})>T)break;w=F}var j={isMatch:S>=0,score:Math.max(.001,I)};if(_){var G=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nR.minMatchCharLength,n=[],i=-1,r=-1,a=0,s=e.length;a<s;a+=1){var o=e[a];o&&-1===i?i=a:o||-1===i||((r=a-1)-i+1>=t&&n.push([i,r]),i=-1)}return e[a-1]&&a-i>=t&&n.push([i,a-1]),n}(A,v);G.length?m&&(j.indices=G):j.isMatch=!1}return j}(e,n,r,{location:s+a,distance:o,threshold:l,findAllMatches:u,minMatchCharLength:c,includeMatches:i,ignoreLocation:h}),m=g.isMatch,p=g.score,y=g.indices;m&&(v=!0),f+=p,m&&y&&(d=(0,X._)(d).concat((0,X._)(y)))});var g={isMatch:v,score:v?f/this.chunks.length:1};return v&&i&&(g.indices=d),g}}]),e}(),nM=function(){"use strict";function e(t){(0,K._)(this,e),this.pattern=t}return(0,H._)(e,[{key:"search",value:function(){}}],[{key:"isMultiMatch",value:function(e){return nF(e,this.multiRegex)}},{key:"isSingleMatch",value:function(e){return nF(e,this.singleRegex)}}]),e}();function nF(e,t){var n=e.match(t);return n?n[1]:null}var nN=function(e){"use strict";function t(e){return(0,K._)(this,t),(0,G._)(this,t,[e])}return(0,W._)(t,e),(0,H._)(t,[{key:"search",value:function(e){var t=e===this.pattern;return{isMatch:t,score:+!t,indices:[0,this.pattern.length-1]}}}],[{key:"type",get:function(){return"exact"}},{key:"multiRegex",get:function(){return/^="(.*)"$/}},{key:"singleRegex",get:function(){return/^=(.*)$/}}]),t}(nM),nB=function(e){"use strict";function t(e){return(0,K._)(this,t),(0,G._)(this,t,[e])}return(0,W._)(t,e),(0,H._)(t,[{key:"search",value:function(e){var t=-1===e.indexOf(this.pattern);return{isMatch:t,score:+!t,indices:[0,e.length-1]}}}],[{key:"type",get:function(){return"inverse-exact"}},{key:"multiRegex",get:function(){return/^!"(.*)"$/}},{key:"singleRegex",get:function(){return/^!(.*)$/}}]),t}(nM),nU=function(e){"use strict";function t(e){return(0,K._)(this,t),(0,G._)(this,t,[e])}return(0,W._)(t,e),(0,H._)(t,[{key:"search",value:function(e){var t=e.startsWith(this.pattern);return{isMatch:t,score:+!t,indices:[0,this.pattern.length-1]}}}],[{key:"type",get:function(){return"prefix-exact"}},{key:"multiRegex",get:function(){return/^\^"(.*)"$/}},{key:"singleRegex",get:function(){return/^\^(.*)$/}}]),t}(nM),nj=function(e){"use strict";function t(e){return(0,K._)(this,t),(0,G._)(this,t,[e])}return(0,W._)(t,e),(0,H._)(t,[{key:"search",value:function(e){var t=!e.startsWith(this.pattern);return{isMatch:t,score:+!t,indices:[0,e.length-1]}}}],[{key:"type",get:function(){return"inverse-prefix-exact"}},{key:"multiRegex",get:function(){return/^!\^"(.*)"$/}},{key:"singleRegex",get:function(){return/^!\^(.*)$/}}]),t}(nM),nG=function(e){"use strict";function t(e){return(0,K._)(this,t),(0,G._)(this,t,[e])}return(0,W._)(t,e),(0,H._)(t,[{key:"search",value:function(e){var t=e.endsWith(this.pattern);return{isMatch:t,score:+!t,indices:[e.length-this.pattern.length,e.length-1]}}}],[{key:"type",get:function(){return"suffix-exact"}},{key:"multiRegex",get:function(){return/^"(.*)"\$$/}},{key:"singleRegex",get:function(){return/^(.*)\$$/}}]),t}(nM),nK=function(e){"use strict";function t(e){return(0,K._)(this,t),(0,G._)(this,t,[e])}return(0,W._)(t,e),(0,H._)(t,[{key:"search",value:function(e){var t=!e.endsWith(this.pattern);return{isMatch:t,score:+!t,indices:[0,e.length-1]}}}],[{key:"type",get:function(){return"inverse-suffix-exact"}},{key:"multiRegex",get:function(){return/^!"(.*)"\$$/}},{key:"singleRegex",get:function(){return/^!(.*)\$$/}}]),t}(nM),nH=function(e){"use strict";function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.location,a=void 0===r?nR.location:r,s=i.threshold,o=void 0===s?nR.threshold:s,l=i.distance,u=void 0===l?nR.distance:l,c=i.includeMatches,h=void 0===c?nR.includeMatches:c,d=i.findAllMatches,f=void 0===d?nR.findAllMatches:d,v=i.minMatchCharLength,g=void 0===v?nR.minMatchCharLength:v,m=i.isCaseSensitive,p=void 0===m?nR.isCaseSensitive:m,y=i.ignoreLocation,E=void 0===y?nR.ignoreLocation:y;return(0,K._)(this,t),(n=(0,G._)(this,t,[e]))._bitapSearch=new nO(e,{location:a,threshold:o,distance:u,includeMatches:h,findAllMatches:f,minMatchCharLength:g,isCaseSensitive:p,ignoreLocation:E}),n}return(0,W._)(t,e),(0,H._)(t,[{key:"search",value:function(e){return this._bitapSearch.searchIn(e)}}],[{key:"type",get:function(){return"fuzzy"}},{key:"multiRegex",get:function(){return/^"(.*)"$/}},{key:"singleRegex",get:function(){return/^(.*)$/}}]),t}(nM),nV=function(e){"use strict";function t(e){return(0,K._)(this,t),(0,G._)(this,t,[e])}return(0,W._)(t,e),(0,H._)(t,[{key:"search",value:function(e){for(var t,n=0,i=[],r=this.pattern.length;(t=e.indexOf(this.pattern,n))>-1;)n=t+r,i.push([t,n-1]);var a=!!i.length;return{isMatch:a,score:+!a,indices:i}}}],[{key:"type",get:function(){return"include"}},{key:"multiRegex",get:function(){return/^'"(.*)"$/}},{key:"singleRegex",get:function(){return/^'(.*)$/}}]),t}(nM),nq=[nN,nV,nU,nj,nK,nG,nB,nH],nY=nq.length,nW=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,nz=new Set([nH.type,nV.type]),nX=function(){"use strict";function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.isCaseSensitive,r=void 0===i?nR.isCaseSensitive:i,a=n.includeMatches,s=void 0===a?nR.includeMatches:a,o=n.minMatchCharLength,l=void 0===o?nR.minMatchCharLength:o,u=n.ignoreLocation,c=void 0===u?nR.ignoreLocation:u,h=n.findAllMatches,d=void 0===h?nR.findAllMatches:h,f=n.location,v=void 0===f?nR.location:f,g=n.threshold,m=void 0===g?nR.threshold:g,p=n.distance,y=void 0===p?nR.distance:p;(0,K._)(this,e),this.query=null,this.options={isCaseSensitive:r,includeMatches:s,minMatchCharLength:l,findAllMatches:d,ignoreLocation:c,location:v,threshold:m,distance:y},this.pattern=r?t:t.toLowerCase(),this.query=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.split("|").map(function(e){for(var n=e.trim().split(nW).filter(function(e){return e&&!!e.trim()}),i=[],r=0,a=n.length;r<a;r+=1){for(var s=n[r],o=!1,l=-1;!o&&++l<nY;){var u=nq[l],c=u.isMultiMatch(s);c&&(i.push(new u(c,t)),o=!0)}if(!o)for(l=-1;++l<nY;){var h=nq[l],d=h.isSingleMatch(s);if(d){i.push(new h(d,t));break}}}return i})}(this.pattern,this.options)}return(0,H._)(e,[{key:"searchIn",value:function(e){var t=this.query;if(!t)return{isMatch:!1,score:1};var n=this.options,i=n.includeMatches;e=n.isCaseSensitive?e:e.toLowerCase();for(var r=0,a=[],s=0,o=0,l=t.length;o<l;o+=1){var u=t[o];a.length=0,r=0;for(var c=0,h=u.length;c<h;c+=1){var d=u[c],f=d.search(e),v=f.isMatch,g=f.indices,m=f.score;if(v){if(r+=1,s+=m,i){var p=d.constructor.type;nz.has(p)?a=(0,X._)(a).concat((0,X._)(g)):a.push(g)}}else{s=0,r=0,a.length=0;break}}if(r){var y={isMatch:!0,score:s/r};return i&&(y.indices=a),y}}return{isMatch:!1,score:1}}}],[{key:"condition",value:function(e,t){return t.useExtendedSearch}}]),e}(),nQ=[];function n$(e,t){for(var n=0,i=nQ.length;n<i;n+=1){var r=nQ[n];if(r.condition(e,t))return new r(e,t)}return new nO(e,t)}var nZ="$and",nJ="$path",n0=function(e){return!!(e[nZ]||e.$or)},n1=function(e){return(0,V._)({},nZ,Object.keys(e).map(function(t){return(0,V._)({},t,e[t])}))};function n2(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.auto,r=void 0===i||i,a=function(e){var n=Object.keys(e),i=!!e[nJ];if(!i&&n.length>1&&!n0(e))return a(n1(e));if(!nm(e)&&nk(e)&&!n0(e)){var s=i?e[nJ]:n[0],o=i?e.$val:e[s];if(!ny(o))throw Error("Invalid value for key ".concat(s));var l={keyId:nI(s),pattern:o};return r&&(l.searcher=n$(o,t)),l}var u={children:[],operator:n[0]};return n.forEach(function(t){var n=e[t];nm(n)&&n.forEach(function(e){u.children.push(a(e))})}),u};return n0(e)||(e=n1(e)),a(e)}function n3(e,t){var n=e.matches;t.matches=[],nb(n)&&n.forEach(function(e){if(nb(e.indices)&&e.indices.length){var n={indices:e.indices,value:e.value};e.key&&(n.key=e.key.src),e.idx>-1&&(n.refIndex=e.idx),t.matches.push(n)}})}function n5(e,t){t.score=e.score}var n4=function(){"use strict";function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;(0,K._)(this,e),this.options=ng(ng({},nR),n),this.options.useExtendedSearch,this._keyStore=new nA(this.options.keys),this.setCollection(t,i)}return(0,H._)(e,[{key:"setCollection",value:function(e,t){if(this._docs=e,t&&!(t instanceof nC))throw Error("Incorrect 'index' type");this._myIndex=t||nx(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}},{key:"add",value:function(e){nb(e)&&(this._docs.push(e),this._myIndex.add(e))}},{key:"remove",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return!1},t=[],n=0,i=this._docs.length;n<i;n+=1){var r=this._docs[n];e(r,n)&&(this.removeAt(n),n-=1,i-=1,t.push(r))}return t}},{key:"removeAt",value:function(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}},{key:"getIndex",value:function(){return this._myIndex}},{key:"search",value:function(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.limit,a=void 0===r?-1:r,s=this.options,o=s.includeMatches,l=s.includeScore,u=s.shouldSort,c=s.sortFn,h=s.ignoreFieldNorm,d=ny(e)?ny(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return t=d,n=void 0===h?nR.ignoreFieldNorm:h,t.forEach(function(e){var t=1;e.matches.forEach(function(e){var i=e.key,r=e.norm,a=e.score,s=i?i.weight:null;t*=Math.pow(0===a&&s?Number.EPSILON:a,(s||1)*(n?1:r))}),e.score=t}),u&&d.sort(c),nE(a)&&a>-1&&(d=d.slice(0,a)),function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.includeMatches,r=void 0===i?nR.includeMatches:i,a=n.includeScore,s=void 0===a?nR.includeScore:a,o=[];return r&&o.push(n3),s&&o.push(n5),e.map(function(e){var n=e.idx,i={item:t[n],refIndex:n};return o.length&&o.forEach(function(t){t(e,i)}),i})}(d,this._docs,{includeMatches:o,includeScore:l})}},{key:"_searchStringList",value:function(e){var t=n$(e,this.options),n=this._myIndex.records,i=[];return n.forEach(function(e){var n=e.v,r=e.i,a=e.n;if(nb(n)){var s=t.searchIn(n),o=s.isMatch,l=s.score,u=s.indices;o&&i.push({item:n,idx:r,matches:[{score:l,value:n,norm:a,indices:u}]})}}),i}},{key:"_searchLogical",value:function(e){var t=this,n=n2(e,this.options),i=function(e,n,r){if(!e.children){var a=e.keyId,s=e.searcher,o=t._findMatches({key:t._keyStore.get(a),value:t._myIndex.getValueForItemAtKeyId(n,a),searcher:s});return o&&o.length?[{idx:r,item:n,matches:o}]:[]}for(var l=[],u=0,c=e.children.length;u<c;u+=1){var h=i(e.children[u],n,r);if(h.length)l.push.apply(l,(0,X._)(h));else if(e.operator===nZ)return[]}return l},r=this._myIndex.records,a={},s=[];return r.forEach(function(e){var t=e.$,r=e.i;if(nb(t)){var o=i(n,t,r);o.length&&(a[r]||(a[r]={idx:r,item:t,matches:[]},s.push(a[r])),o.forEach(function(e){var t,n=e.matches;(t=a[r].matches).push.apply(t,(0,X._)(n))}))}}),s}},{key:"_searchObjectList",value:function(e){var t=this,n=n$(e,this.options),i=this._myIndex,r=i.keys,a=i.records,s=[];return a.forEach(function(e){var i=e.$,a=e.i;if(nb(i)){var o=[];r.forEach(function(e,r){o.push.apply(o,(0,X._)(t._findMatches({key:e,value:i[r],searcher:n})))}),o.length&&s.push({idx:a,item:i,matches:o})}}),s}},{key:"_findMatches",value:function(e){var t=e.key,n=e.value,i=e.searcher;if(!nb(n))return[];var r=[];if(nm(n))n.forEach(function(e){var n=e.v,a=e.i,s=e.n;if(nb(n)){var o=i.searchIn(n),l=o.isMatch,u=o.score,c=o.indices;l&&r.push({score:u,key:t,value:n,idx:a,norm:s,indices:c})}});else{var a=n.v,s=n.n,o=i.searchIn(a),l=o.isMatch,u=o.score,c=o.indices;l&&r.push({score:u,key:t,value:a,norm:s,indices:c})}return r}}]),e}();n4.version="7.0.0",n4.createIndex=nx,n4.parseIndex=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.getFn,i=void 0===n?nR.getFn:n,r=t.fieldNormWeight,a=void 0===r?nR.fieldNormWeight:r,s=e.keys,o=e.records,l=new nC({getFn:i,fieldNormWeight:a});return l.setKeys(s),l.setIndexRecords(o),l},n4.config=nR,n4.parseQuery=n2,function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];nQ.push.apply(nQ,(0,X._)(t))}(nX);var n8=function(){function e(e){this._haystack=[],this._fuseOptions=tE(tE({},e.fuseOptions),{keys:function(e,t,n){if(n||2==arguments.length)for(var i,r=0,a=t.length;r<a;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}([],e.searchFields,!0),includeMatches:!0})}return e.prototype.index=function(e){this._haystack=e,this._fuse&&this._fuse.setCollection(e)},e.prototype.reset=function(){this._haystack=[],this._fuse=void 0},e.prototype.isEmptyIndex=function(){return!this._haystack.length},e.prototype.search=function(e){return this._fuse||(this._fuse=new n4(this._haystack,this._fuseOptions)),this._fuse.search(e).map(function(e,t){return{item:e.item,score:e.score||0,rank:t+1}})},e}(),n6=function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0},n9=function(e,t,n){var i=e.dataset,r=t.customProperties,a=t.labelClass,s=t.labelDescription;a&&(i.labelClass=t0(a).join(" ")),s&&(i.labelDescription=s),n&&r&&("string"==typeof r?i.customProperties=r:(void 0===r?"undefined":(0,Q._)(r))!=="object"||n6(r)||(i.customProperties=JSON.stringify(r)))},n7=function(e,t,n){var i=t&&e.querySelector("label[for='".concat(t,"']")),r=i&&i.innerText;r&&n.setAttribute("aria-label",r)},ie={containerOuter:function(e,t,n,i,r,a,s){var o=e.classNames.containerOuter,l=document.createElement("div");return t2(l,o),l.dataset.type=a,t&&(l.dir=t),i&&(l.tabIndex=0),n&&(l.setAttribute("role",r?"combobox":"listbox"),r?l.setAttribute("aria-autocomplete","list"):s||n7(this._docRoot,this.passedElement.element.id,l),l.setAttribute("aria-haspopup","true"),l.setAttribute("aria-expanded","false")),s&&l.setAttribute("aria-labelledby",s),l},containerInner:function(e){var t=e.classNames.containerInner,n=document.createElement("div");return t2(n,t),n},itemList:function(e,t){var n=e.searchEnabled,i=e.classNames,r=i.list,a=i.listSingle,s=i.listItems,o=document.createElement("div");return t2(o,r),t2(o,t?a:s),this._isSelectElement&&n&&o.setAttribute("role","listbox"),o},placeholder:function(e,t){var n=e.allowHTML,i=e.classNames.placeholder,r=document.createElement("div");return t2(r,i),tQ(r,n,t),r},item:function(e,t,n){var i=e.allowHTML,r=e.removeItemButtonAlignLeft,a=e.removeItemIconText,s=e.removeItemLabelText,o=e.classNames,l=o.item,u=o.button,c=o.highlightedState,h=o.itemSelectable,d=o.placeholder,f=tW(t.value),v=document.createElement("div");if(t2(v,l),t.labelClass){var g=document.createElement("span");tQ(g,i,t.label),t2(g,t.labelClass),v.appendChild(g)}else tQ(v,i,t.label);if(v.dataset.item="",v.dataset.id=t.id,v.dataset.value=f,n9(v,t,!0),(t.disabled||this.containerOuter.isDisabled)&&v.setAttribute("aria-disabled","true"),this._isSelectElement&&(v.setAttribute("aria-selected","true"),v.setAttribute("role","option")),t.placeholder&&(t2(v,d),v.dataset.placeholder=""),t2(v,t.highlighted?c:h),n){t.disabled&&t3(v,h),v.dataset.deletable="";var m=document.createElement("button");m.type="button",t2(m,u),tQ(m,!0,tq(a,t.value));var p=tq(s,t.value);p&&m.setAttribute("aria-label",p),m.dataset.button="",r?v.insertAdjacentElement("afterbegin",m):v.appendChild(m)}return v},choiceList:function(e,t){var n=e.classNames.list,i=document.createElement("div");return t2(i,n),t||i.setAttribute("aria-multiselectable","true"),i.setAttribute("role","listbox"),i},choiceGroup:function(e,t){var n=e.allowHTML,i=e.classNames,r=i.group,a=i.groupHeading,s=i.itemDisabled,o=t.id,l=t.label,u=t.disabled,c=tW(l),h=document.createElement("div");t2(h,r),u&&t2(h,s),h.setAttribute("role","group"),h.dataset.group="",h.dataset.id=o,h.dataset.value=c,u&&h.setAttribute("aria-disabled","true");var d=document.createElement("div");return t2(d,a),tQ(d,n,l||""),h.appendChild(d),h},choice:function(e,t,n,i){var r=e.allowHTML,a=e.classNames,s=a.item,o=a.itemChoice,l=a.itemSelectable,u=a.selectedState,c=a.itemDisabled,h=a.description,d=a.placeholder,f=t.label,v=tW(t.value),g=document.createElement("div");g.id=t.elementId,t2(g,s),t2(g,o),i&&"string"==typeof f&&(f={trusted:f=tX(r,f)+" (".concat(i,")")});var m=g;if(t.labelClass){var p=document.createElement("span");tQ(p,r,f),t2(p,t.labelClass),m=p,g.appendChild(p)}else tQ(g,r,f);if(t.labelDescription){var y="".concat(t.elementId,"-description");m.setAttribute("aria-describedby",y);var E=document.createElement("span");tQ(E,r,t.labelDescription),E.id=y,t2(E,h),g.appendChild(E)}return t.selected&&t2(g,u),t.placeholder&&t2(g,d),g.setAttribute("role",t.group?"treeitem":"option"),g.dataset.choice="",g.dataset.id=t.id,g.dataset.value=v,n&&(g.dataset.selectText=n),t.group&&(g.dataset.groupId="".concat(t.group.id)),n9(g,t,!1),t.disabled?(t2(g,c),g.dataset.choiceDisabled="",g.setAttribute("aria-disabled","true")):(t2(g,l),g.dataset.choiceSelectable=""),g},input:function(e,t){var n=e.classNames,i=n.input,r=n.inputCloned,a=e.labelId,s=document.createElement("input");return s.type="search",t2(s,i),t2(s,r),s.autocomplete="off",s.autocapitalize="off",s.spellcheck=!1,s.setAttribute("aria-autocomplete","list"),t?s.setAttribute("aria-label",t):a||n7(this._docRoot,this.passedElement.element.id,s),s},dropdown:function(e){var t=e.classNames,n=t.list,i=t.listDropdown,r=document.createElement("div");return t2(r,n),t2(r,i),r.setAttribute("aria-expanded","false"),r},notice:function(e,t,n){var i=e.classNames,r=i.item,a=i.itemChoice,s=i.addChoice,o=i.noResults,l=i.noChoices,u=i.notice;void 0===n&&(n="");var c=document.createElement("div");switch(tQ(c,!0,t),t2(c,r),t2(c,a),t2(c,u),n){case nf:t2(c,s);break;case nd:t2(c,o);break;case nh:t2(c,l)}return n===nf&&(c.dataset.choiceSelectable="",c.dataset.choice=""),c},option:function(e){var t=new Option(tW(e.label),e.value,!1,e.selected);return n9(t,e,!0),t.disabled=e.disabled,e.selected&&t.setAttribute("selected",""),t}},it="-ms-scroll-limit"in document.documentElement.style&&"-ms-ime-align"in document.documentElement.style,ii={},ir=function(e){if(e)return e.dataset.id?parseInt(e.dataset.id,10):void 0},ia="[data-choice-selectable]",is=function(){function e(t,n){void 0===t&&(t="[data-choice]"),void 0===n&&(n={});var i=this;this.initialisedOK=void 0,this._hasNonChoicePlaceholder=!1,this._lastAddedChoiceId=0,this._lastAddedGroupId=0;var r=e.defaults;this.config=tE(tE(tE({},r.allOptions),r.options),n),tx.forEach(function(e){i.config[e]=tE(tE(tE({},r.allOptions[e]),r.options[e]),n[e])});var a=this.config;a.silent||this._validateConfig();var s=a.shadowRoot||document.documentElement;this._docRoot=s;var o="string"==typeof t?s.querySelector(t):t;if(!o||(void 0===o?"undefined":(0,Q._)(o))!=="object"||!("INPUT"===o.tagName||na(o))){if(!o&&"string"==typeof t)throw TypeError("Selector ".concat(t," failed to find an element"));throw TypeError("Expected one of the following types text|select-one|select-multiple")}var l=o.type,u="text"===l;(u||1!==a.maxItemCount)&&(a.singleModeForMultiSelect=!1),a.singleModeForMultiSelect&&(l=tO);var c=l===tP,h=l===tO,d=c||h;if(this._elementType=l,this._isTextElement=u,this._isSelectOneElement=c,this._isSelectMultipleElement=h,this._isSelectElement=c||h,this._canAddUserChoices=u&&a.addItems||d&&a.addChoices,"boolean"!=typeof a.renderSelectedChoices&&(a.renderSelectedChoices="always"===a.renderSelectedChoices||c),"auto"===a.closeDropdownOnSelect?a.closeDropdownOnSelect=u||c||a.singleModeForMultiSelect:a.closeDropdownOnSelect=nn(a.closeDropdownOnSelect),a.placeholder&&(a.placeholderValue?this._hasNonChoicePlaceholder=!0:o.dataset.placeholder&&(this._hasNonChoicePlaceholder=!0,a.placeholderValue=o.dataset.placeholder)),n.addItemFilter&&"function"!=typeof n.addItemFilter){var f=n.addItemFilter instanceof RegExp?n.addItemFilter:new RegExp(n.addItemFilter);a.addItemFilter=f.test.bind(f)}if(this._isTextElement?this.passedElement=new nt({element:o,classNames:a.classNames}):this.passedElement=new ns({element:o,classNames:a.classNames,template:function(e){return i._templates.option(e)},extractPlaceholder:a.placeholder&&!this._hasNonChoicePlaceholder}),this.initialised=!1,this._store=new nc(a),this._currentValue="",a.searchEnabled=!u&&a.searchEnabled||h,this._canSearch=a.searchEnabled,this._isScrollingOnIe=!1,this._highlightPosition=0,this._wasTap=!0,this._placeholderValue=this._generatePlaceholderValue(),this._baseId=tj(o,"choices-"),this._direction=o.dir,!this._direction){var v=window.getComputedStyle(o).direction;v!==window.getComputedStyle(document.documentElement).direction&&(this._direction=v)}if(this._idNames={itemChoice:"item-choice"},this._templates=r.templates,this._render=this._render.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onInput=this._onInput.bind(this),this._onClick=this._onClick.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseOver=this._onMouseOver.bind(this),this._onFormReset=this._onFormReset.bind(this),this._onSelectKey=this._onSelectKey.bind(this),this._onEnterKey=this._onEnterKey.bind(this),this._onEscapeKey=this._onEscapeKey.bind(this),this._onDirectionKey=this._onDirectionKey.bind(this),this._onDeleteKey=this._onDeleteKey.bind(this),this.passedElement.isActive){a.silent||console.warn("Trying to initialise Choices on element already initialised",{element:t}),this.initialised=!0,this.initialisedOK=!1;return}this.init(),this._initialItems=this._store.items.map(function(e){return e.value})}return Object.defineProperty(e,"defaults",{get:function(){return Object.preventExtensions({get options(){return ii},get allOptions(){return no},get templates(){return ie}})},enumerable:!1,configurable:!0}),e.prototype.init=function(){if(!this.initialised&&void 0===this.initialisedOK){this._searcher=new n8(this.config),this._loadChoices(),this._createTemplates(),this._createElements(),this._createStructure(),this._isTextElement&&!this.config.addItems||this.passedElement.element.hasAttribute("disabled")||this.passedElement.element.closest("fieldset:disabled")?this.disable():(this.enable(),this._addEventListeners()),this._initStore(),this.initialised=!0,this.initialisedOK=!0;var e=this.config.callbackOnInit;"function"==typeof e&&e.call(this)}},e.prototype.destroy=function(){this.initialised&&(this._removeEventListeners(),this.passedElement.reveal(),this.containerOuter.unwrap(this.passedElement.element),this._store._listeners=[],this.clearStore(!1),this._stopSearch(),this._templates=e.defaults.templates,this.initialised=!1,this.initialisedOK=void 0)},e.prototype.enable=function(){return this.passedElement.isDisabled&&this.passedElement.enable(),this.containerOuter.isDisabled&&(this._addEventListeners(),this.input.enable(),this.containerOuter.enable()),this},e.prototype.disable=function(){return this.passedElement.isDisabled||this.passedElement.disable(),this.containerOuter.isDisabled||(this._removeEventListeners(),this.input.disable(),this.containerOuter.disable()),this},e.prototype.highlightItem=function(e,t){if(void 0===t&&(t=!0),!e||!e.id)return this;var n=this._store.items.find(function(t){return t.id===e.id});return!n||n.highlighted||(this._store.dispatch(tB(n,!0)),t&&this.passedElement.triggerEvent(tC,this._getChoiceForOutput(n))),this},e.prototype.unhighlightItem=function(e,t){if(void 0===t&&(t=!0),!e||!e.id)return this;var n=this._store.items.find(function(t){return t.id===e.id});return n&&n.highlighted&&(this._store.dispatch(tB(n,!1)),t&&this.passedElement.triggerEvent("unhighlightItem",this._getChoiceForOutput(n))),this},e.prototype.highlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(t){t.highlighted||(e._store.dispatch(tB(t,!0)),e.passedElement.triggerEvent(tC,e._getChoiceForOutput(t)))})}),this},e.prototype.unhighlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(t){t.highlighted&&(e._store.dispatch(tB(t,!1)),e.passedElement.triggerEvent(tC,e._getChoiceForOutput(t)))})}),this},e.prototype.removeActiveItemsByValue=function(e){var t=this;return this._store.withTxn(function(){t._store.items.filter(function(t){return t.value===e}).forEach(function(e){return t._removeItem(e)})}),this},e.prototype.removeActiveItems=function(e){var t=this;return this._store.withTxn(function(){t._store.items.filter(function(t){return t.id!==e}).forEach(function(e){return t._removeItem(e)})}),this},e.prototype.removeHighlightedItems=function(e){var t=this;return void 0===e&&(e=!1),this._store.withTxn(function(){t._store.highlightedActiveItems.forEach(function(n){t._removeItem(n),e&&t._triggerChange(n.value)})}),this},e.prototype.showDropdown=function(e){var t=this;return this.dropdown.isActive||(void 0===e&&(e=!this._canSearch),requestAnimationFrame(function(){t.dropdown.show();var n=t.dropdown.element.getBoundingClientRect();t.containerOuter.open(n.bottom,n.height),e||t.input.focus(),t.passedElement.triggerEvent("showDropdown")})),this},e.prototype.hideDropdown=function(e){var t=this;return this.dropdown.isActive&&requestAnimationFrame(function(){t.dropdown.hide(),t.containerOuter.close(),!e&&t._canSearch&&(t.input.removeActiveDescendant(),t.input.blur()),t.passedElement.triggerEvent("hideDropdown")}),this},e.prototype.getValue=function(e){var t=this,n=this._store.items.map(function(n){return e?n.value:t._getChoiceForOutput(n)});return this._isSelectOneElement||this.config.singleModeForMultiSelect?n[0]:n},e.prototype.setValue=function(e){var t=this;return this.initialisedOK?(this._store.withTxn(function(){e.forEach(function(e){e&&t._addChoice(nr(e,!1))})}),this._searcher.reset()):this._warnChoicesInitFailed("setValue"),this},e.prototype.setChoiceByValue=function(e){var t=this;return this.initialisedOK?this._isTextElement||(this._store.withTxn(function(){(Array.isArray(e)?e:[e]).forEach(function(e){return t._findAndSelectChoiceByValue(e)}),t.unhighlightAll()}),this._searcher.reset()):this._warnChoicesInitFailed("setChoiceByValue"),this},e.prototype.setChoices=function(e,t,n,i,r,a){var s=this;if(void 0===e&&(e=[]),void 0===t&&(t="value"),void 0===n&&(n="label"),void 0===i&&(i=!1),void 0===r&&(r=!0),void 0===a&&(a=!1),!this.initialisedOK)return this._warnChoicesInitFailed("setChoices"),this;if(!this._isSelectElement)throw TypeError("setChoices can't be used with INPUT based Choices");if("string"!=typeof t||!t)throw TypeError("value parameter must be a name of 'value' field in passed objects");if("function"==typeof e){var o=e(this);if("function"==typeof Promise&&o instanceof Promise)return new Promise(function(e){return requestAnimationFrame(e)}).then(function(){return s._handleLoadingState(!0)}).then(function(){return o}).then(function(e){return s.setChoices(e,t,n,i,r,a)}).catch(function(e){s.config.silent||console.error(e)}).then(function(){return s._handleLoadingState(!1)}).then(function(){return s});if(!Array.isArray(o))throw TypeError(".setChoices first argument function must return either array of choices or Promise, got: ".concat(void 0===o?"undefined":(0,Q._)(o)));return this.setChoices(o,t,n,!1)}if(!Array.isArray(e))throw TypeError(".setChoices must be called either with array of choices with a function resulting into Promise of array of choices");return this.containerOuter.removeLoadingState(),this._store.withTxn(function(){r&&(s._isSearching=!1),i&&s.clearChoices(!0,a);var o="value"===t,l="label"===n;e.forEach(function(e){if("choices"in e){var i=e;l||(i=tE(tE({},i),{label:i[n]})),s._addGroup(nr(i,!0))}else{var r=e;l&&o||(r=tE(tE({},r),{value:r[t],label:r[n]}));var a=nr(r,!1);s._addChoice(a),a.placeholder&&!s._hasNonChoicePlaceholder&&(s._placeholderValue=tz(a.label))}}),s.unhighlightAll()}),this._searcher.reset(),this},e.prototype.refresh=function(e,t,n){var i=this;return(void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1),this._isSelectElement)?this._store.withTxn(function(){var r=i.passedElement.optionsAsChoices(),a={};n||i._store.items.forEach(function(e){e.id&&e.active&&e.selected&&(a[e.value]=!0)}),i.clearStore(!1);var s=function(e){n?i._store.dispatch(tN(e)):a[e.value]&&(e.selected=!0)};r.forEach(function(e){if("choices"in e)return void e.choices.forEach(s);s(e)}),i._addPredefinedChoices(r,t,e),i._isSearching&&i._searchChoices(i.input.value)}):this.config.silent||console.warn("refresh method can only be used on choices backed by a <select> element"),this},e.prototype.removeChoice=function(e){var t=this._store.choices.find(function(t){return t.value===e});return t?(this._clearNotice(),this._store.dispatch({type:tb,choice:t}),this._searcher.reset(),t.selected&&this.passedElement.triggerEvent(tD,this._getChoiceForOutput(t)),this):this},e.prototype.clearChoices=function(e,t){var n=this;return void 0===e&&(e=!0),void 0===t&&(t=!1),e&&(t?this.passedElement.element.replaceChildren(""):this.passedElement.element.querySelectorAll(":not([selected])").forEach(function(e){e.remove()})),this.itemList.element.replaceChildren(""),this.choiceList.element.replaceChildren(""),this._clearNotice(),this._store.withTxn(function(){var e=t?[]:n._store.items;n._store.reset(),e.forEach(function(e){n._store.dispatch(tM(e)),n._store.dispatch(tF(e))})}),this._searcher.reset(),this},e.prototype.clearStore=function(e){return void 0===e&&(e=!0),this.clearChoices(e,!0),this._stopSearch(),this._lastAddedChoiceId=0,this._lastAddedGroupId=0,this},e.prototype.clearInput=function(){var e=!this._isSelectOneElement;return this.input.clear(e),this._stopSearch(),this},e.prototype._validateConfig=function(){var e=this.config,t=tJ(e,no);t.length&&console.warn("Unknown config option(s) passed",t.join(", ")),e.allowHTML&&e.allowHtmlUserInput&&(e.addItems&&console.warn("Warning: allowHTML/allowHtmlUserInput/addItems all being true is strongly not recommended and may lead to XSS attacks"),e.addChoices&&console.warn("Warning: allowHTML/allowHtmlUserInput/addChoices all being true is strongly not recommended and may lead to XSS attacks"))},e.prototype._render=function(e){void 0===e&&(e={choices:!0,groups:!0,items:!0}),!this._store.inTxn()&&(this._isSelectElement&&(e.choices||e.groups)&&this._renderChoices(),e.items&&this._renderItems())},e.prototype._renderChoices=function(){var e=this;if(this._canAddItems()){var t=this.config,n=this._isSearching,i=this._store,r=i.activeGroups,a=i.activeChoices,s=0;if(n&&t.searchResultLimit>0?s=t.searchResultLimit:t.renderChoiceLimit>0&&(s=t.renderChoiceLimit),this._isSelectElement){var o=a.filter(function(e){return!e.element});o.length&&this.passedElement.addOptions(o)}var l=document.createDocumentFragment(),u=function(e){return e.filter(function(e){return!e.placeholder&&(n?!!e.rank:t.renderSelectedChoices||!e.selected)})},c=!1,h=function(i,r,a){n?i.sort(t$):t.shouldSort&&i.sort(t.sorter);var o=i.length;o=!r&&s&&o>s?s:o,o--,i.every(function(i,r){var s=i.choiceEl||e._templates.choice(t,i,t.itemSelectText,a);return i.choiceEl=s,l.appendChild(s),(n||!i.selected)&&(c=!0),r<o})};a.length&&(t.resetScrollPosition&&requestAnimationFrame(function(){return e.choiceList.scrollToTop()}),this._hasNonChoicePlaceholder||n||!this._isSelectOneElement||h(a.filter(function(e){return e.placeholder&&!e.group}),!1,void 0),r.length&&!n?(t.shouldSort&&r.sort(t.sorter),h(a.filter(function(e){return!e.placeholder&&!e.group}),!1,void 0),r.forEach(function(i){var r=u(i.choices);if(r.length){if(i.label){var a=i.groupEl||e._templates.choiceGroup(e.config,i);i.groupEl=a,a.remove(),l.appendChild(a)}h(r,!0,t.appendGroupInSearch&&n?i.label:void 0)}})):h(u(a),!1,void 0)),c||!n&&l.children.length&&t.renderSelectedChoices||(this._notice||(this._notice={text:tY(n?t.noResultsText:t.noChoicesText),type:n?nd:nh}),l.replaceChildren("")),this._renderNotice(l),this.choiceList.element.replaceChildren(l),c&&this._highlightChoice()}},e.prototype._renderItems=function(){var e=this,t=this._store.items||[],n=this.itemList.element,i=this.config,r=document.createDocumentFragment(),a=function(e){return n.querySelector('[data-item][data-id="'.concat(e.id,'"]'))},s=function(t){var n=t.itemEl;n&&n.parentElement||(n=a(t)||e._templates.item(i,t,i.removeItemButton),t.itemEl=n,r.appendChild(n))};t.forEach(s);var o=!!r.childNodes.length;if(this._isSelectOneElement){var l=n.children.length;if(o||l>1){var u=n.querySelector(t1(i.classNames.placeholder));u&&u.remove()}else o||l||!this._placeholderValue||(o=!0,s(nr({selected:!0,value:"",label:this._placeholderValue,placeholder:!0},!1)))}o&&(n.append(r),i.shouldSortItems&&!this._isSelectOneElement&&(t.sort(i.sorter),t.forEach(function(e){var t=a(e);t&&(t.remove(),r.append(t))}),n.append(r))),this._isTextElement&&(this.passedElement.value=t.map(function(e){return e.value}).join(i.delimiter))},e.prototype._displayNotice=function(e,t,n){void 0===n&&(n=!0);var i=this._notice;if(i&&(i.type===t&&i.text===e||i.type===nf&&(t===nd||t===nh))){n&&this.showDropdown(!0);return}this._clearNotice(),this._notice=e?{text:e,type:t}:void 0,this._renderNotice(),n&&e&&this.showDropdown(!0)},e.prototype._clearNotice=function(){if(this._notice){var e=this.choiceList.element.querySelector(t1(this.config.classNames.notice));e&&e.remove(),this._notice=void 0}},e.prototype._renderNotice=function(e){var t=this._notice;if(t){var n=this._templates.notice(this.config,t.text,t.type);e?e.append(n):this.choiceList.prepend(n)}},e.prototype._getChoiceForOutput=function(e,t){return{id:e.id,highlighted:e.highlighted,labelClass:e.labelClass,labelDescription:e.labelDescription,customProperties:e.customProperties,disabled:e.disabled,active:e.active,label:e.label,placeholder:e.placeholder,value:e.value,groupValue:e.group?e.group.label:void 0,element:e.element,keyCode:t}},e.prototype._triggerChange=function(e){null!=e&&this.passedElement.triggerEvent("change",{value:e})},e.prototype._handleButtonAction=function(e){var t=this,n=this._store.items;if(n.length&&this.config.removeItems&&this.config.removeItemButton){var i=e&&ir(e.parentElement),r=i&&n.find(function(e){return e.id===i});r&&this._store.withTxn(function(){if(t._removeItem(r),t._triggerChange(r.value),t._isSelectOneElement&&!t._hasNonChoicePlaceholder){var e=(t.config.shouldSort?t._store.choices.reverse():t._store.choices).find(function(e){return e.placeholder});e&&(t._addItem(e),t.unhighlightAll(),e.value&&t._triggerChange(e.value))}})}},e.prototype._handleItemAction=function(e,t){var n=this;void 0===t&&(t=!1);var i=this._store.items;if(i.length&&this.config.removeItems&&!this._isSelectOneElement){var r=ir(e);r&&(i.forEach(function(e){e.id!==r||e.highlighted?!t&&e.highlighted&&n.unhighlightItem(e):n.highlightItem(e)}),this.input.focus())}},e.prototype._handleChoiceAction=function(e){var t=this,n=ir(e),i=n&&this._store.getChoiceById(n);if(!i||i.disabled)return!1;var r=this.dropdown.isActive;if(!i.selected){if(!this._canAddItems())return!0;this._store.withTxn(function(){t._addItem(i,!0,!0),t.clearInput(),t.unhighlightAll()}),this._triggerChange(i.value)}return r&&this.config.closeDropdownOnSelect&&(this.hideDropdown(!0),this.containerOuter.element.focus()),!0},e.prototype._handleBackspace=function(e){var t=this.config;if(t.removeItems&&e.length){var n=e[e.length-1],i=e.some(function(e){return e.highlighted});t.editItems&&!i&&n?(this.input.value=n.value,this.input.setWidth(),this._removeItem(n),this._triggerChange(n.value)):(i||this.highlightItem(n,!1),this.removeHighlightedItems(!0))}},e.prototype._loadChoices=function(){var e,t=this,n=this.config;if(this._isTextElement){if(this._presetChoices=n.items.map(function(e){return nr(e,!1)}),this.passedElement.value){var i=this.passedElement.value.split(n.delimiter).map(function(e){return nr(e,!1,t.config.allowHtmlUserInput)});this._presetChoices=this._presetChoices.concat(i)}this._presetChoices.forEach(function(e){e.selected=!0})}else if(this._isSelectElement){this._presetChoices=n.choices.map(function(e){return nr(e,!0)});var r=this.passedElement.optionsAsChoices();r&&(e=this._presetChoices).push.apply(e,r)}},e.prototype._handleLoadingState=function(e){void 0===e&&(e=!0);var t=this.itemList.element;e?(this.disable(),this.containerOuter.addLoadingState(),this._isSelectOneElement?t.replaceChildren(this._templates.placeholder(this.config,this.config.loadingText)):this.input.placeholder=this.config.loadingText):(this.enable(),this.containerOuter.removeLoadingState(),this._isSelectOneElement?(t.replaceChildren(""),this._render()):this.input.placeholder=this._placeholderValue||"")},e.prototype._handleSearch=function(e){if(this.input.isFocussed)if(null!=e&&e.length>=this.config.searchFloor){var t=this.config.searchChoices?this._searchChoices(e):0;null!==t&&this.passedElement.triggerEvent(tR,{value:e,resultCount:t})}else this._store.choices.some(function(e){return!e.active})&&this._stopSearch()},e.prototype._canAddItems=function(){var e=this.config,t=e.maxItemCount,n=e.maxItemText;return!e.singleModeForMultiSelect&&t>0&&t<=this._store.items.length?(this.choiceList.element.replaceChildren(""),this._notice=void 0,this._displayNotice("function"==typeof n?n(t):n,nf),!1):(this._notice&&this._notice.type===nf&&this._clearNotice(),!0)},e.prototype._canCreateItem=function(e){var t=this.config,n=!0,i="";if("function"!=typeof t.addItemFilter||t.addItemFilter(e)||(n=!1,i=tq(t.customAddItemText,e)),n&&this._store.choices.find(function(n){return t.valueComparer(n.value,e)})){if(this._isSelectElement)return this._displayNotice("",nf),!1;t.duplicateItemsAllowed||(n=!1,i=tq(t.uniqueItemText,e))}return n&&(i=tq(t.addItemText,e)),i&&this._displayNotice(i,nf),n},e.prototype._searchChoices=function(e){var t=e.trim().replace(/\s{2,}/," ");if(!t.length||t===this._currentValue)return null;var n=this._searcher;n.isEmptyIndex()&&n.index(this._store.searchableChoices);var i=n.search(t);this._currentValue=t,this._highlightPosition=0,this._isSearching=!0;var r=this._notice;return(r&&r.type)!==nf&&(i.length?this._clearNotice():this._displayNotice(tY(this.config.noResultsText),nd)),this._store.dispatch({type:tT,results:i}),i.length},e.prototype._stopSearch=function(){this._isSearching&&(this._currentValue="",this._isSearching=!1,this._clearNotice(),this._store.dispatch({type:tS,active:!0}),this.passedElement.triggerEvent(tR,{value:"",resultCount:0}))},e.prototype._addEventListeners=function(){var e=this._docRoot,t=this.containerOuter.element,n=this.input.element;e.addEventListener("touchend",this._onTouchEnd,!0),t.addEventListener("keydown",this._onKeyDown,!0),t.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("click",this._onClick,{passive:!0}),e.addEventListener("touchmove",this._onTouchMove,{passive:!0}),this.dropdown.element.addEventListener("mouseover",this._onMouseOver,{passive:!0}),this._isSelectOneElement&&(t.addEventListener("focus",this._onFocus,{passive:!0}),t.addEventListener("blur",this._onBlur,{passive:!0})),n.addEventListener("keyup",this._onKeyUp,{passive:!0}),n.addEventListener("input",this._onInput,{passive:!0}),n.addEventListener("focus",this._onFocus,{passive:!0}),n.addEventListener("blur",this._onBlur,{passive:!0}),n.form&&n.form.addEventListener("reset",this._onFormReset,{passive:!0}),this.input.addEventListeners()},e.prototype._removeEventListeners=function(){var e=this._docRoot,t=this.containerOuter.element,n=this.input.element;e.removeEventListener("touchend",this._onTouchEnd,!0),t.removeEventListener("keydown",this._onKeyDown,!0),t.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("click",this._onClick),e.removeEventListener("touchmove",this._onTouchMove),this.dropdown.element.removeEventListener("mouseover",this._onMouseOver),this._isSelectOneElement&&(t.removeEventListener("focus",this._onFocus),t.removeEventListener("blur",this._onBlur)),n.removeEventListener("keyup",this._onKeyUp),n.removeEventListener("input",this._onInput),n.removeEventListener("focus",this._onFocus),n.removeEventListener("blur",this._onBlur),n.form&&n.form.removeEventListener("reset",this._onFormReset),this.input.removeEventListeners()},e.prototype._onKeyDown=function(e){var t=e.keyCode,n=this.dropdown.isActive,i=1===e.key.length||2===e.key.length&&e.key.charCodeAt(0)>=55296||"Unidentified"===e.key;switch(!this._isTextElement&&!n&&27!==t&&9!==t&&16!==t&&(this.showDropdown(),!this.input.isFocussed&&i&&(this.input.value+=e.key," "===e.key&&e.preventDefault())),t){case 65:return this._onSelectKey(e,this.itemList.element.hasChildNodes());case 13:return this._onEnterKey(e,n);case 27:return this._onEscapeKey(e,n);case 38:case 33:case 40:case 34:return this._onDirectionKey(e,n);case 8:case 46:return this._onDeleteKey(e,this._store.items,this.input.isFocussed)}},e.prototype._onKeyUp=function(){this._canSearch=this.config.searchEnabled},e.prototype._onInput=function(){var e=this.input.value;if(!e)return void(this._isTextElement?this.hideDropdown(!0):this._stopSearch());this._canAddItems()&&(this._canSearch&&this._handleSearch(e),this._canAddUserChoices&&(this._canCreateItem(e),this._isSelectElement&&(this._highlightPosition=0,this._highlightChoice())))},e.prototype._onSelectKey=function(e,t){(e.ctrlKey||e.metaKey)&&t&&(this._canSearch=!1,this.config.removeItems&&!this.input.value&&this.input.element===document.activeElement&&this.highlightAll())},e.prototype._onEnterKey=function(e,t){var n=this,i=this.input.value,r=e.target;if(e.preventDefault(),r&&r.hasAttribute("data-button"))return void this._handleButtonAction(r);if(!t){(this._isSelectElement||this._notice)&&this.showDropdown();return}var a=this.dropdown.element.querySelector(t1(this.config.classNames.highlightedState));if(!(a&&this._handleChoiceAction(a))){if(!r||!i)return void this.hideDropdown(!0);if(this._canAddItems()){var s=!1;this._store.withTxn(function(){if(!(s=n._findAndSelectChoiceByValue(i,!0))){if(!n._canAddUserChoices||!n._canCreateItem(i))return;n._addChoice(nr(i,!1,n.config.allowHtmlUserInput),!0,!0),s=!0}n.clearInput(),n.unhighlightAll()}),s&&(this._triggerChange(i),this.config.closeDropdownOnSelect&&this.hideDropdown(!0))}}},e.prototype._onEscapeKey=function(e,t){t&&(e.stopPropagation(),this.hideDropdown(!0),this._stopSearch(),this.containerOuter.element.focus())},e.prototype._onDirectionKey=function(e,t){var n=e.keyCode;if(t||this._isSelectOneElement){this.showDropdown(),this._canSearch=!1;var i=40===n||34===n?1:-1,r=e.metaKey||34===n||33===n,a=void 0;if(r)a=i>0?this.dropdown.element.querySelector("".concat(ia,":last-of-type")):this.dropdown.element.querySelector(ia);else{var s=this.dropdown.element.querySelector(t1(this.config.classNames.highlightedState));a=s?tG(s,ia,i):this.dropdown.element.querySelector(ia)}a&&(tK(a,this.choiceList.element,i)||this.choiceList.scrollToChildElement(a,i),this._highlightChoice(a)),e.preventDefault()}},e.prototype._onDeleteKey=function(e,t,n){this._isSelectOneElement||e.target.value||!n||(this._handleBackspace(t),e.preventDefault())},e.prototype._onTouchMove=function(){this._wasTap&&(this._wasTap=!1)},e.prototype._onTouchEnd=function(e){var t=(e||e.touches[0]).target;this._wasTap&&this.containerOuter.element.contains(t)&&((t===this.containerOuter.element||t===this.containerInner.element)&&(this._isTextElement?this.input.focus():this._isSelectMultipleElement&&this.showDropdown()),e.stopPropagation()),this._wasTap=!0},e.prototype._onMouseDown=function(e){var t=e.target;if(t instanceof HTMLElement){if(it&&this.choiceList.element.contains(t)){var n=this.choiceList.element.firstElementChild;this._isScrollingOnIe="ltr"===this._direction?e.offsetX>=n.offsetWidth:e.offsetX<n.offsetLeft}if(t!==this.input.element){var i=t.closest("[data-button],[data-item],[data-choice]");i instanceof HTMLElement&&("button"in i.dataset?this._handleButtonAction(i):"item"in i.dataset?this._handleItemAction(i,e.shiftKey):"choice"in i.dataset&&this._handleChoiceAction(i)),e.preventDefault()}}},e.prototype._onMouseOver=function(e){var t=e.target;t instanceof HTMLElement&&"choice"in t.dataset&&this._highlightChoice(t)},e.prototype._onClick=function(e){var t=e.target,n=this.containerOuter;n.element.contains(t)?this.dropdown.isActive||n.isDisabled?this._isSelectOneElement&&t!==this.input.element&&!this.dropdown.element.contains(t)&&this.hideDropdown():this._isTextElement?document.activeElement!==this.input.element&&this.input.focus():(this.showDropdown(),n.element.focus()):(n.removeFocusState(),this.hideDropdown(!0),this.unhighlightAll())},e.prototype._onFocus=function(e){var t=e.target,n=this.containerOuter;if(t&&n.element.contains(t)){var i=t===this.input.element;this._isTextElement?i&&n.addFocusState():this._isSelectMultipleElement?i&&(this.showDropdown(!0),n.addFocusState()):(n.addFocusState(),i&&this.showDropdown(!0))}},e.prototype._onBlur=function(e){var t=e.target,n=this.containerOuter;t&&n.element.contains(t)&&!this._isScrollingOnIe?t===this.input.element?(n.removeFocusState(),this.hideDropdown(!0),(this._isTextElement||this._isSelectMultipleElement)&&this.unhighlightAll()):t===this.containerOuter.element&&(n.removeFocusState(),this._canSearch||this.hideDropdown(!0)):(this._isScrollingOnIe=!1,this.input.element.focus())},e.prototype._onFormReset=function(){var e=this;this._store.withTxn(function(){e.clearInput(),e.hideDropdown(),e.refresh(!1,!1,!0),e._initialItems.length&&e.setChoiceByValue(e._initialItems)})},e.prototype._highlightChoice=function(e){void 0===e&&(e=null);var t=Array.from(this.dropdown.element.querySelectorAll(ia));if(t.length){var n=e,i=this.config.classNames.highlightedState;Array.from(this.dropdown.element.querySelectorAll(t1(i))).forEach(function(e){t3(e,i),e.setAttribute("aria-selected","false")}),n?this._highlightPosition=t.indexOf(n):(n=t.length>this._highlightPosition?t[this._highlightPosition]:t[t.length-1])||(n=t[0]),t2(n,i),n.setAttribute("aria-selected","true"),this.passedElement.triggerEvent("highlightChoice",{el:n}),this.dropdown.isActive&&(this.input.setActiveDescendant(n.id),this.containerOuter.setActiveDescendant(n.id))}},e.prototype._addItem=function(e,t,n){if(void 0===t&&(t=!0),void 0===n&&(n=!1),!e.id)throw TypeError("item.id must be set before _addItem is called for a choice/item");(this.config.singleModeForMultiSelect||this._isSelectOneElement)&&this.removeActiveItems(e.id),this._store.dispatch(tF(e)),t&&(this.passedElement.triggerEvent("addItem",this._getChoiceForOutput(e)),n&&this.passedElement.triggerEvent("choice",this._getChoiceForOutput(e)))},e.prototype._removeItem=function(e){if(e.id){this._store.dispatch(tN(e));var t=this._notice;t&&t.type===nh&&this._clearNotice(),this.passedElement.triggerEvent(tD,this._getChoiceForOutput(e))}},e.prototype._addChoice=function(e,t,n){if(void 0===t&&(t=!0),void 0===n&&(n=!1),e.id)throw TypeError("Can not re-add a choice which has already been added");var i=this.config;if(!(!i.duplicateItemsAllowed&&this._store.choices.find(function(t){return i.valueComparer(t.value,e.value)}))){this._lastAddedChoiceId++,e.id=this._lastAddedChoiceId,e.elementId="".concat(this._baseId,"-").concat(this._idNames.itemChoice,"-").concat(e.id);var r=i.prependValue,a=i.appendValue;r&&(e.value=r+e.value),a&&(e.value+=a.toString()),(r||a)&&e.element&&(e.element.value=e.value),this._clearNotice(),this._store.dispatch(tM(e)),e.selected&&this._addItem(e,t,n)}},e.prototype._addGroup=function(e,t){var n=this;if(void 0===t&&(t=!0),e.id)throw TypeError("Can not re-add a group which has already been added");this._store.dispatch({type:tA,group:e}),e.choices&&(this._lastAddedGroupId++,e.id=this._lastAddedGroupId,e.choices.forEach(function(i){i.group=e,e.disabled&&(i.disabled=!0),n._addChoice(i,t)}))},e.prototype._createTemplates=function(){var e=this,t=this.config.callbackOnCreateTemplates,n={};"function"==typeof t&&(n=t.call(this,tV,tX,t0));var i={};Object.keys(this._templates).forEach(function(t){t in n?i[t]=n[t].bind(e):i[t]=e._templates[t].bind(e)}),this._templates=i},e.prototype._createElements=function(){var e=this._templates,t=this.config,n=this._isSelectOneElement,i=t.position,r=t.classNames,a=this._elementType;this.containerOuter=new t6({element:e.containerOuter(t,this._direction,this._isSelectElement,n,t.searchEnabled,a,t.labelId),classNames:r,type:a,position:i}),this.containerInner=new t6({element:e.containerInner(t),classNames:r,type:a,position:i}),this.input=new t9({element:e.input(t,this._placeholderValue),classNames:r,type:a,preventPaste:!t.paste}),this.choiceList=new t7({element:e.choiceList(t,n)}),this.itemList=new t7({element:e.itemList(t,n)}),this.dropdown=new t8({element:e.dropdown(t),classNames:r,type:a})},e.prototype._createStructure=function(){var e=this.containerInner,t=this.containerOuter,n=this.passedElement,i=this.dropdown.element;n.conceal(),e.wrap(n.element),t.wrap(e.element),this._isSelectOneElement?this.input.placeholder=this.config.searchPlaceholderValue||"":(this._placeholderValue&&(this.input.placeholder=this._placeholderValue),this.input.setWidth()),t.element.appendChild(e.element),t.element.appendChild(i),e.element.appendChild(this.itemList.element),i.appendChild(this.choiceList.element),this._isSelectOneElement?this.config.searchEnabled&&i.insertBefore(this.input.element,i.firstChild):e.element.appendChild(this.input.element),this._highlightPosition=0,this._isSearching=!1},e.prototype._initStore=function(){var e=this;this._store.subscribe(this._render).withTxn(function(){e._addPredefinedChoices(e._presetChoices,e._isSelectOneElement&&!e._hasNonChoicePlaceholder,!1)}),(!this._store.choices.length||this._isSelectOneElement&&this._hasNonChoicePlaceholder)&&this._render()},e.prototype._addPredefinedChoices=function(e,t,n){var i=this;void 0===t&&(t=!1),void 0===n&&(n=!0),t&&-1===e.findIndex(function(e){return e.selected})&&e.some(function(e){return!e.disabled&&!("choices"in e)&&(e.selected=!0,!0)}),e.forEach(function(e){"choices"in e?i._isSelectElement&&i._addGroup(e,n):i._addChoice(e,n)})},e.prototype._findAndSelectChoiceByValue=function(e,t){var n=this;void 0===t&&(t=!1);var i=this._store.choices.find(function(t){return n.config.valueComparer(t.value,e)});return!!i&&!i.disabled&&!i.selected&&(this._addItem(i,!0,t),!0)},e.prototype._generatePlaceholderValue=function(){var e=this.config;if(!e.placeholder)return null;if(this._hasNonChoicePlaceholder)return e.placeholderValue;if(this._isSelectElement){var t=this.passedElement.placeholderOption;return t?t.text:null}return null},e.prototype._warnChoicesInitFailed=function(e){if(!this.config.silent)if(this.initialised){if(!this.initialisedOK)throw TypeError("".concat(e," called for an element which has multiple instances of Choices initialised on it"))}else throw TypeError("".concat(e," called on a non-initialised instance of Choices"))},e.version="11.1.0",e}();function io(e,t,n){var i;return(t="symbol"==(void 0===(i=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?"undefined":(0,Q._)(i))?i:i+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var il=function(e){"use strict";function t(){for(var e,n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];return(0,K._)(this,t),io(e=(0,G._)(this,t,(0,X._)(i)),"containerId",null),e}return(0,W._)(t,e),(0,H._)(t,[{key:"connect",value:function(){var e=this;this.containerId=this.element.dataset.containerId;var t=JSON.parse(atob(this.element.dataset.items));console.log(2,t),this.choices=new is(this.inputTarget,{items:null!=t?t:[],removeItemButton:!0}),this.inputTarget.addEventListener("addItem",function(){e.handleChange()}),this.inputTarget.addEventListener("removeItem",function(){e.handleChange()})}},{key:"handleChange",value:function(){var e=this.getTags(),t=new URL(window.location.href),n=new URLSearchParams;e.length>0&&e.forEach(function(e){n.append("tags[]",e)}),t.search=n.toString(),this.load(t.toString())}},{key:"load",value:function(e){var t="tag_".concat(this.containerId);fetch(e).then(function(e){return e.text()}).then(function(e){var n=new DOMParser().parseFromString(e,"text/html").getElementById(t);document.getElementById(t).innerHTML=n.innerHTML})}},{key:"getTags",value:function(){return this.choices.getValue(!0)}},{key:"disconnect",value:function(){this.choices&&this.choices.destroy()}}]),t}(eZ);io(il,"targets",["input"]);var G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),Q=N("16gB1"),iu=function(e){"use strict";function t(){return(0,K._)(this,t),(0,G._)(this,t,arguments)}return(0,W._)(t,e),(0,H._)(t,[{key:"connect",value:function(){this.seconds=parseInt(this.element.dataset.seconds),this.cancelId=requestAnimationFrame(this.update.bind(this))}},{key:"update",value:function(){var e=this.seconds-Math.floor(Date.now()/1e3),t=Math.floor(e/86400),n=Math.floor((e-=86400*t)/3600)%24,i=Math.floor((e-=3600*n)/60)%60,r=(e-=60*i)%60;this.daysTarget.innerHTML=t,this.hoursTarget.innerHTML=n,this.minutesTarget.innerHTML=i,this.secondsTarget.innerHTML=r,this.cancelId=requestAnimationFrame(this.update.bind(this))}},{key:"disconnect",value:function(){this.cancelId&&window.cancelAnimationFrame(this.cancelId)}}]),t}(eZ);"use strict";v=["days","hours","minutes","seconds"],(f="symbol"==(void 0===(n=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(f="targets","string"))?"undefined":(0,Q._)(n))?n:n+"")in iu?Object.defineProperty(iu,f,{value:v,enumerable:!0,configurable:!0,writable:!0}):iu[f]=v;var G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),X=N("l9etm"),Q=N("16gB1"),z=N("1Zvtp"),Q=N("16gB1");function ic(e,t){return function(){return e.apply(t,arguments)}}"use strict";var ih=Object.prototype.toString,id=Object.getPrototypeOf,iv=Symbol.iterator,ig=Symbol.toStringTag,im=(g=Object.create(null),function(e){var t=ih.call(e);return g[t]||(g[t]=t.slice(8,-1).toLowerCase())}),ip=function(e){return e=e.toLowerCase(),function(t){return im(t)===e}},iy=function(e){return function(t){return(void 0===t?"undefined":(0,Q._)(t))===e}},iE=Array.isArray,ik=iy("undefined");function ib(e){return null!==e&&!ik(e)&&null!==e.constructor&&!ik(e.constructor)&&i_(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}var iT=ip("ArrayBuffer"),iS=iy("string"),i_=iy("function"),iA=iy("number"),iL=function(e){return null!==e&&(void 0===e?"undefined":(0,Q._)(e))==="object"},iw=function(e){if("object"!==im(e))return!1;var t=id(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(ig in e)&&!(iv in e)},iI=ip("Date"),iR=ip("File"),iD=ip("Blob"),iC=ip("FileList"),ix=ip("URLSearchParams"),iP=(0,z._)(["ReadableStream","Request","Response","Headers"].map(ip),4),iO=iP[0],iM=iP[1],iF=iP[2],iN=iP[3];function iB(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.allOwnKeys;if(null!=e)if((void 0===e?"undefined":(0,Q._)(e))!=="object"&&(e=[e]),iE(e))for(r=0,a=e.length;r<a;r++)t.call(null,e[r],r,e);else{if(ib(e))return;var r,a,s,o=void 0!==i&&i?Object.getOwnPropertyNames(e):Object.keys(e),l=o.length;for(r=0;r<l;r++)s=o[r],t.call(null,e[s],s,e)}}function iU(e,t){if(ib(e))return null;t=t.toLowerCase();for(var n,i=Object.keys(e),r=i.length;r-- >0;)if(t===(n=i[r]).toLowerCase())return n;return null}"use strict";var ij="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:P,iG=function(e){return!ik(e)&&e!==ij},iK=(m="undefined"!=typeof Uint8Array&&id(Uint8Array),function(e){return m&&e instanceof m}),iH=ip("HTMLFormElement"),iV=(p=Object.prototype.hasOwnProperty,function(e,t){return p.call(e,t)}),iq=ip("RegExp"),iY=function(e,t){var n=Object.getOwnPropertyDescriptors(e),i={};iB(n,function(n,r){var a;!1!==(a=t(n,r,e))&&(i[r]=a||n)}),Object.defineProperties(e,i)},iW=ip("AsyncFunction"),iz=(i="function"==typeof setImmediate,r=i_(ij.postMessage),i?setImmediate:r?(a="axios@".concat(Math.random()),s=[],ij.addEventListener("message",function(e){var t=e.source,n=e.data;t===ij&&n===a&&s.length&&s.shift()()},!1),function(e){s.push(e),ij.postMessage(a,"*")}):function(e){return setTimeout(e)}),iX="undefined"!=typeof queueMicrotask?queueMicrotask.bind(ij):iz,iQ={isArray:iE,isArrayBuffer:iT,isBuffer:ib,isFormData:function(e){var t;return e&&("function"==typeof FormData&&e instanceof FormData||i_(e.append)&&("formdata"===(t=im(e))||"object"===t&&i_(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&iT(e.buffer)},isString:iS,isNumber:iA,isBoolean:function(e){return!0===e||!1===e},isObject:iL,isPlainObject:iw,isEmptyObject:function(e){if(!iL(e)||ib(e))return!1;try{return 0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype}catch(e){return!1}},isReadableStream:iO,isRequest:iM,isResponse:iF,isHeaders:iN,isUndefined:ik,isDate:iI,isFile:iR,isBlob:iD,isRegExp:iq,isFunction:i_,isStream:function(e){return iL(e)&&i_(e.pipe)},isURLSearchParams:ix,isTypedArray:iK,isFileList:iC,forEach:iB,merge:function e(){for(var t=iG(this)&&this||{},n=t.caseless,i=t.skipUndefined,r={},a=function(t,a){var s=n&&iU(r,a)||a;iw(r[s])&&iw(t)?r[s]=e(r[s],t):iw(t)?r[s]=e({},t):iE(t)?r[s]=t.slice():i&&ik(t)||(r[s]=t)},s=0,o=arguments.length;s<o;s++)arguments[s]&&iB(arguments[s],a);return r},extend:function(e,t,n){var i=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).allOwnKeys;return iB(t,function(t,i){n&&i_(t)?e[i]=ic(t,n):e[i]=t},{allOwnKeys:i}),e},trim:function(e){return e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e},inherits:function(e,t,n,i){e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:function(e,t,n,i){var r,a,s,o={};if(t=t||{},null==e)return t;do{for(a=(r=Object.getOwnPropertyNames(e)).length;a-- >0;)s=r[a],(!i||i(s,e,t))&&!o[s]&&(t[s]=e[s],o[s]=!0);e=!1!==n&&id(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype)return t},kindOf:im,kindOfTest:ip,endsWith:function(e,t,n){e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;var i=e.indexOf(t,n);return -1!==i&&i===n},toArray:function(e){if(!e)return null;if(iE(e))return e;var t=e.length;if(!iA(t))return null;for(var n=Array(t);t-- >0;)n[t]=e[t];return n},forEachEntry:function(e,t){for(var n,i=(e&&e[iv]).call(e);(n=i.next())&&!n.done;){var r=n.value;t.call(e,r[0],r[1])}},matchAll:function(e,t){for(var n,i=[];null!==(n=e.exec(t));)i.push(n);return i},isHTMLForm:iH,hasOwnProperty:iV,hasOwnProp:iV,reduceDescriptors:iY,freezeMethods:function(e){iY(e,function(t,n){if(i_(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;if(i_(e[n])){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=function(){throw Error("Can not rewrite read-only method '"+n+"'")})}})},toObjectSet:function(e,t){var n={};return(iE(e)?e:String(e).split(t)).forEach(function(e){n[e]=!0}),n},toCamelCase:function(e){return e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,n){return t.toUpperCase()+n})},noop:function(){},toFiniteNumber:function(e,t){return null!=e&&Number.isFinite(e*=1)?e:t},findKey:iU,global:ij,isContextDefined:iG,isSpecCompliantForm:function(e){return!!(e&&i_(e.append)&&"FormData"===e[ig]&&e[iv])},toJSONObject:function(e){var t=Array(10),n=function(e,i){if(iL(e)){if(t.indexOf(e)>=0)return;if(ib(e))return e;if(!("toJSON"in e)){t[i]=e;var r=iE(e)?[]:{};return iB(e,function(e,t){var a=n(e,i+1);ik(a)||(r[t]=a)}),t[i]=void 0,r}}return e};return n(e,0)},isAsyncFn:iW,isThenable:function(e){return e&&(iL(e)||i_(e))&&i_(e.then)&&i_(e.catch)},setImmediate:iz,asap:iX,isIterable:function(e){return null!=e&&i_(e[iv])}},K=N("6M8s5"),H=N("8ro5P"),X=N("l9etm"),Q=N("16gB1");function i$(e,t,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}iQ.inherits(i$,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:iQ.toJSONObject(this.config),code:this.code,status:this.status}}});var iZ=i$.prototype,iJ={};"use strict";"use strict";["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(function(e){iJ[e]={value:e}}),Object.defineProperties(i$,iJ),Object.defineProperty(iZ,"isAxiosError",{value:!0}),i$.from=function(e,t,n,i,r,a){var s=Object.create(iZ);iQ.toFlatObject(e,s,function(e){return e!==Error.prototype},function(e){return"isAxiosError"!==e});var o=e&&e.message?e.message:"Error",l=null==t&&e?e.code:t;return i$.call(s,o,l,n,i,r),e&&null==s.cause&&Object.defineProperty(s,"cause",{value:e,configurable:!0}),s.name=e&&e.name||"Error",a&&Object.assign(s,a),s};var G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),Q=N("16gB1");R=function(e){for(var t,n=e.length,i=n%3,r=[],a=0,s=n-i;a<s;a+=16383)r.push(function(e,t,n){for(var i,r=[],a=t;a<n;a+=3)i=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),r.push(i0[i>>18&63]+i0[i>>12&63]+i0[i>>6&63]+i0[63&i]);return r.join("")}(e,a,a+16383>s?s:a+16383));return 1===i?r.push(i0[(t=e[n-1])>>2]+i0[t<<4&63]+"=="):2===i&&r.push(i0[(t=(e[n-2]<<8)+e[n-1])>>10]+i0[t>>4&63]+i0[t<<2&63]+"="),r.join("")};for(var i0=[],i1=[],i2="undefined"!=typeof Uint8Array?Uint8Array:Array,i3="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i5=0,i4=i3.length;i5<i4;++i5)i0[i5]=i3[i5],i1[i3.charCodeAt(i5)]=i5;function i8(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var i=n===t?0:4-n%4;return[n,i]}i1[45]=62,i1[95]=63,D=function(e,t,n,i,r){var a,s,o=8*r-i-1,l=(1<<o)-1,u=l>>1,c=-7,h=n?r-1:0,d=n?-1:1,f=e[t+h];for(h+=d,a=f&(1<<-c)-1,f>>=-c,c+=o;c>0;a=256*a+e[t+h],h+=d,c-=8);for(s=a&(1<<-c)-1,a>>=-c,c+=i;c>0;s=256*s+e[t+h],h+=d,c-=8);if(0===a)a=1-u;else{if(a===l)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,i),a-=u}return(f?-1:1)*s*Math.pow(2,a-i)},C=function(e,t,n,i,r,a){var s,o,l,u=8*a-r-1,c=(1<<u)-1,h=c>>1,d=5960464477539062e-23*(23===r),f=i?0:a-1,v=i?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),s+h>=1?t+=d/l:t+=d*Math.pow(2,1-h),t*l>=2&&(s++,l/=2),s+h>=c?(o=0,s=c):s+h>=1?(o=(t*l-1)*Math.pow(2,r),s+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;e[n+f]=255&o,f+=v,o/=256,r-=8);for(s=s<<r|o,u+=r;u>0;e[n+f]=255&s,f+=v,s/=256,u-=8);e[n+f-v]|=128*g};var i6="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function i9(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,i7.prototype),t}function i7(e,t,n){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return rn(e)}return re(e,t,n)}function re(e,t,n){if("string"==typeof e){var i=e,r=t;if(("string"!=typeof r||""===r)&&(r="utf8"),!i7.isEncoding(r))throw TypeError("Unknown encoding: "+r);var a=0|rs(i,r),s=i9(a),o=s.write(i,r);return o!==a&&(s=s.slice(0,o)),s}if(ArrayBuffer.isView(e)){var l=e;if(rR(l,Uint8Array)){var u=new Uint8Array(l);return rr(u.buffer,u.byteOffset,u.byteLength)}return ri(l)}if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+(void 0===e?"undefined":(0,Q._)(e)));if(rR(e,ArrayBuffer)||e&&rR(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(rR(e,SharedArrayBuffer)||e&&rR(e.buffer,SharedArrayBuffer)))return rr(e,t,n);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var c=e.valueOf&&e.valueOf();if(null!=c&&c!==e)return i7.from(c,t,n);var h=function(e){if(i7.isBuffer(e)){var t=0|ra(e.length),n=i9(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?i9(0):ri(e):"Buffer"===e.type&&Array.isArray(e.data)?ri(e.data):void 0}(e);if(h)return h;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return i7.from(e[Symbol.toPrimitive]("string"),t,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+(void 0===e?"undefined":(0,Q._)(e)))}function rt(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function rn(e){return rt(e),i9(e<0?0:0|ra(e))}function ri(e){for(var t=e.length<0?0:0|ra(e.length),n=i9(t),i=0;i<t;i+=1)n[i]=255&e[i];return n}function rr(e,t,n){var i;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(i=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),i7.prototype),i}function ra(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}i7.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),i7.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(i7.prototype,"parent",{enumerable:!0,get:function(){if(i7.isBuffer(this))return this.buffer}}),Object.defineProperty(i7.prototype,"offset",{enumerable:!0,get:function(){if(i7.isBuffer(this))return this.byteOffset}}),i7.poolSize=8192,i7.from=function(e,t,n){return re(e,t,n)},Object.setPrototypeOf(i7.prototype,Uint8Array.prototype),Object.setPrototypeOf(i7,Uint8Array),i7.alloc=function(e,t,n){return(rt(e),e<=0)?i9(e):void 0!==t?"string"==typeof n?i9(e).fill(t,n):i9(e).fill(t):i9(e)},i7.allocUnsafe=function(e){return rn(e)},i7.allocUnsafeSlow=function(e){return rn(e)};function rs(e,t){if(i7.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||rR(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+(void 0===e?"undefined":(0,Q._)(e)));var n=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return rL(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return rw(e).length;default:if(r)return i?-1:rL(e).length;t=(""+t).toLowerCase(),r=!0}}function ro(e,t,n){var i,r,a,s=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",a=t;a<n;++a)r+=rD[e[a]];return r}(this,t,n);case"utf8":case"utf-8":return rh(this,t,n);case"ascii":return function(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}(this,t,n);case"latin1":case"binary":return function(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}(this,t,n);case"base64":return i=this,r=t,a=n,0===r&&a===i.length?R(i):R(i.slice(r,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,n){for(var i=e.slice(t,n),r="",a=0;a<i.length-1;a+=2)r+=String.fromCharCode(i[a]+256*i[a+1]);return r}(this,t,n);default:if(s)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),s=!0}}function rl(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function ru(e,t,n,i,r){var a;if(0===e.length)return -1;if("string"==typeof n?(i=n,n=0):n>0x7fffffff?n=0x7fffffff:n<-0x80000000&&(n=-0x80000000),(a=n*=1)!=a&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length)if(r)return -1;else n=e.length-1;else if(n<0)if(!r)return -1;else n=0;if("string"==typeof t&&(t=i7.from(t,i)),i7.isBuffer(t))return 0===t.length?-1:rc(e,t,n,i,r);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(r)return Uint8Array.prototype.indexOf.call(e,t,n);else return Uint8Array.prototype.lastIndexOf.call(e,t,n);return rc(e,[t],n,i,r)}throw TypeError("val must be string, number or Buffer")}function rc(e,t,n,i,r){var a,s=1,o=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return -1;s=2,o/=2,l/=2,n/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(r){var c=-1;for(a=n;a<o;a++)if(u(e,a)===u(t,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===l)return c*s}else -1!==c&&(a-=a-c),c=-1}else for(n+l>o&&(n=o-l),a=n;a>=0;a--){for(var h=!0,d=0;d<l;d++)if(u(e,a+d)!==u(t,d)){h=!1;break}if(h)return a}return -1}function rh(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var a=e[r],s=null,o=a>239?4:a>223?3:a>191?2:1;if(r+o<=n){var l=void 0,u=void 0,c=void 0,h=void 0;switch(o){case 1:a<128&&(s=a);break;case 2:(192&(l=e[r+1]))==128&&(h=(31&a)<<6|63&l)>127&&(s=h);break;case 3:l=e[r+1],u=e[r+2],(192&l)==128&&(192&u)==128&&(h=(15&a)<<12|(63&l)<<6|63&u)>2047&&(h<55296||h>57343)&&(s=h);break;case 4:l=e[r+1],u=e[r+2],c=e[r+3],(192&l)==128&&(192&u)==128&&(192&c)==128&&(h=(15&a)<<18|(63&l)<<12|(63&u)<<6|63&c)>65535&&h<1114112&&(s=h)}}null===s?(s=65533,o=1):s>65535&&(s-=65536,i.push(s>>>10&1023|55296),s=56320|1023&s),i.push(s),r+=o}var d=i,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var v="",g=0;g<f;)v+=String.fromCharCode.apply(String,d.slice(g,g+=4096));return v}function rd(e,t,n){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>n)throw RangeError("Trying to access beyond buffer length")}function rf(e,t,n,i,r,a){if(!i7.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<a)throw RangeError('"value" argument is out of bounds');if(n+i>e.length)throw RangeError("Index out of range")}function rv(e,t,n,i,r){rT(t,i,r,e,n,7);var a=Number(t&BigInt(0xffffffff));e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a;var s=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,n}function rg(e,t,n,i,r){rT(t,i,r,e,n,7);var a=Number(t&BigInt(0xffffffff));e[n+7]=a,a>>=8,e[n+6]=a,a>>=8,e[n+5]=a,a>>=8,e[n+4]=a;var s=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[n+3]=s,s>>=8,e[n+2]=s,s>>=8,e[n+1]=s,s>>=8,e[n]=s,n+8}function rm(e,t,n,i,r,a){if(n+i>e.length||n<0)throw RangeError("Index out of range")}function rp(e,t,n,i,r){return t*=1,n>>>=0,r||rm(e,t,n,4,34028234663852886e22,-34028234663852886e22),C(e,t,n,i,23,4),n+4}function ry(e,t,n,i,r){return t*=1,n>>>=0,r||rm(e,t,n,8,17976931348623157e292,-17976931348623157e292),C(e,t,n,i,52,8),n+8}i7.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==i7.prototype},i7.compare=function(e,t){if(rR(e,Uint8Array)&&(e=i7.from(e,e.offset,e.byteLength)),rR(t,Uint8Array)&&(t=i7.from(t,t.offset,t.byteLength)),!i7.isBuffer(e)||!i7.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,i=t.length,r=0,a=Math.min(n,i);r<a;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:+(i<n)},i7.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i7.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return i7.alloc(0);if(void 0===t)for(n=0,t=0;n<e.length;++n)t+=e[n].length;var n,i=i7.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var a=e[n];if(rR(a,Uint8Array))r+a.length>i.length?(i7.isBuffer(a)||(a=i7.from(a)),a.copy(i,r)):Uint8Array.prototype.set.call(i,a,r);else if(i7.isBuffer(a))a.copy(i,r);else throw TypeError('"list" argument must be an Array of Buffers');r+=a.length}return i},i7.byteLength=rs,i7.prototype._isBuffer=!0,i7.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)rl(this,t,t+1);return this},i7.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)rl(this,t,t+3),rl(this,t+1,t+2);return this},i7.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)rl(this,t,t+7),rl(this,t+1,t+6),rl(this,t+2,t+5),rl(this,t+3,t+4);return this},i7.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?rh(this,0,e):ro.apply(this,arguments)},i7.prototype.toLocaleString=i7.prototype.toString,i7.prototype.equals=function(e){if(!i7.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===i7.compare(this,e)},i7.prototype.inspect=function(){var e="";return e=this.toString("hex",0,50).replace(/(.{2})/g,"$1 ").trim(),this.length>50&&(e+=" ... "),"<Buffer "+e+">"},i6&&(i7.prototype[i6]=i7.prototype.inspect),i7.prototype.compare=function(e,t,n,i,r){if(rR(e,Uint8Array)&&(e=i7.from(e,e.offset,e.byteLength)),!i7.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+(void 0===e?"undefined":(0,Q._)(e)));if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return -1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,r>>>=0,this===e)return 0;for(var a=r-i,s=n-t,o=Math.min(a,s),l=this.slice(i,r),u=e.slice(t,n),c=0;c<o;++c)if(l[c]!==u[c]){a=l[c],s=u[c];break}return a<s?-1:+(s<a)},i7.prototype.includes=function(e,t,n){return -1!==this.indexOf(e,t,n)},i7.prototype.indexOf=function(e,t,n){return ru(this,e,t,n,!0)},i7.prototype.lastIndexOf=function(e,t,n){return ru(this,e,t,n,!1)},i7.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(n)?(n>>>=0,void 0===i&&(i="utf8")):(i=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var r,a,s,o,l,u,c,h,d=this.length-t;if((void 0===n||n>d)&&(n=d),e.length>0&&(n<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var f=!1;;)switch(i){case"hex":return function(e,t,n,i){n=Number(n)||0;var r,a=e.length-n;i?(i=Number(i))>a&&(i=a):i=a;var s=t.length;for(i>s/2&&(i=s/2),r=0;r<i;++r){var o,l=parseInt(t.substr(2*r,2),16);if((o=l)!=o)break;e[n+r]=l}return r}(this,e,t,n);case"utf8":case"utf-8":return r=t,a=n,rI(rL(e,this.length-r),this,r,a);case"ascii":case"latin1":case"binary":return s=t,o=n,rI(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(e),this,s,o);case"base64":return l=t,u=n,rI(rw(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c=t,h=n,rI(function(e,t){for(var n,i,r=[],a=0;a<e.length&&!((t-=2)<0);++a)i=(n=e.charCodeAt(a))>>8,r.push(n%256),r.push(i);return r}(e,this.length-c),this,c,h);default:if(f)throw TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),f=!0}},i7.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},i7.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var i=this.subarray(e,t);return Object.setPrototypeOf(i,i7.prototype),i},i7.prototype.readUintLE=i7.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||rd(e,t,this.length);for(var i=this[e],r=1,a=0;++a<t&&(r*=256);)i+=this[e+a]*r;return i},i7.prototype.readUintBE=i7.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||rd(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},i7.prototype.readUint8=i7.prototype.readUInt8=function(e,t){return e>>>=0,t||rd(e,1,this.length),this[e]},i7.prototype.readUint16LE=i7.prototype.readUInt16LE=function(e,t){return e>>>=0,t||rd(e,2,this.length),this[e]|this[e+1]<<8},i7.prototype.readUint16BE=i7.prototype.readUInt16BE=function(e,t){return e>>>=0,t||rd(e,2,this.length),this[e]<<8|this[e+1]},i7.prototype.readUint32LE=i7.prototype.readUInt32LE=function(e,t){return e>>>=0,t||rd(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},i7.prototype.readUint32BE=i7.prototype.readUInt32BE=function(e,t){return e>>>=0,t||rd(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},i7.prototype.readBigUInt64LE=rC(function(e){rS(e>>>=0,"offset");var t=this[e],n=this[e+7];(void 0===t||void 0===n)&&r_(e,this.length-8);var i=t+256*this[++e]+65536*this[++e]+0x1000000*this[++e],r=this[++e]+256*this[++e]+65536*this[++e]+0x1000000*n;return BigInt(i)+(BigInt(r)<<BigInt(32))}),i7.prototype.readBigUInt64BE=rC(function(e){rS(e>>>=0,"offset");var t=this[e],n=this[e+7];(void 0===t||void 0===n)&&r_(e,this.length-8);var i=0x1000000*t+65536*this[++e]+256*this[++e]+this[++e],r=0x1000000*this[++e]+65536*this[++e]+256*this[++e]+n;return(BigInt(i)<<BigInt(32))+BigInt(r)}),i7.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||rd(e,t,this.length);for(var i=this[e],r=1,a=0;++a<t&&(r*=256);)i+=this[e+a]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},i7.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||rd(e,t,this.length);for(var i=t,r=1,a=this[e+--i];i>0&&(r*=256);)a+=this[e+--i]*r;return a>=(r*=128)&&(a-=Math.pow(2,8*t)),a},i7.prototype.readInt8=function(e,t){return(e>>>=0,t||rd(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},i7.prototype.readInt16LE=function(e,t){e>>>=0,t||rd(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?0xffff0000|n:n},i7.prototype.readInt16BE=function(e,t){e>>>=0,t||rd(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?0xffff0000|n:n},i7.prototype.readInt32LE=function(e,t){return e>>>=0,t||rd(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},i7.prototype.readInt32BE=function(e,t){return e>>>=0,t||rd(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},i7.prototype.readBigInt64LE=rC(function(e){rS(e>>>=0,"offset");var t=this[e],n=this[e+7];return(void 0===t||void 0===n)&&r_(e,this.length-8),(BigInt(this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24))<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+0x1000000*this[++e])}),i7.prototype.readBigInt64BE=rC(function(e){rS(e>>>=0,"offset");var t=this[e],n=this[e+7];return(void 0===t||void 0===n)&&r_(e,this.length-8),(BigInt((t<<24)+65536*this[++e]+256*this[++e]+this[++e])<<BigInt(32))+BigInt(0x1000000*this[++e]+65536*this[++e]+256*this[++e]+n)}),i7.prototype.readFloatLE=function(e,t){return e>>>=0,t||rd(e,4,this.length),D(this,e,!0,23,4)},i7.prototype.readFloatBE=function(e,t){return e>>>=0,t||rd(e,4,this.length),D(this,e,!1,23,4)},i7.prototype.readDoubleLE=function(e,t){return e>>>=0,t||rd(e,8,this.length),D(this,e,!0,52,8)},i7.prototype.readDoubleBE=function(e,t){return e>>>=0,t||rd(e,8,this.length),D(this,e,!1,52,8)},i7.prototype.writeUintLE=i7.prototype.writeUIntLE=function(e,t,n,i){if(e*=1,t>>>=0,n>>>=0,!i){var r=Math.pow(2,8*n)-1;rf(this,e,t,n,r,0)}var a=1,s=0;for(this[t]=255&e;++s<n&&(a*=256);)this[t+s]=e/a&255;return t+n},i7.prototype.writeUintBE=i7.prototype.writeUIntBE=function(e,t,n,i){if(e*=1,t>>>=0,n>>>=0,!i){var r=Math.pow(2,8*n)-1;rf(this,e,t,n,r,0)}var a=n-1,s=1;for(this[t+a]=255&e;--a>=0&&(s*=256);)this[t+a]=e/s&255;return t+n},i7.prototype.writeUint8=i7.prototype.writeUInt8=function(e,t,n){return e*=1,t>>>=0,n||rf(this,e,t,1,255,0),this[t]=255&e,t+1},i7.prototype.writeUint16LE=i7.prototype.writeUInt16LE=function(e,t,n){return e*=1,t>>>=0,n||rf(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},i7.prototype.writeUint16BE=i7.prototype.writeUInt16BE=function(e,t,n){return e*=1,t>>>=0,n||rf(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},i7.prototype.writeUint32LE=i7.prototype.writeUInt32LE=function(e,t,n){return e*=1,t>>>=0,n||rf(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},i7.prototype.writeUint32BE=i7.prototype.writeUInt32BE=function(e,t,n){return e*=1,t>>>=0,n||rf(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},i7.prototype.writeBigUInt64LE=rC(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return rv(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),i7.prototype.writeBigUInt64BE=rC(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return rg(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),i7.prototype.writeIntLE=function(e,t,n,i){if(e*=1,t>>>=0,!i){var r=Math.pow(2,8*n-1);rf(this,e,t,n,r-1,-r)}var a=0,s=1,o=0;for(this[t]=255&e;++a<n&&(s*=256);)e<0&&0===o&&0!==this[t+a-1]&&(o=1),this[t+a]=(e/s|0)-o&255;return t+n},i7.prototype.writeIntBE=function(e,t,n,i){if(e*=1,t>>>=0,!i){var r=Math.pow(2,8*n-1);rf(this,e,t,n,r-1,-r)}var a=n-1,s=1,o=0;for(this[t+a]=255&e;--a>=0&&(s*=256);)e<0&&0===o&&0!==this[t+a+1]&&(o=1),this[t+a]=(e/s|0)-o&255;return t+n},i7.prototype.writeInt8=function(e,t,n){return e*=1,t>>>=0,n||rf(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},i7.prototype.writeInt16LE=function(e,t,n){return e*=1,t>>>=0,n||rf(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},i7.prototype.writeInt16BE=function(e,t,n){return e*=1,t>>>=0,n||rf(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},i7.prototype.writeInt32LE=function(e,t,n){return e*=1,t>>>=0,n||rf(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},i7.prototype.writeInt32BE=function(e,t,n){return e*=1,t>>>=0,n||rf(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},i7.prototype.writeBigInt64LE=rC(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return rv(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),i7.prototype.writeBigInt64BE=rC(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return rg(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),i7.prototype.writeFloatLE=function(e,t,n){return rp(this,e,t,!0,n)},i7.prototype.writeFloatBE=function(e,t,n){return rp(this,e,t,!1,n)},i7.prototype.writeDoubleLE=function(e,t,n){return ry(this,e,t,!0,n)},i7.prototype.writeDoubleBE=function(e,t,n){return ry(this,e,t,!1,n)},i7.prototype.copy=function(e,t,n,i){if(!i7.isBuffer(e))throw TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(i<0)throw RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r=i-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),t),r},i7.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw TypeError("encoding must be a string");if("string"==typeof i&&!i7.isEncoding(i))throw TypeError("Unknown encoding: "+i);if(1===e.length){var r,a=e.charCodeAt(0);("utf8"===i&&a<128||"latin1"===i)&&(e=a)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw RangeError("Out of range index");if(n<=t)return this;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(r=t;r<n;++r)this[r]=e;else{var s=i7.isBuffer(e)?e:i7.from(e,i),o=s.length;if(0===o)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(r=0;r<n-t;++r)this[r+t]=s[r%o]}return this};var rE={};function rk(e,t,n){rE[e]=function(n){function i(){var n;return(0,K._)(this,i),Object.defineProperty(n=(0,G._)(this,i),"message",{value:t.apply(n,arguments),writable:!0,configurable:!0}),n.name="".concat(n.name," [").concat(e,"]"),n.stack,delete n.name,n}return(0,W._)(i,n),(0,H._)(i,[{key:"code",get:function(){return e},set:function(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}},{key:"toString",value:function(){return"".concat(this.name," [").concat(e,"]: ").concat(this.message)}}]),i}(n)}function rb(e){for(var t="",n=e.length,i=+("-"===e[0]);n>=i+4;n-=3)t="_".concat(e.slice(n-3,n)).concat(t);return"".concat(e.slice(0,n)).concat(t)}function rT(e,t,n,i,r,a){if(e>n||e<t){var s,o=(void 0===t?"undefined":(0,Q._)(t))==="bigint"?"n":"";throw s=a>3?0===t||t===BigInt(0)?">= 0".concat(o," and < 2").concat(o," ** ").concat((a+1)*8).concat(o):">= -(2".concat(o," ** ").concat((a+1)*8-1).concat(o,") and < 2 ** ")+"".concat((a+1)*8-1).concat(o):">= ".concat(t).concat(o," and <= ").concat(n).concat(o),new rE.ERR_OUT_OF_RANGE("value",s,e)}rS(r,"offset"),(void 0===i[r]||void 0===i[r+a])&&r_(r,i.length-(a+1))}function rS(e,t){if("number"!=typeof e)throw new rE.ERR_INVALID_ARG_TYPE(t,"number",e)}function r_(e,t,n){if(Math.floor(e)!==e)throw rS(e,n),new rE.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new rE.ERR_BUFFER_OUT_OF_BOUNDS;throw new rE.ERR_OUT_OF_RANGE(n||"offset",">= ".concat(+!!n," and <= ").concat(t),e)}rk("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?"".concat(e," is outside of buffer bounds"):"Attempt to access memory outside buffer bounds"},RangeError),rk("ERR_INVALID_ARG_TYPE",function(e,t){return'The "'.concat(e,'" argument must be of type number. Received type ').concat(void 0===t?"undefined":(0,Q._)(t))},TypeError),rk("ERR_OUT_OF_RANGE",function(e,t,n){var i='The value of "'.concat(e,'" is out of range.'),r=n;return Number.isInteger(n)&&Math.abs(n)>0x100000000?r=rb(String(n)):(void 0===n?"undefined":(0,Q._)(n))==="bigint"&&(r=String(n),(n>Math.pow(BigInt(2),BigInt(32))||n<-Math.pow(BigInt(2),BigInt(32)))&&(r=rb(r)),r+="n"),i+=" It must be ".concat(t,". Received ").concat(r)},RangeError);var rA=/[^+/0-9A-Za-z-_]/g;function rL(e,t){t=t||1/0;for(var n,i=e.length,r=null,a=[],s=0;s<i;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!r){if(n>56319||s+1===i){(t-=3)>-1&&a.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),r=n;continue}n=(r-55296<<10|n-56320)+65536}else r&&(t-=3)>-1&&a.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return a}function rw(e){return function(e){var t,n,i=i8(e),r=i[0],a=i[1],s=new i2((r+a)*3/4-a),o=0,l=a>0?r-4:r;for(n=0;n<l;n+=4)t=i1[e.charCodeAt(n)]<<18|i1[e.charCodeAt(n+1)]<<12|i1[e.charCodeAt(n+2)]<<6|i1[e.charCodeAt(n+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=255&t;return 2===a&&(t=i1[e.charCodeAt(n)]<<2|i1[e.charCodeAt(n+1)]>>4,s[o++]=255&t),1===a&&(t=i1[e.charCodeAt(n)]<<10|i1[e.charCodeAt(n+1)]<<4|i1[e.charCodeAt(n+2)]>>2,s[o++]=t>>8&255,s[o++]=255&t),s}(function(e){if((e=(e=e.split("=")[0]).trim().replace(rA,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function rI(e,t,n,i){var r;for(r=0;r<i&&!(r+n>=t.length)&&!(r>=e.length);++r)t[r+n]=e[r];return r}function rR(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var rD=function(){for(var e="0123456789abcdef",t=Array(256),n=0;n<16;++n)for(var i=16*n,r=0;r<16;++r)t[i+r]=e[n]+e[r];return t}();function rC(e){return"undefined"==typeof BigInt?rx:e}function rx(){throw Error("BigInt not supported")}"use strict";function rP(e){return iQ.isPlainObject(e)||iQ.isArray(e)}function rO(e){return iQ.endsWith(e,"[]")?e.slice(0,-2):e}function rM(e,t,n){return e?e.concat(t).map(function(e,t){return e=rO(e),!n&&t?"["+e+"]":e}).join(n?".":""):t}"use strict";var rF=iQ.toFlatObject(iQ,{},null,function(e){return/^is[A-Z]/.test(e)}),rN=function(e,t,n){if(!iQ.isObject(e))throw TypeError("target must be an object");t=t||new FormData;var i=(n=iQ.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!iQ.isUndefined(t[e])})).metaTokens,r=n.visitor||u,a=n.dots,s=n.indexes,o=(n.Blob||"undefined"!=typeof Blob&&Blob)&&iQ.isSpecCompliantForm(t);if(!iQ.isFunction(r))throw TypeError("visitor must be a function");function l(e){if(null===e)return"";if(iQ.isDate(e))return e.toISOString();if(iQ.isBoolean(e))return e.toString();if(!o&&iQ.isBlob(e))throw new i$("Blob is not supported. Use a Buffer instead.");return iQ.isArrayBuffer(e)||iQ.isTypedArray(e)?o&&"function"==typeof Blob?new Blob([e]):i7.from(e):e}function u(e,n,r){var o,u=e;if(e&&!r&&(void 0===e?"undefined":(0,Q._)(e))==="object"){if(iQ.endsWith(n,"{}"))n=i?n:n.slice(0,-2),e=JSON.stringify(e);else if(iQ.isArray(e)&&(o=e,iQ.isArray(o)&&!o.some(rP))||(iQ.isFileList(e)||iQ.endsWith(n,"[]"))&&(u=iQ.toArray(e)))return n=rO(n),u.forEach(function(e,i){iQ.isUndefined(e)||null===e||t.append(!0===s?rM([n],i,a):null===s?n:n+"[]",l(e))}),!1}return!!rP(e)||(t.append(rM(r,n,a),l(e)),!1)}var c=[],h=Object.assign(rF,{defaultVisitor:u,convertValue:l,isVisitable:rP});if(!iQ.isObject(e))throw TypeError("data must be an object");return!function e(n,i){if(!iQ.isUndefined(n)){if(-1!==c.indexOf(n))throw Error("Circular reference detected in "+i.join("."));c.push(n),iQ.forEach(n,function(n,a){!0===(!(iQ.isUndefined(n)||null===n)&&r.call(t,n,iQ.isString(a)?a.trim():a,i,h))&&e(n,i?i.concat(a):[a])}),c.pop()}}(e),t};function rB(e){var t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function rU(e,t){this._pairs=[],e&&rN(e,this,t)}var rj=rU.prototype;"use strict";function rG(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function rK(e,t,n){if(!t)return e;var i,r=n&&n.encode||rG;iQ.isFunction(n)&&(n={serialize:n});var a=n&&n.serialize;if(i=a?a(t,n):iQ.isURLSearchParams(t)?t.toString():new rU(t,n).toString(r)){var s=e.indexOf("#");-1!==s&&(e=e.slice(0,s)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}"use strict";"use strict";rj.append=function(e,t){this._pairs.push([e,t])},rj.toString=function(e){var t=e?function(t){return e.call(this,t,rB)}:rB;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};var K=N("6M8s5"),H=N("8ro5P"),rH=function(){function e(){(0,K._)(this,e),this.handlers=[]}return(0,H._)(e,[{key:"use",value:function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}},{key:"eject",value:function(e){this.handlers[e]&&(this.handlers[e]=null)}},{key:"clear",value:function(){this.handlers&&(this.handlers=[])}},{key:"forEach",value:function(e){iQ.forEach(this.handlers,function(t){null!==t&&e(t)})}}]),e}(),rV={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},V=N("eh14X");function rq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){(0,V._)(e,t,n[t])})}return e}"use strict";"use strict";"use strict";var rY="undefined"!=typeof URLSearchParams?URLSearchParams:rU,rW="undefined"!=typeof FormData?FormData:null,rz="undefined"!=typeof Blob?Blob:null,rX={};"use strict";"use strict";"use strict";e(rX,"hasBrowserEnv",function(){return rQ}),e(rX,"navigator",function(){return r$}),e(rX,"hasStandardBrowserEnv",function(){return rZ}),e(rX,"hasStandardBrowserWebWorkerEnv",function(){return rJ}),e(rX,"origin",function(){return r0});var Q=N("16gB1"),rQ="undefined"!=typeof window&&"undefined"!=typeof document,r$=("undefined"==typeof navigator?"undefined":(0,Q._)(navigator))==="object"&&navigator||void 0,rZ=rQ&&(!r$||0>["ReactNative","NativeScript","NS"].indexOf(r$.product)),rJ="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,r0=rQ&&window.location.href||"http://localhost",r1=rq({},rX,{isBrowser:!0,classes:{URLSearchParams:rY,FormData:rW,Blob:rz},protocols:["http","https","file","blob","url","data"]}),r2=function(e){if(iQ.isFormData(e)&&iQ.isFunction(e.entries)){var t={};return iQ.forEachEntry(e,function(e,n){!function e(t,n,i,r){var a=t[r++];if("__proto__"===a)return!0;var s=Number.isFinite(+a),o=r>=t.length;return(a=!a&&iQ.isArray(i)?i.length:a,o)?iQ.hasOwnProp(i,a)?i[a]=[i[a],n]:i[a]=n:(i[a]&&iQ.isObject(i[a])||(i[a]=[]),e(t,n,i[a],r)&&iQ.isArray(i[a])&&(i[a]=function(e){var t,n,i={},r=Object.keys(e),a=r.length;for(t=0;t<a;t++)i[n=r[t]]=e[n];return i}(i[a]))),!s}(iQ.matchAll(/\w+|\[(\w*)]/g,e).map(function(e){return"[]"===e[0]?"":e[1]||e[0]}),n,t,0)}),t}return null},r3={transitional:rV,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){var n,i=t.getContentType()||"",r=i.indexOf("application/json")>-1,a=iQ.isObject(e);if(a&&iQ.isHTMLForm(e)&&(e=new FormData(e)),iQ.isFormData(e))return r?JSON.stringify(r2(e)):e;if(iQ.isArrayBuffer(e)||iQ.isBuffer(e)||iQ.isStream(e)||iQ.isFile(e)||iQ.isBlob(e)||iQ.isReadableStream(e))return e;if(iQ.isArrayBufferView(e))return e.buffer;if(iQ.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();if(a){if(i.indexOf("application/x-www-form-urlencoded")>-1)return(o=e,l=this.formSerializer,rN(o,new r1.classes.URLSearchParams,rq({visitor:function(e,t,n,i){return r1.isNode&&iQ.isBuffer(e)?(this.append(t,e.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},l))).toString();if((n=iQ.isFileList(e))||i.indexOf("multipart/form-data")>-1){var s=this.env&&this.env.FormData;return rN(n?{"files[]":e}:e,s&&new s,this.formSerializer)}}if(a||r){t.setContentType("application/json",!1);var o,l,u=e;if(iQ.isString(u))try{return(0,JSON.parse)(u),iQ.trim(u)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(u)}return e}],transformResponse:[function(e){var t=this.transitional||r3.transitional,n=t&&t.forcedJSONParsing,i="json"===this.responseType;if(iQ.isResponse(e)||iQ.isReadableStream(e))return e;if(e&&iQ.isString(e)&&(n&&!this.responseType||i)){var r=t&&t.silentJSONParsing;try{return JSON.parse(e,this.parseReviver)}catch(e){if(!r&&i){if("SyntaxError"===e.name)throw i$.from(e,i$.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:r1.classes.FormData,Blob:r1.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};"use strict";"use strict";iQ.forEach(["delete","get","head","post","put","patch"],function(e){r3.headers[e]={}});var K=N("6M8s5"),H=N("8ro5P"),z=N("1Zvtp"),X=N("l9etm"),r5=iQ.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),r4=function(e){var t,n,i,r={};return e&&e.split("\n").forEach(function(e){i=e.indexOf(":"),t=e.substring(0,i).trim().toLowerCase(),n=e.substring(i+1).trim(),!t||r[t]&&r5[t]||("set-cookie"===t?r[t]?r[t].push(n):r[t]=[n]:r[t]=r[t]?r[t]+", "+n:n)}),r},r8=Symbol("internals");function r6(e){return e&&String(e).trim().toLowerCase()}function r9(e){return!1===e||null==e?e:iQ.isArray(e)?e.map(r9):String(e)}function r7(e,t,n,i,r){if(iQ.isFunction(i))return i.call(this,t,n);if(r&&(t=n),iQ.isString(t)){if(iQ.isString(i))return -1!==t.indexOf(i);if(iQ.isRegExp(i))return i.test(t)}}var ae=function(){function e(t){(0,K._)(this,e),t&&this.set(t)}return(0,H._)(e,[{key:"set",value:function(e,t,n){var i=this;function r(e,t,n){var r=r6(t);if(!r)throw Error("header name must be a non-empty string");var a=iQ.findKey(i,r);a&&void 0!==i[a]&&!0!==n&&(void 0!==n||!1===i[a])||(i[a||t]=r9(e))}var a=function(e,t){return iQ.forEach(e,function(e,n){return r(e,n,t)})};if(iQ.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(iQ.isString(e)&&(e=e.trim())&&(s=e,!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim())))a(r4(e),t);else if(iQ.isObject(e)&&iQ.isIterable(e)){var s,o,l,u={},c=!0,h=!1,d=void 0;try{for(var f,v=e[Symbol.iterator]();!(c=(f=v.next()).done);c=!0){var g=f.value;if(!iQ.isArray(g))throw TypeError("Object iterator must return a key-value pair");u[l=g[0]]=(o=u[l])?iQ.isArray(o)?(0,X._)(o).concat([g[1]]):[o,g[1]]:g[1]}}catch(e){h=!0,d=e}finally{try{c||null==v.return||v.return()}finally{if(h)throw d}}a(u,t)}else null!=e&&r(t,e,n);return this}},{key:"get",value:function(e,t){if(e=r6(e)){var n=iQ.findKey(this,e);if(n){var i=this[n];if(!t)return i;if(!0===t){for(var r,a=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;r=s.exec(i);)a[r[1]]=r[2];return a}if(iQ.isFunction(t))return t.call(this,i,n);if(iQ.isRegExp(t))return t.exec(i);throw TypeError("parser must be boolean|regexp|function")}}}},{key:"has",value:function(e,t){if(e=r6(e)){var n=iQ.findKey(this,e);return!!(n&&void 0!==this[n]&&(!t||r7(this,this[n],n,t)))}return!1}},{key:"delete",value:function(e,t){var n=this,i=!1;function r(e){if(e=r6(e)){var r=iQ.findKey(n,e);r&&(!t||r7(n,n[r],r,t))&&(delete n[r],i=!0)}}return iQ.isArray(e)?e.forEach(r):r(e),i}},{key:"clear",value:function(e){for(var t=Object.keys(this),n=t.length,i=!1;n--;){var r=t[n];(!e||r7(this,this[r],r,e,!0))&&(delete this[r],i=!0)}return i}},{key:"normalize",value:function(e){var t=this,n={};return iQ.forEach(this,function(i,r){var a=iQ.findKey(n,r);if(a){t[a]=r9(i),delete t[r];return}var s=e?r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,function(e,t,n){return t.toUpperCase()+n}):String(r).trim();s!==r&&delete t[r],t[s]=r9(i),n[s]=!0}),this}},{key:"concat",value:function(){for(var e,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=this.constructor).concat.apply(e,[this].concat((0,X._)(n)))}},{key:"toJSON",value:function(e){var t=Object.create(null);return iQ.forEach(this,function(n,i){null!=n&&!1!==n&&(t[i]=e&&iQ.isArray(n)?n.join(", "):n)}),t}},{key:Symbol.iterator,value:function(){return Object.entries(this.toJSON())[Symbol.iterator]()}},{key:"toString",value:function(){return Object.entries(this.toJSON()).map(function(e){var t=(0,z._)(e,2);return t[0]+": "+t[1]}).join("\n")}},{key:"getSetCookie",value:function(){return this.get("set-cookie")||[]}},{key:Symbol.toStringTag,get:function(){return"AxiosHeaders"}}],[{key:"from",value:function(e){return e instanceof this?e:new this(e)}},{key:"concat",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var r=new this(e);return n.forEach(function(e){return r.set(e)}),r}},{key:"accessor",value:function(e){var t=(this[r8]=this[r8]={accessors:{}}).accessors,n=this.prototype;function i(e){var i,r=r6(e);t[r]||(i=iQ.toCamelCase(" "+e),["get","set","has"].forEach(function(t){Object.defineProperty(n,t+i,{value:function(n,i,r){return this[t].call(this,e,n,i,r)},configurable:!0})}),t[r]=!0)}return iQ.isArray(e)?e.forEach(i):i(e),this}}]),e}();"use strict";function at(e,t){var n=this||r3,i=t||n,r=ae.from(i.headers),a=i.data;return iQ.forEach(e,function(e){a=e.call(n,a,r.normalize(),t?t.status:void 0)}),r.normalize(),a}"use strict";function an(e){return!!(e&&e.__CANCEL__)}"use strict";function ai(e,t,n){i$.call(this,null==e?"canceled":e,i$.ERR_CANCELED,t,n),this.name="CanceledError"}"use strict";ae.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),iQ.reduceDescriptors(ae.prototype,function(e,t){var n=e.value,i=t[0].toUpperCase()+t.slice(1);return{get:function(){return n},set:function(e){this[i]=e}}}),iQ.freezeMethods(ae),iQ.inherits(ai,i$,{__CANCEL__:!0});var z=(N("1Zvtp"),N("1Zvtp"));function ar(e,t,n){var i=n.config.validateStatus;!n.status||!i||i(n.status)?e(n):t(new i$("Request failed with status code "+n.status,[i$.ERR_BAD_REQUEST,i$.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}"use strict";"use strict";"use strict";"use strict";"use strict";var V=N("eh14X"),X=N("l9etm"),aa=function(e,t){var n,i=Array(e=e||10),r=Array(e),a=0,s=0;return t=void 0!==t?t:1e3,function(o){var l=Date.now(),u=r[s];n||(n=l),i[a]=o,r[a]=l;for(var c=s,h=0;c!==a;)h+=i[c++],c%=e;if((a=(a+1)%e)===s&&(s=(s+1)%e),!(l-n<t)){var d=u&&l-u;return d?Math.round(1e3*h/d):void 0}}},X=N("l9etm"),as=function(e,t){var n,i,r=0,a=1e3/t,s=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();r=a,n=null,i&&(clearTimeout(i),i=null),e.apply(void 0,(0,X._)(t))};return[function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];var l=Date.now(),u=l-r;u>=a?s(t,l):(n=t,i||(i=setTimeout(function(){i=null,s(n)},a-u)))},function(){return n&&s(n)}]},ao=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,i=0,r=aa(50,250);return as(function(n){var a=n.loaded,s=n.lengthComputable?n.total:void 0,o=a-i,l=r(o),u=a<=s;i=a,e((0,V._)({loaded:a,total:s,progress:s?a/s:void 0,bytes:o,rate:l||void 0,estimated:l&&s&&u?(s-a)/l:void 0,event:n,lengthComputable:null!=s},t?"download":"upload",!0))},n)},al=function(e,t){var n=null!=e;return[function(i){return t[0]({lengthComputable:n,total:e,loaded:i})},t[1]]},au=function(e){return function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return iQ.asap(function(){return e.apply(void 0,(0,X._)(n))})}},z=N("1Zvtp"),ac=r1.hasStandardBrowserEnv?(y=new URL(r1.origin),E=r1.navigator&&/(msie|trident)/i.test(r1.navigator.userAgent),function(e){return e=new URL(e,r1.origin),y.protocol===e.protocol&&y.host===e.host&&(E||y.port===e.port)}):function(){return!0},ah=r1.hasStandardBrowserEnv?{write:function(e,t,n,i,r,a){var s=[e+"="+encodeURIComponent(t)];iQ.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),iQ.isString(i)&&s.push("path="+i),iQ.isString(r)&&s.push("domain="+r),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};function ad(e,t,n){var i=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(i||!1==n)?t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e:t}"use strict";var af=function(e){return e instanceof ae?rq({},e):e};function av(e,t){t=t||{};var n={};function i(e,t,n,i){return iQ.isPlainObject(e)&&iQ.isPlainObject(t)?iQ.merge.call({caseless:i},e,t):iQ.isPlainObject(t)?iQ.merge({},t):iQ.isArray(t)?t.slice():t}function r(e,t,n,r){return iQ.isUndefined(t)?iQ.isUndefined(e)?void 0:i(void 0,e,n,r):i(e,t,n,r)}function a(e,t){if(!iQ.isUndefined(t))return i(void 0,t)}function s(e,t){return iQ.isUndefined(t)?iQ.isUndefined(e)?void 0:i(void 0,e):i(void 0,t)}function o(n,r,a){return a in t?i(n,r):a in e?i(void 0,n):void 0}var l={url:a,method:a,data:a,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:o,headers:function(e,t,n){return r(af(e),af(t),n,!0)}};return iQ.forEach(Object.keys(rq({},e,t)),function(i){var a=l[i]||r,s=a(e[i],t[i],i);iQ.isUndefined(s)&&a!==o||(n[i]=s)}),n}var ag=function(e){var t=av({},e),n=t.data,i=t.withXSRFToken,r=t.xsrfHeaderName,a=t.xsrfCookieName,s=t.headers,o=t.auth;if(t.headers=s=ae.from(s),t.url=rK(ad(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),o&&s.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):""))),iQ.isFormData(n)){if(r1.hasStandardBrowserEnv||r1.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(iQ.isFunction(n.getHeaders)){var l=n.getHeaders(),u=["content-type","content-length"];Object.entries(l).forEach(function(e){var t=(0,z._)(e,2),n=t[0],i=t[1];u.includes(n.toLowerCase())&&s.set(n,i)})}}if(r1.hasStandardBrowserEnv&&(i&&iQ.isFunction(i)&&(i=i(t)),i||!1!==i&&ac(t.url))){var c=r&&a&&ah.read(a);c&&s.set(r,c)}return t},am="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise(function(t,n){var i,r,a,s,o,l,u,c,h,d=ag(e),f=d.data,v=ae.from(d.headers).normalize(),g=d.responseType,m=d.onUploadProgress,p=d.onDownloadProgress;function y(){l&&l(),u&&u(),d.cancelToken&&d.cancelToken.unsubscribe(a),d.signal&&d.signal.removeEventListener("abort",a)}var E=new XMLHttpRequest;function k(){if(E){var i=ae.from("getAllResponseHeaders"in E&&E.getAllResponseHeaders());ar(function(e){t(e),y()},function(e){n(e),y()},{data:g&&"text"!==g&&"json"!==g?E.response:E.responseText,status:E.status,statusText:E.statusText,headers:i,config:e,request:E}),E=null}}E.open(d.method.toUpperCase(),d.url,!0),E.timeout=d.timeout,"onloadend"in E?E.onloadend=k:E.onreadystatechange=function(){E&&4===E.readyState&&(0!==E.status||E.responseURL&&0===E.responseURL.indexOf("file:"))&&setTimeout(k)},E.onabort=function(){E&&(n(new i$("Request aborted",i$.ECONNABORTED,e,E)),E=null)},E.onerror=function(t){var i=new i$(t&&t.message?t.message:"Network Error",i$.ERR_NETWORK,e,E);i.event=t||null,n(i),E=null},E.ontimeout=function(){var t=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded",i=d.transitional||rV;d.timeoutErrorMessage&&(t=d.timeoutErrorMessage),n(new i$(t,i.clarifyTimeoutError?i$.ETIMEDOUT:i$.ECONNABORTED,e,E)),E=null},void 0===f&&v.setContentType(null),"setRequestHeader"in E&&iQ.forEach(v.toJSON(),function(e,t){E.setRequestHeader(t,e)}),iQ.isUndefined(d.withCredentials)||(E.withCredentials=!!d.withCredentials),g&&"json"!==g&&(E.responseType=d.responseType),p&&(o=(c=(0,z._)(ao(p,!0),2))[0],u=c[1],E.addEventListener("progress",o)),m&&E.upload&&(s=(h=(0,z._)(ao(m),2))[0],l=h[1],E.upload.addEventListener("progress",s),E.upload.addEventListener("loadend",l)),(d.cancelToken||d.signal)&&(a=function(t){E&&(n(!t||t.type?new ai(null,e,E):t),E.abort(),E=null)},d.cancelToken&&d.cancelToken.subscribe(a),d.signal&&(d.signal.aborted?a():d.signal.addEventListener("abort",a)));var b=(i=d.url,(r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i))&&r[1]||"");if(b&&-1===r1.protocols.indexOf(b))return void n(new i$("Unsupported protocol "+b+":",i$.ERR_BAD_REQUEST,e));E.send(f||null)})};function ap(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}var z=N("1Zvtp"),X=N("l9etm"),ay=function(e,t){var n=(e=e?e.filter(Boolean):[]).length;if(t||n){var i,r=new AbortController,a=function(e){if(!i){i=!0,o();var t=e instanceof Error?e:this.reason;r.abort(t instanceof i$?t:new ai(t instanceof Error?t.message:t))}},s=t&&setTimeout(function(){s=null,a(new i$("timeout ".concat(t," of ms exceeded"),i$.ETIMEDOUT))},t),o=function(){e&&(s&&clearTimeout(s),s=null,e.forEach(function(e){e.unsubscribe?e.unsubscribe(a):e.removeEventListener("abort",a)}),e=null)};e.forEach(function(e){return e.addEventListener("abort",a)});var l=r.signal;return l.unsubscribe=function(){return iQ.asap(o)},l}};function aE(e,t){this.v=e,this.k=t}function ak(e){var t={},n=!1;function i(t,i){return n=!0,{done:!1,value:new aE(i=new Promise(function(n){n(e[t](i))}),1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):i("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return i("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):i("return",e)}),t}function ab(e){var t,n,i,r=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,i=Symbol.iterator);r--;){if(n&&null!=(t=e[n]))return t.call(e);if(i&&null!=(t=e[i]))return new aT(t.call(e));n="@@asyncIterator",i="@@iterator"}throw TypeError("Object is not async iterable")}function aT(e){function t(e){if(Object(e)!==e)return Promise.reject(TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return(aT=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new aT(e)}function aS(e){return new aE(e,0)}function a_(e){var t,n;function i(t,n){try{var a=e[t](n),s=a.value,o=s instanceof aE;Promise.resolve(o?s.v:s).then(function(n){if(o){var l="return"===t?"return":"next";if(!s.k||n.done)return i(l,n);n=e[l](n).value}r(a.done?"return":"normal",n)},function(e){i("throw",e)})}catch(e){r("throw",e)}}function r(e,r){switch(e){case"return":t.resolve({value:r,done:!0});break;case"throw":t.reject(r);break;default:t.resolve({value:r,done:!1})}(t=t.next)?i(t.key,t.arg):n=null}this._invoke=function(e,r){return new Promise(function(a,s){var o={key:e,arg:r,resolve:a,reject:s,next:null};n?n=n.next=o:(t=n=o,i(e,r))})},"function"!=typeof e.return&&(this.return=void 0)}function aA(e){return function(){return new a_(e.apply(this,arguments))}}a_.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},a_.prototype.next=function(e){return this._invoke("next",e)},a_.prototype.throw=function(e){return this._invoke("throw",e)},a_.prototype.return=function(e){return this._invoke("return",e)};var aL=function(e,t){var n,i,r;return $(this,function(a){switch(a.label){case 0:if(n=e.byteLength,!(!t||n<t))return[3,2];return[4,e];case 1:return a.sent(),[2];case 2:i=0,a.label=3;case 3:if(!(i<n))return[3,5];return r=i+t,[4,e.slice(i,r)];case 4:return a.sent(),i=r,[3,3];case 5:return[2]}})},aw=function(e,t,n,i){var r,a=aA(function(){var n,i,r,a,s,o;return $(this,function(l){switch(l.label){case 0:n=!1,i=!1,l.label=1;case 1:var u;l.trys.push([1,7,8,13]),a=ab((u=e,aA(function(){var e,t,n,i;return $(this,function(r){switch(r.label){case 0:if(!u[Symbol.asyncIterator])return[3,2];return[5,Z(ak(ab(u)))];case 1:return r.sent(),[2];case 2:e=u.getReader(),r.label=3;case 3:r.trys.push([3,,9,11]),r.label=4;case 4:return[4,aS(e.read())];case 5:if(n=(t=r.sent()).done,i=t.value,n)return[3,8];return[4,i];case 6:r.sent(),r.label=7;case 7:return[3,4];case 8:return[3,11];case 9:return[4,aS(e.cancel())];case 10:return r.sent(),[7];case 11:return[2]}})})())),l.label=2;case 2:return[4,aS(a.next())];case 3:if(!(n=!(s=l.sent()).done))return[3,6];return[5,Z(ak(ab(aL(s.value,t))))];case 4:l.sent(),l.label=5;case 5:return n=!1,[3,2];case 6:return[3,13];case 7:return o=l.sent(),i=!0,r=o,[3,13];case 8:if(l.trys.push([8,,11,12]),!(n&&null!=a.return))return[3,10];return[4,aS(a.return())];case 9:l.sent(),l.label=10;case 10:return[3,12];case 11:if(i)throw r;return[7];case 12:return[7];case 13:return[2]}})})(),s=0,o=function(e){!r&&(r=!0,i&&i(e))};return new ReadableStream({pull:function(e){return j(function(){var t,i,r,l,u;return $(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,a.next()];case 1:if(i=(t=c.sent()).done,r=t.value,i)return o(),e.close(),[2];return l=r.byteLength,n&&n(s+=l),e.enqueue(new Uint8Array(r)),[3,3];case 2:throw o(u=c.sent()),u;case 3:return[2]}})})()},cancel:function(e){return o(e),a.return()}},{highWaterMark:2})},aI=iQ.isFunction,aR={Request:(k=iQ.global).Request,Response:k.Response},aD=iQ.global,aC=aD.ReadableStream,ax=aD.TextEncoder,aP=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];try{return!!e.apply(void 0,(0,X._)(n))}catch(e){return!1}},aO=function(e){var t,n=(e=iQ.merge.call({skipUndefined:!0},aR,e)).fetch,i=e.Request,r=e.Response,a=n?aI(n):"function"==typeof fetch,s=aI(i),o=aI(r);if(!a)return!1;var l=a&&aI(aC),u=a&&("function"==typeof ax?(t=new ax,function(e){return t.encode(e)}):function(e){return j(function(){var t;return $(this,function(n){switch(n.label){case 0:return t=Uint8Array.bind,[4,new i(e).arrayBuffer()];case 1:return[2,new(t.apply(Uint8Array,[void 0,n.sent()]))]}})})()}),c=s&&l&&aP(function(){var e=!1,t=new i(r1.origin,{body:new aC,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),h=o&&l&&aP(function(){return iQ.isReadableStream(new r("").body)}),d={stream:h&&function(e){return e.body}};return a&&["text","arrayBuffer","blob","formData","stream"].forEach(function(e){d[e]||(d[e]=function(t,n){var i=t&&t[e];if(i)return i.call(t);throw new i$("Response type '".concat(e,"' is not supported"),i$.ERR_NOT_SUPPORT,n)})}),function(e){return j(function(){var t,a,o,l,f,v,g,m,p,y,E,k,b,T,S,_,A,L,w,I,R,D,C,x,P,O,M,F,N,B,U,G,K,H,V,q;return $(this,function(Y){switch(Y.label){case 0:a=(t=ag(e)).url,o=t.method,l=t.data,f=t.signal,v=t.cancelToken,g=t.timeout,m=t.onDownloadProgress,p=t.onUploadProgress,y=t.responseType,E=t.headers,b=void 0===(k=t.withCredentials)?"same-origin":k,T=t.fetchOptions,S=n||fetch,y=y?(y+"").toLowerCase():"text",_=ay([f,v&&v.toAbortSignal()],g),A=null,L=_&&_.unsubscribe&&function(){_.unsubscribe()},Y.label=1;case 1:var W,X;if(Y.trys.push([1,7,,8]),!(I=p&&c&&"get"!==o&&"head"!==o))return[3,3];return[4,(W=E,X=l,j(function(){var e;return $(this,function(t){var n;return[2,null==(e=iQ.toFiniteNumber(W.getContentLength()))?(n=X,j(function(){return $(this,function(e){switch(e.label){case 0:if(null==n)return[2,0];if(iQ.isBlob(n))return[2,n.size];if(!iQ.isSpecCompliantForm(n))return[3,2];return[4,new i(r1.origin,{method:"POST",body:n}).arrayBuffer()];case 1:case 3:return[2,e.sent().byteLength];case 2:if(iQ.isArrayBufferView(n)||iQ.isArrayBuffer(n))return[2,n.byteLength];if(iQ.isURLSearchParams(n)&&(n+=""),!iQ.isString(n))return[3,4];return[4,u(n)];case 4:return[2]}})})()):e]})})())];case 2:I=0!==(w=Y.sent()),Y.label=3;case 3:return I&&(R=new i(a,{method:"POST",body:l,duplex:"half"}),iQ.isFormData(l)&&(D=R.headers.get("content-type"))&&E.setContentType(D),R.body&&(x=(C=(0,z._)(al(w,ao(au(p))),2))[0],P=C[1],l=aw(R.body,65536,x,P))),iQ.isString(b)||(b=b?"include":"omit"),O=s&&"credentials"in i.prototype,M=ap(rq({},T),{signal:_,method:o.toUpperCase(),headers:E.normalize().toJSON(),body:l,duplex:"half",credentials:O?b:void 0}),A=s&&new i(a,M),[4,s?S(A,T):S(a,M)];case 4:return F=Y.sent(),N=h&&("stream"===y||"response"===y),h&&(m||N&&L)&&(B={},["status","statusText","headers"].forEach(function(e){B[e]=F[e]}),U=iQ.toFiniteNumber(F.headers.get("content-length")),K=(G=(0,z._)(m&&al(U,ao(au(m),!0))||[],2))[0],H=G[1],F=new r(aw(F.body,65536,K,function(){H&&H(),L&&L()}),B)),y=y||"text",[4,d[iQ.findKey(d,y)||"text"](F,e)];case 5:return V=Y.sent(),!N&&L&&L(),[4,new Promise(function(t,n){ar(t,n,{data:V,headers:ae.from(F.headers),status:F.status,statusText:F.statusText,config:e,request:A})})];case 6:return[2,Y.sent()];case 7:if(q=Y.sent(),L&&L(),q&&"TypeError"===q.name&&/Load failed|fetch/i.test(q.message))throw Object.assign(new i$("Network Error",i$.ERR_NETWORK,e,A),{cause:q.cause||q});throw i$.from(q,q&&q.code,e,A);case 8:return[2]}})})()}},aM=new Map,aF=function(e){for(var t,n,i=e?e.env:{},r=i.fetch,a=[i.Request,i.Response,r],s=a.length,o=aM;s--;)t=a[s],void 0===(n=o.get(t))&&o.set(t,n=s?new Map:aO(i)),o=n;return n};aF();var aN={http:null,xhr:am,fetch:{get:aF}};"use strict";iQ.forEach(aN,function(e,t){if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}});var aB=function(e){return"- ".concat(e)},aU=function(e,t){for(var n,i,r=(e=iQ.isArray(e)?e:[e]).length,a={},s=0;s<r;s++){n=e[s];var o=void 0;if(i=n,!iQ.isFunction(n)&&null!==n&&!1!==n&&void 0===(i=aN[(o=String(n)).toLowerCase()]))throw new i$("Unknown adapter '".concat(o,"'"));if(i&&(iQ.isFunction(i)||(i=i.get(t))))break;a[o||"#"+s]=i}if(!i){var l=Object.entries(a).map(function(e){var t=(0,z._)(e,2),n=t[0],i=t[1];return"adapter ".concat(n," ")+(!1===i?"is not supported by the environment":"is not available in the build")});throw new i$("There is no suitable adapter to dispatch the request "+(r?l.length>1?"since :\n"+l.map(aB).join("\n"):" "+aB(l[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i};function aj(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ai(null,e)}function aG(e){return aj(e),e.headers=ae.from(e.headers),e.data=at.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),aU(e.adapter||r3.adapter,e)(e).then(function(t){return aj(e),t.data=at.call(e,e.transformResponse,t),t.headers=ae.from(t.headers),t},function(t){return!an(t)&&(aj(e),t&&t.response&&(t.response.data=at.call(e,e.transformResponse,t.response),t.response.headers=ae.from(t.response.headers))),Promise.reject(t)})}"use strict";var Q=N("16gB1"),aK="1.12.2",aH={};["object","boolean","number","function","string","symbol"].forEach(function(e,t){aH[e]=function(n){return(void 0===n?"undefined":(0,Q._)(n))===e||"a"+(t<1?"n ":" ")+e}});var aV={};"use strict";aH.transitional=function(e,t,n){function i(e,t){return"[Axios v"+aK+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,r,a){if(!1===e)throw new i$(i(r," has been removed"+(t?" in "+t:"")),i$.ERR_DEPRECATED);return t&&!aV[r]&&(aV[r]=!0,console.warn(i(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,r,a)}},aH.spelling=function(e){return function(t,n){return console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0}};var aq=function(e,t,n){if((void 0===e?"undefined":(0,Q._)(e))!=="object")throw new i$("options must be an object",i$.ERR_BAD_OPTION_VALUE);for(var i=Object.keys(e),r=i.length;r-- >0;){var a=i[r],s=t[a];if(s){var o=e[a],l=void 0===o||s(o,a,e);if(!0!==l)throw new i$("option "+a+" must be "+l,i$.ERR_BAD_OPTION_VALUE);continue}if(!0!==n)throw new i$("Unknown option "+a,i$.ERR_BAD_OPTION)}},aY=function(){function e(t){(0,K._)(this,e),this.defaults=t||{},this.interceptors={request:new rH,response:new rH}}return(0,H._)(e,[{key:"request",value:function(e,t){return j(function(){var n,i,r;return $(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this._request(e,t)];case 1:return[2,a.sent()];case 2:if((n=a.sent())instanceof Error){i={},Error.captureStackTrace?Error.captureStackTrace(i):i=Error(),r=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?r&&!String(n.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(n.stack+="\n"+r):n.stack=r}catch(e){}}throw n;case 3:return[2]}})}).call(this)}},{key:"_request",value:function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{};var n=(t=av(this.defaults,t)).transitional,i=t.paramsSerializer,r=t.headers;void 0!==n&&aq(n,{silentJSONParsing:aH.transitional(aH.boolean),forcedJSONParsing:aH.transitional(aH.boolean),clarifyTimeoutError:aH.transitional(aH.boolean)},!1),null!=i&&(iQ.isFunction(i)?t.paramsSerializer={serialize:i}:aq(i,{encode:aH.function,serialize:aH.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),aq(t,{baseUrl:aH.spelling("baseURL"),withXsrfToken:aH.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();var a=r&&iQ.merge(r.common,r[t.method]);r&&iQ.forEach(["delete","get","head","post","put","patch","common"],function(e){delete r[e]}),t.headers=ae.concat(a,r);var s=[],o=!0;this.interceptors.request.forEach(function(e){("function"!=typeof e.runWhen||!1!==e.runWhen(t))&&(o=o&&e.synchronous,s.unshift(e.fulfilled,e.rejected))});var l=[];this.interceptors.response.forEach(function(e){l.push(e.fulfilled,e.rejected)});var u=0;if(!o){var c,h,d=[aG.bind(this),void 0];for(d.unshift.apply(d,(0,X._)(s)),d.push.apply(d,(0,X._)(l)),h=d.length,c=Promise.resolve(t);u<h;)c=c.then(d[u++],d[u++]);return c}h=s.length;for(var f=t;u<h;){var v=s[u++],g=s[u++];try{f=v(f)}catch(e){g.call(this,e);break}}try{c=aG.call(this,f)}catch(e){return Promise.reject(e)}for(u=0,h=l.length;u<h;)c=c.then(l[u++],l[u++]);return c}},{key:"getUri",value:function(e){return rK(ad((e=av(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}]),e}();"use strict";"use strict";"use strict";iQ.forEach(["delete","get","head","options"],function(e){aY.prototype[e]=function(t,n){return this.request(av(n||{},{method:e,url:t,data:(n||{}).data}))}}),iQ.forEach(["post","put","patch"],function(e){function t(t){return function(n,i,r){return this.request(av(r||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:i}))}}aY.prototype[e]=t(),aY.prototype[e+"Form"]=t(!0)});var K=N("6M8s5"),H=N("8ro5P"),aW=function(){function e(t){if((0,K._)(this,e),"function"!=typeof t)throw TypeError("executor must be a function.");this.promise=new Promise(function(e){n=e});var n,i=this;this.promise.then(function(e){if(i._listeners){for(var t=i._listeners.length;t-- >0;)i._listeners[t](e);i._listeners=null}}),this.promise.then=function(e){var t,n=new Promise(function(e){i.subscribe(e),t=e}).then(e);return n.cancel=function(){i.unsubscribe(t)},n},t(function(e,t,r){i.reason||(i.reason=new ai(e,t,r),n(i.reason))})}return(0,H._)(e,[{key:"throwIfRequested",value:function(){if(this.reason)throw this.reason}},{key:"subscribe",value:function(e){if(this.reason)return void e(this.reason);this._listeners?this._listeners.push(e):this._listeners=[e]}},{key:"unsubscribe",value:function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}}},{key:"toAbortSignal",value:function(){var e=this,t=new AbortController,n=function(e){t.abort(e)};return this.subscribe(n),t.signal.unsubscribe=function(){return e.unsubscribe(n)},t.signal}}],[{key:"source",value:function(){var t;return{token:new e(function(e){t=e}),cancel:t}}}]),e}(),z=N("1Zvtp"),az={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};"use strict";Object.entries(az).forEach(function(e){var t=(0,z._)(e,2),n=t[0];az[t[1]]=n});var aX=function e(t){var n=new aY(t),i=ic(aY.prototype.request,n);return iQ.extend(i,aY.prototype,n,{allOwnKeys:!0}),iQ.extend(i,n,null,{allOwnKeys:!0}),i.create=function(n){return e(av(t,n))},i}(r3);aX.Axios=aY,aX.CanceledError=ai,aX.CancelToken=aW,aX.isCancel=an,aX.VERSION=aK,aX.toFormData=rN,aX.AxiosError=i$,aX.Cancel=aX.CanceledError,aX.all=function(e){return Promise.all(e)},aX.spread=function(e){return function(t){return e.apply(null,t)}},aX.isAxiosError=function(e){return iQ.isObject(e)&&!0===e.isAxiosError},aX.mergeConfig=av,aX.AxiosHeaders=ae,aX.formToJSON=function(e){return r2(iQ.isHTMLForm(e)?new FormData(e):e)},aX.getAdapter=aU,aX.HttpStatusCode=az,aX.default=aX,aX.Axios,aX.AxiosError,aX.CanceledError,aX.isCancel,aX.CancelToken,aX.VERSION,aX.all,aX.Cancel,aX.isAxiosError,aX.spread,aX.toFormData,aX.AxiosHeaders,aX.HttpStatusCode,aX.formToJSON,aX.getAdapter,aX.mergeConfig;var K=N("6M8s5"),H=N("8ro5P"),Q=N("16gB1"),G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),K=N("6M8s5"),H=N("8ro5P"),Q=N("16gB1"),aQ=void 0;function a$(e,t,n){var i;return(t="symbol"==(void 0===(i=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?"undefined":(0,Q._)(i))?i:i+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var aZ=function(){"use strict";function e(t,n){(0,K._)(this,e),a$(this,"name",null),a$(this,"isRequired",null),a$(this,"element",null),a$(this,"type",null),a$(this,"changeListeners",[]);var i=n.name,r=n.isRequired,a=n.type;this.element=t,this.name=i,this.type=a,this.isRequired=r}return(0,H._)(e,[{key:"onChange",value:function(e){this.changeListeners.push(e)}},{key:"handleChanges",value:function(){var e=this;this.changeListeners.forEach(function(t){return t(e)})}},{key:"getLabel",value:function(){return this.label}},{key:"getValue",value:function(){}},{key:"setValue",value:function(){}},{key:"isValid",value:function(){}},{key:"validate",value:function(){this.element.classList.remove("has-error"),this.isValid()||this.element.classList.add("has-error")}},{key:"getName",value:function(){return this.name}}]),e}();aZ.prototype.getLabel=function(){return aQ.label};var aJ=function(e){"use strict";function t(e,n){var i;return(0,K._)(this,t),(i=(0,G._)(this,t,[e,ap(rq({},n),{type:"input"})])).input=e.querySelectorAll("input")[0],i.input.addEventListener("click",i.handleChanges.bind(i)),i}return(0,W._)(t,e),(0,H._)(t,[{key:"getValue",value:function(){return this.input.checked?this.input.value:void 0}},{key:"isValid",value:function(){return!this.isRequired||this.input.checked}}]),t}(aZ),G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),a0=function(e){"use strict";function t(e,n){var i;return(0,K._)(this,t),(i=(0,G._)(this,t,[e,ap(rq({},n),{type:"input"})])).checkbox=i.element.getElementsByClassName("checkbox-other-checkbox")[0],i.other=i.element.getElementsByClassName("checkbox-other-text")[0],i.checkbox.addEventListener("click",i.handleChanges.bind(i)),i.checkbox.addEventListener("click",i.enableOtherWhenChecked.bind(i)),i.other.addEventListener("keyup",i.handleChanges.bind(i)),i}return(0,W._)(t,e),(0,H._)(t,[{key:"enableOtherWhenChecked",value:function(){console.log("enableOtherWhenChecked"),this.checkbox.checked?(console.log(this.other),this.other.parentElement.classList.remove("hidden"),this.other.setAttribute("required","required"),this.other.focus()):(this.other.parentElement.classList.add("hidden"),this.other.removeAttribute("required"),this.other.value="")}},{key:"getValue",value:function(){return this.checkbox.checked?this.other.value:""}},{key:"isValid",value:function(){return!this.isRequired||!this.checkbox.checked||this.other.value.length>0}}]),t}(aZ),G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),Q=(N("16gB1"),N("16gB1")),a1=["onChange","onClose","onDayCreate","onDestroy","onKeyDown","onMonthChange","onOpen","onParseConfig","onReady","onValueUpdate","onYearChange","onPreCalendarPosition"],a2={_disable:[],allowInput:!1,allowInvalidPreload:!1,altFormat:"F j, Y",altInput:!1,altInputClass:"form-control input",animate:("undefined"==typeof window?"undefined":(0,Q._)(window))==="object"&&-1===window.navigator.userAgent.indexOf("MSIE"),ariaDateFormat:"F j, Y",autoFillDefaultTime:!0,clickOpens:!0,closeOnSelect:!0,conjunction:", ",dateFormat:"Y-m-d",defaultHour:12,defaultMinute:0,defaultSeconds:0,disable:[],disableMobile:!1,enableSeconds:!1,enableTime:!1,errorHandler:function(e){return"undefined"!=typeof console&&console.warn(e)},getWeek:function(e){var t=new Date(e.getTime());t.setHours(0,0,0,0),t.setDate(t.getDate()+3-(t.getDay()+6)%7);var n=new Date(t.getFullYear(),0,4);return 1+Math.round(((t.getTime()-n.getTime())/864e5-3+(n.getDay()+6)%7)/7)},hourIncrement:1,ignoredFocusElements:[],inline:!1,locale:"default",minuteIncrement:5,mode:"single",monthSelectorType:"dropdown",nextArrow:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 17 17'><g></g><path d='M13.207 8.472l-7.854 7.854-0.707-0.707 7.146-7.146-7.146-7.148 0.707-0.707 7.854 7.854z' /></svg>",noCalendar:!1,now:new Date,onChange:[],onClose:[],onDayCreate:[],onDestroy:[],onKeyDown:[],onMonthChange:[],onOpen:[],onParseConfig:[],onReady:[],onValueUpdate:[],onYearChange:[],onPreCalendarPosition:[],plugins:[],position:"auto",positionElement:void 0,prevArrow:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 17 17'><g></g><path d='M5.207 8.471l7.146 7.147-0.707 0.707-7.853-7.854 7.854-7.853 0.707 0.707-7.147 7.146z' /></svg>",shorthandCurrentMonth:!1,showMonths:1,static:!1,time_24hr:!1,weekNumbers:!1,wrap:!1},a3={weekdays:{shorthand:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longhand:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},months:{shorthand:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longhand:["January","February","March","April","May","June","July","August","September","October","November","December"]},daysInMonth:[31,28,31,30,31,30,31,31,30,31,30,31],firstDayOfWeek:0,ordinal:function(e){var t=e%100;if(t>3&&t<21)return"th";switch(t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},rangeSeparator:" to ",weekAbbreviation:"Wk",scrollTitle:"Scroll to increment",toggleTitle:"Click to toggle",amPM:["AM","PM"],yearAriaLabel:"Year",monthAriaLabel:"Month",hourAriaLabel:"Hour",minuteAriaLabel:"Minute",time_24hr:!1},a5=function(e,t){return void 0===t&&(t=2),("000"+e).slice(-1*t)},a4=function(e){return+(!0===e)};function a8(e,t){var n;return function(){var i=this,r=arguments;clearTimeout(n),n=setTimeout(function(){return e.apply(i,r)},t)}}var a6=function(e){return e instanceof Array?e:[e]};function a9(e,t,n){if(!0===n)return e.classList.add(t);e.classList.remove(t)}function a7(e,t,n){var i=window.document.createElement(e);return n=n||"",i.className=t=t||"",void 0!==n&&(i.textContent=n),i}function se(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function st(e,t){var n=a7("div","numInputWrapper"),i=a7("input","numInput "+e),r=a7("span","arrowUp"),a=a7("span","arrowDown");if(-1===navigator.userAgent.indexOf("MSIE 9.0")?i.type="number":(i.type="text",i.pattern="\\d*"),void 0!==t)for(var s in t)i.setAttribute(s,t[s]);return n.appendChild(i),n.appendChild(r),n.appendChild(a),n}function sn(e){try{if("function"==typeof e.composedPath)return e.composedPath()[0];return e.target}catch(t){return e.target}}var si=function(){},sr=function(e,t,n){return n.months[t?"shorthand":"longhand"][e]},sa={D:si,F:function(e,t,n){e.setMonth(n.months.longhand.indexOf(t))},G:function(e,t){e.setHours(12*(e.getHours()>=12)+parseFloat(t))},H:function(e,t){e.setHours(parseFloat(t))},J:function(e,t){e.setDate(parseFloat(t))},K:function(e,t,n){e.setHours(e.getHours()%12+12*int(RegExp(n.amPM[1],"i").test(t)))},M:function(e,t,n){e.setMonth(n.months.shorthand.indexOf(t))},S:function(e,t){e.setSeconds(parseFloat(t))},U:function(e,t){return new Date(1e3*parseFloat(t))},W:function(e,t,n){var i=parseInt(t),r=new Date(e.getFullYear(),0,2+(i-1)*7,0,0,0,0);return r.setDate(r.getDate()-r.getDay()+n.firstDayOfWeek),r},Y:function(e,t){e.setFullYear(parseFloat(t))},Z:function(e,t){return new Date(t)},d:function(e,t){e.setDate(parseFloat(t))},h:function(e,t){e.setHours(12*(e.getHours()>=12)+parseFloat(t))},i:function(e,t){e.setMinutes(parseFloat(t))},j:function(e,t){e.setDate(parseFloat(t))},l:si,m:function(e,t){e.setMonth(parseFloat(t)-1)},n:function(e,t){e.setMonth(parseFloat(t)-1)},s:function(e,t){e.setSeconds(parseFloat(t))},u:function(e,t){return new Date(parseFloat(t))},w:si,y:function(e,t){e.setFullYear(2e3+parseFloat(t))}},ss={D:"",F:"",G:"(\\d\\d|\\d)",H:"(\\d\\d|\\d)",J:"(\\d\\d|\\d)\\w+",K:"",M:"",S:"(\\d\\d|\\d)",U:"(.+)",W:"(\\d\\d|\\d)",Y:"(\\d{4})",Z:"(.+)",d:"(\\d\\d|\\d)",h:"(\\d\\d|\\d)",i:"(\\d\\d|\\d)",j:"(\\d\\d|\\d)",l:"",m:"(\\d\\d|\\d)",n:"(\\d\\d|\\d)",s:"(\\d\\d|\\d)",u:"(.+)",w:"(\\d\\d|\\d)",y:"(\\d{2})"},so={Z:function(e){return e.toISOString()},D:function(e,t,n){return t.weekdays.shorthand[so.w(e,t,n)]},F:function(e,t,n){return sr(so.n(e,t,n)-1,!1,t)},G:function(e,t,n){return a5(so.h(e,t,n))},H:function(e){return a5(e.getHours())},J:function(e,t){return void 0!==t.ordinal?e.getDate()+t.ordinal(e.getDate()):e.getDate()},K:function(e,t){return t.amPM[int(e.getHours()>11)]},M:function(e,t){return sr(e.getMonth(),!0,t)},S:function(e){return a5(e.getSeconds())},U:function(e){return e.getTime()/1e3},W:function(e,t,n){return n.getWeek(e)},Y:function(e){return a5(e.getFullYear(),4)},d:function(e){return a5(e.getDate())},h:function(e){return e.getHours()%12?e.getHours()%12:12},i:function(e){return a5(e.getMinutes())},j:function(e){return e.getDate()},l:function(e,t){return t.weekdays.longhand[e.getDay()]},m:function(e){return a5(e.getMonth()+1)},n:function(e){return e.getMonth()+1},s:function(e){return e.getSeconds()},u:function(e){return e.getTime()},w:function(e){return e.getDay()},y:function(e){return String(e.getFullYear()).substring(2)}},sl=function(e){var t=e.config,n=void 0===t?a2:t,i=e.l10n,r=void 0===i?a3:i,a=e.isMobile,s=void 0!==a&&a;return function(e,t,i){var a=i||r;return void 0===n.formatDate||s?t.split("").map(function(t,i,r){return so[t]&&"\\"!==r[i-1]?so[t](e,a,n):"\\"!==t?t:""}).join(""):n.formatDate(e,t,a)}},su=function(e){var t=e.config,n=void 0===t?a2:t,i=e.l10n,r=void 0===i?a3:i;return function(e,t,i,a){if(0===e||e){var s,o=a||r;if(e instanceof Date)s=new Date(e.getTime());else if("string"!=typeof e&&void 0!==e.toFixed)s=new Date(e);else if("string"==typeof e){var l=t||(n||a2).dateFormat,u=String(e).trim();if("today"===u)s=new Date,i=!0;else if(n&&n.parseDate)s=n.parseDate(e,l);else if(/Z$/.test(u)||/GMT$/.test(u))s=new Date(e);else{for(var c=void 0,h=[],d=0,f=0,v="";d<l.length;d++){var g=l[d],m="\\"===g,p="\\"===l[d-1]||m;if(ss[g]&&!p){var y=new RegExp(v+=ss[g]).exec(e);y&&(c=!0)&&h["Y"!==g?"push":"unshift"]({fn:sa[g],val:y[++f]})}else m||(v+=".")}s=n&&n.noCalendar?new Date(new Date().setHours(0,0,0,0)):new Date(new Date().getFullYear(),0,1,0,0,0,0),h.forEach(function(e){var t=e.fn,n=e.val;return s=t(s,n,o)||s}),s=c?s:void 0}}return s instanceof Date&&!isNaN(s.getTime())?(!0===i&&s.setHours(0,0,0,0),s):void n.errorHandler(Error("Invalid date provided: "+e))}}};function sc(e,t,n){return(void 0===n&&(n=!0),!1!==n)?new Date(e.getTime()).setHours(0,0,0,0)-new Date(t.getTime()).setHours(0,0,0,0):e.getTime()-t.getTime()}var sh=function(e,t,n){return 3600*e+60*t+n},sd=function(e){var t=Math.floor(e/3600),n=(e-3600*t)/60;return[t,n,e-3600*t-60*n]};function sf(e){var t=e.defaultHour,n=e.defaultMinute,i=e.defaultSeconds;if(void 0!==e.minDate){var r=e.minDate.getHours(),a=e.minDate.getMinutes(),s=e.minDate.getSeconds();t<r&&(t=r),t===r&&n<a&&(n=a),t===r&&n===a&&i<s&&(i=e.minDate.getSeconds())}if(void 0!==e.maxDate){var o=e.maxDate.getHours(),l=e.maxDate.getMinutes();(t=Math.min(t,o))===o&&(n=Math.min(l,n)),t===o&&n===l&&(i=e.maxDate.getSeconds())}return{hours:t,minutes:n,seconds:i}}"use strict";"function"!=typeof Object.assign&&(Object.assign=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(!e)throw TypeError("Cannot convert undefined or null to object");for(var i=function(t){t&&Object.keys(t).forEach(function(n){return e[n]=t[n]})},r=0;r<t.length;r++)i(t[r]);return e});var sv=function(){return(sv=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},sg=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var i=Array(e),r=0,t=0;t<n;t++)for(var a=arguments[t],s=0,o=a.length;s<o;s++,r++)i[r]=a[s];return i};function sm(e,t){for(var n=Array.prototype.slice.call(e).filter(function(e){return e instanceof HTMLElement}),i=[],r=0;r<n.length;r++){var a=n[r];try{if(null!==a.getAttribute("data-fp-omit"))continue;void 0!==a._flatpickr&&(a._flatpickr.destroy(),a._flatpickr=void 0),a._flatpickr=function(e,t){var n,i={config:sv(sv({},a2),sp.defaultConfig),l10n:a3};function r(){var e;return(null==(e=i.calendarContainer)?void 0:e.getRootNode()).activeElement||document.activeElement}function a(e){return e.bind(i)}function s(){var e=i.config;(!1!==e.weekNumbers||1!==e.showMonths)&&!0!==e.noCalendar&&window.requestAnimationFrame(function(){if(void 0!==i.calendarContainer&&(i.calendarContainer.style.visibility="hidden",i.calendarContainer.style.display="block"),void 0!==i.daysContainer){var t=(i.days.offsetWidth+1)*e.showMonths;i.daysContainer.style.width=t+"px",i.calendarContainer.style.width=t+(void 0!==i.weekWrapper?i.weekWrapper.offsetWidth:0)+"px",i.calendarContainer.style.removeProperty("visibility"),i.calendarContainer.style.removeProperty("display")}})}function o(e){if(0===i.selectedDates.length){var t=void 0===i.config.minDate||sc(new Date,i.config.minDate)>=0?new Date:new Date(i.config.minDate.getTime()),n=sf(i.config);t.setHours(n.hours,n.minutes,n.seconds,t.getMilliseconds()),i.selectedDates=[t],i.latestSelectedDateObj=t}void 0!==e&&"blur"!==e.type&&function(e){e.preventDefault();var t="keydown"===e.type,n=sn(e);void 0!==i.amPM&&n===i.amPM&&(i.amPM.textContent=i.l10n.amPM[a4(i.amPM.textContent===i.l10n.amPM[0])]);var r=parseFloat(n.getAttribute("min")),a=parseFloat(n.getAttribute("max")),s=parseFloat(n.getAttribute("step")),o=parseInt(n.value,10),l=o+s*(e.delta||(t?38===e.which?1:-1:0));if(void 0!==n.value&&2===n.value.length){var u=n===i.hourElement,c=n===i.minuteElement;l<r?(l=a+l+a4(!u)+(a4(u)&&a4(!i.amPM)),c&&m(void 0,-1,i.hourElement)):l>a&&(l=n===i.hourElement?l-a-a4(!i.amPM):r,c&&m(void 0,1,i.hourElement)),i.amPM&&u&&(1===s?l+o===23:Math.abs(l-o)>s)&&(i.amPM.textContent=i.l10n.amPM[a4(i.amPM.textContent===i.l10n.amPM[0])]),n.value=a5(l)}}(e);var r=i._input.value;l(),J(),i._input.value!==r&&i._debouncedChange()}function l(){if(void 0!==i.hourElement&&void 0!==i.minuteElement){var e=(parseInt(i.hourElement.value.slice(-2),10)||0)%24,t=(parseInt(i.minuteElement.value,10)||0)%60,n=void 0!==i.secondElement?(parseInt(i.secondElement.value,10)||0)%60:0;void 0!==i.amPM&&(e=e%12+12*a4(i.amPM.textContent===i.l10n.amPM[1]));var r=void 0!==i.config.minTime||i.config.minDate&&i.minDateHasTime&&i.latestSelectedDateObj&&0===sc(i.latestSelectedDateObj,i.config.minDate,!0),a=void 0!==i.config.maxTime||i.config.maxDate&&i.maxDateHasTime&&i.latestSelectedDateObj&&0===sc(i.latestSelectedDateObj,i.config.maxDate,!0);if(void 0!==i.config.maxTime&&void 0!==i.config.minTime&&i.config.minTime>i.config.maxTime){var s=sh(i.config.minTime.getHours(),i.config.minTime.getMinutes(),i.config.minTime.getSeconds()),o=sh(i.config.maxTime.getHours(),i.config.maxTime.getMinutes(),i.config.maxTime.getSeconds()),l=sh(e,t,n);if(l>o&&l<s){var u=sd(s);e=u[0],t=u[1],n=u[2]}}else{if(a){var h=void 0!==i.config.maxTime?i.config.maxTime:i.config.maxDate;(e=Math.min(e,h.getHours()))===h.getHours()&&(t=Math.min(t,h.getMinutes())),t===h.getMinutes()&&(n=Math.min(n,h.getSeconds()))}if(r){var d=void 0!==i.config.minTime?i.config.minTime:i.config.minDate;(e=Math.max(e,d.getHours()))===d.getHours()&&t<d.getMinutes()&&(t=d.getMinutes()),t===d.getMinutes()&&(n=Math.max(n,d.getSeconds()))}}c(e,t,n)}}function u(e){var t=e||i.latestSelectedDateObj;t&&t instanceof Date&&c(t.getHours(),t.getMinutes(),t.getSeconds())}function c(e,t,n){void 0!==i.latestSelectedDateObj&&i.latestSelectedDateObj.setHours(e%24,t,n||0,0),i.hourElement&&i.minuteElement&&!i.isMobile&&(i.hourElement.value=a5(i.config.time_24hr?e:(12+e)%12+12*a4(e%12==0)),i.minuteElement.value=a5(t),void 0!==i.amPM&&(i.amPM.textContent=i.l10n.amPM[a4(e>=12)]),void 0!==i.secondElement&&(i.secondElement.value=a5(n)))}function h(e){var t=parseInt(sn(e).value)+(e.delta||0);(t/1e3>1||"Enter"===e.key&&!/[^\d]/.test(t.toString()))&&R(t)}function d(e,t,n,r){return t instanceof Array?t.forEach(function(t){return d(e,t,n,r)}):e instanceof Array?e.forEach(function(e){return d(e,t,n,r)}):void(e.addEventListener(t,n,r),i._handlers.push({remove:function(){return e.removeEventListener(t,n,r)}}))}function f(){W("onChange")}function v(e,t){var n=void 0!==e?i.parseDate(e):i.latestSelectedDateObj||(i.config.minDate&&i.config.minDate>i.now?i.config.minDate:i.config.maxDate&&i.config.maxDate<i.now?i.config.maxDate:i.now),r=i.currentYear,a=i.currentMonth;try{void 0!==n&&(i.currentYear=n.getFullYear(),i.currentMonth=n.getMonth())}catch(e){e.message="Invalid date supplied: "+n,i.config.errorHandler(e)}t&&i.currentYear!==r&&(W("onYearChange"),T()),t&&(i.currentYear!==r||i.currentMonth!==a)&&W("onMonthChange"),i.redraw()}function g(e){var t=sn(e);~t.className.indexOf("arrow")&&m(e,t.classList.contains("arrowUp")?1:-1)}function m(e,t,n){var i=e&&sn(e),r=n||i&&i.parentNode&&i.parentNode.firstChild,a=z("increment");a.delta=t,r&&r.dispatchEvent(a)}function p(e,t,n,r){var a,s=D(t,!0),o=a7("span",e,t.getDate().toString());return o.dateObj=t,o.$i=r,o.setAttribute("aria-label",i.formatDate(t,i.config.ariaDateFormat)),-1===e.indexOf("hidden")&&0===sc(t,i.now)&&(i.todayDateElem=o,o.classList.add("today"),o.setAttribute("aria-current","date")),s?(o.tabIndex=-1,X(t)&&(o.classList.add("selected"),i.selectedDateElem=o,"range"===i.config.mode&&(a9(o,"startRange",i.selectedDates[0]&&0===sc(t,i.selectedDates[0],!0)),a9(o,"endRange",i.selectedDates[1]&&0===sc(t,i.selectedDates[1],!0)),"nextMonthDay"===e&&o.classList.add("inRange")))):o.classList.add("flatpickr-disabled"),"range"===i.config.mode&&(a=t,"range"===i.config.mode&&!(i.selectedDates.length<2)&&sc(a,i.selectedDates[0])>=0&&0>=sc(a,i.selectedDates[1]))&&!X(t)&&o.classList.add("inRange"),i.weekNumbers&&1===i.config.showMonths&&"prevMonthDay"!==e&&r%7==6&&i.weekNumbers.insertAdjacentHTML("beforeend","<span class='flatpickr-day'>"+i.config.getWeek(t)+"</span>"),W("onDayCreate",o),o}function y(e){e.focus(),"range"===i.config.mode&&O(e)}function E(e){for(var t=e>0?0:i.config.showMonths-1,n=e>0?i.config.showMonths:-1,r=t;r!=n;r+=e)for(var a=i.daysContainer.children[r],s=e>0?0:a.children.length-1,o=e>0?a.children.length:-1,l=s;l!=o;l+=e){var u=a.children[l];if(-1===u.className.indexOf("hidden")&&D(u.dateObj))return u}}function k(e,t){var n=r(),a=C(n||document.body),s=void 0!==e?e:a?n:void 0!==i.selectedDateElem&&C(i.selectedDateElem)?i.selectedDateElem:void 0!==i.todayDateElem&&C(i.todayDateElem)?i.todayDateElem:E(t>0?1:-1);void 0===s?i._input.focus():a?function(e,t){for(var n=-1===e.className.indexOf("Month")?e.dateObj.getMonth():i.currentMonth,r=t>0?i.config.showMonths:-1,a=t>0?1:-1,s=n-i.currentMonth;s!=r;s+=a)for(var o=i.daysContainer.children[s],l=n-i.currentMonth===s?e.$i+t:t<0?o.children.length-1:0,u=o.children.length,c=l;c>=0&&c<u&&c!=(t>0?u:-1);c+=a){var h=o.children[c];if(-1===h.className.indexOf("hidden")&&D(h.dateObj)&&Math.abs(e.$i-c)>=Math.abs(t))return y(h)}i.changeMonth(a),k(E(a),0)}(s,t):y(s)}function b(){if(void 0!==i.daysContainer){se(i.daysContainer),i.weekNumbers&&se(i.weekNumbers);for(var e=document.createDocumentFragment(),t=0;t<i.config.showMonths;t++){var n=new Date(i.currentYear,i.currentMonth,1);n.setMonth(i.currentMonth+t),e.appendChild(function(e,t){for(var n=(new Date(e,t,1).getDay()-i.l10n.firstDayOfWeek+7)%7,r=i.utils.getDaysInMonth((t-1+12)%12,e),a=i.utils.getDaysInMonth(t,e),s=window.document.createDocumentFragment(),o=i.config.showMonths>1,l=o?"prevMonthDay hidden":"prevMonthDay",u=o?"nextMonthDay hidden":"nextMonthDay",c=r+1-n,h=0;c<=r;c++,h++)s.appendChild(p("flatpickr-day "+l,new Date(e,t-1,c),c,h));for(c=1;c<=a;c++,h++)s.appendChild(p("flatpickr-day",new Date(e,t,c),c,h));for(var d=a+1;d<=42-n&&(1===i.config.showMonths||h%7!=0);d++,h++)s.appendChild(p("flatpickr-day "+u,new Date(e,t+1,d%a),d,h));var f=a7("div","dayContainer");return f.appendChild(s),f}(n.getFullYear(),n.getMonth()))}i.daysContainer.appendChild(e),i.days=i.daysContainer.firstChild,"range"===i.config.mode&&1===i.selectedDates.length&&O()}}function T(){if(!(i.config.showMonths>1)&&"dropdown"===i.config.monthSelectorType){i.monthsDropdownContainer.tabIndex=-1,i.monthsDropdownContainer.innerHTML="";for(var e,t=0;t<12;t++)if(e=t,!(void 0!==i.config.minDate&&i.currentYear===i.config.minDate.getFullYear()&&e<i.config.minDate.getMonth())&&!(void 0!==i.config.maxDate&&i.currentYear===i.config.maxDate.getFullYear()&&e>i.config.maxDate.getMonth())){var n=a7("option","flatpickr-monthDropdown-month");n.value=new Date(i.currentYear,t).getMonth().toString(),n.textContent=sr(t,i.config.shorthandCurrentMonth,i.l10n),n.tabIndex=-1,i.currentMonth===t&&(n.selected=!0),i.monthsDropdownContainer.appendChild(n)}}}function S(){se(i.monthNav),i.monthNav.appendChild(i.prevMonthNav),i.config.showMonths&&(i.yearElements=[],i.monthElements=[]);for(var e=i.config.showMonths;e--;){var t=function(){var e,t=a7("div","flatpickr-month"),n=window.document.createDocumentFragment();i.config.showMonths>1||"static"===i.config.monthSelectorType?e=a7("span","cur-month"):(i.monthsDropdownContainer=a7("select","flatpickr-monthDropdown-months"),i.monthsDropdownContainer.setAttribute("aria-label",i.l10n.monthAriaLabel),d(i.monthsDropdownContainer,"change",function(e){var t=parseInt(sn(e).value,10);i.changeMonth(t-i.currentMonth),W("onMonthChange")}),T(),e=i.monthsDropdownContainer);var r=st("cur-year",{tabindex:"-1"}),a=r.getElementsByTagName("input")[0];a.setAttribute("aria-label",i.l10n.yearAriaLabel),i.config.minDate&&a.setAttribute("min",i.config.minDate.getFullYear().toString()),i.config.maxDate&&(a.setAttribute("max",i.config.maxDate.getFullYear().toString()),a.disabled=!!i.config.minDate&&i.config.minDate.getFullYear()===i.config.maxDate.getFullYear());var s=a7("div","flatpickr-current-month");return s.appendChild(e),s.appendChild(r),n.appendChild(s),t.appendChild(n),{container:t,yearElement:a,monthElement:e}}();i.yearElements.push(t.yearElement),i.monthElements.push(t.monthElement),i.monthNav.appendChild(t.container)}i.monthNav.appendChild(i.nextMonthNav)}function _(){i.weekdayContainer?se(i.weekdayContainer):i.weekdayContainer=a7("div","flatpickr-weekdays");for(var e=i.config.showMonths;e--;){var t=a7("div","flatpickr-weekdaycontainer");i.weekdayContainer.appendChild(t)}return A(),i.weekdayContainer}function A(){if(i.weekdayContainer){var e=i.l10n.firstDayOfWeek,t=sg(i.l10n.weekdays.shorthand);e>0&&e<t.length&&(t=sg(t.splice(e,t.length),t.splice(0,e)));for(var n=i.config.showMonths;n--;)i.weekdayContainer.children[n].innerHTML="\n      <span class='flatpickr-weekday'>\n        "+t.join("</span><span class='flatpickr-weekday'>")+"\n      </span>\n      "}}function L(e,t){void 0===t&&(t=!0);var n=t?e:e-i.currentMonth;n<0&&!0===i._hidePrevMonthArrow||n>0&&!0===i._hideNextMonthArrow||(i.currentMonth+=n,(i.currentMonth<0||i.currentMonth>11)&&(i.currentYear+=i.currentMonth>11?1:-1,i.currentMonth=(i.currentMonth+12)%12,W("onYearChange"),T()),b(),W("onMonthChange"),$())}function w(e){return i.calendarContainer.contains(e)}function I(e){if(i.isOpen&&!i.config.inline){var t=sn(e),n=w(t),r=!(t===i.input||t===i.altInput||i.element.contains(t)||e.path&&e.path.indexOf&&(~e.path.indexOf(i.input)||~e.path.indexOf(i.altInput)))&&!n&&!w(e.relatedTarget),a=!i.config.ignoredFocusElements.some(function(e){return e.contains(t)});r&&a&&(i.config.allowInput&&i.setDate(i._input.value,!1,i.config.altInput?i.config.altFormat:i.config.dateFormat),void 0!==i.timeContainer&&void 0!==i.minuteElement&&void 0!==i.hourElement&&""!==i.input.value&&void 0!==i.input.value&&o(),i.close(),i.config&&"range"===i.config.mode&&1===i.selectedDates.length&&i.clear(!1))}}function R(e){if(!(!e||i.config.minDate&&e<i.config.minDate.getFullYear()||i.config.maxDate&&e>i.config.maxDate.getFullYear())){var t=i.currentYear!==e;i.currentYear=e||i.currentYear,i.config.maxDate&&i.currentYear===i.config.maxDate.getFullYear()?i.currentMonth=Math.min(i.config.maxDate.getMonth(),i.currentMonth):i.config.minDate&&i.currentYear===i.config.minDate.getFullYear()&&(i.currentMonth=Math.max(i.config.minDate.getMonth(),i.currentMonth)),t&&(i.redraw(),W("onYearChange"),T())}}function D(e,t){void 0===t&&(t=!0);var n,r=i.parseDate(e,void 0,t);if(i.config.minDate&&r&&0>sc(r,i.config.minDate,void 0!==t?t:!i.minDateHasTime)||i.config.maxDate&&r&&sc(r,i.config.maxDate,void 0!==t?t:!i.maxDateHasTime)>0)return!1;if(!i.config.enable&&0===i.config.disable.length)return!0;if(void 0===r)return!1;for(var a=!!i.config.enable,s=null!=(n=i.config.enable)?n:i.config.disable,o=0,l=void 0;o<s.length;o++){if("function"==typeof(l=s[o])&&l(r))return a;if(l instanceof Date&&void 0!==r&&l.getTime()===r.getTime())return a;if("string"==typeof l){var u=i.parseDate(l,void 0,!0);return u&&u.getTime()===r.getTime()?a:!a}else if((void 0===l?"undefined":(0,Q._)(l))==="object"&&void 0!==r&&l.from&&l.to&&r.getTime()>=l.from.getTime()&&r.getTime()<=l.to.getTime())return a}return!a}function C(e){return void 0!==i.daysContainer&&-1===e.className.indexOf("hidden")&&-1===e.className.indexOf("flatpickr-disabled")&&i.daysContainer.contains(e)}function x(e){var t=e.target===i._input,n=i._input.value.trimEnd()!==Z();t&&n&&!(e.relatedTarget&&w(e.relatedTarget))&&i.setDate(i._input.value,!0,e.target===i.altInput?i.config.altFormat:i.config.dateFormat)}function P(t){var n=sn(t),a=i.config.wrap?e.contains(n):n===i._input,s=i.config.allowInput,u=i.isOpen&&(!s||!a),c=i.config.inline&&a&&!s;if(13===t.keyCode&&a)if(s)return i.setDate(i._input.value,!0,n===i.altInput?i.config.altFormat:i.config.dateFormat),i.close(),n.blur();else i.open();else if(w(n)||u||c){var h=!!i.timeContainer&&i.timeContainer.contains(n);switch(t.keyCode){case 13:h?(t.preventDefault(),o(),G()):K(t);break;case 27:t.preventDefault(),G();break;case 8:case 46:a&&!i.config.allowInput&&(t.preventDefault(),i.clear());break;case 37:case 39:if(h||a)i.hourElement&&i.hourElement.focus();else{t.preventDefault();var d=r();if(void 0!==i.daysContainer&&(!1===s||d&&C(d))){var f=39===t.keyCode?1:-1;t.ctrlKey?(t.stopPropagation(),L(f),k(E(1),0)):k(void 0,f)}}break;case 38:case 40:t.preventDefault();var v=40===t.keyCode?1:-1;i.daysContainer&&void 0!==n.$i||n===i.input||n===i.altInput?t.ctrlKey?(t.stopPropagation(),R(i.currentYear-v),k(E(1),0)):h||k(void 0,7*v):n===i.currentYearElement?R(i.currentYear-v):i.config.enableTime&&(!h&&i.hourElement&&i.hourElement.focus(),o(t),i._debouncedChange());break;case 9:if(h){var g=[i.hourElement,i.minuteElement,i.secondElement,i.amPM].concat(i.pluginElements).filter(function(e){return e}),m=g.indexOf(n);if(-1!==m){var p=g[m+(t.shiftKey?-1:1)];t.preventDefault(),(p||i._input).focus()}}else!i.config.noCalendar&&i.daysContainer&&i.daysContainer.contains(n)&&t.shiftKey&&(t.preventDefault(),i._input.focus())}}if(void 0!==i.amPM&&n===i.amPM)switch(t.key){case i.l10n.amPM[0].charAt(0):case i.l10n.amPM[0].charAt(0).toLowerCase():i.amPM.textContent=i.l10n.amPM[0],l(),J();break;case i.l10n.amPM[1].charAt(0):case i.l10n.amPM[1].charAt(0).toLowerCase():i.amPM.textContent=i.l10n.amPM[1],l(),J()}(a||w(n))&&W("onKeyDown",t)}function O(e,t){if(void 0===t&&(t="flatpickr-day"),!(1!==i.selectedDates.length||e&&(!e.classList.contains(t)||e.classList.contains("flatpickr-disabled")))){for(var n=e?e.dateObj.getTime():i.days.firstElementChild.dateObj.getTime(),r=i.parseDate(i.selectedDates[0],void 0,!0).getTime(),a=Math.min(n,i.selectedDates[0].getTime()),s=Math.max(n,i.selectedDates[0].getTime()),o=!1,l=0,u=0,c=a;c<s;c+=864e5)!D(new Date(c),!0)&&(o=o||c>a&&c<s,c<r&&(!l||c>l)?l=c:c>r&&(!u||c<u)&&(u=c));Array.from(i.rContainer.querySelectorAll("*:nth-child(-n+"+i.config.showMonths+") > ."+t)).forEach(function(t){var a,s,c,h=t.dateObj.getTime(),d=l>0&&h<l||u>0&&h>u;if(d){t.classList.add("notAllowed"),["inRange","startRange","endRange"].forEach(function(e){t.classList.remove(e)});return}(!o||d)&&(["startRange","inRange","endRange","notAllowed"].forEach(function(e){t.classList.remove(e)}),void 0!==e&&(e.classList.add(n<=i.selectedDates[0].getTime()?"startRange":"endRange"),r<n&&h===r?t.classList.add("startRange"):r>n&&h===r&&t.classList.add("endRange"),h>=l&&(0===u||h<=u)&&(a=h)>Math.min(s=r,c=n)&&a<Math.max(s,c)&&t.classList.add("inRange")))})}}function M(){!i.isOpen||i.config.static||i.config.inline||U()}function F(e){return function(t){var n=i.config["_"+e+"Date"]=i.parseDate(t,i.config.dateFormat),r=i.config["_"+("min"===e?"max":"min")+"Date"];void 0!==n&&(i["min"===e?"minDateHasTime":"maxDateHasTime"]=n.getHours()>0||n.getMinutes()>0||n.getSeconds()>0),i.selectedDates&&(i.selectedDates=i.selectedDates.filter(function(e){return D(e)}),i.selectedDates.length||"min"!==e||u(n),J()),i.daysContainer&&(j(),void 0!==n?i.currentYearElement[e]=n.getFullYear().toString():i.currentYearElement.removeAttribute(e),i.currentYearElement.disabled=!!r&&void 0!==n&&r.getFullYear()===n.getFullYear())}}function N(){return i.config.wrap?e.querySelector("[data-input]"):e}function B(){"object"!==(0,Q._)(i.config.locale)&&void 0===sp.l10ns[i.config.locale]&&i.config.errorHandler(Error("flatpickr: invalid locale "+i.config.locale)),i.l10n=sv(sv({},sp.l10ns.default),"object"===(0,Q._)(i.config.locale)?i.config.locale:"default"!==i.config.locale?sp.l10ns[i.config.locale]:void 0),ss.D="("+i.l10n.weekdays.shorthand.join("|")+")",ss.l="("+i.l10n.weekdays.longhand.join("|")+")",ss.M="("+i.l10n.months.shorthand.join("|")+")",ss.F="("+i.l10n.months.longhand.join("|")+")",ss.K="("+i.l10n.amPM[0]+"|"+i.l10n.amPM[1]+"|"+i.l10n.amPM[0].toLowerCase()+"|"+i.l10n.amPM[1].toLowerCase()+")",void 0===sv(sv({},t),JSON.parse(JSON.stringify(e.dataset||{}))).time_24hr&&void 0===sp.defaultConfig.time_24hr&&(i.config.time_24hr=i.l10n.time_24hr),i.formatDate=sl(i),i.parseDate=su({config:i.config,l10n:i.l10n})}function U(e){if("function"==typeof i.config.position)return void i.config.position(i,e);if(void 0!==i.calendarContainer){W("onPreCalendarPosition");var t=e||i._positionElement,n=Array.prototype.reduce.call(i.calendarContainer.children,function(e,t){return e+t.offsetHeight},0),r=i.calendarContainer.offsetWidth,a=i.config.position.split(" "),s=a[0],o=a.length>1?a[1]:null,l=t.getBoundingClientRect(),u=window.innerHeight-l.bottom,c="above"===s||"below"!==s&&u<n&&l.top>n,h=window.pageYOffset+l.top+(c?-n-2:t.offsetHeight+2);if(a9(i.calendarContainer,"arrowTop",!c),a9(i.calendarContainer,"arrowBottom",c),!i.config.inline){var d=window.pageXOffset+l.left,f=!1,v=!1;"center"===o?(d-=(r-l.width)/2,f=!0):"right"===o&&(d-=r-l.width,v=!0),a9(i.calendarContainer,"arrowLeft",!f&&!v),a9(i.calendarContainer,"arrowCenter",f),a9(i.calendarContainer,"arrowRight",v);var g=window.document.body.offsetWidth-(window.pageXOffset+l.right),m=d+r>window.document.body.offsetWidth,p=g+r>window.document.body.offsetWidth;if(a9(i.calendarContainer,"rightMost",m),!i.config.static)if(i.calendarContainer.style.top=h+"px",m)if(p){var y=function(){for(var e=null,t=0;t<document.styleSheets.length;t++){var n=document.styleSheets[t];if(n.cssRules){try{n.cssRules}catch(e){continue}e=n;break}}return null!=e?e:function(){var e=document.createElement("style");return document.head.appendChild(e),e.sheet}()}();if(void 0===y)return;var E=Math.max(0,window.document.body.offsetWidth/2-r/2),k=y.cssRules.length,b="{left:"+l.left+"px;right:auto;}";a9(i.calendarContainer,"rightMost",!1),a9(i.calendarContainer,"centerMost",!0),y.insertRule(".flatpickr-calendar.centerMost:before,.flatpickr-calendar.centerMost:after"+b,k),i.calendarContainer.style.left=E+"px",i.calendarContainer.style.right="auto"}else i.calendarContainer.style.left="auto",i.calendarContainer.style.right=g+"px";else i.calendarContainer.style.left=d+"px",i.calendarContainer.style.right="auto"}}}function j(){i.config.noCalendar||i.isMobile||(T(),$(),b())}function G(){i._input.focus(),-1!==window.navigator.userAgent.indexOf("MSIE")||void 0!==navigator.msMaxTouchPoints?setTimeout(i.close,0):i.close()}function K(e){e.preventDefault(),e.stopPropagation();var t=function e(t,n){return n(t)?t:t.parentNode?e(t.parentNode,n):void 0}(sn(e),function(e){return e.classList&&e.classList.contains("flatpickr-day")&&!e.classList.contains("flatpickr-disabled")&&!e.classList.contains("notAllowed")});if(void 0!==t){var n=i.latestSelectedDateObj=new Date(t.dateObj.getTime()),r=(n.getMonth()<i.currentMonth||n.getMonth()>i.currentMonth+i.config.showMonths-1)&&"range"!==i.config.mode;if(i.selectedDateElem=t,"single"===i.config.mode)i.selectedDates=[n];else if("multiple"===i.config.mode){var a=X(n);a?i.selectedDates.splice(parseInt(a),1):i.selectedDates.push(n)}else"range"===i.config.mode&&(2===i.selectedDates.length&&i.clear(!1,!1),i.latestSelectedDateObj=n,i.selectedDates.push(n),0!==sc(n,i.selectedDates[0],!0)&&i.selectedDates.sort(function(e,t){return e.getTime()-t.getTime()}));if(l(),r){var s=i.currentYear!==n.getFullYear();i.currentYear=n.getFullYear(),i.currentMonth=n.getMonth(),s&&(W("onYearChange"),T()),W("onMonthChange")}if($(),b(),J(),r||"range"===i.config.mode||1!==i.config.showMonths?void 0!==i.selectedDateElem&&void 0===i.hourElement&&i.selectedDateElem&&i.selectedDateElem.focus():y(t),void 0!==i.hourElement&&void 0!==i.hourElement&&i.hourElement.focus(),i.config.closeOnSelect){var o="single"===i.config.mode&&!i.config.enableTime,u="range"===i.config.mode&&2===i.selectedDates.length&&!i.config.enableTime;(o||u)&&G()}f()}}i.parseDate=su({config:i.config,l10n:i.l10n}),i._handlers=[],i.pluginElements=[],i.loadedPlugins=[],i._bind=d,i._setHoursFromDate=u,i._positionCalendar=U,i.changeMonth=L,i.changeYear=R,i.clear=function(e,t){if(void 0===e&&(e=!0),void 0===t&&(t=!0),i.input.value="",void 0!==i.altInput&&(i.altInput.value=""),void 0!==i.mobileInput&&(i.mobileInput.value=""),i.selectedDates=[],i.latestSelectedDateObj=void 0,!0===t&&(i.currentYear=i._initialDate.getFullYear(),i.currentMonth=i._initialDate.getMonth()),!0===i.config.enableTime){var n=sf(i.config);c(n.hours,n.minutes,n.seconds)}i.redraw(),e&&W("onChange")},i.close=function(){i.isOpen=!1,i.isMobile||(void 0!==i.calendarContainer&&i.calendarContainer.classList.remove("open"),void 0!==i._input&&i._input.classList.remove("active")),W("onClose")},i.onMouseOver=O,i._createElement=a7,i.createDay=p,i.destroy=function(){void 0!==i.config&&W("onDestroy");for(var e=i._handlers.length;e--;)i._handlers[e].remove();if(i._handlers=[],i.mobileInput)i.mobileInput.parentNode&&i.mobileInput.parentNode.removeChild(i.mobileInput),i.mobileInput=void 0;else if(i.calendarContainer&&i.calendarContainer.parentNode)if(i.config.static&&i.calendarContainer.parentNode){var t=i.calendarContainer.parentNode;if(t.lastChild&&t.removeChild(t.lastChild),t.parentNode){for(;t.firstChild;)t.parentNode.insertBefore(t.firstChild,t);t.parentNode.removeChild(t)}}else i.calendarContainer.parentNode.removeChild(i.calendarContainer);i.altInput&&(i.input.type="text",i.altInput.parentNode&&i.altInput.parentNode.removeChild(i.altInput),delete i.altInput),i.input&&(i.input.type=i.input._type,i.input.classList.remove("flatpickr-input"),i.input.removeAttribute("readonly")),["_showTimeInput","latestSelectedDateObj","_hideNextMonthArrow","_hidePrevMonthArrow","__hideNextMonthArrow","__hidePrevMonthArrow","isMobile","isOpen","selectedDateElem","minDateHasTime","maxDateHasTime","days","daysContainer","_input","_positionElement","innerContainer","rContainer","monthNav","todayDateElem","calendarContainer","weekdayContainer","prevMonthNav","nextMonthNav","monthsDropdownContainer","currentMonthElement","currentYearElement","navigationCurrentMonth","selectedDateElem","config"].forEach(function(e){try{delete i[e]}catch(e){}})},i.isEnabled=D,i.jumpToDate=v,i.updateValue=J,i.open=function(e,t){if(void 0===t&&(t=i._positionElement),!0===i.isMobile){if(e){e.preventDefault();var n=sn(e);n&&n.blur()}void 0!==i.mobileInput&&(i.mobileInput.focus(),i.mobileInput.click()),W("onOpen");return}if(!i._input.disabled&&!i.config.inline){var r=i.isOpen;i.isOpen=!0,r||(i.calendarContainer.classList.add("open"),i._input.classList.add("active"),W("onOpen"),U(t)),!0!==i.config.enableTime||!0!==i.config.noCalendar||!1!==i.config.allowInput||void 0!==e&&i.timeContainer.contains(e.relatedTarget)||setTimeout(function(){return i.hourElement.select()},50)}},i.redraw=j,i.set=function(e,t){if(null!==e&&(void 0===e?"undefined":(0,Q._)(e))==="object")for(var n in Object.assign(i.config,e),e)void 0!==H[n]&&H[n].forEach(function(e){return e()});else i.config[e]=t,void 0!==H[e]?H[e].forEach(function(e){return e()}):a1.indexOf(e)>-1&&(i.config[e]=a6(t));i.redraw(),J(!0)},i.setDate=function(e,t,n){if(void 0===t&&(t=!1),void 0===n&&(n=i.config.dateFormat),0!==e&&!e||e instanceof Array&&0===e.length)return i.clear(t);V(e,n),i.latestSelectedDateObj=i.selectedDates[i.selectedDates.length-1],i.redraw(),v(void 0,t),u(),0===i.selectedDates.length&&i.clear(!1),J(t),t&&W("onChange")},i.toggle=function(e){if(!0===i.isOpen)return i.close();i.open(e)};var H={locale:[B,A],showMonths:[S,s,_],minDate:[v],maxDate:[v],positionElement:[Y],clickOpens:[function(){!0===i.config.clickOpens?(d(i._input,"focus",i.open),d(i._input,"click",i.open)):(i._input.removeEventListener("focus",i.open),i._input.removeEventListener("click",i.open))}]};function V(e,t){var n=[];if(e instanceof Array)n=e.map(function(e){return i.parseDate(e,t)});else if(e instanceof Date||"number"==typeof e)n=[i.parseDate(e,t)];else if("string"==typeof e)switch(i.config.mode){case"single":case"time":n=[i.parseDate(e,t)];break;case"multiple":n=e.split(i.config.conjunction).map(function(e){return i.parseDate(e,t)});break;case"range":n=e.split(i.l10n.rangeSeparator).map(function(e){return i.parseDate(e,t)})}else i.config.errorHandler(Error("Invalid date supplied: "+JSON.stringify(e)));i.selectedDates=i.config.allowInvalidPreload?n:n.filter(function(e){return e instanceof Date&&D(e,!1)}),"range"===i.config.mode&&i.selectedDates.sort(function(e,t){return e.getTime()-t.getTime()})}function q(e){return e.slice().map(function(e){return"string"==typeof e||"number"==typeof e||e instanceof Date?i.parseDate(e,void 0,!0):e&&(void 0===e?"undefined":(0,Q._)(e))==="object"&&e.from&&e.to?{from:i.parseDate(e.from,void 0),to:i.parseDate(e.to,void 0)}:e}).filter(function(e){return e})}function Y(){i._positionElement=i.config.positionElement||i._input}function W(e,t){if(void 0!==i.config){var n=i.config[e];if(void 0!==n&&n.length>0)for(var r=0;n[r]&&r<n.length;r++)n[r](i.selectedDates,i.input.value,i,t);"onChange"===e&&(i.input.dispatchEvent(z("change")),i.input.dispatchEvent(z("input")))}}function z(e){var t=document.createEvent("Event");return t.initEvent(e,!0,!0),t}function X(e){for(var t=0;t<i.selectedDates.length;t++){var n=i.selectedDates[t];if(n instanceof Date&&0===sc(n,e))return""+t}return!1}function $(){i.config.noCalendar||i.isMobile||!i.monthNav||(i.yearElements.forEach(function(e,t){var n=new Date(i.currentYear,i.currentMonth,1);n.setMonth(i.currentMonth+t),i.config.showMonths>1||"static"===i.config.monthSelectorType?i.monthElements[t].textContent=sr(n.getMonth(),i.config.shorthandCurrentMonth,i.l10n)+" ":i.monthsDropdownContainer.value=n.getMonth().toString(),e.value=n.getFullYear().toString()}),i._hidePrevMonthArrow=void 0!==i.config.minDate&&(i.currentYear===i.config.minDate.getFullYear()?i.currentMonth<=i.config.minDate.getMonth():i.currentYear<i.config.minDate.getFullYear()),i._hideNextMonthArrow=void 0!==i.config.maxDate&&(i.currentYear===i.config.maxDate.getFullYear()?i.currentMonth+1>i.config.maxDate.getMonth():i.currentYear>i.config.maxDate.getFullYear()))}function Z(e){var t=e||(i.config.altInput?i.config.altFormat:i.config.dateFormat);return i.selectedDates.map(function(e){return i.formatDate(e,t)}).filter(function(e,t,n){return"range"!==i.config.mode||i.config.enableTime||n.indexOf(e)===t}).join("range"!==i.config.mode?i.config.conjunction:i.l10n.rangeSeparator)}function J(e){void 0===e&&(e=!0),void 0!==i.mobileInput&&i.mobileFormatStr&&(i.mobileInput.value=void 0!==i.latestSelectedDateObj?i.formatDate(i.latestSelectedDateObj,i.mobileFormatStr):""),i.input.value=Z(i.config.dateFormat),void 0!==i.altInput&&(i.altInput.value=Z(i.config.altFormat)),!1!==e&&W("onValueUpdate")}function ee(e){var t=sn(e),n=i.prevMonthNav.contains(t),r=i.nextMonthNav.contains(t);n||r?L(n?-1:1):i.yearElements.indexOf(t)>=0?t.select():t.classList.contains("arrowUp")?i.changeYear(i.currentYear+1):t.classList.contains("arrowDown")&&i.changeYear(i.currentYear-1)}return i.element=i.input=e,i.isOpen=!1,function(){var n=["wrap","weekNumbers","allowInput","allowInvalidPreload","clickOpens","time_24hr","enableTime","noCalendar","altInput","shorthandCurrentMonth","inline","static","enableSeconds","disableMobile"],r=sv(sv({},JSON.parse(JSON.stringify(e.dataset||{}))),t),s={};i.config.parseDate=r.parseDate,i.config.formatDate=r.formatDate,Object.defineProperty(i.config,"enable",{get:function(){return i.config._enable},set:function(e){i.config._enable=q(e)}}),Object.defineProperty(i.config,"disable",{get:function(){return i.config._disable},set:function(e){i.config._disable=q(e)}});var o="time"===r.mode;if(!r.dateFormat&&(r.enableTime||o)){var l=sp.defaultConfig.dateFormat||a2.dateFormat;s.dateFormat=r.noCalendar||o?"H:i"+(r.enableSeconds?":S":""):l+" H:i"+(r.enableSeconds?":S":"")}if(r.altInput&&(r.enableTime||o)&&!r.altFormat){var u=sp.defaultConfig.altFormat||a2.altFormat;s.altFormat=r.noCalendar||o?"h:i"+(r.enableSeconds?":S K":" K"):u+" h:i"+(r.enableSeconds?":S":"")+" K"}Object.defineProperty(i.config,"minDate",{get:function(){return i.config._minDate},set:F("min")}),Object.defineProperty(i.config,"maxDate",{get:function(){return i.config._maxDate},set:F("max")});var c=function(e){return function(t){i.config["min"===e?"_minTime":"_maxTime"]=i.parseDate(t,"H:i:S")}};Object.defineProperty(i.config,"minTime",{get:function(){return i.config._minTime},set:c("min")}),Object.defineProperty(i.config,"maxTime",{get:function(){return i.config._maxTime},set:c("max")}),"time"===r.mode&&(i.config.noCalendar=!0,i.config.enableTime=!0),Object.assign(i.config,s,r);for(var h=0;h<n.length;h++)i.config[n[h]]=!0===i.config[n[h]]||"true"===i.config[n[h]];a1.filter(function(e){return void 0!==i.config[e]}).forEach(function(e){i.config[e]=a6(i.config[e]||[]).map(a)}),i.isMobile=!i.config.disableMobile&&!i.config.inline&&"single"===i.config.mode&&!i.config.disable.length&&!i.config.enable&&!i.config.weekNumbers&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);for(var h=0;h<i.config.plugins.length;h++){var d=i.config.plugins[h](i)||{};for(var f in d)a1.indexOf(f)>-1?i.config[f]=a6(d[f]).map(a).concat(i.config[f]):void 0===r[f]&&(i.config[f]=d[f])}r.altInputClass||(i.config.altInputClass=N().className+" "+i.config.altInputClass),W("onParseConfig")}(),B(),function(){if(i.input=N(),!i.input)return i.config.errorHandler(Error("Invalid input element specified"));i.input._type=i.input.type,i.input.type="text",i.input.classList.add("flatpickr-input"),i._input=i.input,i.config.altInput&&(i.altInput=a7(i.input.nodeName,i.config.altInputClass),i._input=i.altInput,i.altInput.placeholder=i.input.placeholder,i.altInput.disabled=i.input.disabled,i.altInput.required=i.input.required,i.altInput.tabIndex=i.input.tabIndex,i.altInput.type="text",i.input.setAttribute("type","hidden"),!i.config.static&&i.input.parentNode&&i.input.parentNode.insertBefore(i.altInput,i.input.nextSibling)),i.config.allowInput||i._input.setAttribute("readonly","readonly"),Y()}(),function(){i.selectedDates=[],i.now=i.parseDate(i.config.now)||new Date;var e=i.config.defaultDate||(("INPUT"===i.input.nodeName||"TEXTAREA"===i.input.nodeName)&&i.input.placeholder&&i.input.value===i.input.placeholder?null:i.input.value);e&&V(e,i.config.dateFormat),i._initialDate=i.selectedDates.length>0?i.selectedDates[0]:i.config.minDate&&i.config.minDate.getTime()>i.now.getTime()?i.config.minDate:i.config.maxDate&&i.config.maxDate.getTime()<i.now.getTime()?i.config.maxDate:i.now,i.currentYear=i._initialDate.getFullYear(),i.currentMonth=i._initialDate.getMonth(),i.selectedDates.length>0&&(i.latestSelectedDateObj=i.selectedDates[0]),void 0!==i.config.minTime&&(i.config.minTime=i.parseDate(i.config.minTime,"H:i")),void 0!==i.config.maxTime&&(i.config.maxTime=i.parseDate(i.config.maxTime,"H:i")),i.minDateHasTime=!!i.config.minDate&&(i.config.minDate.getHours()>0||i.config.minDate.getMinutes()>0||i.config.minDate.getSeconds()>0),i.maxDateHasTime=!!i.config.maxDate&&(i.config.maxDate.getHours()>0||i.config.maxDate.getMinutes()>0||i.config.maxDate.getSeconds()>0)}(),i.utils={getDaysInMonth:function(e,t){return(void 0===e&&(e=i.currentMonth),void 0===t&&(t=i.currentYear),1===e&&(t%4==0&&t%100!=0||t%400==0))?29:i.l10n.daysInMonth[e]}},i.isMobile||function(){var e=window.document.createDocumentFragment();if(i.calendarContainer=a7("div","flatpickr-calendar"),i.calendarContainer.tabIndex=-1,!i.config.noCalendar){if(e.appendChild((i.monthNav=a7("div","flatpickr-months"),i.yearElements=[],i.monthElements=[],i.prevMonthNav=a7("span","flatpickr-prev-month"),i.prevMonthNav.innerHTML=i.config.prevArrow,i.nextMonthNav=a7("span","flatpickr-next-month"),i.nextMonthNav.innerHTML=i.config.nextArrow,S(),Object.defineProperty(i,"_hidePrevMonthArrow",{get:function(){return i.__hidePrevMonthArrow},set:function(e){i.__hidePrevMonthArrow!==e&&(a9(i.prevMonthNav,"flatpickr-disabled",e),i.__hidePrevMonthArrow=e)}}),Object.defineProperty(i,"_hideNextMonthArrow",{get:function(){return i.__hideNextMonthArrow},set:function(e){i.__hideNextMonthArrow!==e&&(a9(i.nextMonthNav,"flatpickr-disabled",e),i.__hideNextMonthArrow=e)}}),i.currentYearElement=i.yearElements[0],$(),i.monthNav)),i.innerContainer=a7("div","flatpickr-innerContainer"),i.config.weekNumbers){var t=function(){i.calendarContainer.classList.add("hasWeeks");var e=a7("div","flatpickr-weekwrapper");e.appendChild(a7("span","flatpickr-weekday",i.l10n.weekAbbreviation));var t=a7("div","flatpickr-weeks");return e.appendChild(t),{weekWrapper:e,weekNumbers:t}}(),n=t.weekWrapper,r=t.weekNumbers;i.innerContainer.appendChild(n),i.weekNumbers=r,i.weekWrapper=n}i.rContainer=a7("div","flatpickr-rContainer"),i.rContainer.appendChild(_()),i.daysContainer||(i.daysContainer=a7("div","flatpickr-days"),i.daysContainer.tabIndex=-1),b(),i.rContainer.appendChild(i.daysContainer),i.innerContainer.appendChild(i.rContainer),e.appendChild(i.innerContainer)}i.config.enableTime&&e.appendChild(function(){i.calendarContainer.classList.add("hasTime"),i.config.noCalendar&&i.calendarContainer.classList.add("noCalendar");var e=sf(i.config);i.timeContainer=a7("div","flatpickr-time"),i.timeContainer.tabIndex=-1;var t=a7("span","flatpickr-time-separator",":"),n=st("flatpickr-hour",{"aria-label":i.l10n.hourAriaLabel});i.hourElement=n.getElementsByTagName("input")[0];var r=st("flatpickr-minute",{"aria-label":i.l10n.minuteAriaLabel});if(i.minuteElement=r.getElementsByTagName("input")[0],i.hourElement.tabIndex=i.minuteElement.tabIndex=-1,i.hourElement.value=a5(i.latestSelectedDateObj?i.latestSelectedDateObj.getHours():i.config.time_24hr?e.hours:function(e){switch(e%24){case 0:case 12:return 12;default:return e%12}}(e.hours)),i.minuteElement.value=a5(i.latestSelectedDateObj?i.latestSelectedDateObj.getMinutes():e.minutes),i.hourElement.setAttribute("step",i.config.hourIncrement.toString()),i.minuteElement.setAttribute("step",i.config.minuteIncrement.toString()),i.hourElement.setAttribute("min",i.config.time_24hr?"0":"1"),i.hourElement.setAttribute("max",i.config.time_24hr?"23":"12"),i.hourElement.setAttribute("maxlength","2"),i.minuteElement.setAttribute("min","0"),i.minuteElement.setAttribute("max","59"),i.minuteElement.setAttribute("maxlength","2"),i.timeContainer.appendChild(n),i.timeContainer.appendChild(t),i.timeContainer.appendChild(r),i.config.time_24hr&&i.timeContainer.classList.add("time24hr"),i.config.enableSeconds){i.timeContainer.classList.add("hasSeconds");var a=st("flatpickr-second");i.secondElement=a.getElementsByTagName("input")[0],i.secondElement.value=a5(i.latestSelectedDateObj?i.latestSelectedDateObj.getSeconds():e.seconds),i.secondElement.setAttribute("step",i.minuteElement.getAttribute("step")),i.secondElement.setAttribute("min","0"),i.secondElement.setAttribute("max","59"),i.secondElement.setAttribute("maxlength","2"),i.timeContainer.appendChild(a7("span","flatpickr-time-separator",":")),i.timeContainer.appendChild(a)}return i.config.time_24hr||(i.amPM=a7("span","flatpickr-am-pm",i.l10n.amPM[a4((i.latestSelectedDateObj?i.hourElement.value:i.config.defaultHour)>11)]),i.amPM.title=i.l10n.toggleTitle,i.amPM.tabIndex=-1,i.timeContainer.appendChild(i.amPM)),i.timeContainer}()),a9(i.calendarContainer,"rangeMode","range"===i.config.mode),a9(i.calendarContainer,"animate",!0===i.config.animate),a9(i.calendarContainer,"multiMonth",i.config.showMonths>1),i.calendarContainer.appendChild(e);var a=void 0!==i.config.appendTo&&void 0!==i.config.appendTo.nodeType;if((i.config.inline||i.config.static)&&(i.calendarContainer.classList.add(i.config.inline?"inline":"static"),i.config.inline&&(!a&&i.element.parentNode?i.element.parentNode.insertBefore(i.calendarContainer,i._input.nextSibling):void 0!==i.config.appendTo&&i.config.appendTo.appendChild(i.calendarContainer)),i.config.static)){var s=a7("div","flatpickr-wrapper");i.element.parentNode&&i.element.parentNode.insertBefore(s,i.element),s.appendChild(i.element),i.altInput&&s.appendChild(i.altInput),s.appendChild(i.calendarContainer)}i.config.static||i.config.inline||(void 0!==i.config.appendTo?i.config.appendTo:window.document.body).appendChild(i.calendarContainer)}(),function(){if(i.config.wrap&&["open","close","toggle","clear"].forEach(function(e){Array.prototype.forEach.call(i.element.querySelectorAll("[data-"+e+"]"),function(t){return d(t,"click",i[e])})}),i.isMobile)return function(){var e=i.config.enableTime?i.config.noCalendar?"time":"datetime-local":"date";i.mobileInput=a7("input",i.input.className+" flatpickr-mobile"),i.mobileInput.tabIndex=1,i.mobileInput.type=e,i.mobileInput.disabled=i.input.disabled,i.mobileInput.required=i.input.required,i.mobileInput.placeholder=i.input.placeholder,i.mobileFormatStr="datetime-local"===e?"Y-m-d\\TH:i:S":"date"===e?"Y-m-d":"H:i:S",i.selectedDates.length>0&&(i.mobileInput.defaultValue=i.mobileInput.value=i.formatDate(i.selectedDates[0],i.mobileFormatStr)),i.config.minDate&&(i.mobileInput.min=i.formatDate(i.config.minDate,"Y-m-d")),i.config.maxDate&&(i.mobileInput.max=i.formatDate(i.config.maxDate,"Y-m-d")),i.input.getAttribute("step")&&(i.mobileInput.step=String(i.input.getAttribute("step"))),i.input.type="hidden",void 0!==i.altInput&&(i.altInput.type="hidden");try{i.input.parentNode&&i.input.parentNode.insertBefore(i.mobileInput,i.input.nextSibling)}catch(e){}d(i.mobileInput,"change",function(e){i.setDate(sn(e).value,!1,i.mobileFormatStr),W("onChange"),W("onClose")})}();var e=a8(M,50);i._debouncedChange=a8(f,300),i.daysContainer&&!/iPhone|iPad|iPod/i.test(navigator.userAgent)&&d(i.daysContainer,"mouseover",function(e){"range"===i.config.mode&&O(sn(e))}),d(i._input,"keydown",P),void 0!==i.calendarContainer&&d(i.calendarContainer,"keydown",P),i.config.inline||i.config.static||d(window,"resize",e),void 0!==window.ontouchstart?d(window.document,"touchstart",I):d(window.document,"mousedown",I),d(window.document,"focus",I,{capture:!0}),!0===i.config.clickOpens&&(d(i._input,"focus",i.open),d(i._input,"click",i.open)),void 0!==i.daysContainer&&(d(i.monthNav,"click",ee),d(i.monthNav,["keyup","increment"],h),d(i.daysContainer,"click",K)),void 0!==i.timeContainer&&void 0!==i.minuteElement&&void 0!==i.hourElement&&(d(i.timeContainer,["increment"],o),d(i.timeContainer,"blur",o,{capture:!0}),d(i.timeContainer,"click",g),d([i.hourElement,i.minuteElement],["focus","click"],function(e){return sn(e).select()}),void 0!==i.secondElement&&d(i.secondElement,"focus",function(){return i.secondElement&&i.secondElement.select()}),void 0!==i.amPM&&d(i.amPM,"click",function(e){o(e)})),i.config.allowInput&&d(i._input,"blur",x)}(),(i.selectedDates.length||i.config.noCalendar)&&(i.config.enableTime&&u(i.config.noCalendar?i.latestSelectedDateObj:void 0),J(!1)),s(),n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),!i.isMobile&&n&&U(),W("onReady"),i}(a,t||{}),i.push(a._flatpickr)}catch(e){console.error(e)}}return 1===i.length?i[0]:i}"undefined"!=typeof HTMLElement&&"undefined"!=typeof HTMLCollection&&"undefined"!=typeof NodeList&&(HTMLCollection.prototype.flatpickr=NodeList.prototype.flatpickr=function(e){return sm(this,e)},HTMLElement.prototype.flatpickr=function(e){return sm([this],e)});var sp=function(e,t){return"string"==typeof e?sm(window.document.querySelectorAll(e),t):e instanceof Node?sm([e],t):sm(e,t)};sp.defaultConfig={},sp.l10ns={en:sv({},a3),default:sv({},a3)},sp.localize=function(e){sp.l10ns.default=sv(sv({},sp.l10ns.default),e)},sp.setDefaults=function(e){sp.defaultConfig=sv(sv({},sp.defaultConfig),e)},sp.parseDate=su({}),sp.formatDate=sl({}),sp.compareDates=sc,"undefined"!=typeof jQuery&&void 0!==jQuery.fn&&(jQuery.fn.flatpickr=function(e){return sm(this,e)}),Date.prototype.fp_incr=function(e){return new Date(this.getFullYear(),this.getMonth(),this.getDate()+("string"==typeof e?parseInt(e,10):e))},"undefined"!=typeof window&&(window.flatpickr=sp);var sy=function(e){"use strict";function t(e,n){var i;return(0,K._)(this,t),(i=(0,G._)(this,t,[e,ap(rq({},n),{type:"input"})])).input=e.querySelectorAll("input")[0],i.fp=sp(i.input,{dateFormat:"d.m.Y"}),i}return(0,W._)(t,e),(0,H._)(t,[{key:"getValue",value:function(){return this.input.value}},{key:"setValue",value:function(e){}},{key:"reset",value:function(){}},{key:"isValid",value:function(){return!this.isRequired||""!==this.input.value.trim()}}]),t}(aZ),G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),Q=N("16gB1");function sE(e,t,n){var i;return(t="symbol"==(void 0===(i=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?"undefined":(0,Q._)(i))?i:i+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var sk=function(e){"use strict";function t(e,n){(0,K._)(this,t),sE(i=(0,G._)(this,t,[e,ap(rq({},n),{type:"radios"})]),"options",[]),sE(i,"other",null);var i,r=i.element.getElementsByClassName("form-radio-input"),a=i.element.getElementsByClassName("radio-other");a.length&&(i.other=a[0]);for(var s=0;s<r.length;s++)i.options.push(r[s]),r[s].addEventListener("click",function(){i.handleChanges.bind(i)(),i.other&&(i.other.value="")});return i.other&&i.other.addEventListener("keyup",function(){i.options.forEach(function(e){e.checked=!1}),i.handleChanges.bind(i)()}),i}return(0,W._)(t,e),(0,H._)(t,[{key:"getValue",value:function(){var e=null;return this.other&&this.other.value.length&&(e=this.other.value),this.options.forEach(function(t){t.checked&&(e=t.value)}),e}},{key:"isValid",value:function(){if(!this.isRequired)return!0;var e=this.getValue();return e&&e.length}}]),t}(aZ),G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),sb=function(e){"use strict";function t(e,n){var i;return(0,K._)(this,t),(i=(0,G._)(this,t,[e,ap(rq({},n),{type:"input"})])).input=e.querySelectorAll("input")[0],i.input.addEventListener("keyup",i.handleChanges.bind(i)),i}return(0,W._)(t,e),(0,H._)(t,[{key:"getValue",value:function(){return this.input.value}},{key:"setValue",value:function(e){this.input.value=e}},{key:"isValid",value:function(){if(!this.isRequired)return!0;if("email"===this.input.getAttribute("type"))return/\S+@\S+\.\S+/.test(this.input.value);if("date"===this.input.getAttribute("type")&&this.input.getAttribute("min")){var e=new Date(this.input.value),t=new Date;return t.setHours(0,0,0,0),e>t}return""!==this.input.value.trim()}}]),t}(aZ),G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),Q=N("16gB1"),sT=function(e){"use strict";function t(e,n){var i,r,a,s;return(0,K._)(this,t),r=i=(0,G._)(this,t,[e,ap(rq({},n),{type:"select"})]),(a="symbol"==(void 0===(s=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(a="select","string"))?"undefined":(0,Q._)(s))?s:s+"")in r?Object.defineProperty(r,a,{value:null,enumerable:!0,configurable:!0,writable:!0}):r[a]=null,i.select=e.querySelectorAll("select")[0],i.select.addEventListener("change",i.handleChanges.bind(i)),i}return(0,W._)(t,e),(0,H._)(t,[{key:"getValue",value:function(){return this.select.value,this.select.value}},{key:"isValid",value:function(){return!this.isRequired||""!==this.select.value.trim()}}]),t}(aZ),G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),Q=N("16gB1"),sS={},Q=N("16gB1");function s_(e,t,n){var i;return(t="symbol"==(void 0===(i=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?"undefined":(0,Q._)(i))?i:i+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}b="undefined"!=typeof self?self:void 0,T=function(){"function"!=typeof Promise&&function(e){function t(e,t){return function(){e.apply(t,arguments)}}function n(e){if("object"!==(0,Q._)(this))throw TypeError("Promises must be constructed via new");if("function"!=typeof e)throw TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],l(e,t(r,this),t(a,this))}function i(e){var t=this;return null===this._state?void this._deferreds.push(e):void c(function(){var n,i=t._state?e.onFulfilled:e.onRejected;if(null===i)return void(t._state?e.resolve:e.reject)(t._value);try{n=i(t._value)}catch(t){return void e.reject(t)}e.resolve(n)})}function r(e){try{if(e===this)throw TypeError("A promise cannot be resolved with itself.");if(e&&("object"===(void 0===e?"undefined":(0,Q._)(e))||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void l(t(n,e),t(r,this),t(a,this))}this._state=!0,this._value=e,s.call(this)}catch(e){a.call(this,e)}}function a(e){this._state=!1,this._value=e,s.call(this)}function s(){for(var e=0,t=this._deferreds.length;t>e;e++)i.call(this,this._deferreds[e]);this._deferreds=null}function o(e,t,n,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=i}function l(e,t,n){var i=!1;try{e(function(e){i||(i=!0,t(e))},function(e){i||(i=!0,n(e))})}catch(e){if(i)return;i=!0,n(e)}}var u=setTimeout,c="function"==typeof setImmediate&&setImmediate||function(e){u(e,1)},h=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};n.prototype.catch=function(e){return this.then(null,e)},n.prototype.then=function(e,t){var r=this;return new n(function(n,a){i.call(r,new o(e,t,n,a))})},n.all=function(){var e=Array.prototype.slice.call(1==arguments.length&&h(arguments[0])?arguments[0]:arguments);return new n(function(t,n){if(0===e.length)return t([]);for(var i=e.length,r=0;r<e.length;r++)!function r(a,s){try{if(s&&("object"===(void 0===s?"undefined":(0,Q._)(s))||"function"==typeof s)){var o=s.then;if("function"==typeof o)return void o.call(s,function(e){r(a,e)},n)}e[a]=s,0==--i&&t(e)}catch(e){n(e)}}(r,e[r])})},n.resolve=function(e){return e&&"object"===(void 0===e?"undefined":(0,Q._)(e))&&e.constructor===n?e:new n(function(t){t(e)})},n.reject=function(e){return new n(function(t,n){n(e)})},n.race=function(e){return new n(function(t,n){for(var i=0,r=e.length;r>i;i++)e[i].then(t,n)})},n._setImmediateFn=function(e){c=e},sS?sS=n:e.Promise||(e.Promise=n)}(this),"undefined"!=typeof window&&"function"!=typeof window.CustomEvent&&function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}e.prototype=window.Event.prototype,window.CustomEvent=e}(),"undefined"==typeof HTMLCanvasElement||HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,n){for(var i=atob(this.toDataURL(t,n).split(",")[1]),r=i.length,a=new Uint8Array(r),s=0;s<r;s++)a[s]=i.charCodeAt(s);e(new Blob([a],{type:t||"image/png"}))}});var e,t,n,i,r,a=["Webkit","Moz","ms"],s="undefined"!=typeof document?document.createElement("div").style:{},o=[1,8,3,6],l=[2,7,4,5];function u(e){if(e in s)return e;for(var t=e[0].toUpperCase()+e.slice(1),n=a.length;n--;)if((e=a[n]+t)in s)return e}function c(e,t){for(var n in e=e||{},t)t[n]&&t[n].constructor&&t[n].constructor===Object?(e[n]=e[n]||{},c(e[n],t[n])):e[n]=t[n];return e}i=u("transform"),n=u("transformOrigin"),r=u("userSelect");function h(e){if("createEvent"in document){var t=document.createEvent("HTMLEvents");t.initEvent("change",!1,!0),e.dispatchEvent(t)}else e.fireEvent("onchange")}function d(e,t,n){if("string"==typeof t){var i=t;(t={})[i]=n}for(var r in t)e.style[r]=t[r]}function f(e,t){e.classList?e.classList.add(t):e.className+=" "+t}function v(e,t){for(var n in t)e.setAttribute(n,t[n])}function g(e){return parseInt(e,10)}function m(e,t){var n=e.naturalWidth,i=e.naturalHeight,r=t||k(e);if(r&&r>=5){var a=n;n=i,i=a}return{width:n,height:i}}var p={translate3d:{suffix:", 0px"},translate:{suffix:""}},y=function(e,t,n){this.x=parseFloat(e),this.y=parseFloat(t),this.scale=parseFloat(n)};y.parse=function(e){return e.style?y.parse(e.style[i]):e.indexOf("matrix")>-1||e.indexOf("none")>-1?y.fromMatrix(e):y.fromString(e)},y.fromMatrix=function(e){var t=e.substring(7).split(",");return t.length&&"none"!==e||(t=[1,0,0,1,0,0]),new y(g(t[4]),g(t[5]),parseFloat(t[0]))},y.fromString=function(e){var t=e.split(") "),n=t[0].substring(en.globals.translate.length+1).split(","),i=t.length>1?t[1].substring(6):1;return new y(n.length>1?n[0]:0,n.length>1?n[1]:0,i)},y.prototype.toString=function(){var e=p[en.globals.translate].suffix||"";return en.globals.translate+"("+this.x+"px, "+this.y+"px"+e+") scale("+this.scale+")"};var E=function(e){if(!e||!e.style[n]){this.x=0,this.y=0;return}var t=e.style[n].split(" ");this.x=parseFloat(t[0]),this.y=parseFloat(t[1])};function k(e){return e.exifdata&&e.exifdata.Orientation?g(e.exifdata.Orientation):1}function b(e,t,n){var i=t.width,r=t.height,a=e.getContext("2d");switch(e.width=t.width,e.height=t.height,a.save(),n){case 2:a.translate(i,0),a.scale(-1,1);break;case 3:a.translate(i,r),a.rotate(180*Math.PI/180);break;case 4:a.translate(0,r),a.scale(1,-1);break;case 5:e.width=r,e.height=i,a.rotate(90*Math.PI/180),a.scale(1,-1);break;case 6:e.width=r,e.height=i,a.rotate(90*Math.PI/180),a.translate(0,-r);break;case 7:e.width=r,e.height=i,a.rotate(-90*Math.PI/180),a.translate(-i,r),a.scale(1,-1);break;case 8:e.width=r,e.height=i,a.translate(0,i),a.rotate(-90*Math.PI/180)}a.drawImage(t,0,0,i,r),a.restore()}function T(){var e,t,n,i,r,a,s=this.options.viewport.type?"cr-vp-"+this.options.viewport.type:null;this.options.useCanvas=this.options.enableOrientation||S.call(this),this.data={},this.elements={},e=this.elements.boundary=document.createElement("div"),n=this.elements.viewport=document.createElement("div"),t=this.elements.img=document.createElement("img"),i=this.elements.overlay=document.createElement("div"),this.options.useCanvas?(this.elements.canvas=document.createElement("canvas"),this.elements.preview=this.elements.canvas):this.elements.preview=t,f(e,"cr-boundary"),e.setAttribute("aria-dropeffect","none"),r=this.options.boundary.width,a=this.options.boundary.height,d(e,{width:r+(isNaN(r)?"":"px"),height:a+(isNaN(a)?"":"px")}),f(n,"cr-viewport"),s&&f(n,s),d(n,{width:this.options.viewport.width+"px",height:this.options.viewport.height+"px"}),n.setAttribute("tabindex",0),f(this.elements.preview,"cr-image"),v(this.elements.preview,{alt:"preview","aria-grabbed":"false"}),f(i,"cr-overlay"),this.element.appendChild(e),e.appendChild(this.elements.preview),e.appendChild(n),e.appendChild(i),f(this.element,"croppie-container"),this.options.customClass&&f(this.element,this.options.customClass),D.call(this),this.options.enableZoom&&L.call(this),this.options.enableResize&&_.call(this)}function S(){return this.options.enableExif&&window.EXIF}function _(){var e,t,n,i,a,s,o,l=this,u=document.createElement("div"),c=!1;function h(s){if((void 0===s.button||0===s.button)&&(s.preventDefault(),!c)){var o=l.elements.overlay.getBoundingClientRect();if(c=!0,t=s.pageX,n=s.pageY,e=-1!==s.currentTarget.className.indexOf("vertical")?"v":"h",i=o.width,a=o.height,s.touches){var u=s.touches[0];t=u.pageX,n=u.pageY}window.addEventListener("mousemove",v),window.addEventListener("touchmove",v),window.addEventListener("mouseup",g),window.addEventListener("touchend",g),document.body.style[r]="none"}}function v(r){var s=r.pageX,o=r.pageY;if(r.preventDefault(),r.touches){var c=r.touches[0];s=c.pageX,o=c.pageY}var h=s-t,f=o-n,v=l.options.viewport.height+f,g=l.options.viewport.width+h;"v"===e&&v>=50&&v<=a?(d(u,{height:v+"px"}),l.options.boundary.height+=f,d(l.elements.boundary,{height:l.options.boundary.height+"px"}),l.options.viewport.height+=f,d(l.elements.viewport,{height:l.options.viewport.height+"px"})):"h"===e&&g>=50&&g<=i&&(d(u,{width:g+"px"}),l.options.boundary.width+=h,d(l.elements.boundary,{width:l.options.boundary.width+"px"}),l.options.viewport.width+=h,d(l.elements.viewport,{width:l.options.viewport.width+"px"})),C.call(l),F.call(l),R.call(l),P.call(l),n=o,t=s}function g(){c=!1,window.removeEventListener("mousemove",v),window.removeEventListener("touchmove",v),window.removeEventListener("mouseup",g),window.removeEventListener("touchend",g),document.body.style[r]=""}f(u,"cr-resizer"),d(u,{width:this.options.viewport.width+"px",height:this.options.viewport.height+"px"}),this.options.resizeControls.height&&(f(s=document.createElement("div"),"cr-resizer-vertical"),u.appendChild(s)),this.options.resizeControls.width&&(f(o=document.createElement("div"),"cr-resizer-horisontal"),u.appendChild(o)),s&&(s.addEventListener("mousedown",h),s.addEventListener("touchstart",h)),o&&(o.addEventListener("mousedown",h),o.addEventListener("touchstart",h)),this.elements.boundary.appendChild(u)}function A(e){if(this.options.enableZoom){var t=this.elements.zoomer,n=Y(e,4);t.value=Math.max(parseFloat(t.min),Math.min(parseFloat(t.max),n)).toString()}}function L(){var e=this,t=e.elements.zoomerWrap=document.createElement("div"),n=e.elements.zoomer=document.createElement("input");function i(){w.call(e,{value:parseFloat(n.value),origin:new E(e.elements.preview),viewportRect:e.elements.viewport.getBoundingClientRect(),transform:y.parse(e.elements.preview)})}function r(t){var n,r;if("ctrl"===e.options.mouseWheelZoom&&!0!==t.ctrlKey)return 0;n=t.wheelDelta?t.wheelDelta/1200:t.deltaY?t.deltaY/1060:t.detail?-(t.detail/60):0,r=e._currentZoom+n*e._currentZoom,t.preventDefault(),A.call(e,r),i.call(e)}f(t,"cr-slider-wrap"),f(n,"cr-slider"),n.type="range",n.step="0.0001",n.value="1",n.style.display=e.options.showZoomer?"":"none",n.setAttribute("aria-label","zoom"),e.element.appendChild(t),t.appendChild(n),e._currentZoom=1,e.elements.zoomer.addEventListener("input",i),e.elements.zoomer.addEventListener("change",i),e.options.mouseWheelZoom&&(e.elements.boundary.addEventListener("mousewheel",r),e.elements.boundary.addEventListener("DOMMouseScroll",r))}function w(e){var t=this,r=e?e.transform:y.parse(t.elements.preview),a=e?e.viewportRect:t.elements.viewport.getBoundingClientRect(),s=e?e.origin:new E(t.elements.preview);function o(){var e={};e[i]=r.toString(),e[n]=s.toString(),d(t.elements.preview,e)}if(t._currentZoom=e?e.value:t._currentZoom,r.scale=t._currentZoom,t.elements.zoomer.setAttribute("aria-valuenow",t._currentZoom),o(),t.options.enforceBoundary){var l=I.call(t,a),u=l.translate,c=l.origin;r.x>=u.maxX&&(s.x=c.minX,r.x=u.maxX),r.x<=u.minX&&(s.x=c.maxX,r.x=u.minX),r.y>=u.maxY&&(s.y=c.minY,r.y=u.maxY),r.y<=u.minY&&(s.y=c.maxY,r.y=u.minY)}o(),x.call(t),P.call(t)}function I(e){var t=this._currentZoom,n=e.width,i=e.height,r=this.elements.boundary.clientWidth/2,a=this.elements.boundary.clientHeight/2,s=this.elements.preview.getBoundingClientRect(),o=s.width,l=s.height,u=n/2,c=i/2,h=-((u/t-r)*1),d=-((c/t-a)*1),f=1/t*u,v=1/t*c;return{translate:{maxX:h,minX:h-(1/t*o-1/t*n),maxY:d,minY:d-(1/t*l-1/t*i)},origin:{maxX:1/t*o-f,minX:f,maxY:1/t*l-v,minY:v}}}function R(e){var t=this._currentZoom,r=this.elements.preview.getBoundingClientRect(),a=this.elements.viewport.getBoundingClientRect(),s=y.parse(this.elements.preview.style[i]),o=new E(this.elements.preview),l=a.top-r.top+a.height/2,u=a.left-r.left+a.width/2,c={},h={};if(e){var f=o.x,v=o.y,g=s.x,m=s.y;c.y=f,c.x=v,s.y=g,s.x=m}else c.y=l/t,c.x=u/t,h.y=(c.y-o.y)*(1-t),h.x=(c.x-o.x)*(1-t),s.x-=h.x,s.y-=h.y;var p={};p[n]=c.x+"px "+c.y+"px",p[i]=s.toString(),d(this.elements.preview,p)}function D(){var e,t,n,a,s,o=this,l=!1;function u(e,t){var n=o.elements.preview.getBoundingClientRect(),i=s.y+t,r=s.x+e;o.options.enforceBoundary?(a.top>n.top+t&&a.bottom<n.bottom+t&&(s.y=i),a.left>n.left+e&&a.right<n.right+e&&(s.x=r)):(s.y=i,s.x=r)}function c(e){o.elements.preview.setAttribute("aria-grabbed",e),o.elements.boundary.setAttribute("aria-dropeffect",e?"move":"none")}function f(n){if((void 0===n.button||0===n.button)&&(n.preventDefault(),!l)){if(l=!0,e=n.pageX,t=n.pageY,n.touches){var i=n.touches[0];e=i.pageX,t=i.pageY}c(l),s=y.parse(o.elements.preview),window.addEventListener("mousemove",v),window.addEventListener("touchmove",v),window.addEventListener("mouseup",g),window.addEventListener("touchend",g),document.body.style[r]="none",a=o.elements.viewport.getBoundingClientRect()}}function v(r){r.preventDefault();var a=r.pageX,l=r.pageY;if(r.touches){var c=r.touches[0];a=c.pageX,l=c.pageY}var f=a-e,v=l-t,g={};if("touchmove"===r.type&&r.touches.length>1){var m=r.touches[0],p=r.touches[1],y=Math.sqrt((m.pageX-p.pageX)*(m.pageX-p.pageX)+(m.pageY-p.pageY)*(m.pageY-p.pageY));n||(n=y/o._currentZoom);var E=y/n;A.call(o,E),h(o.elements.zoomer);return}u(f,v),g[i]=s.toString(),d(o.elements.preview,g),C.call(o),t=l,e=a}function g(){c(l=!1),window.removeEventListener("mousemove",v),window.removeEventListener("touchmove",v),window.removeEventListener("mouseup",g),window.removeEventListener("touchend",g),document.body.style[r]="",R.call(o),P.call(o),n=0}o.elements.overlay.addEventListener("mousedown",f),o.elements.viewport.addEventListener("keydown",function(e){var t;if(e.shiftKey&&(38===e.keyCode||40===e.keyCode))t=38===e.keyCode?parseFloat(o.elements.zoomer.value)+parseFloat(o.elements.zoomer.step):parseFloat(o.elements.zoomer.value)-parseFloat(o.elements.zoomer.step),o.setZoom(t);else if(o.options.enableKeyMovement&&e.keyCode>=37&&e.keyCode<=40){e.preventDefault();var l,c,h,f,v=function(e){switch(e){case 37:return[1,0];case 38:return[0,1];case 39:return[-1,0];case 40:return[0,-1]}}(e.keyCode);s=y.parse(o.elements.preview),document.body.style[r]="none",a=o.elements.viewport.getBoundingClientRect(),c=(l=v)[0],h=l[1],f={},u(c,h),f[i]=s.toString(),d(o.elements.preview,f),C.call(o),document.body.style[r]="",R.call(o),P.call(o),n=0}}),o.elements.overlay.addEventListener("touchstart",f)}function C(){if(this.elements){var e=this.elements.boundary.getBoundingClientRect(),t=this.elements.preview.getBoundingClientRect();d(this.elements.overlay,{width:t.width+"px",height:t.height+"px",top:t.top-e.top+"px",left:t.left-e.left+"px"})}}E.prototype.toString=function(){return this.x+"px "+this.y+"px"};var x=function(){var n=this,i=arguments,r=e&&!t;clearTimeout(t),t=setTimeout(function(){t=null,e||C.apply(n,i)},500),r&&C.apply(n,i)};function P(){var e,t=this.get();O.call(this)&&(this.options.update.call(this,t),this.$&&"undefined"==typeof Prototype?this.$(this.element).trigger("update.croppie",t):(window.CustomEvent?e=new CustomEvent("update",{detail:t}):(e=document.createEvent("CustomEvent")).initCustomEvent("update",!0,!0,t),this.element.dispatchEvent(e)))}function O(){return this.elements.preview.offsetHeight>0&&this.elements.preview.offsetWidth>0}function M(){var e,t={},r=this.elements.preview,a=new y(0,0,1),s=new E;O.call(this)&&!this.data.bound&&(this.data.bound=!0,t[i]=a.toString(),t[n]=s.toString(),t.opacity=1,d(r,t),e=this.elements.preview.getBoundingClientRect(),this._originalImageWidth=e.width,this._originalImageHeight=e.height,this.data.orientation=S.call(this)?k(this.elements.img):this.data.orientation,this.options.enableZoom?F.call(this,!0):this._currentZoom=1,a.scale=this._currentZoom,t[i]=a.toString(),d(r,t),this.data.points.length?N.call(this,this.data.points):B.call(this),R.call(this),C.call(this))}function F(e){var t,n,i=Math.max(this.options.minZoom,0)||0,r=this.options.maxZoom||1.5,a=this.elements.zoomer,s=parseFloat(a.value),o=this.elements.boundary.getBoundingClientRect(),l=m(this.elements.img,this.data.orientation),u=this.elements.viewport.getBoundingClientRect();this.options.enforceBoundary&&(i=Math.max(u.width/l.width,u.height/l.height)),i>=r&&(r=i+1),a.min=Y(i,4),a.max=Y(r,4),!e&&(s<a.min||s>a.max)?A.call(this,s<a.min?a.min:a.max):e&&(n=Math.max(o.width/l.width,o.height/l.height),t=null!==this.data.boundZoom?this.data.boundZoom:n,A.call(this,t)),h(a)}function N(e){if(4!==e.length)throw"Croppie - Invalid number of points supplied: "+e;var t=e[2]-e[0],r=this.elements.viewport.getBoundingClientRect(),a=this.elements.boundary.getBoundingClientRect(),s={left:r.left-a.left,top:r.top-a.top},o=r.width/t,l=e[1],u=e[0],c=-1*e[1]+s.top,h=-1*e[0]+s.left,f={};f[n]=u+"px "+l+"px",f[i]=new y(h,c,o).toString(),d(this.elements.preview,f),A.call(this,o),this._currentZoom=o}function B(){var e=this.elements.preview.getBoundingClientRect(),t=this.elements.viewport.getBoundingClientRect(),n=this.elements.boundary.getBoundingClientRect(),r=t.left-n.left,a=t.top-n.top,s=new y(r-(e.width-t.width)/2,a-(e.height-t.height)/2,this._currentZoom);d(this.elements.preview,i,s.toString())}function U(e){var t=this.elements.canvas,n=this.elements.img;t.getContext("2d").clearRect(0,0,t.width,t.height),t.width=n.width,t.height=n.height;var i=this.options.enableOrientation&&e||k(n);b(t,n,i)}function j(e){var t=e.points,n=g(t[0]),i=g(t[1]),r=g(t[2]),a=g(t[3]),s=r-n,o=a-i,l=e.circle,u=document.createElement("canvas"),c=u.getContext("2d"),h=e.outputWidth||s,d=e.outputHeight||o;u.width=h,u.height=d,e.backgroundColor&&(c.fillStyle=e.backgroundColor,c.fillRect(0,0,h,d));var f=n,v=i,m=s,p=o,y=0,E=0,k=h,b=d;return n<0&&(f=0,y=Math.abs(n)/s*h),m+f>this._originalImageWidth&&(k=(m=this._originalImageWidth-f)/s*h),i<0&&(v=0,E=Math.abs(i)/o*d),p+v>this._originalImageHeight&&(b=(p=this._originalImageHeight-v)/o*d),c.drawImage(this.elements.preview,f,v,m,p,y,E,k,b),l&&(c.fillStyle="#fff",c.globalCompositeOperation="destination-in",c.beginPath(),c.arc(u.width/2,u.height/2,u.width/2,0,2*Math.PI,!0),c.closePath(),c.fill()),u}function G(e){var t=e.points,n=document.createElement("div"),i=document.createElement("img"),r=t[2]-t[0],a=t[3]-t[1];return f(n,"croppie-result"),n.appendChild(i),d(i,{left:-1*t[0]+"px",top:-1*t[1]+"px"}),i.src=e.url,d(n,{width:r+"px",height:a+"px"}),n}function K(e){return j.call(this,e).toDataURL(e.format,e.quality)}function H(e){var t=this;return new Promise(function(n){j.call(t,e).toBlob(function(e){n(e)},e.format,e.quality)})}function V(e){this.elements.img.parentNode&&(Array.prototype.forEach.call(this.elements.img.classList,function(t){e.classList.add(t)}),this.elements.img.parentNode.replaceChild(e,this.elements.img),this.elements.preview=e),this.elements.img=e}function q(e,t){var n,i=this,r=[],a=null,s=S.call(i);if("string"==typeof e)n=e,e={};else if(Array.isArray(e))r=e.slice();else{if(void 0===e&&i.data.url)return M.call(i),P.call(i),null;n=e.url,r=e.points||[],a=void 0===e.zoom?null:e.zoom}return i.data.bound=!1,i.data.url=n||i.data.url,i.data.boundZoom=a,(function(e,t){if(!e)throw"Source image missing";var n=new Image;return n.style.opacity="0",new Promise(function(i,r){function a(){n.style.opacity="1",setTimeout(function(){i(n)},1)}n.removeAttribute("crossOrigin"),e.match(/^https?:\/\/|^\/\//)&&n.setAttribute("crossOrigin","anonymous"),n.onload=function(){t?EXIF.getData(n,function(){a()}):a()},n.onerror=function(e){n.style.opacity=1,setTimeout(function(){r(e)},1)},n.src=e})})(n,s).then(function(n){if(V.call(i,n),r.length)i.options.relative&&(r=[r[0]*n.naturalWidth/100,r[1]*n.naturalHeight/100,r[2]*n.naturalWidth/100,r[3]*n.naturalHeight/100]);else{var a,s,o=m(n),l=i.elements.viewport.getBoundingClientRect(),u=l.width/l.height;o.width/o.height>u?a=(s=o.height)*u:(a=o.width,s=o.height/u);var c=(o.width-a)/2,h=(o.height-s)/2,d=c+a,f=h+s;i.data.points=[c,h,d,f]}i.data.orientation=e.orientation||1,i.data.points=r.map(function(e){return parseFloat(e)}),i.options.useCanvas&&U.call(i,i.data.orientation),M.call(i),P.call(i),t&&t()})}function Y(e,t){return parseFloat(e).toFixed(t||0)}function W(){var e=this.elements.preview.getBoundingClientRect(),t=this.elements.viewport.getBoundingClientRect(),n=t.left-e.left,i=t.top-e.top,r=(t.width-this.elements.viewport.offsetWidth)/2,a=(t.height-this.elements.viewport.offsetHeight)/2,s=n+this.elements.viewport.offsetWidth+r,o=i+this.elements.viewport.offsetHeight+a,l=this._currentZoom;(l===1/0||isNaN(l))&&(l=1);var u=this.options.enforceBoundary?0:-1/0;return n=Math.max(u,n/l),i=Math.max(u,i/l),s=Math.max(u,s/l),o=Math.max(u,o/l),{points:[Y(n),Y(i),Y(s),Y(o)],zoom:l,orientation:this.data.orientation}}var z={type:"canvas",format:"png",quality:1},X=["jpeg","webp","png"];function $(e){var t=this,n=W.call(t),i=c(c({},z),c({},e)),r="string"==typeof e?e:i.type||"base64",a=i.size||"viewport",s=i.format,o=i.quality,l=i.backgroundColor,u="boolean"==typeof i.circle?i.circle:"circle"===t.options.viewport.type,h=t.elements.viewport.getBoundingClientRect(),d=h.width/h.height;return"viewport"===a?(n.outputWidth=h.width,n.outputHeight=h.height):(void 0===a?"undefined":(0,Q._)(a))==="object"&&(a.width&&a.height?(n.outputWidth=a.width,n.outputHeight=a.height):a.width?(n.outputWidth=a.width,n.outputHeight=a.width/d):a.height&&(n.outputWidth=a.height*d,n.outputHeight=a.height)),X.indexOf(s)>-1&&(n.format="image/"+s,n.quality=o),n.circle=u,n.url=t.data.url,n.backgroundColor=l,new Promise(function(e){switch(r.toLowerCase()){case"rawcanvas":e(j.call(t,n));break;case"canvas":case"base64":e(K.call(t,n));break;case"blob":H.call(t,n).then(e);break;default:e(G.call(t,n))}})}function Z(){M.call(this)}function J(e){if(!this.options.useCanvas||!this.options.enableOrientation)throw"Croppie: Cannot rotate without enableOrientation && EXIF.js included";var t,n,i,r,a=this.elements.canvas;if(this.data.orientation=(t=this.data.orientation,i=(n=o.indexOf(t)>-1?o:l).indexOf(t),r=e/90%n.length,n[(n.length+i+r%n.length)%n.length]),b(a,this.elements.img,this.data.orientation),R.call(this,!0),F.call(this),Math.abs(e)/90%2==1){var s=this._originalImageHeight,u=this._originalImageWidth;this._originalImageWidth=s,this._originalImageHeight=u}}function ee(){var e;this.element.removeChild(this.elements.boundary),e=this.element,e.classList?e.classList.remove("croppie-container"):e.className=e.className.replace("croppie-container",""),this.options.enableZoom&&this.element.removeChild(this.elements.zoomerWrap),delete this.elements}if("undefined"!=typeof window&&window.jQuery){var et=window.jQuery;et.fn.croppie=function(e){if("string"!==(void 0===e?"undefined":(0,Q._)(e)))return this.each(function(){var t=new en(this,e);t.$=et,et(this).data("croppie",t)});var t=Array.prototype.slice.call(arguments,1),n=et(this).data("croppie");return"get"===e?n.get():"result"===e?n.result.apply(n,t):"bind"===e?n.bind.apply(n,t):this.each(function(){var n=et(this).data("croppie");if(n){var i=n[e];if(et.isFunction(i))i.apply(n,t),"destroy"===e&&et(this).removeData("croppie");else throw"Croppie "+e+" method not found"}})}}function en(e,t){if(e.className.indexOf("croppie-container")>-1)throw Error("Croppie: Can't initialize croppie more than once");if(this.element=e,this.options=c(c({},en.defaults),t),"img"===this.element.tagName.toLowerCase()){var n=this.element;f(n,"cr-original-image"),v(n,{"aria-hidden":"true",alt:""});var i=document.createElement("div");this.element.parentNode.appendChild(i),i.appendChild(n),this.element=i,this.options.url=this.options.url||n.src}if(T.call(this),this.options.url){var r={url:this.options.url,points:this.options.points};delete this.options.url,delete this.options.points,q.call(this,r)}}return en.defaults={viewport:{width:100,height:100,type:"square"},boundary:{},orientationControls:{enabled:!0,leftClass:"",rightClass:""},resizeControls:{width:!0,height:!0},customClass:"",showZoomer:!0,enableZoom:!0,enableResize:!1,mouseWheelZoom:!0,enableExif:!1,enforceBoundary:!0,enableOrientation:!1,enableKeyMovement:!0,update:function(){}},en.globals={translate:"translate3d"},c(en.prototype,{bind:function(e,t){return q.call(this,e,t)},get:function(){var e=W.call(this),t=e.points;return this.options.relative&&(t[0]/=this.elements.img.naturalWidth/100,t[1]/=this.elements.img.naturalHeight/100,t[2]/=this.elements.img.naturalWidth/100,t[3]/=this.elements.img.naturalHeight/100),e},result:function(e){return $.call(this,e)},refresh:function(){return Z.call(this)},setZoom:function(e){A.call(this,e),h(this.elements.zoomer)},rotate:function(e){J.call(this,e)},destroy:function(){return ee.call(this)}}),en},"function"==typeof define&&define.amd?define(T):"string"!=typeof sS.nodeName?sS=T():b.Croppie=T();var sA=function(e){"use strict";function t(e,n){var i;return(0,K._)(this,t),s_(i=(0,G._)(this,t,[e,ap(rq({},n),{type:"profile_photo"})]),"cropTarget",null),s_(i,"error",null),s_(i,"blob",null),i.input=e.querySelectorAll("input")[0],i.cropTarget=e.querySelectorAll(".cropper")[0],i.errorTarget=e.querySelectorAll(".photo-error")[0],i.existingValue=e.dataset.value,i.existingValue?(i.croppie=new(O(sS))(i.cropTarget,{enableResize:!0,enableExif:!0,viewport:{width:200,height:270},boundary:{width:300,height:300}}),i.croppie.bind({url:i.existingValue}),i.cropTarget.classList.add("active")):i.croppie=new(O(sS))(i.cropTarget,{enableResize:!0,enableExif:!0,viewport:{width:200,height:270},boundary:{width:300,height:300}}),i.cropTarget.addEventListener("update",function(e){i.croppie.result("blob").then(function(e){i.blob=e})}),i.input.addEventListener("change",(function(){var e=i.input;if(i.element.classList.remove("has-error"),e.files&&e.files[0]){var t=new FileReader;t.onload=function(e){i.cropTarget.classList.add("active"),i.croppie.bind({url:e.target.result}).then(function(){})},t.readAsDataURL(e.files[0])}}).bind(i)),i}return(0,W._)(t,e),(0,H._)(t,[{key:"getValue",value:function(){return this.blob}},{key:"isValid",value:function(){return!this.isRequired||null!==this.blob}}]),t}(aZ),G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),Q=N("16gB1"),G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),Q=N("16gB1"),sL=function(e){"use strict";function t(e,n){var i,r,a,s;return(0,K._)(this,t),r=i=(0,G._)(this,t,[e,n]),(a="symbol"==(void 0===(s=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(a="number","string"))?"undefined":(0,Q._)(s))?s:s+"")in r?Object.defineProperty(r,a,{value:null,enumerable:!0,configurable:!0,writable:!0}):r[a]=null,i.number=e.querySelectorAll(".question-number")[0],i}return(0,W._)(t,e),(0,H._)(t,[{key:"setNumber",value:function(e){this.number.innerHTML=e}},{key:"deactivate",value:function(){this.element.classList.remove("active")}},{key:"activate",value:function(){this.element.classList.remove("active"),this.element.classList.add("active")}},{key:"isActive",value:function(){return this.element.classList.contains("active")}},{key:"isValid",value:function(){return!(this.isRequired&&this.isActive())||""!==this.getValue().trim()}}]),t}(aZ);function sw(e,t,n){var i;return(t="symbol"==(void 0===(i=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?"undefined":(0,Q._)(i))?i:i+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var sI=function(e){"use strict";function t(e,n){(0,K._)(this,t),sw(i=(0,G._)(this,t,[e,ap(rq({},n),{type:"survey_checkbox"})]),"options",[]),sw(i,"other",null);for(var i,r=i.element.getElementsByClassName("form-check-input"),a=0;a<r.length;a++)i.options.push(r[a]),r[a].addEventListener("click",i.handleChanges.bind(i));var s=i.element.getElementsByClassName("checkbox-other");return s.length&&(i.other=s[0],i.other.addEventListener("keyup",i.handleChanges.bind(i))),i}return(0,W._)(t,e),(0,H._)(t,[{key:"getValue",value:function(){var e=[];return this.options.forEach(function(t){t.checked&&e.push(t.value)}),this.other&&this.other.value.length&&e.push(this.other.value),e.join(", ")}}]),t}(sL),G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),Q=N("16gB1"),sR=function(e){"use strict";function t(e,n){var i;(0,K._)(this,t),r=o=(0,G._)(this,t,[e,ap(rq({},n),{type:"survey_radio_boxes"})]),s=[],(a="symbol"==(void 0===(i=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(a="options","string"))?"undefined":(0,Q._)(i))?i:i+"")in r?Object.defineProperty(r,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[a]=s;for(var r,a,s,o,l=o.element.getElementsByClassName("question-option"),u=0;u<l.length;u++)o.options.push(l[u]);return o.options.forEach(function(e){e.addEventListener("click",function(){o.options.forEach(function(e){return e.classList.remove("active")}),e.classList.add("active"),o.handleChanges(o)})}),o}return(0,W._)(t,e),(0,H._)(t,[{key:"getValue",value:function(){var e="";return this.options.forEach(function(t){t.classList.contains("active")&&(e=t.dataset.value)}),e}}]),t}(sL),G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),Q=N("16gB1");function sD(e,t,n){var i;return(t="symbol"==(void 0===(i=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?"undefined":(0,Q._)(i))?i:i+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var sC=function(e){"use strict";function t(e,n){(0,K._)(this,t),sD(i=(0,G._)(this,t,[e,ap(rq({},n),{type:"survey_select"})]),"select",null),sD(i,"other",null),i.select=e.querySelectorAll("select")[0];var i,r=i.element.getElementsByClassName("survey-other");return r.length&&(i.other=r[0],i.other.addEventListener("keyup",i.handleChanges.bind(i))),i.select.addEventListener("change",function(){i.other&&"Other"===i.select.value?i.other.classList.add("active"):i.other&&i.other.classList.remove("active"),i.handleChanges(i)}),i}return(0,W._)(t,e),(0,H._)(t,[{key:"getValue",value:function(){var e=this.select.value;return this.other&&"Other"===e?"Other: "+this.other.value:this.select.value}}]),t}(sL),G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),sx=function(e){"use strict";function t(e,n){var i;return(0,K._)(this,t),(i=(0,G._)(this,t,[e,ap(rq({},n),{type:"survey_text"})])).input=e.querySelectorAll("textarea")[0],i.input.addEventListener("keyup",i.handleChanges.bind(i)),i}return(0,W._)(t,e),(0,H._)(t,[{key:"getValue",value:function(){return this.input?this.input.value:""}},{key:"setValue",value:function(e){this.input.value=e}}]),t}(sL);function sP(e,t,n){var i;return(t="symbol"==(void 0===(i=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?"undefined":(0,Q._)(i))?i:i+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var sO=function(){"use strict";function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"data-field-name";(0,K._)(this,e),sP(this,"firstValidated",!1),sP(this,"onValidate",null),sP(this,"name",null),sP(this,"fields",[]),sP(this,"map",{radios:sk,checkbox:aJ,checkbox_other:a0,input:sb,date:sy,select:sT,profile_photo:sA,survey_checkboxes:sI,survey_radio_boxes:sR,survey_select:sC,survey_text:sx}),this.onValidate=n;var r=t.querySelectorAll("[".concat(i,"]"));this.name=t.getAttribute("name");for(var a=0;a<r.length;a++){var s=r[a],o=s.dataset.fieldName||s.dataset.surveyFieldName,l=s.dataset.fieldType,u="1"===s.dataset.fieldRequired,c=void 0!==this.map[l]?this.map[l]:null;c&&this.fields.push(new c(s,{name:o,isRequired:u}))}}return(0,H._)(e,[{key:"validate",value:function(){var e=!0;return this.fields.forEach(function(t){t.validate(),e=e&&t.isValid()}),this.firstValidated||e||(this.firstValidated=!0,this.validateOnChange()),this.onValidate&&this.onValidate(e),e}},{key:"validateOnChange",value:function(){var e=this;this.fields.forEach(function(t){return t.onChange(e.validate.bind(e))})}},{key:"setValue",value:function(e,t){this.fields.forEach(function(n){n.getName()===e&&n.setValue(t)})}},{key:"getFields",value:function(){return this.fields}},{key:"getRequiredFields",value:function(){var e=[];return this.fields.forEach(function(t){t.isRequired&&e.push(t)}),e}},{key:"getDataObject",value:function(){var e={};return this.fields.forEach(function(t){t.getValue()&&(e[t.getName()]=t.getValue())}),e}},{key:"getData",value:function(){var e=new FormData,t=this.getDataObject();return Object.keys(t).forEach(function(n){e.append(n,t[n])}),e}}]),e}(),G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),Q=N("16gB1");function sM(e,t,n){var i;return(t="symbol"==(void 0===(i=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?"undefined":(0,Q._)(i))?i:i+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var sF=function(e){"use strict";function t(e,n){var i;return(0,K._)(this,t),sM(i=(0,G._)(this,t,[e,n,"data-survey-field-name"]),"answerMap",{}),sM(i,"hasMainQuestion",null),i.answerMap=JSON.parse(atob(e.dataset.answerMap)),i.hasMainQuestion="1"===e.dataset.hasMainQuestion,i.showSurveyQuestions(),i.fields.forEach(function(e){return e.onChange(i.showSurveyQuestions.bind(i))}),i}return(0,W._)(t,e),(0,H._)(t,[{key:"showSurveyQuestions",value:function(){var e=this,t=0,n=function(e){e.activate(),e.setNumber(t+1),t++},i=function(t){return t.getName().replace(e.name+"__","")},r=null,a=function(t){"1"===t.element.dataset.isMainQuestion&&(r=t.getValue(),n(t)),r&&e.answerMap[r]&&e.answerMap[r].includes(i(t))&&n(t)},s=function(t){e.questionHasAnswer("why_attend","network")&&n(t),e.questionHasAnswer("private_why_attend","network")&&n(t)},o=function(t){e.questionHasAnswer("private_why_attend","investment")&&n(t)};this.hasMainQuestion?this.fields.forEach(function(e){switch(e.deactivate(),i(e)){case"why_attend_networking_details":s(e);break;case"why_attend_investment_opportunities":o(e);break;default:a(e)}}):this.fields.forEach(function(e){e.deactivate(),n(e)})}},{key:"getRequiredFields",value:function(){var e=[];return this.fields.forEach(function(t){t.isRequired&&t.isActive()&&e.push(t)}),e}},{key:"questionHasAnswer",value:function(e,t){var n,i=this.getDataObject(),r=t.toLowerCase().trim(),a=null!=(n=i["survey__"+e])?n:"";return(a=a.toLowerCase().trim()).includes(r)}},{key:"getDataObject",value:function(){var e={};return this.fields.forEach(function(t){t.isActive()&&(e[t.getName()]=t.getValue())}),e}}]),t}(sO),G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),q=N("fd2TQ"),Y=N("drHcY"),W=N("3w2eu"),K=N("6M8s5"),H=N("8ro5P"),Q=N("16gB1"),sN="https://js.stripe.com/v3",sB=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,sU=function(){for(var e=document.querySelectorAll('script[src^="'.concat(sN,'"]')),t=0;t<e.length;t++){var n=e[t];if(sB.test(n.src))return n}return null},sj=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(sN).concat(t);var i=document.head||document.body;if(!i)throw Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return i.appendChild(n),n},sG=function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"4.6.0",startTime:t})},sK=null,sH=null,sV=null,sq=function(e,t,n){if(null===e)return null;var i=e.apply(void 0,t);return sG(i,n),i},sY=!1,sW=function(){return x?x:x=(null!==sK?sK:(sK=new Promise(function(e,t){if("undefined"==typeof window||"undefined"==typeof document)return void e(null);if(window.Stripe,window.Stripe)return void e(window.Stripe);try{var n,i=sU();i?i&&null!==sV&&null!==sH&&(i.removeEventListener("load",sV),i.removeEventListener("error",sH),null==(n=i.parentNode)||n.removeChild(i),i=sj(null)):i=sj(null),sV=function(){window.Stripe?e(window.Stripe):t(Error("Stripe.js not available"))},sH=function(){t(Error("Failed to load Stripe.js"))},i.addEventListener("load",sV),i.addEventListener("error",sH)}catch(e){t(e);return}})).catch(function(e){return sK=null,Promise.reject(e)})).catch(function(e){return x=null,Promise.reject(e)})};Promise.resolve().then(function(){return sW()}).catch(function(e){sY||console.warn(e)});var sz=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];sY=!0;var i=Date.now();return sW().then(function(e){return sq(e,t,i)})};function sX(e,t,n){var i;return(t="symbol"==(void 0===(i=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?"undefined":(0,Q._)(i))?i:i+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var sQ=function(){"use strict";function e(t){var n=t.stripeKey,i=t.intentSecret,r=t.intentId,a=t.element;(0,K._)(this,e),sX(this,"stripe",null),sX(this,"intentSecret",null),sX(this,"intentId",null),sX(this,"isValid",!1),sX(this,"error",null),sX(this,"card",null),sX(this,"changeListeners",[]),this.stripeKey=n,this.intentSecret=i,this.intentId=r,this.element=a,this.setup()}return(0,H._)(e,[{key:"setup",value:function(){return j(function(){var e,t,n,i,r;return $(this,function(a){switch(a.label){case 0:return e=document.getElementsByTagName("body")[0],window.getComputedStyle(e).getPropertyValue("font-size"),t=this,[4,sz(this.stripeKey)];case 1:return t.stripe=a.sent(),n=this.stripe.elements({fonts:[{cssSrc:"https://cfc-stmoritz.com/assets/stripe/font.css"}],locale:"en"}),i={base:{iconColor:"#000000",color:"#000000",fontFamily:"'Brown', sans-serif",fontSmoothing:"antialiased",paddingTop:"9px",paddingBottom:"14px",fontSize:"18px","::selection":{backgroundColor:"rgb(239, 239, 239)"},"::placeholder":{color:"#6b7280"},":-webkit-autofill":{color:"#000000"}},invalid:{color:"#000000",iconColor:"#000000"}},(r=n.create("card",{style:i})).addEventListener("change",this.handleChange.bind(this)),r.mount("#card-element"),this.card=r,[2]}})}).call(this)}},{key:"onChange",value:function(e){this.changeListeners.push(e)}},{key:"handleChanges",value:function(){var e=this;this.changeListeners.forEach(function(t){return t(e)})}},{key:"validate",value:function(){return this.element.classList.remove("has-error"),!!this.isValid||(this.element.classList.add("has-error"),!1)}},{key:"handleChange",value:function(e){e.error?(this.error=e.error.message,this.isValid=!1):(this.isValid=!0,this.error=null),this.validate(),this.handleChanges()}},{key:"submit",value:function(e,t){var n=e.firstName,i=e.lastName,r={receipt_email:e.email,payment_method_data:{billing_details:{name:"".concat(n," ").concat(i)}}};this.stripe.handleCardPayment(this.intentSecret,this.card,r).then(t)}}]),e}(),s$=function(e){"use strict";function t(e,n){(0,K._)(this,t);var i=(0,G._)(this,t,[e,n]),r=e.dataset;return i.stripe=new sQ({stripeKey:r.stripeKey,intentId:r.intentId,intentSecret:r.intentSecret,element:document.getElementById("card-element-container")}),i}return(0,W._)(t,e),(0,H._)(t,[{key:"validate",value:function(){var e=(0,q._)((0,Y._)(t.prototype),"validate",this).call(this),n=this.stripe.validate();return e&&n}},{key:"submit",value:function(e){var t=this.getDataObject(),n={firstName:t.billing__first_name,lastName:t.billing__last_name,email:t.billing__email};this.stripe.submit(n,e)}}]),t}(sO);function sZ(e,t,n){var i;return(t="symbol"==(void 0===(i=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?"undefined":(0,Q._)(i))?i:i+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var sJ=function(e){"use strict";function t(){for(var e,n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];return(0,K._)(this,t),sZ(e=(0,G._)(this,t,(0,X._)(i)),"forms",[]),sZ(e,"formNames",[]),sZ(e,"paymentHandler",null),sZ(e,"submitting",!1),sZ(e,"handlers",{"form-fields":sO,"survey-form-fields":sF,"payment-form-fields":s$}),e}return(0,W._)(t,e),(0,H._)(t,[{key:"connect",value:function(){var e=this;this.action=this.element.dataset.action,this.step=this.element.dataset.step,this.t=this.element.dataset.t,this.s=this.element.dataset.s;var t=(0,X._)(this.element.getElementsByTagName("form"));this.messages=JSON.parse(atob(this.element.dataset.messages)),t.forEach(function(t){t.addEventListener("submit",function(e){return e.preventDefault()});var n,i,r=t.getAttribute("name"),a=null!=(n=t.dataset.handler)?n:"form-fields",s=new(null!=(i=e.handlers[a])?i:sO)(t);"payment-form-fields"===a&&(e.paymentHandler=s),e.formNames.push(r),e.forms.push({name:r,element:t,handler:s})})}},{key:"disconnect",value:function(){this.forms.forEach(function(e){e.removeEventListener("submit",function(e){return e.preventDefault()})})}},{key:"next",value:function(e){return j(function(){var t,n,i;return $(this,function(r){return t=this,this.submitting||((e.preventDefault(),this.submitting=!0,n=!0,(i=new FormData).append("step",this.step),this.s.length&&i.append("s",this.s),this.t.length&&i.append("t",this.t),this.formNames.length&&i.append("forms",this.formNames),this.forms.forEach(function(e){e.name;var t=e.handler.validate();if(n=n&&t,t){var r=e.handler.getDataObject();console.log(r),Object.keys(r).forEach(function(e){i.append(e,r[e])})}}),n)?(this.resetError(),this.paymentHandler?this.paymentHandler.submit(function(e){e.error?(t.submitting=!1,t.showError(e.error.message)):t._doNext(i)}):this._doNext(i)):(this.submitting=!1,this.showError(this.messages.required))),[2]})}).call(this)}},{key:"showError",value:function(e){this.errorTarget.innerHTML=e}},{key:"resetError",value:function(){this.errorTarget.innerHTML=""}},{key:"_doNext",value:function(e){var t=this;aX.post(this.action,e,{headers:{"content-type":"multipart/form-data"}}).then(function(e){t.submitting=!1,e.data&&e.data.redirect&&(window.location.href=e.data.redirect)}).catch(function(e){t.submitting=!1,e.response&&e.response.data&&e.response.data.error?t.showError(e.response.data.error):t.showError(t.messages.unknown)})}}]),t}(eZ);sZ(sJ,"targets",["error"]);var G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),X=N("l9etm"),Q=N("16gB1");function s0(e,t,n){var i;return(t="symbol"==(void 0===(i=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?"undefined":(0,Q._)(i))?i:i+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}N("gkaGM");var s1=function(e){"use strict";function t(){for(var e,n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];return(0,K._)(this,t),s0(e=(0,G._)(this,t,(0,X._)(i)),"landscape",{2560:"2560x1440"}),s0(e,"portrait",{1080:"810x1440"}),e}return(0,W._)(t,e),(0,H._)(t,[{key:"connect",value:function(){this.videoName=null,this.fileName=null,window.addEventListener("resize",e2(this.init.bind(this))),this.init()}},{key:"disconnect",value:function(){window.removeEventListener("resize",e2(this.init.bind(this)))}},{key:"init",value:function(){if(window){var e=e0(window),t=e.w,n=e.h,i=this.element.dataset.videoName;i=t>n?i:i+"_portrait";var r=t>n?this.landscape:this.portrait,a=!1;Object.keys(r).forEach(function(e,n){!a&&(e>t||n===Object.keys(r).length-1)&&(a=r[e])}),(this.videoName!==i||this.fileName!==a)&&(this.videoTarget.poster=this.getVideoPoster(i,a),console.log(this.getCroppedSource(i,a)),this.videoTarget.src=this.getCroppedSource(i,a))}}},{key:"getVideoPoster",value:function(e,t){return"/assets/video/".concat(e,"/segmented/").concat(t,"/poster.jpg")}},{key:"getSegmentedSource",value:function(e,t){return"/assets/video/".concat(e,"/segmented/").concat(t,"/index.m3u8")}},{key:"getCroppedSource",value:function(e,t){return"/assets/video/".concat(e,"/cropped/").concat(t,".mp4?v=1")}}]),t}(eZ);s0(s1,"targets",["video"]);var G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),Q=N("16gB1"),s2=function(e){"use strict";function t(){return(0,K._)(this,t),(0,G._)(this,t,arguments)}return(0,W._)(t,e),(0,H._)(t,[{key:"connect",value:function(){var e=this,t=JSON.parse(atob(this.element.dataset.infiniteScrollConfig));this.loading=!1,this.id=t.id,this.page=t.page,this.total=t.total,new IntersectionObserver(function(t){t[0].intersectionRatio<=0||e.load()}).observe(this.moreTarget)}},{key:"load",value:function(){var e=this;if(!this.loading){this.loading=!0;var t="?infinite-scroll=1&".concat(this.id,"_page=").concat(this.page+1),n="scroll_".concat(this.id);fetch(t).then(function(e){return e.text()}).then(function(t){var i=new DOMParser().parseFromString(t,"text/html").getElementById(n);e.containerTarget.insertAdjacentHTML("beforeend",i.innerHTML),e.page=e.page+1,e.page>=e.total&&(e.moreTarget.classList.add("hidden"),e.interactionObserver.unobserve(e.moreTarget)),e.loading=!1})}}},{key:"disconnect",value:function(){this.interactionObserver&&this.interactionObserver.unobserve(this.moreTarget)}}]),t}(eZ);_=["container","more"],(S="symbol"==(void 0===(o=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(S="targets","string"))?"undefined":(0,Q._)(o))?o:o+"")in s2?Object.defineProperty(s2,S,{value:_,enumerable:!0,configurable:!0,writable:!0}):s2[S]=_;var G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),Q=N("16gB1"),s3={};s3=(function e(t,n,i){function r(s,o){if(!n[s]){if(!t[s]){var l=void 0;if(!o&&l)return l(s,!0);if(a)return a(s,!0);var u=Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){return r(t[s][1][e]||e)},c,c.exports,e,t,n,i)}return n[s].exports}for(var a=void 0,s=0;s<i.length;s++)r(i[s]);return r})({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.create=n.visible=void 0;var i=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.createElement("div");return n.innerHTML=e.trim(),!0===t?n.children:n.firstChild},r=function(e,t){var n=e.children;return 1===n.length&&n[0].tagName===t},a=function(e){return null!=(e=e||document.querySelector(".basicLightbox"))&&!0===e.ownerDocument.body.contains(e)};n.visible=a,n.create=function(e,t){var n,s,o,l,u,c,h,d=(n=e=function(e){var t="string"==typeof e,n=e instanceof HTMLElement==1;if(!1===t&&!1===n)throw Error("Content must be a DOM element/node or string");return!0===t?Array.from(i(e,!0)):"TEMPLATE"===e.tagName?[e.content.cloneNode(!0)]:Array.from(e.children)}(e),s=t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(null==(e=Object.assign({},e)).closable&&(e.closable=!0),null==e.className&&(e.className=""),null==e.onShow&&(e.onShow=function(){}),null==e.onClose&&(e.onClose=function(){}),"boolean"!=typeof e.closable)throw Error("Property `closable` must be a boolean");if("string"!=typeof e.className)throw Error("Property `className` must be a string");if("function"!=typeof e.onShow)throw Error("Property `onShow` must be a function");if("function"!=typeof e.onClose)throw Error("Property `onClose` must be a function");return e}(t),l=(o=i('\n		<div class="basicLightbox '.concat(s.className,'">\n			<div class="basicLightbox__placeholder" role="dialog"></div>\n		</div>\n	'))).querySelector(".basicLightbox__placeholder"),n.forEach(function(e){return l.appendChild(e)}),u=r(l,"IMG"),c=r(l,"VIDEO"),h=r(l,"IFRAME"),!0===u&&o.classList.add("basicLightbox--img"),!0===c&&o.classList.add("basicLightbox--video"),!0===h&&o.classList.add("basicLightbox--iframe"),o),f=function(e){var n;return!1!==t.onClose(v)&&(n=function(){if("function"==typeof e)return e(v)},d.classList.remove("basicLightbox--visible"),setTimeout(function(){return!1===a(d)||d.parentElement.removeChild(d),n()},410),!0)};!0===t.closable&&d.addEventListener("click",function(e){e.target===d&&f()});var v={element:function(){return d},visible:function(){return a(d)},show:function(e){var n;return!1!==t.onShow(v)&&(n=function(){if("function"==typeof e)return e(v)},document.body.appendChild(d),setTimeout(function(){requestAnimationFrame(function(){return d.classList.add("basicLightbox--visible"),n()})},10),!0)},close:f};return v}},{}]},{},[1])(1);var s5=function(e){"use strict";function t(){return(0,K._)(this,t),(0,G._)(this,t,arguments)}return(0,W._)(t,e),(0,H._)(t,[{key:"connect",value:function(){var e=this.imageTarget,t=this.element.dataset.lightboxUrl;this.lightbox=s3.create('<img src="'.concat(t,'"  alt="').concat(e.alt,'" sizes="100vw">'))}},{key:"open",value:function(){this.lightbox.show()}}]),t}(eZ);L=["image"],(A="symbol"==(void 0===(l=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(A="targets","string"))?"undefined":(0,Q._)(l))?l:l+"")in s5?Object.defineProperty(s5,A,{value:L,enumerable:!0,configurable:!0,writable:!0}):s5[A]=L;var G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),Q=N("16gB1"),s4=function(e){"use strict";function t(){return(0,K._)(this,t),(0,G._)(this,t,arguments)}return(0,W._)(t,e),(0,H._)(t,[{key:"connect",value:function(){this.lastScrollTop=0,"home"===this.element.dataset.template&&(window.addEventListener("scroll",e2(this.init.bind(this)),{passive:!0}),this.init())}},{key:"handleScroll",value:function(){var e=e1(window);if(this.element.classList.remove("has-scrolled"),e>20){this.element.classList.contains("has-scrolled")||this.element.classList.add("has-scrolled");var t=this.navElementTarget.offsetHeight,n=this.heroTarget.offsetHeight-t,i=e>n?1:(e/n).toFixed(2);this.underlayTarget.style.opacity=i}}},{key:"init",value:function(){if("none"!==getComputedStyle(this.element.parentElement).display){var e=e0(window),t=e1(window);t>0&&"none"===getComputedStyle(this.logoTarget).display&&(this.logoTarget.style.display="");var n=t/(.05*e.h);n>=1?(this.underlayTarget.style.opacity=1,this.logoTarget.style.opacity=1):(this.underlayTarget.style.opacity=n,this.logoTarget.style.opacity=n)}}},{key:"disconnect",value:function(){window.removeEventListener("scroll",e2(this.init.bind(this)))}}]),t}(eZ);I=["navElement","hero","underlay","logo"],(w="symbol"==(void 0===(u=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(w="targets","string"))?"undefined":(0,Q._)(u))?u:u+"")in s4?Object.defineProperty(s4,w,{value:I,enumerable:!0,configurable:!0,writable:!0}):s4[w]=I;var G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),X=N("l9etm"),Q=N("16gB1");function s8(e,t,n){var i;return(t="symbol"==(void 0===(i=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?"undefined":(0,Q._)(i))?i:i+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s6=function(e){"use strict";function t(){for(var e,n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];return(0,K._)(this,t),s8(e=(0,G._)(this,t,(0,X._)(i)),"messages",{}),s8(e,"action",null),s8(e,"steps",[]),e}return(0,W._)(t,e),(0,H._)(t,[{key:"connect",value:function(){this.form=new sO(this.formTarget),this.messages=JSON.parse(atob(this.element.dataset.messages)),this.action=this.element.dataset.action;for(var e=this.element.getElementsByClassName("newsletter-step"),t=0;t<e.length;t++)this.steps.push(e[t])}},{key:"next",value:function(e){return j(function(){var t,n,i,r;return $(this,function(a){return(t=this,e.preventDefault(),this.form.validate())?(n=function(e){t.resetError(),t.steps[0].classList.remove("active"),t.steps[1].classList.add("active")},i=function(e){e.response&&e.response.data&&e.response.data.error?t.showError(e.response.data.error):t.showError(t.messages.unknown)},r=this.form.getData(),aX.post(this.action,r).then(n).catch(i)):this.showError(this.messages.required),[2]})}).call(this)}},{key:"showError",value:function(e){this.errorTarget.innerHTML=e}},{key:"resetError",value:function(){this.errorTarget.innerHTML=""}}]),t}(eZ);s8(s6,"targets",["error","form"]);var G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),X=N("l9etm"),Q=N("16gB1");function s9(e,t,n){var i;return(t="symbol"==(void 0===(i=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?"undefined":(0,Q._)(i))?i:i+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s7=function(e){"use strict";function t(){for(var e,n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];return(0,K._)(this,t),s9(e=(0,G._)(this,t,(0,X._)(i)),"input",null),s9(e,"error",null),e}return(0,W._)(t,e),(0,H._)(t,[{key:"connect",value:function(){for(var e=this.element.getElementsByClassName("reduction-input"),t=0;t<e.length;t++){this.input=e[t];break}this.input.addEventListener("input",this.resetError.bind(this));for(var n=this.element.getElementsByClassName("reduction-error"),i=0;i<n.length;i++){this.error=n[i];break}}},{key:"disconnect",value:function(){this.input.removeEventListener("input",this.resetError.bind(this))}},{key:"resetError",value:function(){this.error.innerHTML=""}},{key:"showError",value:function(e){this.error.innerHTML=e}},{key:"apply",value:function(e){var t=this;e.preventDefault(),this.input&&this.input.value.length&&fetch(this.element.getAttribute("data-end-point")+this.input.value).then(function(e){return e.json()}).then(function(e){e.error&&t.showError(e.message),e.html&&(t.summaryTarget.innerHTML=e.html),t.input.value=""}).catch(function(e){t.showError("An unknown error ocurred")})}}]),t}(eZ);s9(s7,"targets",["summary"]);var G=N("375Sc"),K=N("6M8s5"),H=N("8ro5P"),W=N("3w2eu"),X=N("l9etm"),Q=N("16gB1");function oe(e,t,n){var i;return(t="symbol"==(void 0===(i=function(e,t){if("object"!=(void 0===e?"undefined":(0,Q._)(e))||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(void 0===i?"undefined":(0,Q._)(i)))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?"undefined":(0,Q._)(i))?i:i+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ot=function(e){"use strict";function t(){for(var e,n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];return(0,K._)(this,t),oe(e=(0,G._)(this,t,(0,X._)(i)),"toggles",[]),oe(e,"items",[]),e}return(0,W._)(t,e),(0,H._)(t,[{key:"connect",value:function(){for(var e=this.element.children[0].children,t=0;t<e.length;t++)e[t].classList.contains("tab-toggle")&&this.toggles.push(e[t]);for(var n=this.element.children,i=0;i<n.length;i++)n[i].classList.contains("tab-item")&&this.items.push(n[i])}},{key:"reset",value:function(e){this.toggles.forEach(function(e){e.classList.remove("active")}),this.items.forEach(function(e){e.classList.remove("active")})}},{key:"toggle",value:function(e){var t=e.currentTarget,n=t.dataset.tabToggleId,i=null;this.items.forEach(function(e){e.dataset.tabItemId===n&&(i=e)}),i&&(this.reset(),i.classList.add("active"),t.classList.add("active"))}}]),t}(eZ);oe(ot,"targets",["toggles"]);var on=eK.start();on.register("accordion",eJ),on.register("burger",e3),on.register("carousel",tg),on.register("cookie-consent",tm),on.register("countdown",iu),on.register("form-step",sJ),on.register("header-video",s1),on.register("infinite-scroll",s2),on.register("lightbox",s5),on.register("reduction-code",s7),on.register("nav",s4),on.register("newsletter",s6),on.register("tabs",ot),on.register("tag-filter",il)}();
//# sourceMappingURL=main.js.map
